{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeActionContributions.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/lightBulbWidget.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeActionMenu.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeActionUi.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeActionModel.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeActionCommands.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/colorPicker/colorPickerWidget.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/colorPicker/color.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codelens/codelens.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codelens/codelensWidget.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codelens/codeLensCache.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codelens/codelensController.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/contextmenu/contextmenu.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeAction.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/colorPicker/colorDetector.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/types.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/comment/blockCommentCommand.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/comment/lineCommentCommand.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/comment/comment.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/colorPicker/colorPickerModel.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/clipboard/clipboard.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/cursorUndo/cursorUndo.js"],"names":["ID","LightBulbState","__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","k","a","j","jl","CodeActionAction","_super","action","callback","_this","command","id","title","undefined","disabled","CodeActionMenu","_editor","_delegate","_contextMenuService","keybindingService","_visible","_showingActions","_register","_keybindingResolver","getKeybindings","get","enumerable","configurable","show","trigger","codeActions","at","options","actionsToShow","menuActions","anchor","resolver","_a","includeDisabledActions","allActions","validActions","getDomNode","getMenuActions","isIPosition","_toCoords","x","getResolver","showContextMenu","getAnchor","getActions","onHide","focus","autoSelectFirstItem","getKeyBinding","_b","toCodeActionAction","onSelectCodeAction","map","model","getModel","_i","_c","all","provider","_getAdditionalMenuItems","items","type","only","filter","include","position","hasModel","revealPosition","render","cursorCoords","getScrolledVisiblePosition","editorCoords","left","top","height","CodeActionKeybindingResolver","_keybindingProvider","allCodeActionBindings","item","codeActionCommands","indexOf","resolvedKeybinding","commandArgs","kind","SourceOrganizeImports","SourceFixAll","fromUser","None","binding","bestKeybindingForCodeAction","getValue","candidates","candidate","contains","preferred","isPreferred","reduceRight","currentBest","codeAction","Hidden","Showing","actions","editorPosition","widgetPosition","LightBulbWidget","_quickFixActionId","_preferredFixActionId","_keybindingService","_onClick","onClick","event","_state","_domNode","document","createElement","className","addContentWidget","onDidChangeModelContent","editorModel","state","lineNumber","getLineCount","hide","ignoreTarget","dom","preventDefault","lineHeight","getOption","pad","Math","floor","fire","posx","buttons","monitor","startMonitoring","dispose","onDidChangeConfiguration","hasChanged","enabled","_updateLightBulbTitle","onDidUpdateKeybindings","removeContentWidget","getId","getPosition","update","atPosition","getOptions","column","tabSize","fontInfo","lineContent","getLineContent","indent","computeIndentLevel","lineHasSpace","spaceWidth","isFolded","getTopForLineNumber","effectiveLineNumber","preference","_posPref","hasAutoFix","layoutContentWidget","set","preferredKb","lookupKeybinding","nls","getLabel","kb","theme","collector","editorLightBulbForegroundColor","getColor","addRule","editorLightBulbAutoFixForegroundColor","CodeActionsState","CodeActionUi","quickFixActionId","preferredFixActionId","delegate","instantiationService","_activeCodeActions","_codeActionWidget","createInstance","applyCodeAction","_lightBulbWidget","widget","showCodeActionList","newState","e_1","validActionToApply","invalidAction","_d","rawValue","tryGetValidActionToApply","context","getInvalidActionThatWouldHaveBeenApplied","showMessage","notAvailableMessage","isVisible","autoApply","SUPPORTED_CODE_ACTIONS","CodeActionOracle","_markerService","_signalChange","_delay","_autoTriggerTimer","onMarkerChanged","_onMarkerChanges","onDidChangeCursorPosition","_onCursorChange","selection","_getRangeOfSelectionUnlessWhitespaceEnclosed","_createEventAndSignalChange","resources","some","resource","uri","cancelAndSet","_getRangeOfMarker","read","marker","markerRange","validateRange","intersectRanges","lift","getSelection","isEmpty","line","test","getLineMaxColumn","getStartPosition","Empty","Triggered","rangeOrSelection","CodeActionModel","contextKeyService","_progressService","_codeActionOracle","_onDidChangeState","onDidChangeState","_supportedCodeActions","bindTo","onDidChangeModel","_update","onDidChangeModelLanguage","onDidChange","setState","has","supportedActions","isArray","providedCodeActionKinds","join","token","showWhile","reset","skipNotify","cancel","contextKeyForSupportedActions","regex","keys","RegExp","argsSchema","required","defaultSnippets","properties","description","default","enum","enumDescriptions","QuickFixController","editor","markerService","progressService","_instantiationService","_model","_ui","Id","retrigger","_applyCodeAction","_trigger","getContribution","showCodeActions","manualTriggerAtCurrentPosition","closeMessage","triggerPosition","invokeFunction","accessor","bulkEditService","commandService","telemetryService","notificationService","err_1","message","publicLog2","codeActionTitle","codeActionKind","codeActionIsPreferred","edit","executeCommand","asMessage","error","err","Error","triggerCodeActionsForEditorSelection","controller","QuickFixAction","alias","precondition","and","writable","hasCodeActionsProvider","kbOpts","kbExpr","editorTextFocus","primary","weight","run","_accessor","CodeActionCommand","args","name","schema","runEditorCommand","userArgs","includeSourceActions","onlyIncludePreferredActions","RefactorAction","mac","contextMenuOpts","group","order","when","Refactor","SourceAction","Source","OrganizeImportsAction","FixAllAction","AutoFixAction","QuickFix","$","ColorPickerHeader","container","themeService","domNode","pickedColorNode","colorBox","style","backgroundColor","Format","CSS","format","originalColor","getTheme","white","CLICK","selectNextColorPresentation","color","flushColor","onDidChangeColor","onDidChangePresentation","rgba","isLighter","textContent","presentation","ColorPickerBody","pixelRatio","saturationBox","SaturationBox","onDidSaturationValueChange","onColorFlushed","opacityStrip","OpacityStrip","onDidOpacityChange","hueStrip","HueStrip","onDidHueChange","hsva","h","layout","_onDidChange","_onColorFlushed","canvas","onMouseDown","origin","onDidChangePosition","offsetX","offsetY","posy","mouseUpListener","stopMonitoring","max","min","width","paintSelection","offsetWidth","offsetHeight","paint","saturatedColor","ctx","getContext","whiteGradient","createLinearGradient","addColorStop","blackGradient","rect","fillStyle","fill","isMonitoring","Strip","overlay","slider","updateSliderPosition","onDidChangeTop","opaque","transparent","background","ColorPickerWidget","element","appendChild","header","getColors","colors","providers","ordered","reverse","promises","provideDocumentColors","result_1","colorInfo","getColorPresentations","provideColorPresentations","rawCIs","result_2","ci","range","red","green","blue","alpha","isIRange","presentations","CodeLensModel","lenses","_disposables","add","list","symbol","getCodeLensData","providerRanks","Map","provideCodeLenses","catch","startLineNumber","startColumn","itemResolveCount","disposables","_loop_1","Boolean","resolveCodeLens","finally","setTimeout","CodeLensViewZone","afterLineNumber","onHeight","_onHeight","heightInLines","suppressMouseDown","onComputedHeight","_lastHeight","CodeLensContentWidget","allowEditorOverflow","_commands","_isEmpty","_id","_idPool","updatePosition","withCommands","animate","clear","innerHtml","hasSymbol","lens","String","innerHTML","getCommand","link","parentElement","getLineFirstNonWhitespaceColumn","_widgetPosition","CodeLensHelper","_removeDecorations","_addDecorations","_addDecorationsCallbacks","addDecoration","decoration","removeDecoration","decorationId","commit","changeAccessor","resultingDecorations","deltaDecorations","len","CodeLensWidget","data","helper","viewZoneChangeAccessor","updateCallback","_isDisposed","_className","_data","_decorationIds","forEach","codeLensData","EMPTY","plusRange","_viewZone","_viewZoneId","addZone","_createContentWidgetIfNecessary","_contentWidget","removeZone","isDisposed","isValid","getDecorationRange","updateCodeLensSymbols","computeIfNecessary","hasAttribute","updateCommands","symbols","resolved","getLineNumber","layoutZone","codeLensForeground","activeLinkForeground","ICodeLensCache","CacheItem","lineCount","CodeLensCache","storageService","_fakeProvider","class_1","_cache","oldkey","remove","raw","_deserialize","onWillSaveState","reason","SHUTDOWN","store","_serialize","put","copyItems","copyModel","toString","delete","lines","Set","JSON","stringify","parse","CodeLensContribution","_commandService","_notificationService","_codeLensCache","_globalToDispose","_localToDispose","_lenses","_oldCodeLensModels","_modelChangeCounter","_isEnabled","_onModelChange","prevIsEnabled","_updateLensStyle","_styleClassName","hash","_styleElement","getContainerDomNode","_localDispose","_currentCodeLensModel","round","fontSize","newStyle","_currentFindCodeLensSymbolsPromise","_currentResolveCodeLensSymbolsPromise","cachedLenses","_renderCodeLensSymbols","registration","scheduler","schedule","detectVisibleLenses","_detectVisibleLenses","_onViewportChanged","counterValue","changeDecorations","decorationsAccessor","changeViewZones","viewZonesAccessor","toDispose","lastLensLineNumber","l","splice","onDidScrollChange","scrollTopChanged","onDidLayoutChange","scrollState","capture","_disposeAllLenses","restore","onMouseUp","tagName","cachedLensesNow","decChangeAccessor","lastGroup","maxLineNumber","groups","viewZoneAccessor","codeLensIndex","groupsIndex","symbolsLineNumber","codeLensLineNumber","toResolve","request","resolvePromise","resolvedSymbols","isCancellationRequested","ContextMenuController","_contextViewService","_contextKeyService","_menuService","_toDispose","_contextMenuIsBeingShownCount","onContextMenu","_onContextMenu","onMouseWheel","hideContextView","onKeyDown","keyCode","stopPropagation","containsPosition","setPosition","hasSelectionAtPosition","getSelections","_getMenuActions","_doShowContextMenu","menuId","menu","createMenu","arg","groups_1","addedItems","actions_1","subActions","submenu","oldHoverSetting","updateOptions","hover","getActionViewItem","keybinding","_keybindingFor","isMenu","customActionViewItem","icon","wasCancelled","ShowContextMenu","textInputFocus","contribution","codeActionCommandId","refactorCommandId","sourceActionCommandId","organizeImportsCommandId","fixAllCommandId","ManagedCodeActionSet","codeActionsComparator","diagnostics","localeCompare","fix","getCodeActions","codeActionContext","cts","getCodeActionProviders","providedCodeActions","provideCodeActions","listener","newProviders","validatedRangeOrSelection","codeActionSet","isISelection","liftSelection","MAX_DECORATORS","ColorDetector","_codeEditorService","_configurationService","_decorationsIds","_colorDatas","_colorDecoratorIds","_decorationsTypes","isEnabled","onModelChanged","removeAllDecorations","_timeoutTimer","_computePromise","languageId","getLanguageIdentifier","deprecatedConfig","language","colorDecorators","stop","beginCompute","RECOMPUTE_TIME","colorInfos","updateDecorations","updateColorDecorators","colorDatas","decorations","endLineNumber","endColumn","colorData","newDecorationsTypes","subKey","registerDecorationType","before","contentText","border","margin","dark","resolveDecorationOptions","subType","removeDecorationType","getColorData","getDecorationsInRange","fromPositions","CodeActionKind","equals","other","sep","intersects","append","part","mayIncludeActionsOfKind","providedKind","excludes","exclude","excludesAction","filtersAction","actionKind","CodeActionCommandArgs","defaults","getKindFromUser","getApplyFromUser","getPreferredUser","defaultAutoApply","toLowerCase","defaultKind","BlockCommentCommand","insertSpace","_selection","_insertSpace","_usedEndToken","_haystackHasNeedleAtOffset","haystack","needle","offset","needleLength","haystackLength","codeA","charCodeAt","codeB","_createOperationsForBlockComment","startToken","endToken","builder","startLineText","endLineText","startTokenIndex","lastIndexOf","endTokenIndex","lineBetweenTokens","substring","startLineAfterStartToken","endLineBeforeEndToken","_createRemoveBlockCommentOperations","_createAddBlockCommentOperations","ops_1","addTrackedEditOperation","text","res","replace","insert","getEditOperations","tokenizeIfCheap","getLanguageIdAtPosition","config","getComments","blockCommentStartToken","blockCommentEndToken","computeCursorState","inverseEditOperations","getInverseEditOperations","startTokenEditOperation","endTokenEditOperation","srcRange","deltaColumn","LineCommentCommand","_tabSize","_type","_selectionId","_deltaColumn","_moveEndPositionDown","_gatherPreflightCommentStrings","commentStr","lineCommentToken","ignore","commentStrOffset","commentStrLength","_analyzeLines","shouldRemoveComments","onlyWhitespaceLines","lineData","lineContentStartOffset","strings","commentStrEndOffset","supported","_gatherPreflightData","_executeLineComments","_createRemoveLineCommentsOperations","_normalizeInsertionPoint","_createAddLineCommentsOperations","cursorPosition","positionLineNumber","positionColumn","addEditOperation","trackSelection","_attemptRemoveBlockComment","startTokenAllowedBeforeColumn","_executeBlockComment","firstNonWhitespaceIndex","setEndPosition","getTrackedSelection","selectionStartLineNumber","selectionStartColumn","afterCommentStr","nextVisibleColumn","currentVisibleColumn","isTab","columnSize","lenJ","minVisibleColumn","j_1","lenJ_1","CommentLineAction","opts","commands","selections","modelOptions","commentsOptions","selections_1","pushUndoStop","executeCommands","ToggleCommentLineAction","menuOpts","comment","AddLineCommentAction","RemoveLineCommentAction","BlockCommentAction","linux","selections_2","ColorPickerModel","availableColorPresentations","presentationIndex","_onDidChangeColor","_onDidChangePresentation","_color","_colorPresentations","colorPresentations","guessColorPresentation","originalText","CLIPBOARD_CONTEXT_MENU_GROUP","supportsCut","queryCommandSupported","supportsCopy","supportsCopyWithSyntaxHighlighting","supportsPaste","ExecCommandAction","browserCommand","runCommand","focusedEditor","getFocusedCodeEditor","hasTextFocus","execCommand","ExecCommandCutAction","win","secondary","emptySelectionClipboard","ExecCommandCopyAction","ExecCommandPasteAction","ExecCommandCopyWithSyntaxHighlightingAction","forceCopyWithSyntaxHighlighting","CursorState","thisLen","otherLen","equalsSelection","StackElement","cursorState","scrollTop","scrollLeft","CursorUndoRedoController","_isCursorUndoRedo","_undoStack","_redoStack","onDidChangeCursorSelection","oldSelections","oldModelVersionId","modelVersionId","prevState","isEqualToLastUndoStack","getScrollTop","getScrollLeft","shift","cursorUndo","_applyState","cursorRedo","stackElement","setSelections","setScrollPosition","CursorUndo","CursorRedo"],"mappings":"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","file":"js/chunk-vendors~39c4d835.c0fa026c.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { registerEditorAction, registerEditorCommand, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { CodeActionCommand, OrganizeImportsAction, QuickFixAction, QuickFixController, RefactorAction, SourceAction, AutoFixAction, FixAllAction } from './codeActionCommands.js';\r\nregisterEditorContribution(QuickFixController.ID, QuickFixController);\r\nregisterEditorAction(QuickFixAction);\r\nregisterEditorAction(RefactorAction);\r\nregisterEditorAction(SourceAction);\r\nregisterEditorAction(OrganizeImportsAction);\r\nregisterEditorAction(AutoFixAction);\r\nregisterEditorAction(FixAllAction);\r\nregisterEditorCommand(new CodeActionCommand());\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { GlobalMouseMoveMonitor, standardMouseMoveMerger } from '../../../base/browser/globalMouseMoveMonitor.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport './lightBulbWidget.css';\r\nimport { TextModel } from '../../common/model/textModel.js';\r\nimport * as nls from '../../../nls.js';\r\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { editorLightBulbForeground, editorLightBulbAutoFixForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { Gesture } from '../../../base/browser/touch.js';\r\nvar LightBulbState;\r\n(function (LightBulbState) {\r\n    LightBulbState.Hidden = { type: 0 /* Hidden */ };\r\n    var Showing = /** @class */ (function () {\r\n        function Showing(actions, trigger, editorPosition, widgetPosition) {\r\n            this.actions = actions;\r\n            this.trigger = trigger;\r\n            this.editorPosition = editorPosition;\r\n            this.widgetPosition = widgetPosition;\r\n            this.type = 1 /* Showing */;\r\n        }\r\n        return Showing;\r\n    }());\r\n    LightBulbState.Showing = Showing;\r\n})(LightBulbState || (LightBulbState = {}));\r\nvar LightBulbWidget = /** @class */ (function (_super) {\r\n    __extends(LightBulbWidget, _super);\r\n    function LightBulbWidget(_editor, _quickFixActionId, _preferredFixActionId, _keybindingService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._quickFixActionId = _quickFixActionId;\r\n        _this._preferredFixActionId = _preferredFixActionId;\r\n        _this._keybindingService = _keybindingService;\r\n        _this._onClick = _this._register(new Emitter());\r\n        _this.onClick = _this._onClick.event;\r\n        _this._state = LightBulbState.Hidden;\r\n        _this._domNode = document.createElement('div');\r\n        _this._domNode.className = 'codicon codicon-lightbulb';\r\n        _this._editor.addContentWidget(_this);\r\n        _this._register(_this._editor.onDidChangeModelContent(function (_) {\r\n            // cancel when the line in question has been removed\r\n            var editorModel = _this._editor.getModel();\r\n            if (_this.state.type !== 1 /* Showing */ || !editorModel || _this.state.editorPosition.lineNumber >= editorModel.getLineCount()) {\r\n                _this.hide();\r\n            }\r\n        }));\r\n        Gesture.ignoreTarget(_this._domNode);\r\n        _this._register(dom.addStandardDisposableGenericMouseDownListner(_this._domNode, function (e) {\r\n            if (_this.state.type !== 1 /* Showing */) {\r\n                return;\r\n            }\r\n            // Make sure that focus / cursor location is not lost when clicking widget icon\r\n            _this._editor.focus();\r\n            e.preventDefault();\r\n            // a bit of extra work to make sure the menu\r\n            // doesn't cover the line-text\r\n            var _a = dom.getDomNodePagePosition(_this._domNode), top = _a.top, height = _a.height;\r\n            var lineHeight = _this._editor.getOption(49 /* lineHeight */);\r\n            var pad = Math.floor(lineHeight / 3);\r\n            if (_this.state.widgetPosition.position !== null && _this.state.widgetPosition.position.lineNumber < _this.state.editorPosition.lineNumber) {\r\n                pad += lineHeight;\r\n            }\r\n            _this._onClick.fire({\r\n                x: e.posx,\r\n                y: top + height + pad,\r\n                actions: _this.state.actions,\r\n                trigger: _this.state.trigger,\r\n            });\r\n        }));\r\n        _this._register(dom.addDisposableListener(_this._domNode, 'mouseenter', function (e) {\r\n            if ((e.buttons & 1) !== 1) {\r\n                return;\r\n            }\r\n            // mouse enters lightbulb while the primary/left button\r\n            // is being pressed -> hide the lightbulb and block future\r\n            // showings until mouse is released\r\n            _this.hide();\r\n            var monitor = new GlobalMouseMoveMonitor();\r\n            monitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, function () { }, function () {\r\n                monitor.dispose();\r\n            });\r\n        }));\r\n        _this._register(_this._editor.onDidChangeConfiguration(function (e) {\r\n            // hide when told to do so\r\n            if (e.hasChanged(47 /* lightbulb */) && !_this._editor.getOption(47 /* lightbulb */).enabled) {\r\n                _this.hide();\r\n            }\r\n        }));\r\n        _this._updateLightBulbTitle();\r\n        _this._register(_this._keybindingService.onDidUpdateKeybindings(_this._updateLightBulbTitle, _this));\r\n        return _this;\r\n    }\r\n    LightBulbWidget.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this._editor.removeContentWidget(this);\r\n    };\r\n    LightBulbWidget.prototype.getId = function () {\r\n        return 'LightBulbWidget';\r\n    };\r\n    LightBulbWidget.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    LightBulbWidget.prototype.getPosition = function () {\r\n        return this._state.type === 1 /* Showing */ ? this._state.widgetPosition : null;\r\n    };\r\n    LightBulbWidget.prototype.update = function (actions, trigger, atPosition) {\r\n        var _this = this;\r\n        if (actions.validActions.length <= 0) {\r\n            return this.hide();\r\n        }\r\n        var options = this._editor.getOptions();\r\n        if (!options.get(47 /* lightbulb */).enabled) {\r\n            return this.hide();\r\n        }\r\n        var lineNumber = atPosition.lineNumber, column = atPosition.column;\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return this.hide();\r\n        }\r\n        var tabSize = model.getOptions().tabSize;\r\n        var fontInfo = options.get(34 /* fontInfo */);\r\n        var lineContent = model.getLineContent(lineNumber);\r\n        var indent = TextModel.computeIndentLevel(lineContent, tabSize);\r\n        var lineHasSpace = fontInfo.spaceWidth * indent > 22;\r\n        var isFolded = function (lineNumber) {\r\n            return lineNumber > 2 && _this._editor.getTopForLineNumber(lineNumber) === _this._editor.getTopForLineNumber(lineNumber - 1);\r\n        };\r\n        var effectiveLineNumber = lineNumber;\r\n        if (!lineHasSpace) {\r\n            if (lineNumber > 1 && !isFolded(lineNumber - 1)) {\r\n                effectiveLineNumber -= 1;\r\n            }\r\n            else if (!isFolded(lineNumber + 1)) {\r\n                effectiveLineNumber += 1;\r\n            }\r\n            else if (column * fontInfo.spaceWidth < 22) {\r\n                // cannot show lightbulb above/below and showing\r\n                // it inline would overlay the cursor...\r\n                return this.hide();\r\n            }\r\n        }\r\n        this.state = new LightBulbState.Showing(actions, trigger, atPosition, {\r\n            position: { lineNumber: effectiveLineNumber, column: 1 },\r\n            preference: LightBulbWidget._posPref\r\n        });\r\n        dom.toggleClass(this._domNode, 'codicon-lightbulb-autofix', actions.hasAutoFix);\r\n        this._editor.layoutContentWidget(this);\r\n    };\r\n    LightBulbWidget.prototype.hide = function () {\r\n        this.state = LightBulbState.Hidden;\r\n        this._editor.layoutContentWidget(this);\r\n    };\r\n    Object.defineProperty(LightBulbWidget.prototype, \"state\", {\r\n        get: function () { return this._state; },\r\n        set: function (value) {\r\n            this._state = value;\r\n            this._updateLightBulbTitle();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LightBulbWidget.prototype._updateLightBulbTitle = function () {\r\n        if (this.state.type === 1 /* Showing */ && this.state.actions.hasAutoFix) {\r\n            var preferredKb = this._keybindingService.lookupKeybinding(this._preferredFixActionId);\r\n            if (preferredKb) {\r\n                this.title = nls.localize('prefferedQuickFixWithKb', \"Show Fixes. Preferred Fix Available ({0})\", preferredKb.getLabel());\r\n                return;\r\n            }\r\n        }\r\n        var kb = this._keybindingService.lookupKeybinding(this._quickFixActionId);\r\n        if (kb) {\r\n            this.title = nls.localize('quickFixWithKb', \"Show Fixes ({0})\", kb.getLabel());\r\n        }\r\n        else {\r\n            this.title = nls.localize('quickFix', \"Show Fixes\");\r\n        }\r\n    };\r\n    Object.defineProperty(LightBulbWidget.prototype, \"title\", {\r\n        set: function (value) {\r\n            this._domNode.title = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LightBulbWidget._posPref = [0 /* EXACT */];\r\n    LightBulbWidget = __decorate([\r\n        __param(3, IKeybindingService)\r\n    ], LightBulbWidget);\r\n    return LightBulbWidget;\r\n}(Disposable));\r\nexport { LightBulbWidget };\r\nregisterThemingParticipant(function (theme, collector) {\r\n    // Lightbulb Icon\r\n    var editorLightBulbForegroundColor = theme.getColor(editorLightBulbForeground);\r\n    if (editorLightBulbForegroundColor) {\r\n        collector.addRule(\"\\n\\t\\t.monaco-editor .contentWidgets .codicon-lightbulb {\\n\\t\\t\\tcolor: \" + editorLightBulbForegroundColor + \";\\n\\t\\t}\");\r\n    }\r\n    // Lightbulb Auto Fix Icon\r\n    var editorLightBulbAutoFixForegroundColor = theme.getColor(editorLightBulbAutoFixForeground);\r\n    if (editorLightBulbAutoFixForegroundColor) {\r\n        collector.addRule(\"\\n\\t\\t.monaco-editor .contentWidgets .codicon-lightbulb-autofix {\\n\\t\\t\\tcolor: \" + editorLightBulbAutoFixForegroundColor + \";\\n\\t\\t}\");\r\n    }\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { getDomNodePagePosition } from '../../../base/browser/dom.js';\r\nimport { Separator } from '../../../base/browser/ui/actionbar/actionbar.js';\r\nimport { Action } from '../../../base/common/actions.js';\r\nimport { canceled } from '../../../base/common/errors.js';\r\nimport { Lazy } from '../../../base/common/lazy.js';\r\nimport { Disposable, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { CodeActionProviderRegistry } from '../../common/modes.js';\r\nimport { codeActionCommandId, fixAllCommandId, organizeImportsCommandId, refactorCommandId, sourceActionCommandId } from './codeAction.js';\r\nimport { CodeActionCommandArgs, CodeActionKind } from './types.js';\r\nimport { IContextMenuService } from '../../../platform/contextview/browser/contextView.js';\r\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\r\nvar CodeActionAction = /** @class */ (function (_super) {\r\n    __extends(CodeActionAction, _super);\r\n    function CodeActionAction(action, callback) {\r\n        var _this = _super.call(this, action.command ? action.command.id : action.title, action.title, undefined, !action.disabled, callback) || this;\r\n        _this.action = action;\r\n        return _this;\r\n    }\r\n    return CodeActionAction;\r\n}(Action));\r\nvar CodeActionMenu = /** @class */ (function (_super) {\r\n    __extends(CodeActionMenu, _super);\r\n    function CodeActionMenu(_editor, _delegate, _contextMenuService, keybindingService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._delegate = _delegate;\r\n        _this._contextMenuService = _contextMenuService;\r\n        _this._visible = false;\r\n        _this._showingActions = _this._register(new MutableDisposable());\r\n        _this._keybindingResolver = new CodeActionKeybindingResolver({\r\n            getKeybindings: function () { return keybindingService.getKeybindings(); }\r\n        });\r\n        return _this;\r\n    }\r\n    Object.defineProperty(CodeActionMenu.prototype, \"isVisible\", {\r\n        get: function () {\r\n            return this._visible;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CodeActionMenu.prototype.show = function (trigger, codeActions, at, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var actionsToShow, menuActions, anchor, resolver;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                actionsToShow = options.includeDisabledActions ? codeActions.allActions : codeActions.validActions;\r\n                if (!actionsToShow.length) {\r\n                    this._visible = false;\r\n                    return [2 /*return*/];\r\n                }\r\n                if (!this._editor.getDomNode()) {\r\n                    // cancel when editor went off-dom\r\n                    this._visible = false;\r\n                    throw canceled();\r\n                }\r\n                this._visible = true;\r\n                this._showingActions.value = codeActions;\r\n                menuActions = this.getMenuActions(trigger, actionsToShow);\r\n                anchor = Position.isIPosition(at) ? this._toCoords(at) : at || { x: 0, y: 0 };\r\n                resolver = this._keybindingResolver.getResolver();\r\n                this._contextMenuService.showContextMenu({\r\n                    getAnchor: function () { return anchor; },\r\n                    getActions: function () { return menuActions; },\r\n                    onHide: function () {\r\n                        _this._visible = false;\r\n                        _this._editor.focus();\r\n                    },\r\n                    autoSelectFirstItem: true,\r\n                    getKeyBinding: function (action) { return action instanceof CodeActionAction ? resolver(action.action) : undefined; },\r\n                });\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    CodeActionMenu.prototype.getMenuActions = function (trigger, actionsToShow) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        var toCodeActionAction = function (action) { return new CodeActionAction(action, function () { return _this._delegate.onSelectCodeAction(action); }); };\r\n        var result = actionsToShow\r\n            .map(toCodeActionAction);\r\n        var model = this._editor.getModel();\r\n        if (model && result.length) {\r\n            for (var _i = 0, _c = CodeActionProviderRegistry.all(model); _i < _c.length; _i++) {\r\n                var provider = _c[_i];\r\n                if (provider._getAdditionalMenuItems) {\r\n                    var items = provider._getAdditionalMenuItems({ trigger: trigger.type, only: (_b = (_a = trigger.filter) === null || _a === void 0 ? void 0 : _a.include) === null || _b === void 0 ? void 0 : _b.value }, actionsToShow);\r\n                    if (items.length) {\r\n                        result.push.apply(result, __spreadArrays([new Separator()], items.map(function (command) { return toCodeActionAction({\r\n                            title: command.title,\r\n                            command: command,\r\n                        }); })));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    CodeActionMenu.prototype._toCoords = function (position) {\r\n        if (!this._editor.hasModel()) {\r\n            return { x: 0, y: 0 };\r\n        }\r\n        this._editor.revealPosition(position, 1 /* Immediate */);\r\n        this._editor.render();\r\n        // Translate to absolute editor position\r\n        var cursorCoords = this._editor.getScrolledVisiblePosition(position);\r\n        var editorCoords = getDomNodePagePosition(this._editor.getDomNode());\r\n        var x = editorCoords.left + cursorCoords.left;\r\n        var y = editorCoords.top + cursorCoords.top + cursorCoords.height;\r\n        return { x: x, y: y };\r\n    };\r\n    CodeActionMenu = __decorate([\r\n        __param(2, IContextMenuService),\r\n        __param(3, IKeybindingService)\r\n    ], CodeActionMenu);\r\n    return CodeActionMenu;\r\n}(Disposable));\r\nexport { CodeActionMenu };\r\nvar CodeActionKeybindingResolver = /** @class */ (function () {\r\n    function CodeActionKeybindingResolver(_keybindingProvider) {\r\n        this._keybindingProvider = _keybindingProvider;\r\n    }\r\n    CodeActionKeybindingResolver.prototype.getResolver = function () {\r\n        var _this = this;\r\n        // Lazy since we may not actually ever read the value\r\n        var allCodeActionBindings = new Lazy(function () {\r\n            return _this._keybindingProvider.getKeybindings()\r\n                .filter(function (item) { return CodeActionKeybindingResolver.codeActionCommands.indexOf(item.command) >= 0; })\r\n                .filter(function (item) { return item.resolvedKeybinding; })\r\n                .map(function (item) {\r\n                // Special case these commands since they come built-in with VS Code and don't use 'commandArgs'\r\n                var commandArgs = item.commandArgs;\r\n                if (item.command === organizeImportsCommandId) {\r\n                    commandArgs = { kind: CodeActionKind.SourceOrganizeImports.value };\r\n                }\r\n                else if (item.command === fixAllCommandId) {\r\n                    commandArgs = { kind: CodeActionKind.SourceFixAll.value };\r\n                }\r\n                return __assign({ resolvedKeybinding: item.resolvedKeybinding }, CodeActionCommandArgs.fromUser(commandArgs, {\r\n                    kind: CodeActionKind.None,\r\n                    apply: \"never\" /* Never */\r\n                }));\r\n            });\r\n        });\r\n        return function (action) {\r\n            if (action.kind) {\r\n                var binding = _this.bestKeybindingForCodeAction(action, allCodeActionBindings.getValue());\r\n                return binding === null || binding === void 0 ? void 0 : binding.resolvedKeybinding;\r\n            }\r\n            return undefined;\r\n        };\r\n    };\r\n    CodeActionKeybindingResolver.prototype.bestKeybindingForCodeAction = function (action, candidates) {\r\n        if (!action.kind) {\r\n            return undefined;\r\n        }\r\n        var kind = new CodeActionKind(action.kind);\r\n        return candidates\r\n            .filter(function (candidate) { return candidate.kind.contains(kind); })\r\n            .filter(function (candidate) {\r\n            if (candidate.preferred) {\r\n                // If the candidate keybinding only applies to preferred actions, the this action must also be preferred\r\n                return action.isPreferred;\r\n            }\r\n            return true;\r\n        })\r\n            .reduceRight(function (currentBest, candidate) {\r\n            if (!currentBest) {\r\n                return candidate;\r\n            }\r\n            // Select the more specific binding\r\n            return currentBest.kind.contains(candidate.kind) ? candidate : currentBest;\r\n        }, undefined);\r\n    };\r\n    CodeActionKeybindingResolver.codeActionCommands = [\r\n        refactorCommandId,\r\n        codeActionCommandId,\r\n        sourceActionCommandId,\r\n        organizeImportsCommandId,\r\n        fixAllCommandId\r\n    ];\r\n    return CodeActionKeybindingResolver;\r\n}());\r\nexport { CodeActionKeybindingResolver };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { find } from '../../../base/common/arrays.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { Lazy } from '../../../base/common/lazy.js';\r\nimport { Disposable, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { MessageController } from '../message/messageController.js';\r\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { CodeActionMenu } from './codeActionMenu.js';\r\nimport { LightBulbWidget } from './lightBulbWidget.js';\r\nvar CodeActionUi = /** @class */ (function (_super) {\r\n    __extends(CodeActionUi, _super);\r\n    function CodeActionUi(_editor, quickFixActionId, preferredFixActionId, delegate, instantiationService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this.delegate = delegate;\r\n        _this._activeCodeActions = _this._register(new MutableDisposable());\r\n        _this._codeActionWidget = new Lazy(function () {\r\n            return _this._register(instantiationService.createInstance(CodeActionMenu, _this._editor, {\r\n                onSelectCodeAction: function (action) { return __awaiter(_this, void 0, void 0, function () {\r\n                    return __generator(this, function (_a) {\r\n                        this.delegate.applyCodeAction(action, /* retrigger */ true);\r\n                        return [2 /*return*/];\r\n                    });\r\n                }); }\r\n            }));\r\n        });\r\n        _this._lightBulbWidget = new Lazy(function () {\r\n            var widget = _this._register(instantiationService.createInstance(LightBulbWidget, _this._editor, quickFixActionId, preferredFixActionId));\r\n            _this._register(widget.onClick(function (e) { return _this.showCodeActionList(e.trigger, e.actions, e, { includeDisabledActions: false }); }));\r\n            return widget;\r\n        });\r\n        return _this;\r\n    }\r\n    CodeActionUi.prototype.update = function (newState) {\r\n        var _a, _b, _c;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var actions, e_1, validActionToApply, invalidAction, includeDisabledActions;\r\n            return __generator(this, function (_d) {\r\n                switch (_d.label) {\r\n                    case 0:\r\n                        if (newState.type !== 1 /* Triggered */) {\r\n                            (_a = this._lightBulbWidget.rawValue) === null || _a === void 0 ? void 0 : _a.hide();\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _d.label = 1;\r\n                    case 1:\r\n                        _d.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, newState.actions];\r\n                    case 2:\r\n                        actions = _d.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _d.sent();\r\n                        onUnexpectedError(e_1);\r\n                        return [2 /*return*/];\r\n                    case 4:\r\n                        this._lightBulbWidget.getValue().update(actions, newState.trigger, newState.position);\r\n                        if (!(newState.trigger.type === 2 /* Manual */)) return [3 /*break*/, 11];\r\n                        if (!((_b = newState.trigger.filter) === null || _b === void 0 ? void 0 : _b.include)) return [3 /*break*/, 10];\r\n                        validActionToApply = this.tryGetValidActionToApply(newState.trigger, actions);\r\n                        if (!validActionToApply) return [3 /*break*/, 9];\r\n                        _d.label = 5;\r\n                    case 5:\r\n                        _d.trys.push([5, , 7, 8]);\r\n                        return [4 /*yield*/, this.delegate.applyCodeAction(validActionToApply, false)];\r\n                    case 6:\r\n                        _d.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        actions.dispose();\r\n                        return [7 /*endfinally*/];\r\n                    case 8: return [2 /*return*/];\r\n                    case 9:\r\n                        // Check to see if there is an action that we would have applied were it not invalid\r\n                        if (newState.trigger.context) {\r\n                            invalidAction = this.getInvalidActionThatWouldHaveBeenApplied(newState.trigger, actions);\r\n                            if (invalidAction && invalidAction.disabled) {\r\n                                MessageController.get(this._editor).showMessage(invalidAction.disabled, newState.trigger.context.position);\r\n                                actions.dispose();\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        _d.label = 10;\r\n                    case 10:\r\n                        includeDisabledActions = !!((_c = newState.trigger.filter) === null || _c === void 0 ? void 0 : _c.include);\r\n                        if (newState.trigger.context) {\r\n                            if (!actions.allActions.length || !includeDisabledActions && !actions.validActions.length) {\r\n                                MessageController.get(this._editor).showMessage(newState.trigger.context.notAvailableMessage, newState.trigger.context.position);\r\n                                this._activeCodeActions.value = actions;\r\n                                actions.dispose();\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        this._activeCodeActions.value = actions;\r\n                        this._codeActionWidget.getValue().show(newState.trigger, actions, newState.position, { includeDisabledActions: includeDisabledActions });\r\n                        return [3 /*break*/, 12];\r\n                    case 11:\r\n                        // auto magically triggered\r\n                        if (this._codeActionWidget.getValue().isVisible) {\r\n                            // TODO: Figure out if we should update the showing menu?\r\n                            actions.dispose();\r\n                        }\r\n                        else {\r\n                            this._activeCodeActions.value = actions;\r\n                        }\r\n                        _d.label = 12;\r\n                    case 12: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    CodeActionUi.prototype.getInvalidActionThatWouldHaveBeenApplied = function (trigger, actions) {\r\n        if (!actions.allActions.length) {\r\n            return undefined;\r\n        }\r\n        if ((trigger.autoApply === \"first\" /* First */ && actions.validActions.length === 0)\r\n            || (trigger.autoApply === \"ifSingle\" /* IfSingle */ && actions.allActions.length === 1)) {\r\n            return find(actions.allActions, function (action) { return action.disabled; });\r\n        }\r\n        return undefined;\r\n    };\r\n    CodeActionUi.prototype.tryGetValidActionToApply = function (trigger, actions) {\r\n        if (!actions.validActions.length) {\r\n            return undefined;\r\n        }\r\n        if ((trigger.autoApply === \"first\" /* First */ && actions.validActions.length > 0)\r\n            || (trigger.autoApply === \"ifSingle\" /* IfSingle */ && actions.validActions.length === 1)) {\r\n            return actions.validActions[0];\r\n        }\r\n        return undefined;\r\n    };\r\n    CodeActionUi.prototype.showCodeActionList = function (trigger, actions, at, options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                this._codeActionWidget.getValue().show(trigger, actions, at, options);\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    CodeActionUi = __decorate([\r\n        __param(4, IInstantiationService)\r\n    ], CodeActionUi);\r\n    return CodeActionUi;\r\n}(Disposable));\r\nexport { CodeActionUi };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { createCancelablePromise, TimeoutTimer } from '../../../base/common/async.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { CodeActionProviderRegistry } from '../../common/modes.js';\r\nimport { RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { getCodeActions } from './codeAction.js';\r\nimport { isEqual } from '../../../base/common/resources.js';\r\nexport var SUPPORTED_CODE_ACTIONS = new RawContextKey('supportedCodeAction', '');\r\nvar CodeActionOracle = /** @class */ (function (_super) {\r\n    __extends(CodeActionOracle, _super);\r\n    function CodeActionOracle(_editor, _markerService, _signalChange, _delay) {\r\n        if (_delay === void 0) { _delay = 250; }\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._markerService = _markerService;\r\n        _this._signalChange = _signalChange;\r\n        _this._delay = _delay;\r\n        _this._autoTriggerTimer = _this._register(new TimeoutTimer());\r\n        _this._register(_this._markerService.onMarkerChanged(function (e) { return _this._onMarkerChanges(e); }));\r\n        _this._register(_this._editor.onDidChangeCursorPosition(function () { return _this._onCursorChange(); }));\r\n        return _this;\r\n    }\r\n    CodeActionOracle.prototype.trigger = function (trigger) {\r\n        var selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);\r\n        return this._createEventAndSignalChange(trigger, selection);\r\n    };\r\n    CodeActionOracle.prototype._onMarkerChanges = function (resources) {\r\n        var _this = this;\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return;\r\n        }\r\n        if (resources.some(function (resource) { return isEqual(resource, model.uri); })) {\r\n            this._autoTriggerTimer.cancelAndSet(function () {\r\n                _this.trigger({ type: 1 /* Auto */ });\r\n            }, this._delay);\r\n        }\r\n    };\r\n    CodeActionOracle.prototype._onCursorChange = function () {\r\n        var _this = this;\r\n        this._autoTriggerTimer.cancelAndSet(function () {\r\n            _this.trigger({ type: 1 /* Auto */ });\r\n        }, this._delay);\r\n    };\r\n    CodeActionOracle.prototype._getRangeOfMarker = function (selection) {\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return undefined;\r\n        }\r\n        for (var _i = 0, _a = this._markerService.read({ resource: model.uri }); _i < _a.length; _i++) {\r\n            var marker = _a[_i];\r\n            var markerRange = model.validateRange(marker);\r\n            if (Range.intersectRanges(markerRange, selection)) {\r\n                return Range.lift(markerRange);\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    CodeActionOracle.prototype._getRangeOfSelectionUnlessWhitespaceEnclosed = function (trigger) {\r\n        if (!this._editor.hasModel()) {\r\n            return undefined;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var selection = this._editor.getSelection();\r\n        if (selection.isEmpty() && trigger.type === 1 /* Auto */) {\r\n            var _a = selection.getPosition(), lineNumber = _a.lineNumber, column = _a.column;\r\n            var line = model.getLineContent(lineNumber);\r\n            if (line.length === 0) {\r\n                // empty line\r\n                return undefined;\r\n            }\r\n            else if (column === 1) {\r\n                // look only right\r\n                if (/\\s/.test(line[0])) {\r\n                    return undefined;\r\n                }\r\n            }\r\n            else if (column === model.getLineMaxColumn(lineNumber)) {\r\n                // look only left\r\n                if (/\\s/.test(line[line.length - 1])) {\r\n                    return undefined;\r\n                }\r\n            }\r\n            else {\r\n                // look left and right\r\n                if (/\\s/.test(line[column - 2]) && /\\s/.test(line[column - 1])) {\r\n                    return undefined;\r\n                }\r\n            }\r\n        }\r\n        return selection;\r\n    };\r\n    CodeActionOracle.prototype._createEventAndSignalChange = function (trigger, selection) {\r\n        var model = this._editor.getModel();\r\n        if (!selection || !model) {\r\n            // cancel\r\n            this._signalChange(undefined);\r\n            return undefined;\r\n        }\r\n        var markerRange = this._getRangeOfMarker(selection);\r\n        var position = markerRange ? markerRange.getStartPosition() : selection.getStartPosition();\r\n        var e = {\r\n            trigger: trigger,\r\n            selection: selection,\r\n            position: position\r\n        };\r\n        this._signalChange(e);\r\n        return e;\r\n    };\r\n    return CodeActionOracle;\r\n}(Disposable));\r\nexport var CodeActionsState;\r\n(function (CodeActionsState) {\r\n    CodeActionsState.Empty = { type: 0 /* Empty */ };\r\n    var Triggered = /** @class */ (function () {\r\n        function Triggered(trigger, rangeOrSelection, position, actions) {\r\n            this.trigger = trigger;\r\n            this.rangeOrSelection = rangeOrSelection;\r\n            this.position = position;\r\n            this.actions = actions;\r\n            this.type = 1 /* Triggered */;\r\n        }\r\n        return Triggered;\r\n    }());\r\n    CodeActionsState.Triggered = Triggered;\r\n})(CodeActionsState || (CodeActionsState = {}));\r\nvar CodeActionModel = /** @class */ (function (_super) {\r\n    __extends(CodeActionModel, _super);\r\n    function CodeActionModel(_editor, _markerService, contextKeyService, _progressService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._markerService = _markerService;\r\n        _this._progressService = _progressService;\r\n        _this._codeActionOracle = _this._register(new MutableDisposable());\r\n        _this._state = CodeActionsState.Empty;\r\n        _this._onDidChangeState = _this._register(new Emitter());\r\n        _this.onDidChangeState = _this._onDidChangeState.event;\r\n        _this._supportedCodeActions = SUPPORTED_CODE_ACTIONS.bindTo(contextKeyService);\r\n        _this._register(_this._editor.onDidChangeModel(function () { return _this._update(); }));\r\n        _this._register(_this._editor.onDidChangeModelLanguage(function () { return _this._update(); }));\r\n        _this._register(CodeActionProviderRegistry.onDidChange(function () { return _this._update(); }));\r\n        _this._update();\r\n        return _this;\r\n    }\r\n    CodeActionModel.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this.setState(CodeActionsState.Empty, true);\r\n    };\r\n    CodeActionModel.prototype._update = function () {\r\n        var _this = this;\r\n        this._codeActionOracle.value = undefined;\r\n        this.setState(CodeActionsState.Empty);\r\n        var model = this._editor.getModel();\r\n        if (model\r\n            && CodeActionProviderRegistry.has(model)\r\n            && !this._editor.getOption(68 /* readOnly */)) {\r\n            var supportedActions = [];\r\n            for (var _i = 0, _a = CodeActionProviderRegistry.all(model); _i < _a.length; _i++) {\r\n                var provider = _a[_i];\r\n                if (Array.isArray(provider.providedCodeActionKinds)) {\r\n                    supportedActions.push.apply(supportedActions, provider.providedCodeActionKinds);\r\n                }\r\n            }\r\n            this._supportedCodeActions.set(supportedActions.join(' '));\r\n            this._codeActionOracle.value = new CodeActionOracle(this._editor, this._markerService, function (trigger) {\r\n                if (!trigger) {\r\n                    _this.setState(CodeActionsState.Empty);\r\n                    return;\r\n                }\r\n                var actions = createCancelablePromise(function (token) { return getCodeActions(model, trigger.selection, trigger.trigger, token); });\r\n                if (_this._progressService && trigger.trigger.type === 2 /* Manual */) {\r\n                    _this._progressService.showWhile(actions, 250);\r\n                }\r\n                _this.setState(new CodeActionsState.Triggered(trigger.trigger, trigger.selection, trigger.position, actions));\r\n            }, undefined);\r\n            this._codeActionOracle.value.trigger({ type: 1 /* Auto */ });\r\n        }\r\n        else {\r\n            this._supportedCodeActions.reset();\r\n        }\r\n    };\r\n    CodeActionModel.prototype.trigger = function (trigger) {\r\n        if (this._codeActionOracle.value) {\r\n            this._codeActionOracle.value.trigger(trigger);\r\n        }\r\n    };\r\n    CodeActionModel.prototype.setState = function (newState, skipNotify) {\r\n        if (newState === this._state) {\r\n            return;\r\n        }\r\n        // Cancel old request\r\n        if (this._state.type === 1 /* Triggered */) {\r\n            this._state.actions.cancel();\r\n        }\r\n        this._state = newState;\r\n        if (!skipNotify) {\r\n            this._onDidChangeState.fire(newState);\r\n        }\r\n    };\r\n    return CodeActionModel;\r\n}(Disposable));\r\nexport { CodeActionModel };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { Lazy } from '../../../base/common/lazy.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { escapeRegExpCharacters } from '../../../base/common/strings.js';\r\nimport { EditorAction, EditorCommand } from '../../browser/editorExtensions.js';\r\nimport { IBulkEditService } from '../../browser/services/bulkEditService.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { codeActionCommandId, fixAllCommandId, organizeImportsCommandId, refactorCommandId, sourceActionCommandId } from './codeAction.js';\r\nimport { CodeActionUi } from './codeActionUi.js';\r\nimport { MessageController } from '../message/messageController.js';\r\nimport * as nls from '../../../nls.js';\r\nimport { ICommandService } from '../../../platform/commands/common/commands.js';\r\nimport { ContextKeyExpr, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { IMarkerService } from '../../../platform/markers/common/markers.js';\r\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\r\nimport { IEditorProgressService } from '../../../platform/progress/common/progress.js';\r\nimport { ITelemetryService } from '../../../platform/telemetry/common/telemetry.js';\r\nimport { CodeActionModel, SUPPORTED_CODE_ACTIONS } from './codeActionModel.js';\r\nimport { CodeActionCommandArgs, CodeActionKind } from './types.js';\r\nfunction contextKeyForSupportedActions(kind) {\r\n    return ContextKeyExpr.regex(SUPPORTED_CODE_ACTIONS.keys()[0], new RegExp('(\\\\s|^)' + escapeRegExpCharacters(kind.value) + '\\\\b'));\r\n}\r\nvar argsSchema = {\r\n    type: 'object',\r\n    required: ['kind'],\r\n    defaultSnippets: [{ body: { kind: '' } }],\r\n    properties: {\r\n        'kind': {\r\n            type: 'string',\r\n            description: nls.localize('args.schema.kind', \"Kind of the code action to run.\"),\r\n        },\r\n        'apply': {\r\n            type: 'string',\r\n            description: nls.localize('args.schema.apply', \"Controls when the returned actions are applied.\"),\r\n            default: \"ifSingle\" /* IfSingle */,\r\n            enum: [\"first\" /* First */, \"ifSingle\" /* IfSingle */, \"never\" /* Never */],\r\n            enumDescriptions: [\r\n                nls.localize('args.schema.apply.first', \"Always apply the first returned code action.\"),\r\n                nls.localize('args.schema.apply.ifSingle', \"Apply the first returned code action if it is the only one.\"),\r\n                nls.localize('args.schema.apply.never', \"Do not apply the returned code actions.\"),\r\n            ]\r\n        },\r\n        'preferred': {\r\n            type: 'boolean',\r\n            default: false,\r\n            description: nls.localize('args.schema.preferred', \"Controls if only preferred code actions should be returned.\"),\r\n        }\r\n    }\r\n};\r\nvar QuickFixController = /** @class */ (function (_super) {\r\n    __extends(QuickFixController, _super);\r\n    function QuickFixController(editor, markerService, contextKeyService, progressService, _instantiationService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._instantiationService = _instantiationService;\r\n        _this._editor = editor;\r\n        _this._model = _this._register(new CodeActionModel(_this._editor, markerService, contextKeyService, progressService));\r\n        _this._register(_this._model.onDidChangeState(function (newState) { return _this.update(newState); }));\r\n        _this._ui = new Lazy(function () {\r\n            return _this._register(new CodeActionUi(editor, QuickFixAction.Id, AutoFixAction.Id, {\r\n                applyCodeAction: function (action, retrigger) { return __awaiter(_this, void 0, void 0, function () {\r\n                    return __generator(this, function (_a) {\r\n                        switch (_a.label) {\r\n                            case 0:\r\n                                _a.trys.push([0, , 2, 3]);\r\n                                return [4 /*yield*/, this._applyCodeAction(action)];\r\n                            case 1:\r\n                                _a.sent();\r\n                                return [3 /*break*/, 3];\r\n                            case 2:\r\n                                if (retrigger) {\r\n                                    this._trigger({ type: 1 /* Auto */, filter: {} });\r\n                                }\r\n                                return [7 /*endfinally*/];\r\n                            case 3: return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); }\r\n            }, _this._instantiationService));\r\n        });\r\n        return _this;\r\n    }\r\n    QuickFixController.get = function (editor) {\r\n        return editor.getContribution(QuickFixController.ID);\r\n    };\r\n    QuickFixController.prototype.update = function (newState) {\r\n        this._ui.getValue().update(newState);\r\n    };\r\n    QuickFixController.prototype.showCodeActions = function (trigger, actions, at) {\r\n        return this._ui.getValue().showCodeActionList(trigger, actions, at, { includeDisabledActions: false });\r\n    };\r\n    QuickFixController.prototype.manualTriggerAtCurrentPosition = function (notAvailableMessage, filter, autoApply) {\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        MessageController.get(this._editor).closeMessage();\r\n        var triggerPosition = this._editor.getPosition();\r\n        this._trigger({ type: 2 /* Manual */, filter: filter, autoApply: autoApply, context: { notAvailableMessage: notAvailableMessage, position: triggerPosition } });\r\n    };\r\n    QuickFixController.prototype._trigger = function (trigger) {\r\n        return this._model.trigger(trigger);\r\n    };\r\n    QuickFixController.prototype._applyCodeAction = function (action) {\r\n        return this._instantiationService.invokeFunction(applyCodeAction, action, this._editor);\r\n    };\r\n    QuickFixController.ID = 'editor.contrib.quickFixController';\r\n    QuickFixController = __decorate([\r\n        __param(1, IMarkerService),\r\n        __param(2, IContextKeyService),\r\n        __param(3, IEditorProgressService),\r\n        __param(4, IInstantiationService)\r\n    ], QuickFixController);\r\n    return QuickFixController;\r\n}(Disposable));\r\nexport { QuickFixController };\r\nexport function applyCodeAction(accessor, action, editor) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var bulkEditService, commandService, telemetryService, notificationService, err_1, message;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    bulkEditService = accessor.get(IBulkEditService);\r\n                    commandService = accessor.get(ICommandService);\r\n                    telemetryService = accessor.get(ITelemetryService);\r\n                    notificationService = accessor.get(INotificationService);\r\n                    telemetryService.publicLog2('codeAction.applyCodeAction', {\r\n                        codeActionTitle: action.title,\r\n                        codeActionKind: action.kind,\r\n                        codeActionIsPreferred: !!action.isPreferred,\r\n                    });\r\n                    if (!action.edit) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, bulkEditService.apply(action.edit, { editor: editor })];\r\n                case 1:\r\n                    _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!action.command) return [3 /*break*/, 6];\r\n                    _a.label = 3;\r\n                case 3:\r\n                    _a.trys.push([3, 5, , 6]);\r\n                    return [4 /*yield*/, commandService.executeCommand.apply(commandService, __spreadArrays([action.command.id], (action.command.arguments || [])))];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_1 = _a.sent();\r\n                    message = asMessage(err_1);\r\n                    notificationService.error(typeof message === 'string'\r\n                        ? message\r\n                        : nls.localize('applyCodeActionFailed', \"An unknown error occurred while applying the code action\"));\r\n                    return [3 /*break*/, 6];\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction asMessage(err) {\r\n    if (typeof err === 'string') {\r\n        return err;\r\n    }\r\n    else if (err instanceof Error && typeof err.message === 'string') {\r\n        return err.message;\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\nfunction triggerCodeActionsForEditorSelection(editor, notAvailableMessage, filter, autoApply) {\r\n    if (editor.hasModel()) {\r\n        var controller = QuickFixController.get(editor);\r\n        if (controller) {\r\n            controller.manualTriggerAtCurrentPosition(notAvailableMessage, filter, autoApply);\r\n        }\r\n    }\r\n}\r\nvar QuickFixAction = /** @class */ (function (_super) {\r\n    __extends(QuickFixAction, _super);\r\n    function QuickFixAction() {\r\n        return _super.call(this, {\r\n            id: QuickFixAction.Id,\r\n            label: nls.localize('quickfix.trigger.label', \"Quick Fix...\"),\r\n            alias: 'Quick Fix...',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCodeActionsProvider),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 84 /* US_DOT */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    QuickFixAction.prototype.run = function (_accessor, editor) {\r\n        return triggerCodeActionsForEditorSelection(editor, nls.localize('editor.action.quickFix.noneMessage', \"No code actions available\"), undefined, undefined);\r\n    };\r\n    QuickFixAction.Id = 'editor.action.quickFix';\r\n    return QuickFixAction;\r\n}(EditorAction));\r\nexport { QuickFixAction };\r\nvar CodeActionCommand = /** @class */ (function (_super) {\r\n    __extends(CodeActionCommand, _super);\r\n    function CodeActionCommand() {\r\n        return _super.call(this, {\r\n            id: codeActionCommandId,\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCodeActionsProvider),\r\n            description: {\r\n                description: 'Trigger a code action',\r\n                args: [{ name: 'args', schema: argsSchema, }]\r\n            }\r\n        }) || this;\r\n    }\r\n    CodeActionCommand.prototype.runEditorCommand = function (_accessor, editor, userArgs) {\r\n        var args = CodeActionCommandArgs.fromUser(userArgs, {\r\n            kind: CodeActionKind.Empty,\r\n            apply: \"ifSingle\" /* IfSingle */,\r\n        });\r\n        return triggerCodeActionsForEditorSelection(editor, typeof (userArgs === null || userArgs === void 0 ? void 0 : userArgs.kind) === 'string'\r\n            ? args.preferred\r\n                ? nls.localize('editor.action.codeAction.noneMessage.preferred.kind', \"No preferred code actions for '{0}' available\", userArgs.kind)\r\n                : nls.localize('editor.action.codeAction.noneMessage.kind', \"No code actions for '{0}' available\", userArgs.kind)\r\n            : args.preferred\r\n                ? nls.localize('editor.action.codeAction.noneMessage.preferred', \"No preferred code actions available\")\r\n                : nls.localize('editor.action.codeAction.noneMessage', \"No code actions available\"), {\r\n            include: args.kind,\r\n            includeSourceActions: true,\r\n            onlyIncludePreferredActions: args.preferred,\r\n        }, args.apply);\r\n    };\r\n    return CodeActionCommand;\r\n}(EditorCommand));\r\nexport { CodeActionCommand };\r\nvar RefactorAction = /** @class */ (function (_super) {\r\n    __extends(RefactorAction, _super);\r\n    function RefactorAction() {\r\n        return _super.call(this, {\r\n            id: refactorCommandId,\r\n            label: nls.localize('refactor.label', \"Refactor...\"),\r\n            alias: 'Refactor...',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCodeActionsProvider),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 48 /* KEY_R */,\r\n                mac: {\r\n                    primary: 256 /* WinCtrl */ | 1024 /* Shift */ | 48 /* KEY_R */\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            contextMenuOpts: {\r\n                group: '1_modification',\r\n                order: 2,\r\n                when: ContextKeyExpr.and(EditorContextKeys.writable, contextKeyForSupportedActions(CodeActionKind.Refactor)),\r\n            },\r\n            description: {\r\n                description: 'Refactor...',\r\n                args: [{ name: 'args', schema: argsSchema }]\r\n            }\r\n        }) || this;\r\n    }\r\n    RefactorAction.prototype.run = function (_accessor, editor, userArgs) {\r\n        var args = CodeActionCommandArgs.fromUser(userArgs, {\r\n            kind: CodeActionKind.Refactor,\r\n            apply: \"never\" /* Never */\r\n        });\r\n        return triggerCodeActionsForEditorSelection(editor, typeof (userArgs === null || userArgs === void 0 ? void 0 : userArgs.kind) === 'string'\r\n            ? args.preferred\r\n                ? nls.localize('editor.action.refactor.noneMessage.preferred.kind', \"No preferred refactorings for '{0}' available\", userArgs.kind)\r\n                : nls.localize('editor.action.refactor.noneMessage.kind', \"No refactorings for '{0}' available\", userArgs.kind)\r\n            : args.preferred\r\n                ? nls.localize('editor.action.refactor.noneMessage.preferred', \"No preferred refactorings available\")\r\n                : nls.localize('editor.action.refactor.noneMessage', \"No refactorings available\"), {\r\n            include: CodeActionKind.Refactor.contains(args.kind) ? args.kind : CodeActionKind.None,\r\n            onlyIncludePreferredActions: args.preferred,\r\n        }, args.apply);\r\n    };\r\n    return RefactorAction;\r\n}(EditorAction));\r\nexport { RefactorAction };\r\nvar SourceAction = /** @class */ (function (_super) {\r\n    __extends(SourceAction, _super);\r\n    function SourceAction() {\r\n        return _super.call(this, {\r\n            id: sourceActionCommandId,\r\n            label: nls.localize('source.label', \"Source Action...\"),\r\n            alias: 'Source Action...',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCodeActionsProvider),\r\n            contextMenuOpts: {\r\n                group: '1_modification',\r\n                order: 2.1,\r\n                when: ContextKeyExpr.and(EditorContextKeys.writable, contextKeyForSupportedActions(CodeActionKind.Source)),\r\n            },\r\n            description: {\r\n                description: 'Source Action...',\r\n                args: [{ name: 'args', schema: argsSchema }]\r\n            }\r\n        }) || this;\r\n    }\r\n    SourceAction.prototype.run = function (_accessor, editor, userArgs) {\r\n        var args = CodeActionCommandArgs.fromUser(userArgs, {\r\n            kind: CodeActionKind.Source,\r\n            apply: \"never\" /* Never */\r\n        });\r\n        return triggerCodeActionsForEditorSelection(editor, typeof (userArgs === null || userArgs === void 0 ? void 0 : userArgs.kind) === 'string'\r\n            ? args.preferred\r\n                ? nls.localize('editor.action.source.noneMessage.preferred.kind', \"No preferred source actions for '{0}' available\", userArgs.kind)\r\n                : nls.localize('editor.action.source.noneMessage.kind', \"No source actions for '{0}' available\", userArgs.kind)\r\n            : args.preferred\r\n                ? nls.localize('editor.action.source.noneMessage.preferred', \"No preferred source actions available\")\r\n                : nls.localize('editor.action.source.noneMessage', \"No source actions available\"), {\r\n            include: CodeActionKind.Source.contains(args.kind) ? args.kind : CodeActionKind.None,\r\n            includeSourceActions: true,\r\n            onlyIncludePreferredActions: args.preferred,\r\n        }, args.apply);\r\n    };\r\n    return SourceAction;\r\n}(EditorAction));\r\nexport { SourceAction };\r\nvar OrganizeImportsAction = /** @class */ (function (_super) {\r\n    __extends(OrganizeImportsAction, _super);\r\n    function OrganizeImportsAction() {\r\n        return _super.call(this, {\r\n            id: organizeImportsCommandId,\r\n            label: nls.localize('organizeImports.label', \"Organize Imports\"),\r\n            alias: 'Organize Imports',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, contextKeyForSupportedActions(CodeActionKind.SourceOrganizeImports)),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 1024 /* Shift */ | 512 /* Alt */ | 45 /* KEY_O */,\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n        }) || this;\r\n    }\r\n    OrganizeImportsAction.prototype.run = function (_accessor, editor) {\r\n        return triggerCodeActionsForEditorSelection(editor, nls.localize('editor.action.organize.noneMessage', \"No organize imports action available\"), { include: CodeActionKind.SourceOrganizeImports, includeSourceActions: true }, \"ifSingle\" /* IfSingle */);\r\n    };\r\n    return OrganizeImportsAction;\r\n}(EditorAction));\r\nexport { OrganizeImportsAction };\r\nvar FixAllAction = /** @class */ (function (_super) {\r\n    __extends(FixAllAction, _super);\r\n    function FixAllAction() {\r\n        return _super.call(this, {\r\n            id: fixAllCommandId,\r\n            label: nls.localize('fixAll.label', \"Fix All\"),\r\n            alias: 'Fix All',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, contextKeyForSupportedActions(CodeActionKind.SourceFixAll))\r\n        }) || this;\r\n    }\r\n    FixAllAction.prototype.run = function (_accessor, editor) {\r\n        return triggerCodeActionsForEditorSelection(editor, nls.localize('fixAll.noneMessage', \"No fix all action available\"), { include: CodeActionKind.SourceFixAll, includeSourceActions: true }, \"ifSingle\" /* IfSingle */);\r\n    };\r\n    return FixAllAction;\r\n}(EditorAction));\r\nexport { FixAllAction };\r\nvar AutoFixAction = /** @class */ (function (_super) {\r\n    __extends(AutoFixAction, _super);\r\n    function AutoFixAction() {\r\n        return _super.call(this, {\r\n            id: AutoFixAction.Id,\r\n            label: nls.localize('autoFix.label', \"Auto Fix...\"),\r\n            alias: 'Auto Fix...',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, contextKeyForSupportedActions(CodeActionKind.QuickFix)),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 512 /* Alt */ | 1024 /* Shift */ | 84 /* US_DOT */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 84 /* US_DOT */\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    AutoFixAction.prototype.run = function (_accessor, editor) {\r\n        return triggerCodeActionsForEditorSelection(editor, nls.localize('editor.action.autoFix.noneMessage', \"No auto fixes available\"), {\r\n            include: CodeActionKind.QuickFix,\r\n            onlyIncludePreferredActions: true\r\n        }, \"ifSingle\" /* IfSingle */);\r\n    };\r\n    AutoFixAction.Id = 'editor.action.autoFix';\r\n    return AutoFixAction;\r\n}(EditorAction));\r\nexport { AutoFixAction };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './colorPicker.css';\r\nimport { onDidChangeZoomLevel } from '../../../base/browser/browser.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { GlobalMouseMoveMonitor, standardMouseMoveMerger } from '../../../base/browser/globalMouseMoveMonitor.js';\r\nimport { Widget } from '../../../base/browser/ui/widget.js';\r\nimport { Color, HSVA, RGBA } from '../../../base/common/color.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { editorHoverBackground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nvar $ = dom.$;\r\nvar ColorPickerHeader = /** @class */ (function (_super) {\r\n    __extends(ColorPickerHeader, _super);\r\n    function ColorPickerHeader(container, model, themeService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = model;\r\n        _this.domNode = $('.colorpicker-header');\r\n        dom.append(container, _this.domNode);\r\n        _this.pickedColorNode = dom.append(_this.domNode, $('.picked-color'));\r\n        var colorBox = dom.append(_this.domNode, $('.original-color'));\r\n        colorBox.style.backgroundColor = Color.Format.CSS.format(_this.model.originalColor) || '';\r\n        _this.backgroundColor = themeService.getTheme().getColor(editorHoverBackground) || Color.white;\r\n        _this._register(registerThemingParticipant(function (theme, collector) {\r\n            _this.backgroundColor = theme.getColor(editorHoverBackground) || Color.white;\r\n        }));\r\n        _this._register(dom.addDisposableListener(_this.pickedColorNode, dom.EventType.CLICK, function () { return _this.model.selectNextColorPresentation(); }));\r\n        _this._register(dom.addDisposableListener(colorBox, dom.EventType.CLICK, function () {\r\n            _this.model.color = _this.model.originalColor;\r\n            _this.model.flushColor();\r\n        }));\r\n        _this._register(model.onDidChangeColor(_this.onDidChangeColor, _this));\r\n        _this._register(model.onDidChangePresentation(_this.onDidChangePresentation, _this));\r\n        _this.pickedColorNode.style.backgroundColor = Color.Format.CSS.format(model.color) || '';\r\n        dom.toggleClass(_this.pickedColorNode, 'light', model.color.rgba.a < 0.5 ? _this.backgroundColor.isLighter() : model.color.isLighter());\r\n        return _this;\r\n    }\r\n    ColorPickerHeader.prototype.onDidChangeColor = function (color) {\r\n        this.pickedColorNode.style.backgroundColor = Color.Format.CSS.format(color) || '';\r\n        dom.toggleClass(this.pickedColorNode, 'light', color.rgba.a < 0.5 ? this.backgroundColor.isLighter() : color.isLighter());\r\n        this.onDidChangePresentation();\r\n    };\r\n    ColorPickerHeader.prototype.onDidChangePresentation = function () {\r\n        this.pickedColorNode.textContent = this.model.presentation ? this.model.presentation.label : '';\r\n    };\r\n    return ColorPickerHeader;\r\n}(Disposable));\r\nexport { ColorPickerHeader };\r\nvar ColorPickerBody = /** @class */ (function (_super) {\r\n    __extends(ColorPickerBody, _super);\r\n    function ColorPickerBody(container, model, pixelRatio) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = model;\r\n        _this.pixelRatio = pixelRatio;\r\n        _this.domNode = $('.colorpicker-body');\r\n        dom.append(container, _this.domNode);\r\n        _this.saturationBox = new SaturationBox(_this.domNode, _this.model, _this.pixelRatio);\r\n        _this._register(_this.saturationBox);\r\n        _this._register(_this.saturationBox.onDidChange(_this.onDidSaturationValueChange, _this));\r\n        _this._register(_this.saturationBox.onColorFlushed(_this.flushColor, _this));\r\n        _this.opacityStrip = new OpacityStrip(_this.domNode, _this.model);\r\n        _this._register(_this.opacityStrip);\r\n        _this._register(_this.opacityStrip.onDidChange(_this.onDidOpacityChange, _this));\r\n        _this._register(_this.opacityStrip.onColorFlushed(_this.flushColor, _this));\r\n        _this.hueStrip = new HueStrip(_this.domNode, _this.model);\r\n        _this._register(_this.hueStrip);\r\n        _this._register(_this.hueStrip.onDidChange(_this.onDidHueChange, _this));\r\n        _this._register(_this.hueStrip.onColorFlushed(_this.flushColor, _this));\r\n        return _this;\r\n    }\r\n    ColorPickerBody.prototype.flushColor = function () {\r\n        this.model.flushColor();\r\n    };\r\n    ColorPickerBody.prototype.onDidSaturationValueChange = function (_a) {\r\n        var s = _a.s, v = _a.v;\r\n        var hsva = this.model.color.hsva;\r\n        this.model.color = new Color(new HSVA(hsva.h, s, v, hsva.a));\r\n    };\r\n    ColorPickerBody.prototype.onDidOpacityChange = function (a) {\r\n        var hsva = this.model.color.hsva;\r\n        this.model.color = new Color(new HSVA(hsva.h, hsva.s, hsva.v, a));\r\n    };\r\n    ColorPickerBody.prototype.onDidHueChange = function (value) {\r\n        var hsva = this.model.color.hsva;\r\n        var h = (1 - value) * 360;\r\n        this.model.color = new Color(new HSVA(h === 360 ? 0 : h, hsva.s, hsva.v, hsva.a));\r\n    };\r\n    ColorPickerBody.prototype.layout = function () {\r\n        this.saturationBox.layout();\r\n        this.opacityStrip.layout();\r\n        this.hueStrip.layout();\r\n    };\r\n    return ColorPickerBody;\r\n}(Disposable));\r\nexport { ColorPickerBody };\r\nvar SaturationBox = /** @class */ (function (_super) {\r\n    __extends(SaturationBox, _super);\r\n    function SaturationBox(container, model, pixelRatio) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = model;\r\n        _this.pixelRatio = pixelRatio;\r\n        _this._onDidChange = new Emitter();\r\n        _this.onDidChange = _this._onDidChange.event;\r\n        _this._onColorFlushed = new Emitter();\r\n        _this.onColorFlushed = _this._onColorFlushed.event;\r\n        _this.domNode = $('.saturation-wrap');\r\n        dom.append(container, _this.domNode);\r\n        // Create canvas, draw selected color\r\n        _this.canvas = document.createElement('canvas');\r\n        _this.canvas.className = 'saturation-box';\r\n        dom.append(_this.domNode, _this.canvas);\r\n        // Add selection circle\r\n        _this.selection = $('.saturation-selection');\r\n        dom.append(_this.domNode, _this.selection);\r\n        _this.layout();\r\n        _this._register(dom.addDisposableGenericMouseDownListner(_this.domNode, function (e) { return _this.onMouseDown(e); }));\r\n        _this._register(_this.model.onDidChangeColor(_this.onDidChangeColor, _this));\r\n        _this.monitor = null;\r\n        return _this;\r\n    }\r\n    SaturationBox.prototype.onMouseDown = function (e) {\r\n        var _this = this;\r\n        this.monitor = this._register(new GlobalMouseMoveMonitor());\r\n        var origin = dom.getDomNodePagePosition(this.domNode);\r\n        if (e.target !== this.selection) {\r\n            this.onDidChangePosition(e.offsetX, e.offsetY);\r\n        }\r\n        this.monitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, function (event) { return _this.onDidChangePosition(event.posx - origin.left, event.posy - origin.top); }, function () { return null; });\r\n        var mouseUpListener = dom.addDisposableGenericMouseUpListner(document, function () {\r\n            _this._onColorFlushed.fire();\r\n            mouseUpListener.dispose();\r\n            if (_this.monitor) {\r\n                _this.monitor.stopMonitoring(true);\r\n                _this.monitor = null;\r\n            }\r\n        }, true);\r\n    };\r\n    SaturationBox.prototype.onDidChangePosition = function (left, top) {\r\n        var s = Math.max(0, Math.min(1, left / this.width));\r\n        var v = Math.max(0, Math.min(1, 1 - (top / this.height)));\r\n        this.paintSelection(s, v);\r\n        this._onDidChange.fire({ s: s, v: v });\r\n    };\r\n    SaturationBox.prototype.layout = function () {\r\n        this.width = this.domNode.offsetWidth;\r\n        this.height = this.domNode.offsetHeight;\r\n        this.canvas.width = this.width * this.pixelRatio;\r\n        this.canvas.height = this.height * this.pixelRatio;\r\n        this.paint();\r\n        var hsva = this.model.color.hsva;\r\n        this.paintSelection(hsva.s, hsva.v);\r\n    };\r\n    SaturationBox.prototype.paint = function () {\r\n        var hsva = this.model.color.hsva;\r\n        var saturatedColor = new Color(new HSVA(hsva.h, 1, 1, 1));\r\n        var ctx = this.canvas.getContext('2d');\r\n        var whiteGradient = ctx.createLinearGradient(0, 0, this.canvas.width, 0);\r\n        whiteGradient.addColorStop(0, 'rgba(255, 255, 255, 1)');\r\n        whiteGradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.5)');\r\n        whiteGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');\r\n        var blackGradient = ctx.createLinearGradient(0, 0, 0, this.canvas.height);\r\n        blackGradient.addColorStop(0, 'rgba(0, 0, 0, 0)');\r\n        blackGradient.addColorStop(1, 'rgba(0, 0, 0, 1)');\r\n        ctx.rect(0, 0, this.canvas.width, this.canvas.height);\r\n        ctx.fillStyle = Color.Format.CSS.format(saturatedColor);\r\n        ctx.fill();\r\n        ctx.fillStyle = whiteGradient;\r\n        ctx.fill();\r\n        ctx.fillStyle = blackGradient;\r\n        ctx.fill();\r\n    };\r\n    SaturationBox.prototype.paintSelection = function (s, v) {\r\n        this.selection.style.left = s * this.width + \"px\";\r\n        this.selection.style.top = this.height - v * this.height + \"px\";\r\n    };\r\n    SaturationBox.prototype.onDidChangeColor = function () {\r\n        if (this.monitor && this.monitor.isMonitoring()) {\r\n            return;\r\n        }\r\n        this.paint();\r\n    };\r\n    return SaturationBox;\r\n}(Disposable));\r\nvar Strip = /** @class */ (function (_super) {\r\n    __extends(Strip, _super);\r\n    function Strip(container, model) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = model;\r\n        _this._onDidChange = new Emitter();\r\n        _this.onDidChange = _this._onDidChange.event;\r\n        _this._onColorFlushed = new Emitter();\r\n        _this.onColorFlushed = _this._onColorFlushed.event;\r\n        _this.domNode = dom.append(container, $('.strip'));\r\n        _this.overlay = dom.append(_this.domNode, $('.overlay'));\r\n        _this.slider = dom.append(_this.domNode, $('.slider'));\r\n        _this.slider.style.top = \"0px\";\r\n        _this._register(dom.addDisposableGenericMouseDownListner(_this.domNode, function (e) { return _this.onMouseDown(e); }));\r\n        _this.layout();\r\n        return _this;\r\n    }\r\n    Strip.prototype.layout = function () {\r\n        this.height = this.domNode.offsetHeight - this.slider.offsetHeight;\r\n        var value = this.getValue(this.model.color);\r\n        this.updateSliderPosition(value);\r\n    };\r\n    Strip.prototype.onMouseDown = function (e) {\r\n        var _this = this;\r\n        var monitor = this._register(new GlobalMouseMoveMonitor());\r\n        var origin = dom.getDomNodePagePosition(this.domNode);\r\n        dom.addClass(this.domNode, 'grabbing');\r\n        if (e.target !== this.slider) {\r\n            this.onDidChangeTop(e.offsetY);\r\n        }\r\n        monitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, function (event) { return _this.onDidChangeTop(event.posy - origin.top); }, function () { return null; });\r\n        var mouseUpListener = dom.addDisposableGenericMouseUpListner(document, function () {\r\n            _this._onColorFlushed.fire();\r\n            mouseUpListener.dispose();\r\n            monitor.stopMonitoring(true);\r\n            dom.removeClass(_this.domNode, 'grabbing');\r\n        }, true);\r\n    };\r\n    Strip.prototype.onDidChangeTop = function (top) {\r\n        var value = Math.max(0, Math.min(1, 1 - (top / this.height)));\r\n        this.updateSliderPosition(value);\r\n        this._onDidChange.fire(value);\r\n    };\r\n    Strip.prototype.updateSliderPosition = function (value) {\r\n        this.slider.style.top = (1 - value) * this.height + \"px\";\r\n    };\r\n    return Strip;\r\n}(Disposable));\r\nvar OpacityStrip = /** @class */ (function (_super) {\r\n    __extends(OpacityStrip, _super);\r\n    function OpacityStrip(container, model) {\r\n        var _this = _super.call(this, container, model) || this;\r\n        dom.addClass(_this.domNode, 'opacity-strip');\r\n        _this._register(model.onDidChangeColor(_this.onDidChangeColor, _this));\r\n        _this.onDidChangeColor(_this.model.color);\r\n        return _this;\r\n    }\r\n    OpacityStrip.prototype.onDidChangeColor = function (color) {\r\n        var _a = color.rgba, r = _a.r, g = _a.g, b = _a.b;\r\n        var opaque = new Color(new RGBA(r, g, b, 1));\r\n        var transparent = new Color(new RGBA(r, g, b, 0));\r\n        this.overlay.style.background = \"linear-gradient(to bottom, \" + opaque + \" 0%, \" + transparent + \" 100%)\";\r\n    };\r\n    OpacityStrip.prototype.getValue = function (color) {\r\n        return color.hsva.a;\r\n    };\r\n    return OpacityStrip;\r\n}(Strip));\r\nvar HueStrip = /** @class */ (function (_super) {\r\n    __extends(HueStrip, _super);\r\n    function HueStrip(container, model) {\r\n        var _this = _super.call(this, container, model) || this;\r\n        dom.addClass(_this.domNode, 'hue-strip');\r\n        return _this;\r\n    }\r\n    HueStrip.prototype.getValue = function (color) {\r\n        return 1 - (color.hsva.h / 360);\r\n    };\r\n    return HueStrip;\r\n}(Strip));\r\nvar ColorPickerWidget = /** @class */ (function (_super) {\r\n    __extends(ColorPickerWidget, _super);\r\n    function ColorPickerWidget(container, model, pixelRatio, themeService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = model;\r\n        _this.pixelRatio = pixelRatio;\r\n        _this._register(onDidChangeZoomLevel(function () { return _this.layout(); }));\r\n        var element = $('.colorpicker-widget');\r\n        container.appendChild(element);\r\n        var header = new ColorPickerHeader(element, _this.model, themeService);\r\n        _this.body = new ColorPickerBody(element, _this.model, _this.pixelRatio);\r\n        _this._register(header);\r\n        _this._register(_this.body);\r\n        return _this;\r\n    }\r\n    ColorPickerWidget.prototype.layout = function () {\r\n        this.body.layout();\r\n    };\r\n    return ColorPickerWidget;\r\n}(Widget));\r\nexport { ColorPickerWidget };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { illegalArgument } from '../../../base/common/errors.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { ColorProviderRegistry } from '../../common/modes.js';\r\nimport { IModelService } from '../../common/services/modelService.js';\r\nexport function getColors(model, token) {\r\n    var colors = [];\r\n    var providers = ColorProviderRegistry.ordered(model).reverse();\r\n    var promises = providers.map(function (provider) { return Promise.resolve(provider.provideDocumentColors(model, token)).then(function (result) {\r\n        if (Array.isArray(result)) {\r\n            for (var _i = 0, result_1 = result; _i < result_1.length; _i++) {\r\n                var colorInfo = result_1[_i];\r\n                colors.push({ colorInfo: colorInfo, provider: provider });\r\n            }\r\n        }\r\n    }); });\r\n    return Promise.all(promises).then(function () { return colors; });\r\n}\r\nexport function getColorPresentations(model, colorInfo, provider, token) {\r\n    return Promise.resolve(provider.provideColorPresentations(model, colorInfo, token));\r\n}\r\nregisterLanguageCommand('_executeDocumentColorProvider', function (accessor, args) {\r\n    var resource = args.resource;\r\n    if (!(resource instanceof URI)) {\r\n        throw illegalArgument();\r\n    }\r\n    var model = accessor.get(IModelService).getModel(resource);\r\n    if (!model) {\r\n        throw illegalArgument();\r\n    }\r\n    var rawCIs = [];\r\n    var providers = ColorProviderRegistry.ordered(model).reverse();\r\n    var promises = providers.map(function (provider) { return Promise.resolve(provider.provideDocumentColors(model, CancellationToken.None)).then(function (result) {\r\n        if (Array.isArray(result)) {\r\n            for (var _i = 0, result_2 = result; _i < result_2.length; _i++) {\r\n                var ci = result_2[_i];\r\n                rawCIs.push({ range: ci.range, color: [ci.color.red, ci.color.green, ci.color.blue, ci.color.alpha] });\r\n            }\r\n        }\r\n    }); });\r\n    return Promise.all(promises).then(function () { return rawCIs; });\r\n});\r\nregisterLanguageCommand('_executeColorPresentationProvider', function (accessor, args) {\r\n    var resource = args.resource, color = args.color, range = args.range;\r\n    if (!(resource instanceof URI) || !Array.isArray(color) || color.length !== 4 || !Range.isIRange(range)) {\r\n        throw illegalArgument();\r\n    }\r\n    var red = color[0], green = color[1], blue = color[2], alpha = color[3];\r\n    var model = accessor.get(IModelService).getModel(resource);\r\n    if (!model) {\r\n        throw illegalArgument();\r\n    }\r\n    var colorInfo = {\r\n        range: range,\r\n        color: { red: red, green: green, blue: blue, alpha: alpha }\r\n    };\r\n    var presentations = [];\r\n    var providers = ColorProviderRegistry.ordered(model).reverse();\r\n    var promises = providers.map(function (provider) { return Promise.resolve(provider.provideColorPresentations(model, colorInfo, CancellationToken.None)).then(function (result) {\r\n        if (Array.isArray(result)) {\r\n            presentations.push.apply(presentations, result);\r\n        }\r\n    }); });\r\n    return Promise.all(promises).then(function () { return presentations; });\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { mergeSort } from '../../../base/common/arrays.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { illegalArgument, onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport { CodeLensProviderRegistry } from '../../common/modes.js';\r\nimport { IModelService } from '../../common/services/modelService.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nvar CodeLensModel = /** @class */ (function () {\r\n    function CodeLensModel() {\r\n        this.lenses = [];\r\n        this._disposables = new DisposableStore();\r\n    }\r\n    CodeLensModel.prototype.dispose = function () {\r\n        this._disposables.dispose();\r\n    };\r\n    CodeLensModel.prototype.add = function (list, provider) {\r\n        this._disposables.add(list);\r\n        for (var _i = 0, _a = list.lenses; _i < _a.length; _i++) {\r\n            var symbol = _a[_i];\r\n            this.lenses.push({ symbol: symbol, provider: provider });\r\n        }\r\n    };\r\n    return CodeLensModel;\r\n}());\r\nexport { CodeLensModel };\r\nexport function getCodeLensData(model, token) {\r\n    var provider = CodeLensProviderRegistry.ordered(model);\r\n    var providerRanks = new Map();\r\n    var result = new CodeLensModel();\r\n    var promises = provider.map(function (provider, i) {\r\n        providerRanks.set(provider, i);\r\n        return Promise.resolve(provider.provideCodeLenses(model, token))\r\n            .then(function (list) { return list && result.add(list, provider); })\r\n            .catch(onUnexpectedExternalError);\r\n    });\r\n    return Promise.all(promises).then(function () {\r\n        result.lenses = mergeSort(result.lenses, function (a, b) {\r\n            // sort by lineNumber, provider-rank, and column\r\n            if (a.symbol.range.startLineNumber < b.symbol.range.startLineNumber) {\r\n                return -1;\r\n            }\r\n            else if (a.symbol.range.startLineNumber > b.symbol.range.startLineNumber) {\r\n                return 1;\r\n            }\r\n            else if (providerRanks.get(a.provider) < providerRanks.get(b.provider)) {\r\n                return -1;\r\n            }\r\n            else if (providerRanks.get(a.provider) > providerRanks.get(b.provider)) {\r\n                return 1;\r\n            }\r\n            else if (a.symbol.range.startColumn < b.symbol.range.startColumn) {\r\n                return -1;\r\n            }\r\n            else if (a.symbol.range.startColumn > b.symbol.range.startColumn) {\r\n                return 1;\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        });\r\n        return result;\r\n    });\r\n}\r\nregisterLanguageCommand('_executeCodeLensProvider', function (accessor, args) {\r\n    var resource = args.resource, itemResolveCount = args.itemResolveCount;\r\n    if (!(resource instanceof URI)) {\r\n        throw illegalArgument();\r\n    }\r\n    var model = accessor.get(IModelService).getModel(resource);\r\n    if (!model) {\r\n        throw illegalArgument();\r\n    }\r\n    var result = [];\r\n    var disposables = new DisposableStore();\r\n    return getCodeLensData(model, CancellationToken.None).then(function (value) {\r\n        disposables.add(value);\r\n        var resolve = [];\r\n        var _loop_1 = function (item) {\r\n            if (typeof itemResolveCount === 'undefined' || Boolean(item.symbol.command)) {\r\n                result.push(item.symbol);\r\n            }\r\n            else if (itemResolveCount-- > 0 && item.provider.resolveCodeLens) {\r\n                resolve.push(Promise.resolve(item.provider.resolveCodeLens(model, item.symbol, CancellationToken.None)).then(function (symbol) { return result.push(symbol || item.symbol); }));\r\n            }\r\n        };\r\n        for (var _i = 0, _a = value.lenses; _i < _a.length; _i++) {\r\n            var item = _a[_i];\r\n            _loop_1(item);\r\n        }\r\n        return Promise.all(resolve);\r\n    }).then(function () {\r\n        return result;\r\n    }).finally(function () {\r\n        // make sure to return results, then (on next tick)\r\n        // dispose the results\r\n        setTimeout(function () { return disposables.dispose(); }, 100);\r\n    });\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport './codelensWidget.css';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { renderCodicons } from '../../../base/common/codicons.js';\r\nimport { escape } from '../../../base/common/strings.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { editorCodeLensForeground } from '../../common/view/editorColorRegistry.js';\r\nimport { editorActiveLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nvar CodeLensViewZone = /** @class */ (function () {\r\n    function CodeLensViewZone(afterLineNumber, onHeight) {\r\n        this.afterLineNumber = afterLineNumber;\r\n        this._onHeight = onHeight;\r\n        this.heightInLines = 1;\r\n        this.suppressMouseDown = true;\r\n        this.domNode = document.createElement('div');\r\n    }\r\n    CodeLensViewZone.prototype.onComputedHeight = function (height) {\r\n        if (this._lastHeight === undefined) {\r\n            this._lastHeight = height;\r\n        }\r\n        else if (this._lastHeight !== height) {\r\n            this._lastHeight = height;\r\n            this._onHeight();\r\n        }\r\n    };\r\n    return CodeLensViewZone;\r\n}());\r\nvar CodeLensContentWidget = /** @class */ (function () {\r\n    function CodeLensContentWidget(editor, className, line) {\r\n        // Editor.IContentWidget.allowEditorOverflow\r\n        this.allowEditorOverflow = false;\r\n        this.suppressMouseDown = true;\r\n        this._commands = new Map();\r\n        this._isEmpty = true;\r\n        this._editor = editor;\r\n        this._id = \"codelens.widget-\" + (CodeLensContentWidget._idPool++);\r\n        this.updatePosition(line);\r\n        this._domNode = document.createElement('span');\r\n        this._domNode.className = \"codelens-decoration \" + className;\r\n    }\r\n    CodeLensContentWidget.prototype.withCommands = function (lenses, animate) {\r\n        this._commands.clear();\r\n        var innerHtml = '';\r\n        var hasSymbol = false;\r\n        for (var i = 0; i < lenses.length; i++) {\r\n            var lens = lenses[i];\r\n            if (!lens) {\r\n                continue;\r\n            }\r\n            hasSymbol = true;\r\n            if (lens.command) {\r\n                var title = renderCodicons(escape(lens.command.title));\r\n                if (lens.command.id) {\r\n                    innerHtml += \"<a id=\" + i + \">\" + title + \"</a>\";\r\n                    this._commands.set(String(i), lens.command);\r\n                }\r\n                else {\r\n                    innerHtml += \"<span>\" + title + \"</span>\";\r\n                }\r\n                if (i + 1 < lenses.length) {\r\n                    innerHtml += '<span>&#160;|&#160;</span>';\r\n                }\r\n            }\r\n        }\r\n        if (!hasSymbol) {\r\n            // symbols but no commands\r\n            this._domNode.innerHTML = '<span>no commands</span>';\r\n        }\r\n        else {\r\n            // symbols and commands\r\n            if (!innerHtml) {\r\n                innerHtml = '&#160;';\r\n            }\r\n            this._domNode.innerHTML = innerHtml;\r\n            if (this._isEmpty && animate) {\r\n                dom.addClass(this._domNode, 'fadein');\r\n            }\r\n            this._isEmpty = false;\r\n        }\r\n    };\r\n    CodeLensContentWidget.prototype.getCommand = function (link) {\r\n        return link.parentElement === this._domNode\r\n            ? this._commands.get(link.id)\r\n            : undefined;\r\n    };\r\n    CodeLensContentWidget.prototype.getId = function () {\r\n        return this._id;\r\n    };\r\n    CodeLensContentWidget.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    CodeLensContentWidget.prototype.updatePosition = function (line) {\r\n        var column = this._editor.getModel().getLineFirstNonWhitespaceColumn(line);\r\n        this._widgetPosition = {\r\n            position: { lineNumber: line, column: column },\r\n            preference: [1 /* ABOVE */]\r\n        };\r\n    };\r\n    CodeLensContentWidget.prototype.getPosition = function () {\r\n        return this._widgetPosition || null;\r\n    };\r\n    CodeLensContentWidget._idPool = 0;\r\n    return CodeLensContentWidget;\r\n}());\r\nvar CodeLensHelper = /** @class */ (function () {\r\n    function CodeLensHelper() {\r\n        this._removeDecorations = [];\r\n        this._addDecorations = [];\r\n        this._addDecorationsCallbacks = [];\r\n    }\r\n    CodeLensHelper.prototype.addDecoration = function (decoration, callback) {\r\n        this._addDecorations.push(decoration);\r\n        this._addDecorationsCallbacks.push(callback);\r\n    };\r\n    CodeLensHelper.prototype.removeDecoration = function (decorationId) {\r\n        this._removeDecorations.push(decorationId);\r\n    };\r\n    CodeLensHelper.prototype.commit = function (changeAccessor) {\r\n        var resultingDecorations = changeAccessor.deltaDecorations(this._removeDecorations, this._addDecorations);\r\n        for (var i = 0, len = resultingDecorations.length; i < len; i++) {\r\n            this._addDecorationsCallbacks[i](resultingDecorations[i]);\r\n        }\r\n    };\r\n    return CodeLensHelper;\r\n}());\r\nexport { CodeLensHelper };\r\nvar CodeLensWidget = /** @class */ (function () {\r\n    function CodeLensWidget(data, editor, className, helper, viewZoneChangeAccessor, updateCallback) {\r\n        var _this = this;\r\n        this._isDisposed = false;\r\n        this._editor = editor;\r\n        this._className = className;\r\n        this._data = data;\r\n        // create combined range, track all ranges with decorations,\r\n        // check if there is already something to render\r\n        this._decorationIds = [];\r\n        var range;\r\n        var lenses = [];\r\n        this._data.forEach(function (codeLensData, i) {\r\n            if (codeLensData.symbol.command) {\r\n                lenses.push(codeLensData.symbol);\r\n            }\r\n            helper.addDecoration({\r\n                range: codeLensData.symbol.range,\r\n                options: ModelDecorationOptions.EMPTY\r\n            }, function (id) { return _this._decorationIds[i] = id; });\r\n            // the range contains all lenses on this line\r\n            if (!range) {\r\n                range = Range.lift(codeLensData.symbol.range);\r\n            }\r\n            else {\r\n                range = Range.plusRange(range, codeLensData.symbol.range);\r\n            }\r\n        });\r\n        this._viewZone = new CodeLensViewZone(range.startLineNumber - 1, updateCallback);\r\n        this._viewZoneId = viewZoneChangeAccessor.addZone(this._viewZone);\r\n        if (lenses.length > 0) {\r\n            this._createContentWidgetIfNecessary();\r\n            this._contentWidget.withCommands(lenses, false);\r\n        }\r\n    }\r\n    CodeLensWidget.prototype._createContentWidgetIfNecessary = function () {\r\n        if (!this._contentWidget) {\r\n            this._contentWidget = new CodeLensContentWidget(this._editor, this._className, this._viewZone.afterLineNumber + 1);\r\n            this._editor.addContentWidget(this._contentWidget);\r\n        }\r\n    };\r\n    CodeLensWidget.prototype.dispose = function (helper, viewZoneChangeAccessor) {\r\n        this._decorationIds.forEach(helper.removeDecoration, helper);\r\n        this._decorationIds = [];\r\n        if (viewZoneChangeAccessor) {\r\n            viewZoneChangeAccessor.removeZone(this._viewZoneId);\r\n        }\r\n        if (this._contentWidget) {\r\n            this._editor.removeContentWidget(this._contentWidget);\r\n            this._contentWidget = undefined;\r\n        }\r\n        this._isDisposed = true;\r\n    };\r\n    CodeLensWidget.prototype.isDisposed = function () {\r\n        return this._isDisposed;\r\n    };\r\n    CodeLensWidget.prototype.isValid = function () {\r\n        var _this = this;\r\n        return this._decorationIds.some(function (id, i) {\r\n            var range = _this._editor.getModel().getDecorationRange(id);\r\n            var symbol = _this._data[i].symbol;\r\n            return !!(range && Range.isEmpty(symbol.range) === range.isEmpty());\r\n        });\r\n    };\r\n    CodeLensWidget.prototype.updateCodeLensSymbols = function (data, helper) {\r\n        var _this = this;\r\n        this._decorationIds.forEach(helper.removeDecoration, helper);\r\n        this._decorationIds = [];\r\n        this._data = data;\r\n        this._data.forEach(function (codeLensData, i) {\r\n            helper.addDecoration({\r\n                range: codeLensData.symbol.range,\r\n                options: ModelDecorationOptions.EMPTY\r\n            }, function (id) { return _this._decorationIds[i] = id; });\r\n        });\r\n    };\r\n    CodeLensWidget.prototype.computeIfNecessary = function (model) {\r\n        if (!this._viewZone.domNode.hasAttribute('monaco-visible-view-zone')) {\r\n            return null;\r\n        }\r\n        // Read editor current state\r\n        for (var i = 0; i < this._decorationIds.length; i++) {\r\n            var range = model.getDecorationRange(this._decorationIds[i]);\r\n            if (range) {\r\n                this._data[i].symbol.range = range;\r\n            }\r\n        }\r\n        return this._data;\r\n    };\r\n    CodeLensWidget.prototype.updateCommands = function (symbols) {\r\n        this._createContentWidgetIfNecessary();\r\n        this._contentWidget.withCommands(symbols, true);\r\n        for (var i = 0; i < this._data.length; i++) {\r\n            var resolved = symbols[i];\r\n            if (resolved) {\r\n                var symbol = this._data[i].symbol;\r\n                symbol.command = resolved.command || symbol.command;\r\n            }\r\n        }\r\n    };\r\n    CodeLensWidget.prototype.getCommand = function (link) {\r\n        var _a;\r\n        return (_a = this._contentWidget) === null || _a === void 0 ? void 0 : _a.getCommand(link);\r\n    };\r\n    CodeLensWidget.prototype.getLineNumber = function () {\r\n        var range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\r\n        if (range) {\r\n            return range.startLineNumber;\r\n        }\r\n        return -1;\r\n    };\r\n    CodeLensWidget.prototype.update = function (viewZoneChangeAccessor) {\r\n        if (this.isValid()) {\r\n            var range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\r\n            if (range) {\r\n                this._viewZone.afterLineNumber = range.startLineNumber - 1;\r\n                viewZoneChangeAccessor.layoutZone(this._viewZoneId);\r\n                if (this._contentWidget) {\r\n                    this._contentWidget.updatePosition(range.startLineNumber);\r\n                    this._editor.layoutContentWidget(this._contentWidget);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return CodeLensWidget;\r\n}());\r\nexport { CodeLensWidget };\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var codeLensForeground = theme.getColor(editorCodeLensForeground);\r\n    if (codeLensForeground) {\r\n        collector.addRule(\".monaco-editor .codelens-decoration { color: \" + codeLensForeground + \"; }\");\r\n        collector.addRule(\".monaco-editor .codelens-decoration .codicon { color: \" + codeLensForeground + \"; }\");\r\n    }\r\n    var activeLinkForeground = theme.getColor(editorActiveLinkForeground);\r\n    if (activeLinkForeground) {\r\n        collector.addRule(\".monaco-editor .codelens-decoration > a:hover { color: \" + activeLinkForeground + \" !important; }\");\r\n        collector.addRule(\".monaco-editor .codelens-decoration > a:hover .codicon { color: \" + activeLinkForeground + \" !important; }\");\r\n    }\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\r\nimport { CodeLensModel } from './codelens.js';\r\nimport { LRUCache, values } from '../../../base/common/map.js';\r\nimport { IStorageService, WillSaveStateReason } from '../../../platform/storage/common/storage.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { runWhenIdle } from '../../../base/common/async.js';\r\nimport { once } from '../../../base/common/functional.js';\r\nexport var ICodeLensCache = createDecorator('ICodeLensCache');\r\nvar CacheItem = /** @class */ (function () {\r\n    function CacheItem(lineCount, data) {\r\n        this.lineCount = lineCount;\r\n        this.data = data;\r\n    }\r\n    return CacheItem;\r\n}());\r\nvar CodeLensCache = /** @class */ (function () {\r\n    function CodeLensCache(storageService) {\r\n        var _this = this;\r\n        this._fakeProvider = new /** @class */ (function () {\r\n            function class_1() {\r\n            }\r\n            class_1.prototype.provideCodeLenses = function () {\r\n                throw new Error('not supported');\r\n            };\r\n            return class_1;\r\n        }());\r\n        this._cache = new LRUCache(20, 0.75);\r\n        // remove old data\r\n        var oldkey = 'codelens/cache';\r\n        runWhenIdle(function () { return storageService.remove(oldkey, 1 /* WORKSPACE */); });\r\n        // restore lens data on start\r\n        var key = 'codelens/cache2';\r\n        var raw = storageService.get(key, 1 /* WORKSPACE */, '{}');\r\n        this._deserialize(raw);\r\n        // store lens data on shutdown\r\n        once(storageService.onWillSaveState)(function (e) {\r\n            if (e.reason === WillSaveStateReason.SHUTDOWN) {\r\n                storageService.store(key, _this._serialize(), 1 /* WORKSPACE */);\r\n            }\r\n        });\r\n    }\r\n    CodeLensCache.prototype.put = function (model, data) {\r\n        // create a copy of the model that is without command-ids\r\n        // but with comand-labels\r\n        var copyItems = data.lenses.map(function (item) {\r\n            var _a;\r\n            return {\r\n                range: item.symbol.range,\r\n                command: item.symbol.command && { id: '', title: (_a = item.symbol.command) === null || _a === void 0 ? void 0 : _a.title },\r\n            };\r\n        });\r\n        var copyModel = new CodeLensModel();\r\n        copyModel.add({ lenses: copyItems, dispose: function () { } }, this._fakeProvider);\r\n        var item = new CacheItem(model.getLineCount(), copyModel);\r\n        this._cache.set(model.uri.toString(), item);\r\n    };\r\n    CodeLensCache.prototype.get = function (model) {\r\n        var item = this._cache.get(model.uri.toString());\r\n        return item && item.lineCount === model.getLineCount() ? item.data : undefined;\r\n    };\r\n    CodeLensCache.prototype.delete = function (model) {\r\n        this._cache.delete(model.uri.toString());\r\n    };\r\n    // --- persistence\r\n    CodeLensCache.prototype._serialize = function () {\r\n        var data = Object.create(null);\r\n        this._cache.forEach(function (value, key) {\r\n            var lines = new Set();\r\n            for (var _i = 0, _a = value.data.lenses; _i < _a.length; _i++) {\r\n                var d = _a[_i];\r\n                lines.add(d.symbol.range.startLineNumber);\r\n            }\r\n            data[key] = {\r\n                lineCount: value.lineCount,\r\n                lines: values(lines)\r\n            };\r\n        });\r\n        return JSON.stringify(data);\r\n    };\r\n    CodeLensCache.prototype._deserialize = function (raw) {\r\n        try {\r\n            var data = JSON.parse(raw);\r\n            for (var key in data) {\r\n                var element = data[key];\r\n                var lenses = [];\r\n                for (var _i = 0, _a = element.lines; _i < _a.length; _i++) {\r\n                    var line = _a[_i];\r\n                    lenses.push({ range: new Range(line, 1, line, 11) });\r\n                }\r\n                var model = new CodeLensModel();\r\n                model.add({ lenses: lenses, dispose: function () { } }, this._fakeProvider);\r\n                this._cache.set(key, new CacheItem(element.lineCount, model));\r\n            }\r\n        }\r\n        catch (_b) {\r\n            // ignore...\r\n        }\r\n    };\r\n    CodeLensCache = __decorate([\r\n        __param(0, IStorageService)\r\n    ], CodeLensCache);\r\n    return CodeLensCache;\r\n}());\r\nexport { CodeLensCache };\r\nregisterSingleton(ICodeLensCache, CodeLensCache);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { RunOnceScheduler, createCancelablePromise, disposableTimeout } from '../../../base/common/async.js';\r\nimport { onUnexpectedError, onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { toDisposable, DisposableStore, dispose } from '../../../base/common/lifecycle.js';\r\nimport { StableEditorScrollState } from '../../browser/core/editorState.js';\r\nimport { registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { CodeLensProviderRegistry } from '../../common/modes.js';\r\nimport { getCodeLensData } from './codelens.js';\r\nimport { CodeLensWidget, CodeLensHelper } from './codelensWidget.js';\r\nimport { ICommandService } from '../../../platform/commands/common/commands.js';\r\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\r\nimport { ICodeLensCache } from './codeLensCache.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { hash } from '../../../base/common/hash.js';\r\nvar CodeLensContribution = /** @class */ (function () {\r\n    function CodeLensContribution(_editor, _commandService, _notificationService, _codeLensCache) {\r\n        var _this = this;\r\n        this._editor = _editor;\r\n        this._commandService = _commandService;\r\n        this._notificationService = _notificationService;\r\n        this._codeLensCache = _codeLensCache;\r\n        this._globalToDispose = new DisposableStore();\r\n        this._localToDispose = new DisposableStore();\r\n        this._lenses = [];\r\n        this._oldCodeLensModels = new DisposableStore();\r\n        this._modelChangeCounter = 0;\r\n        this._isEnabled = this._editor.getOption(11 /* codeLens */);\r\n        this._globalToDispose.add(this._editor.onDidChangeModel(function () { return _this._onModelChange(); }));\r\n        this._globalToDispose.add(this._editor.onDidChangeModelLanguage(function () { return _this._onModelChange(); }));\r\n        this._globalToDispose.add(this._editor.onDidChangeConfiguration(function () {\r\n            var prevIsEnabled = _this._isEnabled;\r\n            _this._isEnabled = _this._editor.getOption(11 /* codeLens */);\r\n            if (prevIsEnabled !== _this._isEnabled) {\r\n                _this._onModelChange();\r\n            }\r\n        }));\r\n        this._globalToDispose.add(CodeLensProviderRegistry.onDidChange(this._onModelChange, this));\r\n        this._globalToDispose.add(this._editor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(34 /* fontInfo */)) {\r\n                _this._updateLensStyle();\r\n            }\r\n        }));\r\n        this._onModelChange();\r\n        this._styleClassName = hash(this._editor.getId()).toString(16);\r\n        this._styleElement = dom.createStyleSheet(dom.isInShadowDOM(this._editor.getContainerDomNode())\r\n            ? this._editor.getContainerDomNode()\r\n            : undefined);\r\n        this._updateLensStyle();\r\n    }\r\n    CodeLensContribution.prototype.dispose = function () {\r\n        this._localDispose();\r\n        this._globalToDispose.dispose();\r\n        this._oldCodeLensModels.dispose();\r\n        dispose(this._currentCodeLensModel);\r\n    };\r\n    CodeLensContribution.prototype._updateLensStyle = function () {\r\n        var options = this._editor.getOptions();\r\n        var fontInfo = options.get(34 /* fontInfo */);\r\n        var lineHeight = options.get(49 /* lineHeight */);\r\n        var height = Math.round(lineHeight * 1.1);\r\n        var fontSize = Math.round(fontInfo.fontSize * 0.9);\r\n        var newStyle = \"\\n\\t\\t.monaco-editor .codelens-decoration.\" + this._styleClassName + \" { height: \" + height + \"px; line-height: \" + lineHeight + \"px; font-size: \" + fontSize + \"px; padding-right: \" + Math.round(fontInfo.fontSize * 0.45) + \"px;}\\n\\t\\t.monaco-editor .codelens-decoration.\" + this._styleClassName + \" > a > .codicon { line-height: \" + lineHeight + \"px; font-size: \" + fontSize + \"px; }\\n\\t\\t\";\r\n        this._styleElement.innerHTML = newStyle;\r\n    };\r\n    CodeLensContribution.prototype._localDispose = function () {\r\n        if (this._currentFindCodeLensSymbolsPromise) {\r\n            this._currentFindCodeLensSymbolsPromise.cancel();\r\n            this._currentFindCodeLensSymbolsPromise = undefined;\r\n            this._modelChangeCounter++;\r\n        }\r\n        if (this._currentResolveCodeLensSymbolsPromise) {\r\n            this._currentResolveCodeLensSymbolsPromise.cancel();\r\n            this._currentResolveCodeLensSymbolsPromise = undefined;\r\n        }\r\n        this._localToDispose.clear();\r\n        this._oldCodeLensModels.clear();\r\n        dispose(this._currentCodeLensModel);\r\n    };\r\n    CodeLensContribution.prototype._onModelChange = function () {\r\n        var _this = this;\r\n        this._localDispose();\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return;\r\n        }\r\n        if (!this._isEnabled) {\r\n            return;\r\n        }\r\n        var cachedLenses = this._codeLensCache.get(model);\r\n        if (cachedLenses) {\r\n            this._renderCodeLensSymbols(cachedLenses);\r\n        }\r\n        if (!CodeLensProviderRegistry.has(model)) {\r\n            // no provider -> return but check with\r\n            // cached lenses. they expire after 30 seconds\r\n            if (cachedLenses) {\r\n                this._localToDispose.add(disposableTimeout(function () {\r\n                    var cachedLensesNow = _this._codeLensCache.get(model);\r\n                    if (cachedLenses === cachedLensesNow) {\r\n                        _this._codeLensCache.delete(model);\r\n                        _this._onModelChange();\r\n                    }\r\n                }, 30 * 1000));\r\n            }\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = CodeLensProviderRegistry.all(model); _i < _a.length; _i++) {\r\n            var provider = _a[_i];\r\n            if (typeof provider.onDidChange === 'function') {\r\n                var registration = provider.onDidChange(function () { return scheduler.schedule(); });\r\n                this._localToDispose.add(registration);\r\n            }\r\n        }\r\n        var detectVisibleLenses = this._detectVisibleLenses = new RunOnceScheduler(function () { return _this._onViewportChanged(); }, 250);\r\n        var scheduler = new RunOnceScheduler(function () {\r\n            var counterValue = ++_this._modelChangeCounter;\r\n            if (_this._currentFindCodeLensSymbolsPromise) {\r\n                _this._currentFindCodeLensSymbolsPromise.cancel();\r\n            }\r\n            _this._currentFindCodeLensSymbolsPromise = createCancelablePromise(function (token) { return getCodeLensData(model, token); });\r\n            _this._currentFindCodeLensSymbolsPromise.then(function (result) {\r\n                if (counterValue === _this._modelChangeCounter) { // only the last one wins\r\n                    if (_this._currentCodeLensModel) {\r\n                        _this._oldCodeLensModels.add(_this._currentCodeLensModel);\r\n                    }\r\n                    _this._currentCodeLensModel = result;\r\n                    // cache model to reduce flicker\r\n                    _this._codeLensCache.put(model, result);\r\n                    // render lenses\r\n                    _this._renderCodeLensSymbols(result);\r\n                    detectVisibleLenses.schedule();\r\n                }\r\n            }, onUnexpectedError);\r\n        }, 250);\r\n        this._localToDispose.add(scheduler);\r\n        this._localToDispose.add(detectVisibleLenses);\r\n        this._localToDispose.add(this._editor.onDidChangeModelContent(function () {\r\n            _this._editor.changeDecorations(function (decorationsAccessor) {\r\n                _this._editor.changeViewZones(function (viewZonesAccessor) {\r\n                    var toDispose = [];\r\n                    var lastLensLineNumber = -1;\r\n                    _this._lenses.forEach(function (lens) {\r\n                        if (!lens.isValid() || lastLensLineNumber === lens.getLineNumber()) {\r\n                            // invalid -> lens collapsed, attach range doesn't exist anymore\r\n                            // line_number -> lenses should never be on the same line\r\n                            toDispose.push(lens);\r\n                        }\r\n                        else {\r\n                            lens.update(viewZonesAccessor);\r\n                            lastLensLineNumber = lens.getLineNumber();\r\n                        }\r\n                    });\r\n                    var helper = new CodeLensHelper();\r\n                    toDispose.forEach(function (l) {\r\n                        l.dispose(helper, viewZonesAccessor);\r\n                        _this._lenses.splice(_this._lenses.indexOf(l), 1);\r\n                    });\r\n                    helper.commit(decorationsAccessor);\r\n                });\r\n            });\r\n            // Compute new `visible` code lenses\r\n            detectVisibleLenses.schedule();\r\n            // Ask for all references again\r\n            scheduler.schedule();\r\n        }));\r\n        this._localToDispose.add(this._editor.onDidScrollChange(function (e) {\r\n            if (e.scrollTopChanged && _this._lenses.length > 0) {\r\n                detectVisibleLenses.schedule();\r\n            }\r\n        }));\r\n        this._localToDispose.add(this._editor.onDidLayoutChange(function () {\r\n            detectVisibleLenses.schedule();\r\n        }));\r\n        this._localToDispose.add(toDisposable(function () {\r\n            if (_this._editor.getModel()) {\r\n                var scrollState = StableEditorScrollState.capture(_this._editor);\r\n                _this._editor.changeDecorations(function (decorationsAccessor) {\r\n                    _this._editor.changeViewZones(function (viewZonesAccessor) {\r\n                        _this._disposeAllLenses(decorationsAccessor, viewZonesAccessor);\r\n                    });\r\n                });\r\n                scrollState.restore(_this._editor);\r\n            }\r\n            else {\r\n                // No accessors available\r\n                _this._disposeAllLenses(undefined, undefined);\r\n            }\r\n        }));\r\n        this._localToDispose.add(this._editor.onMouseUp(function (e) {\r\n            var _a;\r\n            if (e.target.type !== 9 /* CONTENT_WIDGET */) {\r\n                return;\r\n            }\r\n            var target = e.target.element;\r\n            if ((target === null || target === void 0 ? void 0 : target.tagName) === 'SPAN') {\r\n                target = target.parentElement;\r\n            }\r\n            if ((target === null || target === void 0 ? void 0 : target.tagName) === 'A') {\r\n                for (var _i = 0, _b = _this._lenses; _i < _b.length; _i++) {\r\n                    var lens = _b[_i];\r\n                    var command = lens.getCommand(target);\r\n                    if (command) {\r\n                        (_a = _this._commandService).executeCommand.apply(_a, __spreadArrays([command.id], (command.arguments || []))).catch(function (err) { return _this._notificationService.error(err); });\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }));\r\n        scheduler.schedule();\r\n    };\r\n    CodeLensContribution.prototype._disposeAllLenses = function (decChangeAccessor, viewZoneChangeAccessor) {\r\n        var helper = new CodeLensHelper();\r\n        for (var _i = 0, _a = this._lenses; _i < _a.length; _i++) {\r\n            var lens = _a[_i];\r\n            lens.dispose(helper, viewZoneChangeAccessor);\r\n        }\r\n        if (decChangeAccessor) {\r\n            helper.commit(decChangeAccessor);\r\n        }\r\n        this._lenses = [];\r\n    };\r\n    CodeLensContribution.prototype._renderCodeLensSymbols = function (symbols) {\r\n        var _this = this;\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var maxLineNumber = this._editor.getModel().getLineCount();\r\n        var groups = [];\r\n        var lastGroup;\r\n        for (var _i = 0, _a = symbols.lenses; _i < _a.length; _i++) {\r\n            var symbol = _a[_i];\r\n            var line = symbol.symbol.range.startLineNumber;\r\n            if (line < 1 || line > maxLineNumber) {\r\n                // invalid code lens\r\n                continue;\r\n            }\r\n            else if (lastGroup && lastGroup[lastGroup.length - 1].symbol.range.startLineNumber === line) {\r\n                // on same line as previous\r\n                lastGroup.push(symbol);\r\n            }\r\n            else {\r\n                // on later line as previous\r\n                lastGroup = [symbol];\r\n                groups.push(lastGroup);\r\n            }\r\n        }\r\n        var scrollState = StableEditorScrollState.capture(this._editor);\r\n        this._editor.changeDecorations(function (decorationsAccessor) {\r\n            _this._editor.changeViewZones(function (viewZoneAccessor) {\r\n                var helper = new CodeLensHelper();\r\n                var codeLensIndex = 0;\r\n                var groupsIndex = 0;\r\n                while (groupsIndex < groups.length && codeLensIndex < _this._lenses.length) {\r\n                    var symbolsLineNumber = groups[groupsIndex][0].symbol.range.startLineNumber;\r\n                    var codeLensLineNumber = _this._lenses[codeLensIndex].getLineNumber();\r\n                    if (codeLensLineNumber < symbolsLineNumber) {\r\n                        _this._lenses[codeLensIndex].dispose(helper, viewZoneAccessor);\r\n                        _this._lenses.splice(codeLensIndex, 1);\r\n                    }\r\n                    else if (codeLensLineNumber === symbolsLineNumber) {\r\n                        _this._lenses[codeLensIndex].updateCodeLensSymbols(groups[groupsIndex], helper);\r\n                        groupsIndex++;\r\n                        codeLensIndex++;\r\n                    }\r\n                    else {\r\n                        _this._lenses.splice(codeLensIndex, 0, new CodeLensWidget(groups[groupsIndex], _this._editor, _this._styleClassName, helper, viewZoneAccessor, function () { return _this._detectVisibleLenses && _this._detectVisibleLenses.schedule(); }));\r\n                        codeLensIndex++;\r\n                        groupsIndex++;\r\n                    }\r\n                }\r\n                // Delete extra code lenses\r\n                while (codeLensIndex < _this._lenses.length) {\r\n                    _this._lenses[codeLensIndex].dispose(helper, viewZoneAccessor);\r\n                    _this._lenses.splice(codeLensIndex, 1);\r\n                }\r\n                // Create extra symbols\r\n                while (groupsIndex < groups.length) {\r\n                    _this._lenses.push(new CodeLensWidget(groups[groupsIndex], _this._editor, _this._styleClassName, helper, viewZoneAccessor, function () { return _this._detectVisibleLenses && _this._detectVisibleLenses.schedule(); }));\r\n                    groupsIndex++;\r\n                }\r\n                helper.commit(decorationsAccessor);\r\n            });\r\n        });\r\n        scrollState.restore(this._editor);\r\n    };\r\n    CodeLensContribution.prototype._onViewportChanged = function () {\r\n        var _this = this;\r\n        if (this._currentResolveCodeLensSymbolsPromise) {\r\n            this._currentResolveCodeLensSymbolsPromise.cancel();\r\n            this._currentResolveCodeLensSymbolsPromise = undefined;\r\n        }\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return;\r\n        }\r\n        var toResolve = [];\r\n        var lenses = [];\r\n        this._lenses.forEach(function (lens) {\r\n            var request = lens.computeIfNecessary(model);\r\n            if (request) {\r\n                toResolve.push(request);\r\n                lenses.push(lens);\r\n            }\r\n        });\r\n        if (toResolve.length === 0) {\r\n            return;\r\n        }\r\n        var resolvePromise = createCancelablePromise(function (token) {\r\n            var promises = toResolve.map(function (request, i) {\r\n                var resolvedSymbols = new Array(request.length);\r\n                var promises = request.map(function (request, i) {\r\n                    if (!request.symbol.command && typeof request.provider.resolveCodeLens === 'function') {\r\n                        return Promise.resolve(request.provider.resolveCodeLens(model, request.symbol, token)).then(function (symbol) {\r\n                            resolvedSymbols[i] = symbol;\r\n                        }, onUnexpectedExternalError);\r\n                    }\r\n                    else {\r\n                        resolvedSymbols[i] = request.symbol;\r\n                        return Promise.resolve(undefined);\r\n                    }\r\n                });\r\n                return Promise.all(promises).then(function () {\r\n                    if (!token.isCancellationRequested && !lenses[i].isDisposed()) {\r\n                        lenses[i].updateCommands(resolvedSymbols);\r\n                    }\r\n                });\r\n            });\r\n            return Promise.all(promises);\r\n        });\r\n        this._currentResolveCodeLensSymbolsPromise = resolvePromise;\r\n        this._currentResolveCodeLensSymbolsPromise.then(function () {\r\n            if (_this._currentCodeLensModel) { // update the cached state with new resolved items\r\n                _this._codeLensCache.put(model, _this._currentCodeLensModel);\r\n            }\r\n            _this._oldCodeLensModels.clear(); // dispose old models once we have updated the UI with the current model\r\n            if (resolvePromise === _this._currentResolveCodeLensSymbolsPromise) {\r\n                _this._currentResolveCodeLensSymbolsPromise = undefined;\r\n            }\r\n        }, function (err) {\r\n            onUnexpectedError(err); // can also be cancellation!\r\n            if (resolvePromise === _this._currentResolveCodeLensSymbolsPromise) {\r\n                _this._currentResolveCodeLensSymbolsPromise = undefined;\r\n            }\r\n        });\r\n    };\r\n    CodeLensContribution.ID = 'css.editor.codeLens';\r\n    CodeLensContribution = __decorate([\r\n        __param(1, ICommandService),\r\n        __param(2, INotificationService),\r\n        __param(3, ICodeLensCache)\r\n    ], CodeLensContribution);\r\n    return CodeLensContribution;\r\n}());\r\nexport { CodeLensContribution };\r\nregisterEditorContribution(CodeLensContribution.ID, CodeLensContribution);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport * as nls from '../../../nls.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { ActionViewItem, Separator } from '../../../base/browser/ui/actionbar/actionbar.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { IMenuService, SubmenuItemAction } from '../../../platform/actions/common/actions.js';\r\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { IContextMenuService, IContextViewService } from '../../../platform/contextview/browser/contextView.js';\r\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\r\nimport { ContextSubMenu } from '../../../base/browser/contextmenu.js';\r\nvar ContextMenuController = /** @class */ (function () {\r\n    function ContextMenuController(editor, _contextMenuService, _contextViewService, _contextKeyService, _keybindingService, _menuService) {\r\n        var _this = this;\r\n        this._contextMenuService = _contextMenuService;\r\n        this._contextViewService = _contextViewService;\r\n        this._contextKeyService = _contextKeyService;\r\n        this._keybindingService = _keybindingService;\r\n        this._menuService = _menuService;\r\n        this._toDispose = new DisposableStore();\r\n        this._contextMenuIsBeingShownCount = 0;\r\n        this._editor = editor;\r\n        this._toDispose.add(this._editor.onContextMenu(function (e) { return _this._onContextMenu(e); }));\r\n        this._toDispose.add(this._editor.onMouseWheel(function (e) {\r\n            if (_this._contextMenuIsBeingShownCount > 0) {\r\n                _this._contextViewService.hideContextView();\r\n            }\r\n        }));\r\n        this._toDispose.add(this._editor.onKeyDown(function (e) {\r\n            if (e.keyCode === 58 /* ContextMenu */) {\r\n                // Chrome is funny like that\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                _this.showContextMenu();\r\n            }\r\n        }));\r\n    }\r\n    ContextMenuController.get = function (editor) {\r\n        return editor.getContribution(ContextMenuController.ID);\r\n    };\r\n    ContextMenuController.prototype._onContextMenu = function (e) {\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        if (!this._editor.getOption(14 /* contextmenu */)) {\r\n            this._editor.focus();\r\n            // Ensure the cursor is at the position of the mouse click\r\n            if (e.target.position && !this._editor.getSelection().containsPosition(e.target.position)) {\r\n                this._editor.setPosition(e.target.position);\r\n            }\r\n            return; // Context menu is turned off through configuration\r\n        }\r\n        if (e.target.type === 12 /* OVERLAY_WIDGET */) {\r\n            return; // allow native menu on widgets to support right click on input field for example in find\r\n        }\r\n        e.event.preventDefault();\r\n        if (e.target.type !== 6 /* CONTENT_TEXT */ && e.target.type !== 7 /* CONTENT_EMPTY */ && e.target.type !== 1 /* TEXTAREA */) {\r\n            return; // only support mouse click into text or native context menu key for now\r\n        }\r\n        // Ensure the editor gets focus if it hasn't, so the right events are being sent to other contributions\r\n        this._editor.focus();\r\n        // Ensure the cursor is at the position of the mouse click\r\n        if (e.target.position) {\r\n            var hasSelectionAtPosition = false;\r\n            for (var _i = 0, _a = this._editor.getSelections(); _i < _a.length; _i++) {\r\n                var selection = _a[_i];\r\n                if (selection.containsPosition(e.target.position)) {\r\n                    hasSelectionAtPosition = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!hasSelectionAtPosition) {\r\n                this._editor.setPosition(e.target.position);\r\n            }\r\n        }\r\n        // Unless the user triggerd the context menu through Shift+F10, use the mouse position as menu position\r\n        var anchor = null;\r\n        if (e.target.type !== 1 /* TEXTAREA */) {\r\n            anchor = { x: e.event.posx - 1, width: 2, y: e.event.posy - 1, height: 2 };\r\n        }\r\n        // Show the context menu\r\n        this.showContextMenu(anchor);\r\n    };\r\n    ContextMenuController.prototype.showContextMenu = function (anchor) {\r\n        if (!this._editor.getOption(14 /* contextmenu */)) {\r\n            return; // Context menu is turned off through configuration\r\n        }\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        if (!this._contextMenuService) {\r\n            this._editor.focus();\r\n            return; // We need the context menu service to function\r\n        }\r\n        // Find actions available for menu\r\n        var menuActions = this._getMenuActions(this._editor.getModel(), 7 /* EditorContext */);\r\n        // Show menu if we have actions to show\r\n        if (menuActions.length > 0) {\r\n            this._doShowContextMenu(menuActions, anchor);\r\n        }\r\n    };\r\n    ContextMenuController.prototype._getMenuActions = function (model, menuId) {\r\n        var result = [];\r\n        // get menu groups\r\n        var menu = this._menuService.createMenu(menuId, this._contextKeyService);\r\n        var groups = menu.getActions({ arg: model.uri });\r\n        menu.dispose();\r\n        // translate them into other actions\r\n        for (var _i = 0, groups_1 = groups; _i < groups_1.length; _i++) {\r\n            var group = groups_1[_i];\r\n            var actions = group[1];\r\n            var addedItems = 0;\r\n            for (var _a = 0, actions_1 = actions; _a < actions_1.length; _a++) {\r\n                var action = actions_1[_a];\r\n                if (action instanceof SubmenuItemAction) {\r\n                    var subActions = this._getMenuActions(model, action.item.submenu);\r\n                    if (subActions.length > 0) {\r\n                        result.push(new ContextSubMenu(action.label, subActions));\r\n                        addedItems++;\r\n                    }\r\n                }\r\n                else {\r\n                    result.push(action);\r\n                    addedItems++;\r\n                }\r\n            }\r\n            if (addedItems) {\r\n                result.push(new Separator());\r\n            }\r\n        }\r\n        if (result.length) {\r\n            result.pop(); // remove last separator\r\n        }\r\n        return result;\r\n    };\r\n    ContextMenuController.prototype._doShowContextMenu = function (actions, anchor) {\r\n        var _this = this;\r\n        if (anchor === void 0) { anchor = null; }\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        // Disable hover\r\n        var oldHoverSetting = this._editor.getOption(44 /* hover */);\r\n        this._editor.updateOptions({\r\n            hover: {\r\n                enabled: false\r\n            }\r\n        });\r\n        if (!anchor) {\r\n            // Ensure selection is visible\r\n            this._editor.revealPosition(this._editor.getPosition(), 1 /* Immediate */);\r\n            this._editor.render();\r\n            var cursorCoords = this._editor.getScrolledVisiblePosition(this._editor.getPosition());\r\n            // Translate to absolute editor position\r\n            var editorCoords = dom.getDomNodePagePosition(this._editor.getDomNode());\r\n            var posx = editorCoords.left + cursorCoords.left;\r\n            var posy = editorCoords.top + cursorCoords.top + cursorCoords.height;\r\n            anchor = { x: posx, y: posy };\r\n        }\r\n        // Show menu\r\n        this._contextMenuIsBeingShownCount++;\r\n        this._contextMenuService.showContextMenu({\r\n            getAnchor: function () { return anchor; },\r\n            getActions: function () { return actions; },\r\n            getActionViewItem: function (action) {\r\n                var keybinding = _this._keybindingFor(action);\r\n                if (keybinding) {\r\n                    return new ActionViewItem(action, action, { label: true, keybinding: keybinding.getLabel(), isMenu: true });\r\n                }\r\n                var customActionViewItem = action;\r\n                if (typeof customActionViewItem.getActionViewItem === 'function') {\r\n                    return customActionViewItem.getActionViewItem();\r\n                }\r\n                return new ActionViewItem(action, action, { icon: true, label: true, isMenu: true });\r\n            },\r\n            getKeyBinding: function (action) {\r\n                return _this._keybindingFor(action);\r\n            },\r\n            onHide: function (wasCancelled) {\r\n                _this._contextMenuIsBeingShownCount--;\r\n                _this._editor.focus();\r\n                _this._editor.updateOptions({\r\n                    hover: oldHoverSetting\r\n                });\r\n            }\r\n        });\r\n    };\r\n    ContextMenuController.prototype._keybindingFor = function (action) {\r\n        return this._keybindingService.lookupKeybinding(action.id);\r\n    };\r\n    ContextMenuController.prototype.dispose = function () {\r\n        if (this._contextMenuIsBeingShownCount > 0) {\r\n            this._contextViewService.hideContextView();\r\n        }\r\n        this._toDispose.dispose();\r\n    };\r\n    ContextMenuController.ID = 'editor.contrib.contextmenu';\r\n    ContextMenuController = __decorate([\r\n        __param(1, IContextMenuService),\r\n        __param(2, IContextViewService),\r\n        __param(3, IContextKeyService),\r\n        __param(4, IKeybindingService),\r\n        __param(5, IMenuService)\r\n    ], ContextMenuController);\r\n    return ContextMenuController;\r\n}());\r\nexport { ContextMenuController };\r\nvar ShowContextMenu = /** @class */ (function (_super) {\r\n    __extends(ShowContextMenu, _super);\r\n    function ShowContextMenu() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.showContextMenu',\r\n            label: nls.localize('action.showContextMenu.label', \"Show Editor Context Menu\"),\r\n            alias: 'Show Editor Context Menu',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.textInputFocus,\r\n                primary: 1024 /* Shift */ | 68 /* F10 */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    ShowContextMenu.prototype.run = function (accessor, editor) {\r\n        var contribution = ContextMenuController.get(editor);\r\n        contribution.showContextMenu();\r\n    };\r\n    return ShowContextMenu;\r\n}(EditorAction));\r\nregisterEditorContribution(ContextMenuController.ID, ContextMenuController);\r\nregisterEditorAction(ShowContextMenu);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { equals, flatten, isNonEmptyArray, mergeSort } from '../../../base/common/arrays.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { illegalArgument, isPromiseCanceledError, onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { TextModelCancellationTokenSource } from '../../browser/core/editorState.js';\r\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport * as modes from '../../common/modes.js';\r\nimport { IModelService } from '../../common/services/modelService.js';\r\nimport { CodeActionKind, filtersAction, mayIncludeActionsOfKind } from './types.js';\r\nexport var codeActionCommandId = 'editor.action.codeAction';\r\nexport var refactorCommandId = 'editor.action.refactor';\r\nexport var sourceActionCommandId = 'editor.action.sourceAction';\r\nexport var organizeImportsCommandId = 'editor.action.organizeImports';\r\nexport var fixAllCommandId = 'editor.action.fixAll';\r\nvar ManagedCodeActionSet = /** @class */ (function (_super) {\r\n    __extends(ManagedCodeActionSet, _super);\r\n    function ManagedCodeActionSet(actions, disposables) {\r\n        var _this = _super.call(this) || this;\r\n        _this._register(disposables);\r\n        _this.allActions = mergeSort(__spreadArrays(actions), ManagedCodeActionSet.codeActionsComparator);\r\n        _this.validActions = _this.allActions.filter(function (action) { return !action.disabled; });\r\n        return _this;\r\n    }\r\n    ManagedCodeActionSet.codeActionsComparator = function (a, b) {\r\n        if (isNonEmptyArray(a.diagnostics)) {\r\n            if (isNonEmptyArray(b.diagnostics)) {\r\n                return a.diagnostics[0].message.localeCompare(b.diagnostics[0].message);\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (isNonEmptyArray(b.diagnostics)) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return 0; // both have no diagnostics\r\n        }\r\n    };\r\n    Object.defineProperty(ManagedCodeActionSet.prototype, \"hasAutoFix\", {\r\n        get: function () {\r\n            return this.validActions.some(function (fix) { return !!fix.kind && CodeActionKind.QuickFix.contains(new CodeActionKind(fix.kind)) && !!fix.isPreferred; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ManagedCodeActionSet;\r\n}(Disposable));\r\nexport function getCodeActions(model, rangeOrSelection, trigger, token) {\r\n    var _this = this;\r\n    var _a;\r\n    var filter = trigger.filter || {};\r\n    var codeActionContext = {\r\n        only: (_a = filter.include) === null || _a === void 0 ? void 0 : _a.value,\r\n        trigger: trigger.type,\r\n    };\r\n    var cts = new TextModelCancellationTokenSource(model, token);\r\n    var providers = getCodeActionProviders(model, filter);\r\n    var disposables = new DisposableStore();\r\n    var promises = providers.map(function (provider) { return __awaiter(_this, void 0, void 0, function () {\r\n        var providedCodeActions, err_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 3]);\r\n                    return [4 /*yield*/, provider.provideCodeActions(model, rangeOrSelection, codeActionContext, cts.token)];\r\n                case 1:\r\n                    providedCodeActions = _a.sent();\r\n                    if (cts.token.isCancellationRequested || !providedCodeActions) {\r\n                        return [2 /*return*/, []];\r\n                    }\r\n                    disposables.add(providedCodeActions);\r\n                    return [2 /*return*/, providedCodeActions.actions.filter(function (action) { return action && filtersAction(filter, action); })];\r\n                case 2:\r\n                    err_1 = _a.sent();\r\n                    if (isPromiseCanceledError(err_1)) {\r\n                        throw err_1;\r\n                    }\r\n                    onUnexpectedExternalError(err_1);\r\n                    return [2 /*return*/, []];\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    }); });\r\n    var listener = modes.CodeActionProviderRegistry.onDidChange(function () {\r\n        var newProviders = modes.CodeActionProviderRegistry.all(model);\r\n        if (!equals(newProviders, providers)) {\r\n            cts.cancel();\r\n        }\r\n    });\r\n    return Promise.all(promises)\r\n        .then(flatten)\r\n        .then(function (actions) { return new ManagedCodeActionSet(actions, disposables); })\r\n        .finally(function () {\r\n        listener.dispose();\r\n        cts.dispose();\r\n    });\r\n}\r\nfunction getCodeActionProviders(model, filter) {\r\n    return modes.CodeActionProviderRegistry.all(model)\r\n        // Don't include providers that we know will not return code actions of interest\r\n        .filter(function (provider) {\r\n        if (!provider.providedCodeActionKinds) {\r\n            // We don't know what type of actions this provider will return.\r\n            return true;\r\n        }\r\n        return provider.providedCodeActionKinds.some(function (kind) { return mayIncludeActionsOfKind(filter, new CodeActionKind(kind)); });\r\n    });\r\n}\r\nregisterLanguageCommand('_executeCodeActionProvider', function (accessor, args) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var resource, rangeOrSelection, kind, model, validatedRangeOrSelection, codeActionSet;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    resource = args.resource, rangeOrSelection = args.rangeOrSelection, kind = args.kind;\r\n                    if (!(resource instanceof URI)) {\r\n                        throw illegalArgument();\r\n                    }\r\n                    model = accessor.get(IModelService).getModel(resource);\r\n                    if (!model) {\r\n                        throw illegalArgument();\r\n                    }\r\n                    validatedRangeOrSelection = Selection.isISelection(rangeOrSelection)\r\n                        ? Selection.liftSelection(rangeOrSelection)\r\n                        : Range.isIRange(rangeOrSelection)\r\n                            ? model.validateRange(rangeOrSelection)\r\n                            : undefined;\r\n                    if (!validatedRangeOrSelection) {\r\n                        throw illegalArgument();\r\n                    }\r\n                    return [4 /*yield*/, getCodeActions(model, validatedRangeOrSelection, { type: 2 /* Manual */, filter: { includeSourceActions: true, include: kind && kind.value ? new CodeActionKind(kind.value) : undefined } }, CancellationToken.None)];\r\n                case 1:\r\n                    codeActionSet = _a.sent();\r\n                    setTimeout(function () { return codeActionSet.dispose(); }, 100);\r\n                    return [2 /*return*/, codeActionSet.validActions];\r\n            }\r\n        });\r\n    });\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { TimeoutTimer, createCancelablePromise } from '../../../base/common/async.js';\r\nimport { RGBA } from '../../../base/common/color.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { hash } from '../../../base/common/hash.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { ColorProviderRegistry } from '../../common/modes.js';\r\nimport { getColors } from './color.js';\r\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\r\nvar MAX_DECORATORS = 500;\r\nvar ColorDetector = /** @class */ (function (_super) {\r\n    __extends(ColorDetector, _super);\r\n    function ColorDetector(_editor, _codeEditorService, _configurationService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._codeEditorService = _codeEditorService;\r\n        _this._configurationService = _configurationService;\r\n        _this._localToDispose = _this._register(new DisposableStore());\r\n        _this._decorationsIds = [];\r\n        _this._colorDatas = new Map();\r\n        _this._colorDecoratorIds = [];\r\n        _this._decorationsTypes = new Set();\r\n        _this._register(_editor.onDidChangeModel(function (e) {\r\n            _this._isEnabled = _this.isEnabled();\r\n            _this.onModelChanged();\r\n        }));\r\n        _this._register(_editor.onDidChangeModelLanguage(function (e) { return _this.onModelChanged(); }));\r\n        _this._register(ColorProviderRegistry.onDidChange(function (e) { return _this.onModelChanged(); }));\r\n        _this._register(_editor.onDidChangeConfiguration(function (e) {\r\n            var prevIsEnabled = _this._isEnabled;\r\n            _this._isEnabled = _this.isEnabled();\r\n            if (prevIsEnabled !== _this._isEnabled) {\r\n                if (_this._isEnabled) {\r\n                    _this.onModelChanged();\r\n                }\r\n                else {\r\n                    _this.removeAllDecorations();\r\n                }\r\n            }\r\n        }));\r\n        _this._timeoutTimer = null;\r\n        _this._computePromise = null;\r\n        _this._isEnabled = _this.isEnabled();\r\n        _this.onModelChanged();\r\n        return _this;\r\n    }\r\n    ColorDetector.prototype.isEnabled = function () {\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return false;\r\n        }\r\n        var languageId = model.getLanguageIdentifier();\r\n        // handle deprecated settings. [languageId].colorDecorators.enable\r\n        var deprecatedConfig = this._configurationService.getValue(languageId.language);\r\n        if (deprecatedConfig) {\r\n            var colorDecorators = deprecatedConfig['colorDecorators']; // deprecatedConfig.valueOf('.colorDecorators.enable');\r\n            if (colorDecorators && colorDecorators['enable'] !== undefined && !colorDecorators['enable']) {\r\n                return colorDecorators['enable'];\r\n            }\r\n        }\r\n        return this._editor.getOption(12 /* colorDecorators */);\r\n    };\r\n    ColorDetector.get = function (editor) {\r\n        return editor.getContribution(this.ID);\r\n    };\r\n    ColorDetector.prototype.dispose = function () {\r\n        this.stop();\r\n        this.removeAllDecorations();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ColorDetector.prototype.onModelChanged = function () {\r\n        var _this = this;\r\n        this.stop();\r\n        if (!this._isEnabled) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        if (!model || !ColorProviderRegistry.has(model)) {\r\n            return;\r\n        }\r\n        this._localToDispose.add(this._editor.onDidChangeModelContent(function (e) {\r\n            if (!_this._timeoutTimer) {\r\n                _this._timeoutTimer = new TimeoutTimer();\r\n                _this._timeoutTimer.cancelAndSet(function () {\r\n                    _this._timeoutTimer = null;\r\n                    _this.beginCompute();\r\n                }, ColorDetector.RECOMPUTE_TIME);\r\n            }\r\n        }));\r\n        this.beginCompute();\r\n    };\r\n    ColorDetector.prototype.beginCompute = function () {\r\n        var _this = this;\r\n        this._computePromise = createCancelablePromise(function (token) {\r\n            var model = _this._editor.getModel();\r\n            if (!model) {\r\n                return Promise.resolve([]);\r\n            }\r\n            return getColors(model, token);\r\n        });\r\n        this._computePromise.then(function (colorInfos) {\r\n            _this.updateDecorations(colorInfos);\r\n            _this.updateColorDecorators(colorInfos);\r\n            _this._computePromise = null;\r\n        }, onUnexpectedError);\r\n    };\r\n    ColorDetector.prototype.stop = function () {\r\n        if (this._timeoutTimer) {\r\n            this._timeoutTimer.cancel();\r\n            this._timeoutTimer = null;\r\n        }\r\n        if (this._computePromise) {\r\n            this._computePromise.cancel();\r\n            this._computePromise = null;\r\n        }\r\n        this._localToDispose.clear();\r\n    };\r\n    ColorDetector.prototype.updateDecorations = function (colorDatas) {\r\n        var _this = this;\r\n        var decorations = colorDatas.map(function (c) { return ({\r\n            range: {\r\n                startLineNumber: c.colorInfo.range.startLineNumber,\r\n                startColumn: c.colorInfo.range.startColumn,\r\n                endLineNumber: c.colorInfo.range.endLineNumber,\r\n                endColumn: c.colorInfo.range.endColumn\r\n            },\r\n            options: ModelDecorationOptions.EMPTY\r\n        }); });\r\n        this._decorationsIds = this._editor.deltaDecorations(this._decorationsIds, decorations);\r\n        this._colorDatas = new Map();\r\n        this._decorationsIds.forEach(function (id, i) { return _this._colorDatas.set(id, colorDatas[i]); });\r\n    };\r\n    ColorDetector.prototype.updateColorDecorators = function (colorData) {\r\n        var _this = this;\r\n        var decorations = [];\r\n        var newDecorationsTypes = {};\r\n        for (var i = 0; i < colorData.length && decorations.length < MAX_DECORATORS; i++) {\r\n            var _a = colorData[i].colorInfo.color, red = _a.red, green = _a.green, blue = _a.blue, alpha = _a.alpha;\r\n            var rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\r\n            var subKey = hash(rgba).toString(16);\r\n            var color = \"rgba(\" + rgba.r + \", \" + rgba.g + \", \" + rgba.b + \", \" + rgba.a + \")\";\r\n            var key = 'colorBox-' + subKey;\r\n            if (!this._decorationsTypes.has(key) && !newDecorationsTypes[key]) {\r\n                this._codeEditorService.registerDecorationType(key, {\r\n                    before: {\r\n                        contentText: ' ',\r\n                        border: 'solid 0.1em #000',\r\n                        margin: '0.1em 0.2em 0 0.2em',\r\n                        width: '0.8em',\r\n                        height: '0.8em',\r\n                        backgroundColor: color\r\n                    },\r\n                    dark: {\r\n                        before: {\r\n                            border: 'solid 0.1em #eee'\r\n                        }\r\n                    }\r\n                }, undefined, this._editor);\r\n            }\r\n            newDecorationsTypes[key] = true;\r\n            decorations.push({\r\n                range: {\r\n                    startLineNumber: colorData[i].colorInfo.range.startLineNumber,\r\n                    startColumn: colorData[i].colorInfo.range.startColumn,\r\n                    endLineNumber: colorData[i].colorInfo.range.endLineNumber,\r\n                    endColumn: colorData[i].colorInfo.range.endColumn\r\n                },\r\n                options: this._codeEditorService.resolveDecorationOptions(key, true)\r\n            });\r\n        }\r\n        this._decorationsTypes.forEach(function (subType) {\r\n            if (!newDecorationsTypes[subType]) {\r\n                _this._codeEditorService.removeDecorationType(subType);\r\n            }\r\n        });\r\n        this._colorDecoratorIds = this._editor.deltaDecorations(this._colorDecoratorIds, decorations);\r\n    };\r\n    ColorDetector.prototype.removeAllDecorations = function () {\r\n        var _this = this;\r\n        this._decorationsIds = this._editor.deltaDecorations(this._decorationsIds, []);\r\n        this._colorDecoratorIds = this._editor.deltaDecorations(this._colorDecoratorIds, []);\r\n        this._decorationsTypes.forEach(function (subType) {\r\n            _this._codeEditorService.removeDecorationType(subType);\r\n        });\r\n    };\r\n    ColorDetector.prototype.getColorData = function (position) {\r\n        var _this = this;\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return null;\r\n        }\r\n        var decorations = model\r\n            .getDecorationsInRange(Range.fromPositions(position, position))\r\n            .filter(function (d) { return _this._colorDatas.has(d.id); });\r\n        if (decorations.length === 0) {\r\n            return null;\r\n        }\r\n        return this._colorDatas.get(decorations[0].id);\r\n    };\r\n    ColorDetector.ID = 'editor.contrib.colorDetector';\r\n    ColorDetector.RECOMPUTE_TIME = 1000; // ms\r\n    ColorDetector = __decorate([\r\n        __param(1, ICodeEditorService),\r\n        __param(2, IConfigurationService)\r\n    ], ColorDetector);\r\n    return ColorDetector;\r\n}(Disposable));\r\nexport { ColorDetector };\r\nregisterEditorContribution(ColorDetector.ID, ColorDetector);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { startsWith } from '../../../base/common/strings.js';\r\nvar CodeActionKind = /** @class */ (function () {\r\n    function CodeActionKind(value) {\r\n        this.value = value;\r\n    }\r\n    CodeActionKind.prototype.equals = function (other) {\r\n        return this.value === other.value;\r\n    };\r\n    CodeActionKind.prototype.contains = function (other) {\r\n        return this.equals(other) || this.value === '' || startsWith(other.value, this.value + CodeActionKind.sep);\r\n    };\r\n    CodeActionKind.prototype.intersects = function (other) {\r\n        return this.contains(other) || other.contains(this);\r\n    };\r\n    CodeActionKind.prototype.append = function (part) {\r\n        return new CodeActionKind(this.value + CodeActionKind.sep + part);\r\n    };\r\n    CodeActionKind.sep = '.';\r\n    CodeActionKind.None = new CodeActionKind('@@none@@'); // Special code action that contains nothing\r\n    CodeActionKind.Empty = new CodeActionKind('');\r\n    CodeActionKind.QuickFix = new CodeActionKind('quickfix');\r\n    CodeActionKind.Refactor = new CodeActionKind('refactor');\r\n    CodeActionKind.Source = new CodeActionKind('source');\r\n    CodeActionKind.SourceOrganizeImports = CodeActionKind.Source.append('organizeImports');\r\n    CodeActionKind.SourceFixAll = CodeActionKind.Source.append('fixAll');\r\n    return CodeActionKind;\r\n}());\r\nexport { CodeActionKind };\r\nexport function mayIncludeActionsOfKind(filter, providedKind) {\r\n    // A provided kind may be a subset or superset of our filtered kind.\r\n    if (filter.include && !filter.include.intersects(providedKind)) {\r\n        return false;\r\n    }\r\n    if (filter.excludes) {\r\n        if (filter.excludes.some(function (exclude) { return excludesAction(providedKind, exclude, filter.include); })) {\r\n            return false;\r\n        }\r\n    }\r\n    // Don't return source actions unless they are explicitly requested\r\n    if (!filter.includeSourceActions && CodeActionKind.Source.contains(providedKind)) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\nexport function filtersAction(filter, action) {\r\n    var actionKind = action.kind ? new CodeActionKind(action.kind) : undefined;\r\n    // Filter out actions by kind\r\n    if (filter.include) {\r\n        if (!actionKind || !filter.include.contains(actionKind)) {\r\n            return false;\r\n        }\r\n    }\r\n    if (filter.excludes) {\r\n        if (actionKind && filter.excludes.some(function (exclude) { return excludesAction(actionKind, exclude, filter.include); })) {\r\n            return false;\r\n        }\r\n    }\r\n    // Don't return source actions unless they are explicitly requested\r\n    if (!filter.includeSourceActions) {\r\n        if (actionKind && CodeActionKind.Source.contains(actionKind)) {\r\n            return false;\r\n        }\r\n    }\r\n    if (filter.onlyIncludePreferredActions) {\r\n        if (!action.isPreferred) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction excludesAction(providedKind, exclude, include) {\r\n    if (!exclude.contains(providedKind)) {\r\n        return false;\r\n    }\r\n    if (include && exclude.contains(include)) {\r\n        // The include is more specific, don't filter out\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\nvar CodeActionCommandArgs = /** @class */ (function () {\r\n    function CodeActionCommandArgs(kind, apply, preferred) {\r\n        this.kind = kind;\r\n        this.apply = apply;\r\n        this.preferred = preferred;\r\n    }\r\n    CodeActionCommandArgs.fromUser = function (arg, defaults) {\r\n        if (!arg || typeof arg !== 'object') {\r\n            return new CodeActionCommandArgs(defaults.kind, defaults.apply, false);\r\n        }\r\n        return new CodeActionCommandArgs(CodeActionCommandArgs.getKindFromUser(arg, defaults.kind), CodeActionCommandArgs.getApplyFromUser(arg, defaults.apply), CodeActionCommandArgs.getPreferredUser(arg));\r\n    };\r\n    CodeActionCommandArgs.getApplyFromUser = function (arg, defaultAutoApply) {\r\n        switch (typeof arg.apply === 'string' ? arg.apply.toLowerCase() : '') {\r\n            case 'first': return \"first\" /* First */;\r\n            case 'never': return \"never\" /* Never */;\r\n            case 'ifsingle': return \"ifSingle\" /* IfSingle */;\r\n            default: return defaultAutoApply;\r\n        }\r\n    };\r\n    CodeActionCommandArgs.getKindFromUser = function (arg, defaultKind) {\r\n        return typeof arg.kind === 'string'\r\n            ? new CodeActionKind(arg.kind)\r\n            : defaultKind;\r\n    };\r\n    CodeActionCommandArgs.getPreferredUser = function (arg) {\r\n        return typeof arg.preferred === 'boolean'\r\n            ? arg.preferred\r\n            : false;\r\n    };\r\n    return CodeActionCommandArgs;\r\n}());\r\nexport { CodeActionCommandArgs };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { EditOperation } from '../../common/core/editOperation.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\r\nvar BlockCommentCommand = /** @class */ (function () {\r\n    function BlockCommentCommand(selection, insertSpace) {\r\n        this._selection = selection;\r\n        this._insertSpace = insertSpace;\r\n        this._usedEndToken = null;\r\n    }\r\n    BlockCommentCommand._haystackHasNeedleAtOffset = function (haystack, needle, offset) {\r\n        if (offset < 0) {\r\n            return false;\r\n        }\r\n        var needleLength = needle.length;\r\n        var haystackLength = haystack.length;\r\n        if (offset + needleLength > haystackLength) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < needleLength; i++) {\r\n            var codeA = haystack.charCodeAt(offset + i);\r\n            var codeB = needle.charCodeAt(i);\r\n            if (codeA === codeB) {\r\n                continue;\r\n            }\r\n            if (codeA >= 65 /* A */ && codeA <= 90 /* Z */ && codeA + 32 === codeB) {\r\n                // codeA is upper-case variant of codeB\r\n                continue;\r\n            }\r\n            if (codeB >= 65 /* A */ && codeB <= 90 /* Z */ && codeB + 32 === codeA) {\r\n                // codeB is upper-case variant of codeA\r\n                continue;\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    BlockCommentCommand.prototype._createOperationsForBlockComment = function (selection, startToken, endToken, insertSpace, model, builder) {\r\n        var startLineNumber = selection.startLineNumber;\r\n        var startColumn = selection.startColumn;\r\n        var endLineNumber = selection.endLineNumber;\r\n        var endColumn = selection.endColumn;\r\n        var startLineText = model.getLineContent(startLineNumber);\r\n        var endLineText = model.getLineContent(endLineNumber);\r\n        var startTokenIndex = startLineText.lastIndexOf(startToken, startColumn - 1 + startToken.length);\r\n        var endTokenIndex = endLineText.indexOf(endToken, endColumn - 1 - endToken.length);\r\n        if (startTokenIndex !== -1 && endTokenIndex !== -1) {\r\n            if (startLineNumber === endLineNumber) {\r\n                var lineBetweenTokens = startLineText.substring(startTokenIndex + startToken.length, endTokenIndex);\r\n                if (lineBetweenTokens.indexOf(endToken) >= 0) {\r\n                    // force to add a block comment\r\n                    startTokenIndex = -1;\r\n                    endTokenIndex = -1;\r\n                }\r\n            }\r\n            else {\r\n                var startLineAfterStartToken = startLineText.substring(startTokenIndex + startToken.length);\r\n                var endLineBeforeEndToken = endLineText.substring(0, endTokenIndex);\r\n                if (startLineAfterStartToken.indexOf(endToken) >= 0 || endLineBeforeEndToken.indexOf(endToken) >= 0) {\r\n                    // force to add a block comment\r\n                    startTokenIndex = -1;\r\n                    endTokenIndex = -1;\r\n                }\r\n            }\r\n        }\r\n        var ops;\r\n        if (startTokenIndex !== -1 && endTokenIndex !== -1) {\r\n            // Consider spaces as part of the comment tokens\r\n            if (insertSpace && startTokenIndex + startToken.length < startLineText.length && startLineText.charCodeAt(startTokenIndex + startToken.length) === 32 /* Space */) {\r\n                // Pretend the start token contains a trailing space\r\n                startToken = startToken + ' ';\r\n            }\r\n            if (insertSpace && endTokenIndex > 0 && endLineText.charCodeAt(endTokenIndex - 1) === 32 /* Space */) {\r\n                // Pretend the end token contains a leading space\r\n                endToken = ' ' + endToken;\r\n                endTokenIndex -= 1;\r\n            }\r\n            ops = BlockCommentCommand._createRemoveBlockCommentOperations(new Range(startLineNumber, startTokenIndex + startToken.length + 1, endLineNumber, endTokenIndex + 1), startToken, endToken);\r\n        }\r\n        else {\r\n            ops = BlockCommentCommand._createAddBlockCommentOperations(selection, startToken, endToken, this._insertSpace);\r\n            this._usedEndToken = ops.length === 1 ? endToken : null;\r\n        }\r\n        for (var _i = 0, ops_1 = ops; _i < ops_1.length; _i++) {\r\n            var op = ops_1[_i];\r\n            builder.addTrackedEditOperation(op.range, op.text);\r\n        }\r\n    };\r\n    BlockCommentCommand._createRemoveBlockCommentOperations = function (r, startToken, endToken) {\r\n        var res = [];\r\n        if (!Range.isEmpty(r)) {\r\n            // Remove block comment start\r\n            res.push(EditOperation.delete(new Range(r.startLineNumber, r.startColumn - startToken.length, r.startLineNumber, r.startColumn)));\r\n            // Remove block comment end\r\n            res.push(EditOperation.delete(new Range(r.endLineNumber, r.endColumn, r.endLineNumber, r.endColumn + endToken.length)));\r\n        }\r\n        else {\r\n            // Remove both continuously\r\n            res.push(EditOperation.delete(new Range(r.startLineNumber, r.startColumn - startToken.length, r.endLineNumber, r.endColumn + endToken.length)));\r\n        }\r\n        return res;\r\n    };\r\n    BlockCommentCommand._createAddBlockCommentOperations = function (r, startToken, endToken, insertSpace) {\r\n        var res = [];\r\n        if (!Range.isEmpty(r)) {\r\n            // Insert block comment start\r\n            res.push(EditOperation.insert(new Position(r.startLineNumber, r.startColumn), startToken + (insertSpace ? ' ' : '')));\r\n            // Insert block comment end\r\n            res.push(EditOperation.insert(new Position(r.endLineNumber, r.endColumn), (insertSpace ? ' ' : '') + endToken));\r\n        }\r\n        else {\r\n            // Insert both continuously\r\n            res.push(EditOperation.replace(new Range(r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn), startToken + '  ' + endToken));\r\n        }\r\n        return res;\r\n    };\r\n    BlockCommentCommand.prototype.getEditOperations = function (model, builder) {\r\n        var startLineNumber = this._selection.startLineNumber;\r\n        var startColumn = this._selection.startColumn;\r\n        model.tokenizeIfCheap(startLineNumber);\r\n        var languageId = model.getLanguageIdAtPosition(startLineNumber, startColumn);\r\n        var config = LanguageConfigurationRegistry.getComments(languageId);\r\n        if (!config || !config.blockCommentStartToken || !config.blockCommentEndToken) {\r\n            // Mode does not support block comments\r\n            return;\r\n        }\r\n        this._createOperationsForBlockComment(this._selection, config.blockCommentStartToken, config.blockCommentEndToken, this._insertSpace, model, builder);\r\n    };\r\n    BlockCommentCommand.prototype.computeCursorState = function (model, helper) {\r\n        var inverseEditOperations = helper.getInverseEditOperations();\r\n        if (inverseEditOperations.length === 2) {\r\n            var startTokenEditOperation = inverseEditOperations[0];\r\n            var endTokenEditOperation = inverseEditOperations[1];\r\n            return new Selection(startTokenEditOperation.range.endLineNumber, startTokenEditOperation.range.endColumn, endTokenEditOperation.range.startLineNumber, endTokenEditOperation.range.startColumn);\r\n        }\r\n        else {\r\n            var srcRange = inverseEditOperations[0].range;\r\n            var deltaColumn = this._usedEndToken ? -this._usedEndToken.length - 1 : 0; // minus 1 space before endToken\r\n            return new Selection(srcRange.endLineNumber, srcRange.endColumn + deltaColumn, srcRange.endLineNumber, srcRange.endColumn + deltaColumn);\r\n        }\r\n    };\r\n    return BlockCommentCommand;\r\n}());\r\nexport { BlockCommentCommand };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { EditOperation } from '../../common/core/editOperation.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\r\nimport { BlockCommentCommand } from './blockCommentCommand.js';\r\nvar LineCommentCommand = /** @class */ (function () {\r\n    function LineCommentCommand(selection, tabSize, type, insertSpace) {\r\n        this._selection = selection;\r\n        this._tabSize = tabSize;\r\n        this._type = type;\r\n        this._insertSpace = insertSpace;\r\n        this._selectionId = null;\r\n        this._deltaColumn = 0;\r\n        this._moveEndPositionDown = false;\r\n    }\r\n    /**\r\n     * Do an initial pass over the lines and gather info about the line comment string.\r\n     * Returns null if any of the lines doesn't support a line comment string.\r\n     */\r\n    LineCommentCommand._gatherPreflightCommentStrings = function (model, startLineNumber, endLineNumber) {\r\n        model.tokenizeIfCheap(startLineNumber);\r\n        var languageId = model.getLanguageIdAtPosition(startLineNumber, 1);\r\n        var config = LanguageConfigurationRegistry.getComments(languageId);\r\n        var commentStr = (config ? config.lineCommentToken : null);\r\n        if (!commentStr) {\r\n            // Mode does not support line comments\r\n            return null;\r\n        }\r\n        var lines = [];\r\n        for (var i = 0, lineCount = endLineNumber - startLineNumber + 1; i < lineCount; i++) {\r\n            lines[i] = {\r\n                ignore: false,\r\n                commentStr: commentStr,\r\n                commentStrOffset: 0,\r\n                commentStrLength: commentStr.length\r\n            };\r\n        }\r\n        return lines;\r\n    };\r\n    /**\r\n     * Analyze lines and decide which lines are relevant and what the toggle should do.\r\n     * Also, build up several offsets and lengths useful in the generation of editor operations.\r\n     */\r\n    LineCommentCommand._analyzeLines = function (type, insertSpace, model, lines, startLineNumber) {\r\n        var onlyWhitespaceLines = true;\r\n        var shouldRemoveComments;\r\n        if (type === 0 /* Toggle */) {\r\n            shouldRemoveComments = true;\r\n        }\r\n        else if (type === 1 /* ForceAdd */) {\r\n            shouldRemoveComments = false;\r\n        }\r\n        else {\r\n            shouldRemoveComments = true;\r\n        }\r\n        for (var i = 0, lineCount = lines.length; i < lineCount; i++) {\r\n            var lineData = lines[i];\r\n            var lineNumber = startLineNumber + i;\r\n            var lineContent = model.getLineContent(lineNumber);\r\n            var lineContentStartOffset = strings.firstNonWhitespaceIndex(lineContent);\r\n            if (lineContentStartOffset === -1) {\r\n                // Empty or whitespace only line\r\n                if (type === 0 /* Toggle */) {\r\n                    lineData.ignore = true;\r\n                }\r\n                else if (type === 1 /* ForceAdd */) {\r\n                    lineData.ignore = true;\r\n                }\r\n                else {\r\n                    lineData.ignore = true;\r\n                }\r\n                lineData.commentStrOffset = lineContent.length;\r\n                continue;\r\n            }\r\n            onlyWhitespaceLines = false;\r\n            lineData.ignore = false;\r\n            lineData.commentStrOffset = lineContentStartOffset;\r\n            if (shouldRemoveComments && !BlockCommentCommand._haystackHasNeedleAtOffset(lineContent, lineData.commentStr, lineContentStartOffset)) {\r\n                if (type === 0 /* Toggle */) {\r\n                    // Every line so far has been a line comment, but this one is not\r\n                    shouldRemoveComments = false;\r\n                }\r\n                else if (type === 1 /* ForceAdd */) {\r\n                    // Will not happen\r\n                }\r\n                else {\r\n                    lineData.ignore = true;\r\n                }\r\n            }\r\n            if (shouldRemoveComments && insertSpace) {\r\n                // Remove a following space if present\r\n                var commentStrEndOffset = lineContentStartOffset + lineData.commentStrLength;\r\n                if (commentStrEndOffset < lineContent.length && lineContent.charCodeAt(commentStrEndOffset) === 32 /* Space */) {\r\n                    lineData.commentStrLength += 1;\r\n                }\r\n            }\r\n        }\r\n        if (type === 0 /* Toggle */ && onlyWhitespaceLines) {\r\n            // For only whitespace lines, we insert comments\r\n            shouldRemoveComments = false;\r\n            // Also, no longer ignore them\r\n            for (var i = 0, lineCount = lines.length; i < lineCount; i++) {\r\n                lines[i].ignore = false;\r\n            }\r\n        }\r\n        return {\r\n            supported: true,\r\n            shouldRemoveComments: shouldRemoveComments,\r\n            lines: lines\r\n        };\r\n    };\r\n    /**\r\n     * Analyze all lines and decide exactly what to do => not supported | insert line comments | remove line comments\r\n     */\r\n    LineCommentCommand._gatherPreflightData = function (type, insertSpace, model, startLineNumber, endLineNumber) {\r\n        var lines = LineCommentCommand._gatherPreflightCommentStrings(model, startLineNumber, endLineNumber);\r\n        if (lines === null) {\r\n            return {\r\n                supported: false\r\n            };\r\n        }\r\n        return LineCommentCommand._analyzeLines(type, insertSpace, model, lines, startLineNumber);\r\n    };\r\n    /**\r\n     * Given a successful analysis, execute either insert line comments, either remove line comments\r\n     */\r\n    LineCommentCommand.prototype._executeLineComments = function (model, builder, data, s) {\r\n        var ops;\r\n        if (data.shouldRemoveComments) {\r\n            ops = LineCommentCommand._createRemoveLineCommentsOperations(data.lines, s.startLineNumber);\r\n        }\r\n        else {\r\n            LineCommentCommand._normalizeInsertionPoint(model, data.lines, s.startLineNumber, this._tabSize);\r\n            ops = this._createAddLineCommentsOperations(data.lines, s.startLineNumber);\r\n        }\r\n        var cursorPosition = new Position(s.positionLineNumber, s.positionColumn);\r\n        for (var i = 0, len = ops.length; i < len; i++) {\r\n            builder.addEditOperation(ops[i].range, ops[i].text);\r\n            if (ops[i].range.isEmpty() && ops[i].range.getStartPosition().equals(cursorPosition)) {\r\n                var lineContent = model.getLineContent(cursorPosition.lineNumber);\r\n                if (lineContent.length + 1 === cursorPosition.column) {\r\n                    this._deltaColumn = (ops[i].text || '').length;\r\n                }\r\n            }\r\n        }\r\n        this._selectionId = builder.trackSelection(s);\r\n    };\r\n    LineCommentCommand.prototype._attemptRemoveBlockComment = function (model, s, startToken, endToken) {\r\n        var startLineNumber = s.startLineNumber;\r\n        var endLineNumber = s.endLineNumber;\r\n        var startTokenAllowedBeforeColumn = endToken.length + Math.max(model.getLineFirstNonWhitespaceColumn(s.startLineNumber), s.startColumn);\r\n        var startTokenIndex = model.getLineContent(startLineNumber).lastIndexOf(startToken, startTokenAllowedBeforeColumn - 1);\r\n        var endTokenIndex = model.getLineContent(endLineNumber).indexOf(endToken, s.endColumn - 1 - startToken.length);\r\n        if (startTokenIndex !== -1 && endTokenIndex === -1) {\r\n            endTokenIndex = model.getLineContent(startLineNumber).indexOf(endToken, startTokenIndex + startToken.length);\r\n            endLineNumber = startLineNumber;\r\n        }\r\n        if (startTokenIndex === -1 && endTokenIndex !== -1) {\r\n            startTokenIndex = model.getLineContent(endLineNumber).lastIndexOf(startToken, endTokenIndex);\r\n            startLineNumber = endLineNumber;\r\n        }\r\n        if (s.isEmpty() && (startTokenIndex === -1 || endTokenIndex === -1)) {\r\n            startTokenIndex = model.getLineContent(startLineNumber).indexOf(startToken);\r\n            if (startTokenIndex !== -1) {\r\n                endTokenIndex = model.getLineContent(startLineNumber).indexOf(endToken, startTokenIndex + startToken.length);\r\n            }\r\n        }\r\n        // We have to adjust to possible inner white space.\r\n        // For Space after startToken, add Space to startToken - range math will work out.\r\n        if (startTokenIndex !== -1 && model.getLineContent(startLineNumber).charCodeAt(startTokenIndex + startToken.length) === 32 /* Space */) {\r\n            startToken += ' ';\r\n        }\r\n        // For Space before endToken, add Space before endToken and shift index one left.\r\n        if (endTokenIndex !== -1 && model.getLineContent(endLineNumber).charCodeAt(endTokenIndex - 1) === 32 /* Space */) {\r\n            endToken = ' ' + endToken;\r\n            endTokenIndex -= 1;\r\n        }\r\n        if (startTokenIndex !== -1 && endTokenIndex !== -1) {\r\n            return BlockCommentCommand._createRemoveBlockCommentOperations(new Range(startLineNumber, startTokenIndex + startToken.length + 1, endLineNumber, endTokenIndex + 1), startToken, endToken);\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * Given an unsuccessful analysis, delegate to the block comment command\r\n     */\r\n    LineCommentCommand.prototype._executeBlockComment = function (model, builder, s) {\r\n        model.tokenizeIfCheap(s.startLineNumber);\r\n        var languageId = model.getLanguageIdAtPosition(s.startLineNumber, 1);\r\n        var config = LanguageConfigurationRegistry.getComments(languageId);\r\n        if (!config || !config.blockCommentStartToken || !config.blockCommentEndToken) {\r\n            // Mode does not support block comments\r\n            return;\r\n        }\r\n        var startToken = config.blockCommentStartToken;\r\n        var endToken = config.blockCommentEndToken;\r\n        var ops = this._attemptRemoveBlockComment(model, s, startToken, endToken);\r\n        if (!ops) {\r\n            if (s.isEmpty()) {\r\n                var lineContent = model.getLineContent(s.startLineNumber);\r\n                var firstNonWhitespaceIndex = strings.firstNonWhitespaceIndex(lineContent);\r\n                if (firstNonWhitespaceIndex === -1) {\r\n                    // Line is empty or contains only whitespace\r\n                    firstNonWhitespaceIndex = lineContent.length;\r\n                }\r\n                ops = BlockCommentCommand._createAddBlockCommentOperations(new Range(s.startLineNumber, firstNonWhitespaceIndex + 1, s.startLineNumber, lineContent.length + 1), startToken, endToken, this._insertSpace);\r\n            }\r\n            else {\r\n                ops = BlockCommentCommand._createAddBlockCommentOperations(new Range(s.startLineNumber, model.getLineFirstNonWhitespaceColumn(s.startLineNumber), s.endLineNumber, model.getLineMaxColumn(s.endLineNumber)), startToken, endToken, this._insertSpace);\r\n            }\r\n            if (ops.length === 1) {\r\n                // Leave cursor after token and Space\r\n                this._deltaColumn = startToken.length + 1;\r\n            }\r\n        }\r\n        this._selectionId = builder.trackSelection(s);\r\n        for (var _i = 0, ops_1 = ops; _i < ops_1.length; _i++) {\r\n            var op = ops_1[_i];\r\n            builder.addEditOperation(op.range, op.text);\r\n        }\r\n    };\r\n    LineCommentCommand.prototype.getEditOperations = function (model, builder) {\r\n        var s = this._selection;\r\n        this._moveEndPositionDown = false;\r\n        if (s.startLineNumber < s.endLineNumber && s.endColumn === 1) {\r\n            this._moveEndPositionDown = true;\r\n            s = s.setEndPosition(s.endLineNumber - 1, model.getLineMaxColumn(s.endLineNumber - 1));\r\n        }\r\n        var data = LineCommentCommand._gatherPreflightData(this._type, this._insertSpace, model, s.startLineNumber, s.endLineNumber);\r\n        if (data.supported) {\r\n            return this._executeLineComments(model, builder, data, s);\r\n        }\r\n        return this._executeBlockComment(model, builder, s);\r\n    };\r\n    LineCommentCommand.prototype.computeCursorState = function (model, helper) {\r\n        var result = helper.getTrackedSelection(this._selectionId);\r\n        if (this._moveEndPositionDown) {\r\n            result = result.setEndPosition(result.endLineNumber + 1, 1);\r\n        }\r\n        return new Selection(result.selectionStartLineNumber, result.selectionStartColumn + this._deltaColumn, result.positionLineNumber, result.positionColumn + this._deltaColumn);\r\n    };\r\n    /**\r\n     * Generate edit operations in the remove line comment case\r\n     */\r\n    LineCommentCommand._createRemoveLineCommentsOperations = function (lines, startLineNumber) {\r\n        var res = [];\r\n        for (var i = 0, len = lines.length; i < len; i++) {\r\n            var lineData = lines[i];\r\n            if (lineData.ignore) {\r\n                continue;\r\n            }\r\n            res.push(EditOperation.delete(new Range(startLineNumber + i, lineData.commentStrOffset + 1, startLineNumber + i, lineData.commentStrOffset + lineData.commentStrLength + 1)));\r\n        }\r\n        return res;\r\n    };\r\n    /**\r\n     * Generate edit operations in the add line comment case\r\n     */\r\n    LineCommentCommand.prototype._createAddLineCommentsOperations = function (lines, startLineNumber) {\r\n        var res = [];\r\n        var afterCommentStr = this._insertSpace ? ' ' : '';\r\n        for (var i = 0, len = lines.length; i < len; i++) {\r\n            var lineData = lines[i];\r\n            if (lineData.ignore) {\r\n                continue;\r\n            }\r\n            res.push(EditOperation.insert(new Position(startLineNumber + i, lineData.commentStrOffset + 1), lineData.commentStr + afterCommentStr));\r\n        }\r\n        return res;\r\n    };\r\n    LineCommentCommand.nextVisibleColumn = function (currentVisibleColumn, tabSize, isTab, columnSize) {\r\n        if (isTab) {\r\n            return currentVisibleColumn + (tabSize - (currentVisibleColumn % tabSize));\r\n        }\r\n        return currentVisibleColumn + columnSize;\r\n    };\r\n    /**\r\n     * Adjust insertion points to have them vertically aligned in the add line comment case\r\n     */\r\n    LineCommentCommand._normalizeInsertionPoint = function (model, lines, startLineNumber, tabSize) {\r\n        var minVisibleColumn = 1073741824 /* MAX_SAFE_SMALL_INTEGER */;\r\n        var j;\r\n        var lenJ;\r\n        for (var i = 0, len = lines.length; i < len; i++) {\r\n            if (lines[i].ignore) {\r\n                continue;\r\n            }\r\n            var lineContent = model.getLineContent(startLineNumber + i);\r\n            var currentVisibleColumn = 0;\r\n            for (var j_1 = 0, lenJ_1 = lines[i].commentStrOffset; currentVisibleColumn < minVisibleColumn && j_1 < lenJ_1; j_1++) {\r\n                currentVisibleColumn = LineCommentCommand.nextVisibleColumn(currentVisibleColumn, tabSize, lineContent.charCodeAt(j_1) === 9 /* Tab */, 1);\r\n            }\r\n            if (currentVisibleColumn < minVisibleColumn) {\r\n                minVisibleColumn = currentVisibleColumn;\r\n            }\r\n        }\r\n        minVisibleColumn = Math.floor(minVisibleColumn / tabSize) * tabSize;\r\n        for (var i = 0, len = lines.length; i < len; i++) {\r\n            if (lines[i].ignore) {\r\n                continue;\r\n            }\r\n            var lineContent = model.getLineContent(startLineNumber + i);\r\n            var currentVisibleColumn = 0;\r\n            for (j = 0, lenJ = lines[i].commentStrOffset; currentVisibleColumn < minVisibleColumn && j < lenJ; j++) {\r\n                currentVisibleColumn = LineCommentCommand.nextVisibleColumn(currentVisibleColumn, tabSize, lineContent.charCodeAt(j) === 9 /* Tab */, 1);\r\n            }\r\n            if (currentVisibleColumn > minVisibleColumn) {\r\n                lines[i].commentStrOffset = j - 1;\r\n            }\r\n            else {\r\n                lines[i].commentStrOffset = j;\r\n            }\r\n        }\r\n    };\r\n    return LineCommentCommand;\r\n}());\r\nexport { LineCommentCommand };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as nls from '../../../nls.js';\r\nimport { KeyChord } from '../../../base/common/keyCodes.js';\r\nimport { EditorAction, registerEditorAction } from '../../browser/editorExtensions.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { BlockCommentCommand } from './blockCommentCommand.js';\r\nimport { LineCommentCommand } from './lineCommentCommand.js';\r\nvar CommentLineAction = /** @class */ (function (_super) {\r\n    __extends(CommentLineAction, _super);\r\n    function CommentLineAction(type, opts) {\r\n        var _this = _super.call(this, opts) || this;\r\n        _this._type = type;\r\n        return _this;\r\n    }\r\n    CommentLineAction.prototype.run = function (accessor, editor) {\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = editor.getModel();\r\n        var commands = [];\r\n        var selections = editor.getSelections();\r\n        var modelOptions = model.getOptions();\r\n        var commentsOptions = editor.getOption(13 /* comments */);\r\n        for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\r\n            var selection = selections_1[_i];\r\n            commands.push(new LineCommentCommand(selection, modelOptions.tabSize, this._type, commentsOptions.insertSpace));\r\n        }\r\n        editor.pushUndoStop();\r\n        editor.executeCommands(this.id, commands);\r\n        editor.pushUndoStop();\r\n    };\r\n    return CommentLineAction;\r\n}(EditorAction));\r\nvar ToggleCommentLineAction = /** @class */ (function (_super) {\r\n    __extends(ToggleCommentLineAction, _super);\r\n    function ToggleCommentLineAction() {\r\n        return _super.call(this, 0 /* Toggle */, {\r\n            id: 'editor.action.commentLine',\r\n            label: nls.localize('comment.line', \"Toggle Line Comment\"),\r\n            alias: 'Toggle Line Comment',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 85 /* US_SLASH */,\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            menuOpts: {\r\n                menuId: 17 /* MenubarEditMenu */,\r\n                group: '5_insert',\r\n                title: nls.localize({ key: 'miToggleLineComment', comment: ['&& denotes a mnemonic'] }, \"&&Toggle Line Comment\"),\r\n                order: 1\r\n            }\r\n        }) || this;\r\n    }\r\n    return ToggleCommentLineAction;\r\n}(CommentLineAction));\r\nvar AddLineCommentAction = /** @class */ (function (_super) {\r\n    __extends(AddLineCommentAction, _super);\r\n    function AddLineCommentAction() {\r\n        return _super.call(this, 1 /* ForceAdd */, {\r\n            id: 'editor.action.addCommentLine',\r\n            label: nls.localize('comment.line.add', \"Add Line Comment\"),\r\n            alias: 'Add Line Comment',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 33 /* KEY_C */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    return AddLineCommentAction;\r\n}(CommentLineAction));\r\nvar RemoveLineCommentAction = /** @class */ (function (_super) {\r\n    __extends(RemoveLineCommentAction, _super);\r\n    function RemoveLineCommentAction() {\r\n        return _super.call(this, 2 /* ForceRemove */, {\r\n            id: 'editor.action.removeCommentLine',\r\n            label: nls.localize('comment.line.remove', \"Remove Line Comment\"),\r\n            alias: 'Remove Line Comment',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 51 /* KEY_U */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    return RemoveLineCommentAction;\r\n}(CommentLineAction));\r\nvar BlockCommentAction = /** @class */ (function (_super) {\r\n    __extends(BlockCommentAction, _super);\r\n    function BlockCommentAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.blockComment',\r\n            label: nls.localize('comment.block', \"Toggle Block Comment\"),\r\n            alias: 'Toggle Block Comment',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 1024 /* Shift */ | 512 /* Alt */ | 31 /* KEY_A */,\r\n                linux: { primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 31 /* KEY_A */ },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            menuOpts: {\r\n                menuId: 17 /* MenubarEditMenu */,\r\n                group: '5_insert',\r\n                title: nls.localize({ key: 'miToggleBlockComment', comment: ['&& denotes a mnemonic'] }, \"Toggle &&Block Comment\"),\r\n                order: 2\r\n            }\r\n        }) || this;\r\n    }\r\n    BlockCommentAction.prototype.run = function (accessor, editor) {\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var commentsOptions = editor.getOption(13 /* comments */);\r\n        var commands = [];\r\n        var selections = editor.getSelections();\r\n        for (var _i = 0, selections_2 = selections; _i < selections_2.length; _i++) {\r\n            var selection = selections_2[_i];\r\n            commands.push(new BlockCommentCommand(selection, commentsOptions.insertSpace));\r\n        }\r\n        editor.pushUndoStop();\r\n        editor.executeCommands(this.id, commands);\r\n        editor.pushUndoStop();\r\n    };\r\n    return BlockCommentAction;\r\n}(EditorAction));\r\nregisterEditorAction(ToggleCommentLineAction);\r\nregisterEditorAction(AddLineCommentAction);\r\nregisterEditorAction(RemoveLineCommentAction);\r\nregisterEditorAction(BlockCommentAction);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nvar ColorPickerModel = /** @class */ (function () {\r\n    function ColorPickerModel(color, availableColorPresentations, presentationIndex) {\r\n        this.presentationIndex = presentationIndex;\r\n        this._onColorFlushed = new Emitter();\r\n        this.onColorFlushed = this._onColorFlushed.event;\r\n        this._onDidChangeColor = new Emitter();\r\n        this.onDidChangeColor = this._onDidChangeColor.event;\r\n        this._onDidChangePresentation = new Emitter();\r\n        this.onDidChangePresentation = this._onDidChangePresentation.event;\r\n        this.originalColor = color;\r\n        this._color = color;\r\n        this._colorPresentations = availableColorPresentations;\r\n    }\r\n    Object.defineProperty(ColorPickerModel.prototype, \"color\", {\r\n        get: function () {\r\n            return this._color;\r\n        },\r\n        set: function (color) {\r\n            if (this._color.equals(color)) {\r\n                return;\r\n            }\r\n            this._color = color;\r\n            this._onDidChangeColor.fire(color);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ColorPickerModel.prototype, \"presentation\", {\r\n        get: function () { return this.colorPresentations[this.presentationIndex]; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ColorPickerModel.prototype, \"colorPresentations\", {\r\n        get: function () {\r\n            return this._colorPresentations;\r\n        },\r\n        set: function (colorPresentations) {\r\n            this._colorPresentations = colorPresentations;\r\n            if (this.presentationIndex > colorPresentations.length - 1) {\r\n                this.presentationIndex = 0;\r\n            }\r\n            this._onDidChangePresentation.fire(this.presentation);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ColorPickerModel.prototype.selectNextColorPresentation = function () {\r\n        this.presentationIndex = (this.presentationIndex + 1) % this.colorPresentations.length;\r\n        this.flushColor();\r\n        this._onDidChangePresentation.fire(this.presentation);\r\n    };\r\n    ColorPickerModel.prototype.guessColorPresentation = function (color, originalText) {\r\n        for (var i = 0; i < this.colorPresentations.length; i++) {\r\n            if (originalText === this.colorPresentations[i].label) {\r\n                this.presentationIndex = i;\r\n                this._onDidChangePresentation.fire(this.presentation);\r\n                break;\r\n            }\r\n        }\r\n    };\r\n    ColorPickerModel.prototype.flushColor = function () {\r\n        this._onColorFlushed.fire(this._color);\r\n    };\r\n    return ColorPickerModel;\r\n}());\r\nexport { ColorPickerModel };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './clipboard.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { CopyOptions } from '../../browser/controller/textAreaInput.js';\r\nimport { EditorAction, registerEditorAction } from '../../browser/editorExtensions.js';\r\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nvar CLIPBOARD_CONTEXT_MENU_GROUP = '9_cutcopypaste';\r\nvar supportsCut = (platform.isNative || document.queryCommandSupported('cut'));\r\nvar supportsCopy = (platform.isNative || document.queryCommandSupported('copy'));\r\n// IE and Edge have trouble with setting html content in clipboard\r\nvar supportsCopyWithSyntaxHighlighting = (supportsCopy && !browser.isEdgeOrIE);\r\n// Chrome incorrectly returns true for document.queryCommandSupported('paste')\r\n// when the paste feature is available but the calling script has insufficient\r\n// privileges to actually perform the action\r\nvar supportsPaste = (platform.isNative || (!browser.isChrome && document.queryCommandSupported('paste')));\r\nvar ExecCommandAction = /** @class */ (function (_super) {\r\n    __extends(ExecCommandAction, _super);\r\n    function ExecCommandAction(browserCommand, opts) {\r\n        var _this = _super.call(this, opts) || this;\r\n        _this.browserCommand = browserCommand;\r\n        return _this;\r\n    }\r\n    ExecCommandAction.prototype.runCommand = function (accessor, args) {\r\n        var focusedEditor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\r\n        // Only if editor text focus (i.e. not if editor has widget focus).\r\n        if (focusedEditor && focusedEditor.hasTextFocus()) {\r\n            focusedEditor.trigger('keyboard', this.id, args);\r\n            return;\r\n        }\r\n        document.execCommand(this.browserCommand);\r\n    };\r\n    ExecCommandAction.prototype.run = function (accessor, editor) {\r\n        editor.focus();\r\n        document.execCommand(this.browserCommand);\r\n    };\r\n    return ExecCommandAction;\r\n}(EditorAction));\r\nvar ExecCommandCutAction = /** @class */ (function (_super) {\r\n    __extends(ExecCommandCutAction, _super);\r\n    function ExecCommandCutAction() {\r\n        var _this = this;\r\n        var kbOpts = {\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 54 /* KEY_X */,\r\n            win: { primary: 2048 /* CtrlCmd */ | 54 /* KEY_X */, secondary: [1024 /* Shift */ | 20 /* Delete */] },\r\n            weight: 100 /* EditorContrib */\r\n        };\r\n        // Do not bind cut keybindings in the browser,\r\n        // since browsers do that for us and it avoids security prompts\r\n        if (!platform.isNative) {\r\n            kbOpts = undefined;\r\n        }\r\n        _this = _super.call(this, 'cut', {\r\n            id: 'editor.action.clipboardCutAction',\r\n            label: nls.localize('actions.clipboard.cutLabel', \"Cut\"),\r\n            alias: 'Cut',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: kbOpts,\r\n            contextMenuOpts: {\r\n                group: CLIPBOARD_CONTEXT_MENU_GROUP,\r\n                order: 1\r\n            },\r\n            menuOpts: {\r\n                menuId: 17 /* MenubarEditMenu */,\r\n                group: '2_ccp',\r\n                title: nls.localize({ key: 'miCut', comment: ['&& denotes a mnemonic'] }, \"Cu&&t\"),\r\n                order: 1\r\n            }\r\n        }) || this;\r\n        return _this;\r\n    }\r\n    ExecCommandCutAction.prototype.run = function (accessor, editor) {\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var emptySelectionClipboard = editor.getOption(25 /* emptySelectionClipboard */);\r\n        if (!emptySelectionClipboard && editor.getSelection().isEmpty()) {\r\n            return;\r\n        }\r\n        _super.prototype.run.call(this, accessor, editor);\r\n    };\r\n    return ExecCommandCutAction;\r\n}(ExecCommandAction));\r\nvar ExecCommandCopyAction = /** @class */ (function (_super) {\r\n    __extends(ExecCommandCopyAction, _super);\r\n    function ExecCommandCopyAction() {\r\n        var _this = this;\r\n        var kbOpts = {\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 33 /* KEY_C */,\r\n            win: { primary: 2048 /* CtrlCmd */ | 33 /* KEY_C */, secondary: [2048 /* CtrlCmd */ | 19 /* Insert */] },\r\n            weight: 100 /* EditorContrib */\r\n        };\r\n        // Do not bind copy keybindings in the browser,\r\n        // since browsers do that for us and it avoids security prompts\r\n        if (!platform.isNative) {\r\n            kbOpts = undefined;\r\n        }\r\n        _this = _super.call(this, 'copy', {\r\n            id: 'editor.action.clipboardCopyAction',\r\n            label: nls.localize('actions.clipboard.copyLabel', \"Copy\"),\r\n            alias: 'Copy',\r\n            precondition: undefined,\r\n            kbOpts: kbOpts,\r\n            contextMenuOpts: {\r\n                group: CLIPBOARD_CONTEXT_MENU_GROUP,\r\n                order: 2\r\n            },\r\n            menuOpts: {\r\n                menuId: 17 /* MenubarEditMenu */,\r\n                group: '2_ccp',\r\n                title: nls.localize({ key: 'miCopy', comment: ['&& denotes a mnemonic'] }, \"&&Copy\"),\r\n                order: 2\r\n            }\r\n        }) || this;\r\n        return _this;\r\n    }\r\n    ExecCommandCopyAction.prototype.run = function (accessor, editor) {\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var emptySelectionClipboard = editor.getOption(25 /* emptySelectionClipboard */);\r\n        if (!emptySelectionClipboard && editor.getSelection().isEmpty()) {\r\n            return;\r\n        }\r\n        _super.prototype.run.call(this, accessor, editor);\r\n    };\r\n    return ExecCommandCopyAction;\r\n}(ExecCommandAction));\r\nvar ExecCommandPasteAction = /** @class */ (function (_super) {\r\n    __extends(ExecCommandPasteAction, _super);\r\n    function ExecCommandPasteAction() {\r\n        var _this = this;\r\n        var kbOpts = {\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 52 /* KEY_V */,\r\n            win: { primary: 2048 /* CtrlCmd */ | 52 /* KEY_V */, secondary: [1024 /* Shift */ | 19 /* Insert */] },\r\n            weight: 100 /* EditorContrib */\r\n        };\r\n        // Do not bind paste keybindings in the browser,\r\n        // since browsers do that for us and it avoids security prompts\r\n        if (!platform.isNative) {\r\n            kbOpts = undefined;\r\n        }\r\n        _this = _super.call(this, 'paste', {\r\n            id: 'editor.action.clipboardPasteAction',\r\n            label: nls.localize('actions.clipboard.pasteLabel', \"Paste\"),\r\n            alias: 'Paste',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: kbOpts,\r\n            contextMenuOpts: {\r\n                group: CLIPBOARD_CONTEXT_MENU_GROUP,\r\n                order: 3\r\n            },\r\n            menuOpts: {\r\n                menuId: 17 /* MenubarEditMenu */,\r\n                group: '2_ccp',\r\n                title: nls.localize({ key: 'miPaste', comment: ['&& denotes a mnemonic'] }, \"&&Paste\"),\r\n                order: 3\r\n            }\r\n        }) || this;\r\n        return _this;\r\n    }\r\n    return ExecCommandPasteAction;\r\n}(ExecCommandAction));\r\nvar ExecCommandCopyWithSyntaxHighlightingAction = /** @class */ (function (_super) {\r\n    __extends(ExecCommandCopyWithSyntaxHighlightingAction, _super);\r\n    function ExecCommandCopyWithSyntaxHighlightingAction() {\r\n        return _super.call(this, 'copy', {\r\n            id: 'editor.action.clipboardCopyWithSyntaxHighlightingAction',\r\n            label: nls.localize('actions.clipboard.copyWithSyntaxHighlightingLabel', \"Copy With Syntax Highlighting\"),\r\n            alias: 'Copy With Syntax Highlighting',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.textInputFocus,\r\n                primary: 0,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    ExecCommandCopyWithSyntaxHighlightingAction.prototype.run = function (accessor, editor) {\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var emptySelectionClipboard = editor.getOption(25 /* emptySelectionClipboard */);\r\n        if (!emptySelectionClipboard && editor.getSelection().isEmpty()) {\r\n            return;\r\n        }\r\n        CopyOptions.forceCopyWithSyntaxHighlighting = true;\r\n        _super.prototype.run.call(this, accessor, editor);\r\n        CopyOptions.forceCopyWithSyntaxHighlighting = false;\r\n    };\r\n    return ExecCommandCopyWithSyntaxHighlightingAction;\r\n}(ExecCommandAction));\r\nif (supportsCut) {\r\n    registerEditorAction(ExecCommandCutAction);\r\n}\r\nif (supportsCopy) {\r\n    registerEditorAction(ExecCommandCopyAction);\r\n}\r\nif (supportsPaste) {\r\n    registerEditorAction(ExecCommandPasteAction);\r\n}\r\nif (supportsCopyWithSyntaxHighlighting) {\r\n    registerEditorAction(ExecCommandCopyWithSyntaxHighlightingAction);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as nls from '../../../nls.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nvar CursorState = /** @class */ (function () {\r\n    function CursorState(selections) {\r\n        this.selections = selections;\r\n    }\r\n    CursorState.prototype.equals = function (other) {\r\n        var thisLen = this.selections.length;\r\n        var otherLen = other.selections.length;\r\n        if (thisLen !== otherLen) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < thisLen; i++) {\r\n            if (!this.selections[i].equalsSelection(other.selections[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    return CursorState;\r\n}());\r\nvar StackElement = /** @class */ (function () {\r\n    function StackElement(cursorState, scrollTop, scrollLeft) {\r\n        this.cursorState = cursorState;\r\n        this.scrollTop = scrollTop;\r\n        this.scrollLeft = scrollLeft;\r\n    }\r\n    return StackElement;\r\n}());\r\nvar CursorUndoRedoController = /** @class */ (function (_super) {\r\n    __extends(CursorUndoRedoController, _super);\r\n    function CursorUndoRedoController(editor) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = editor;\r\n        _this._isCursorUndoRedo = false;\r\n        _this._undoStack = [];\r\n        _this._redoStack = [];\r\n        _this._register(editor.onDidChangeModel(function (e) {\r\n            _this._undoStack = [];\r\n            _this._redoStack = [];\r\n        }));\r\n        _this._register(editor.onDidChangeModelContent(function (e) {\r\n            _this._undoStack = [];\r\n            _this._redoStack = [];\r\n        }));\r\n        _this._register(editor.onDidChangeCursorSelection(function (e) {\r\n            if (_this._isCursorUndoRedo) {\r\n                return;\r\n            }\r\n            if (!e.oldSelections) {\r\n                return;\r\n            }\r\n            if (e.oldModelVersionId !== e.modelVersionId) {\r\n                return;\r\n            }\r\n            var prevState = new CursorState(e.oldSelections);\r\n            var isEqualToLastUndoStack = (_this._undoStack.length > 0 && _this._undoStack[_this._undoStack.length - 1].cursorState.equals(prevState));\r\n            if (!isEqualToLastUndoStack) {\r\n                _this._undoStack.push(new StackElement(prevState, editor.getScrollTop(), editor.getScrollLeft()));\r\n                _this._redoStack = [];\r\n                if (_this._undoStack.length > 50) {\r\n                    // keep the cursor undo stack bounded\r\n                    _this._undoStack.shift();\r\n                }\r\n            }\r\n        }));\r\n        return _this;\r\n    }\r\n    CursorUndoRedoController.get = function (editor) {\r\n        return editor.getContribution(CursorUndoRedoController.ID);\r\n    };\r\n    CursorUndoRedoController.prototype.cursorUndo = function () {\r\n        if (!this._editor.hasModel() || this._undoStack.length === 0) {\r\n            return;\r\n        }\r\n        this._redoStack.push(new StackElement(new CursorState(this._editor.getSelections()), this._editor.getScrollTop(), this._editor.getScrollLeft()));\r\n        this._applyState(this._undoStack.pop());\r\n    };\r\n    CursorUndoRedoController.prototype.cursorRedo = function () {\r\n        if (!this._editor.hasModel() || this._redoStack.length === 0) {\r\n            return;\r\n        }\r\n        this._undoStack.push(new StackElement(new CursorState(this._editor.getSelections()), this._editor.getScrollTop(), this._editor.getScrollLeft()));\r\n        this._applyState(this._redoStack.pop());\r\n    };\r\n    CursorUndoRedoController.prototype._applyState = function (stackElement) {\r\n        this._isCursorUndoRedo = true;\r\n        this._editor.setSelections(stackElement.cursorState.selections);\r\n        this._editor.setScrollPosition({\r\n            scrollTop: stackElement.scrollTop,\r\n            scrollLeft: stackElement.scrollLeft\r\n        });\r\n        this._isCursorUndoRedo = false;\r\n    };\r\n    CursorUndoRedoController.ID = 'editor.contrib.cursorUndoRedoController';\r\n    return CursorUndoRedoController;\r\n}(Disposable));\r\nexport { CursorUndoRedoController };\r\nvar CursorUndo = /** @class */ (function (_super) {\r\n    __extends(CursorUndo, _super);\r\n    function CursorUndo() {\r\n        return _super.call(this, {\r\n            id: 'cursorUndo',\r\n            label: nls.localize('cursor.undo', \"Cursor Undo\"),\r\n            alias: 'Cursor Undo',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.textInputFocus,\r\n                primary: 2048 /* CtrlCmd */ | 51 /* KEY_U */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    CursorUndo.prototype.run = function (accessor, editor, args) {\r\n        CursorUndoRedoController.get(editor).cursorUndo();\r\n    };\r\n    return CursorUndo;\r\n}(EditorAction));\r\nexport { CursorUndo };\r\nvar CursorRedo = /** @class */ (function (_super) {\r\n    __extends(CursorRedo, _super);\r\n    function CursorRedo() {\r\n        return _super.call(this, {\r\n            id: 'cursorRedo',\r\n            label: nls.localize('cursor.redo', \"Cursor Redo\"),\r\n            alias: 'Cursor Redo',\r\n            precondition: undefined\r\n        }) || this;\r\n    }\r\n    CursorRedo.prototype.run = function (accessor, editor, args) {\r\n        CursorUndoRedoController.get(editor).cursorRedo();\r\n    };\r\n    return CursorRedo;\r\n}(EditorAction));\r\nexport { CursorRedo };\r\nregisterEditorContribution(CursorUndoRedoController.ID, CursorUndoRedoController);\r\nregisterEditorAction(CursorUndo);\r\nregisterEditorAction(CursorRedo);\r\n"],"sourceRoot":""}