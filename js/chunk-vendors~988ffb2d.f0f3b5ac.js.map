{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/view/viewPart.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/view/viewLayer.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/view/viewOutgoingEvents.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/view/viewController.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/view/viewOverlays.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/view/viewImpl.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","this","constructor","prototype","create","ViewPart","_super","context","_this","call","_context","addEventHandler","dispose","removeEventHandler","PartFingerprints","write","target","partId","setAttribute","String","read","r","getAttribute","parseInt","collect","child","stopAt","result","resultLen","document","body","nodeType","ELEMENT_NODE","parentElement","Uint8Array","i","RenderedLinesCollection","createLine","_createLine","_set","flush","rendLineNumberStart","lines","_lines","_rendLineNumberStart","_get","getStartLineNumber","getEndLineNumber","length","getCount","getLine","lineNumber","lineIndex","Error","onLinesDeleted","deleteFromLineNumber","deleteToLineNumber","startLineNumber","endLineNumber","deleteCnt","deleteStartIndex","deleteCount","deleteAboveCount","deleted","splice","onLinesChanged","changeFromLineNumber","changeToLineNumber","someoneNotified","changedLineNumber","onContentChanged","onLinesInserted","insertFromLineNumber","insertToLineNumber","insertCnt","newLines","insertIndex","beforeLines","slice","afterLines","deletedLines","concat","onTokensChanged","ranges","notifiedSomeone","len","rng","toLineNumber","fromLineNumber","from","Math","max","to","min","VisibleLinesCollection","host","_host","domNode","_createDomNode","_linesCollection","createVisibleLine","createElement","setClassName","setPosition","onConfigurationChanged","e","hasChanged","onFlushed","lineDomNode","getDomNode","removeChild","onScrollChanged","scrollTopChanged","onZonesChanged","getVisibleLine","renderLines","viewportData","inp","renderer","ViewLayerRenderer","ctx","linesLength","resCtx","render","relativeVerticalOffset","inContext","stopLineNumber","deltaTop","x","_finishRendering","_renderUntouchedLines","_insertLinesBefore","removeCnt","_removeLinesBefore","_insertLinesAfter","_removeLinesAfter","startIndex","endIndex","deltaLN","layoutLine","newLinesLen","removeCount","removeIndex","_finishRenderingNewLines","domNodeIsEmpty","newLinesHTML","wasNew","lastChild","innerHTML","insertAdjacentHTML","currChild","line","setDomNode","previousSibling","_finishRenderingInvalidLines","invalidLinesHTML","wasInvalid","hugeDomNode","source","firstChild","parentNode","replaceChild","sb","_sb","reset","hadNewLine","renderResult","renderLine","build","hadInvalidLine","ViewOutgoingEvents","viewModel","onDidContentSizeChange","onDidScroll","onDidGainFocus","onDidLoseFocus","onKeyDown","onKeyUp","onContextMenu","onMouseMove","onMouseLeave","onMouseUp","onMouseDown","onMouseDrag","onMouseDrop","onMouseWheel","_viewModel","emitContentSizeChange","emitScrollChanged","emitViewFocusGained","undefined","emitViewFocusLost","emitKeyDown","emitKeyUp","emitContextMenu","_convertViewToModelMouseEvent","emitMouseMove","emitMouseLeave","emitMouseUp","emitMouseDown","emitMouseDrag","emitMouseDrop","emitMouseWheel","event","_convertViewToModelMouseTarget","convertViewToModelMouseTarget","coordinatesConverter","ExternalMouseTarget","element","type","mouseColumn","position","convertViewPositionToModelPosition","range","convertViewRangeToModelRange","detail","toString","ViewController","configuration","outgoingEvents","commandDelegate","_execMouseCommand","editorCommand","args","executeEditorCommand","paste","text","pasteOnNewLine","multicursorText","mode","replacePreviousChar","replaceCharCnt","compositionStart","compositionEnd","cut","setSelection","modelSelection","SetSelection","selection","_validateViewColumn","viewPosition","minColumn","getLineMinColumn","column","_hasMulticursorModifier","data","options","get","altKey","ctrlKey","metaKey","_hasNonMulticursorModifier","dispatchMouse","selectionClipboardIsOn","platform","middleButton","_columnSelect","inSelectionMode","startedOnLineNumbers","_lastCursorLineSelect","_createCursor","_lineSelectDrag","_lineSelect","mouseDownCount","_selectAll","_lastCursorLineSelectDrag","_lastCursorWordSelect","_wordSelectDrag","_wordSelect","shiftKey","_lastCursorMoveToSelect","_moveToSelect","moveTo","_usualArgs","_convertViewToModelPosition","MoveTo","MoveToSelect","doColumnSelect","ColumnSelect","wholeLine","CreateCursor","LastCursorMoveToSelect","WordSelect","WordSelectDrag","LastCursorWordSelect","LineSelect","LineSelectDrag","LastCursorLineSelect","LastCursorLineSelectDrag","SelectAll","ViewOverlays","_visibleLines","_dynamicOverlays","_isFocused","shouldRender","dynamicOverlay","addDynamicOverlay","overlay","push","onFocusChanged","isFocused","prepareRender","toRender","filter","onDidRender","_viewOverlaysRender","toggleClassName","ViewOverlayLine","dynamicOverlays","_configuration","_lineHeight","_domNode","_renderedContent","appendASCIIString","setTop","setHeight","ContentViewOverlays","layoutInfo","_contentWidth","contentWidth","scrollWidthChanged","setWidth","scrollWidth","MarginViewOverlays","_contentLeft","contentLeft","applyFontInfo","scrollHeightChanged","height","scrollHeight","View","themeService","model","cursor","_cursor","_renderAnimationFrame","viewController","eventDispatcher","callback","_renderOnce","getTheme","_register","onThemeChange","theme","emit","viewEvents","viewParts","_textAreaHandler","createTextAreaHandlerHelper","linesContent","getEditorClassName","overflowGuardContainer","_scrollbar","viewLines","viewZones","decorationsOverviewRuler","scrollDecoration","contentViewOverlays","marginViewOverlays","margin","appendChild","marginDomNode","contentWidgets","viewCursors","overlayWidgets","rulers","minimap","overviewRulerData","getOverviewRulerLayoutInfo","parent","insertBefore","textArea","textAreaCover","overflowingContentWidgetsDomNode","_applyLayout","pointerHandler","createPointerHandlerHelper","addEventListener","events","emitMany","_flushAccumulatedAndRenderNow","_renderNow","viewDomNode","linesContentDomNode","focusTextArea","focus","getLastRenderData","lastViewCursorsRenderData","lastTextareaPosition","shouldSuppressMouseDownOnViewZone","viewZoneId","shouldSuppressMouseDownOnWidget","widgetId","getPositionFromDOMInfo","spanNode","offset","visibleRangeForPosition","getLineWidth","visibleRangeForPositionRelativeToEditor","width","focused","onContentSizeChanged","setHasFocus","onThemeChanged","safeInvokeNoArg","_scheduleRender","dom","_onRenderScheduled","bind","_actualRender","_getViewPartsToRender","viewPart","viewPartsToRender","partialViewportData","viewLayout","getLinesViewportData","setViewport","centeredLineNumber","getViewSelections","getWhitespaceViewportData","onBeforeRender","renderText","renderingContext","delegateVerticalScrollbarMouseDown","browserEvent","restoreState","scrollPosition","setScrollPositionNow","scrollTop","tokenizeViewport","updateLineWidths","scrollLeft","getOffsetForColumn","modelLineNumber","modelColumn","modelPosition","validateModelPosition","convertModelPositionToViewPosition","visibleRange","left","getTargetAtClientPoint","clientX","clientY","mouseTarget","createOverviewRuler","cssClassName","change","zonesHaveChanged","changeViewZones","onHeightMaybeChanged","privateViewEventBus","now","everything","forceShouldRender","setAriaOptions","addContentWidget","widgetData","addWidget","widget","layoutContentWidget","newRange","newPosition","newPreference","preference","setWidgetPosition","removeContentWidget","removeWidget","addOverlayWidget","layoutOverlayWidget","removeOverlayWidget","func"],"mappings":"wHAAA,gGAIIA,EAAwC,WACxC,IAAIC,EAAgB,SAAUC,EAAGC,GAI7B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,KAClEP,EAAcC,EAAGC,IAE5B,OAAO,SAAUD,EAAGC,GAEhB,SAASO,IAAOC,KAAKC,YAAcV,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEW,UAAkB,OAANV,EAAaC,OAAOU,OAAOX,IAAMO,EAAGG,UAAYV,EAAEU,UAAW,IAAIH,IAV3C,GAexCK,EAA0B,SAAUC,GAEpC,SAASD,EAASE,GACd,IAAIC,EAAQF,EAAOG,KAAKR,OAASA,KAGjC,OAFAO,EAAME,SAAWH,EACjBC,EAAME,SAASC,gBAAgBH,GACxBA,EAMX,OAXAlB,EAAUe,EAAUC,GAOpBD,EAASF,UAAUS,QAAU,WACzBX,KAAKS,SAASG,mBAAmBZ,MACjCK,EAAOH,UAAUS,QAAQH,KAAKR,OAE3BI,EAZkB,CAa3B,QAEES,EAAkC,WAClC,SAASA,KAkCT,OAhCAA,EAAiBC,MAAQ,SAAUC,EAAQC,GACjB,OAClBD,EAAOE,aAAa,YAAaC,OAAOF,KAMhDH,EAAiBM,KAAO,SAAUJ,GAC9B,IAAIK,EAAIL,EAAOM,aAAa,aAC5B,OAAU,OAAND,EACO,EAEJE,SAASF,EAAG,KAEvBP,EAAiBU,QAAU,SAAUC,EAAOC,GACxC,IAAIC,EAAS,GAAIC,EAAY,EAC7B,MAAOH,GAASA,IAAUI,SAASC,KAAM,CACrC,GAAIL,IAAUC,EACV,MAEAD,EAAMM,WAAaN,EAAMO,eACzBL,EAAOC,KAAe3B,KAAKmB,KAAKK,IAEpCA,EAAQA,EAAMQ,cAGlB,IADA,IAAIZ,EAAI,IAAIa,WAAWN,GACdO,EAAI,EAAGA,EAAIP,EAAWO,IAC3Bd,EAAEc,GAAKR,EAAOC,EAAYO,EAAI,GAElC,OAAOd,GAEJP,EAnC0B,I,oCClCrC,gGAMIsB,EAAyC,WACzC,SAASA,EAAwBC,GAC7BpC,KAAKqC,YAAcD,EACnBpC,KAAKsC,KAAK,EAAG,IAqKjB,OAnKAH,EAAwBjC,UAAUqC,MAAQ,WACtCvC,KAAKsC,KAAK,EAAG,KAEjBH,EAAwBjC,UAAUoC,KAAO,SAAUE,EAAqBC,GACpEzC,KAAK0C,OAASD,EACdzC,KAAK2C,qBAAuBH,GAEhCL,EAAwBjC,UAAU0C,KAAO,WACrC,MAAO,CACHJ,oBAAqBxC,KAAK2C,qBAC1BF,MAAOzC,KAAK0C,SAMpBP,EAAwBjC,UAAU2C,mBAAqB,WACnD,OAAO7C,KAAK2C,sBAKhBR,EAAwBjC,UAAU4C,iBAAmB,WACjD,OAAO9C,KAAK2C,qBAAuB3C,KAAK0C,OAAOK,OAAS,GAE5DZ,EAAwBjC,UAAU8C,SAAW,WACzC,OAAOhD,KAAK0C,OAAOK,QAEvBZ,EAAwBjC,UAAU+C,QAAU,SAAUC,GAClD,IAAIC,EAAYD,EAAalD,KAAK2C,qBAClC,GAAIQ,EAAY,GAAKA,GAAanD,KAAK0C,OAAOK,OAC1C,MAAM,IAAIK,MAAM,gCAEpB,OAAOpD,KAAK0C,OAAOS,IAKvBhB,EAAwBjC,UAAUmD,eAAiB,SAAUC,EAAsBC,GAC/E,GAAwB,IAApBvD,KAAKgD,WAEL,OAAO,KAEX,IAAIQ,EAAkBxD,KAAK6C,qBACvBY,EAAgBzD,KAAK8C,mBACzB,GAAIS,EAAqBC,EAAiB,CAEtC,IAAIE,EAAYH,EAAqBD,EAAuB,EAE5D,OADAtD,KAAK2C,sBAAwBe,EACtB,KAEX,GAAIJ,EAAuBG,EAEvB,OAAO,KAKX,IAFA,IAAIE,EAAmB,EACnBC,EAAc,EACTV,EAAaM,EAAiBN,GAAcO,EAAeP,IAAc,CAC9E,IAAIC,EAAYD,EAAalD,KAAK2C,qBAC9BW,GAAwBJ,GAAcA,GAAcK,IAEhC,IAAhBK,GAEAD,EAAmBR,EACnBS,EAAc,GAGdA,KAKZ,GAAIN,EAAuBE,EAAiB,CAExC,IAAIK,EAAmB,EAGnBA,EAFAN,EAAqBC,EAEFD,EAAqBD,EAAuB,EAG5CE,EAAkBF,EAEzCtD,KAAK2C,sBAAwBkB,EAEjC,IAAIC,EAAU9D,KAAK0C,OAAOqB,OAAOJ,EAAkBC,GACnD,OAAOE,GAEX3B,EAAwBjC,UAAU8D,eAAiB,SAAUC,EAAsBC,GAC/E,GAAwB,IAApBlE,KAAKgD,WAEL,OAAO,EAKX,IAHA,IAAIQ,EAAkBxD,KAAK6C,qBACvBY,EAAgBzD,KAAK8C,mBACrBqB,GAAkB,EACbC,EAAoBH,EAAsBG,GAAqBF,EAAoBE,IACpFA,GAAqBZ,GAAmBY,GAAqBX,IAE7DzD,KAAK0C,OAAO0B,EAAoBpE,KAAK2C,sBAAsB0B,mBAC3DF,GAAkB,GAG1B,OAAOA,GAEXhC,EAAwBjC,UAAUoE,gBAAkB,SAAUC,EAAsBC,GAChF,GAAwB,IAApBxE,KAAKgD,WAEL,OAAO,KAEX,IAAIyB,EAAYD,EAAqBD,EAAuB,EACxDf,EAAkBxD,KAAK6C,qBACvBY,EAAgBzD,KAAK8C,mBACzB,GAAIyB,GAAwBf,EAGxB,OADAxD,KAAK2C,sBAAwB8B,EACtB,KAEX,GAAIF,EAAuBd,EAEvB,OAAO,KAEX,GAAIgB,EAAYF,EAAuBd,EAAe,CAElD,IAAIK,EAAU9D,KAAK0C,OAAOqB,OAAOQ,EAAuBvE,KAAK2C,qBAAsBc,EAAgBc,EAAuB,GAC1H,OAAOT,EAIX,IADA,IAAIY,EAAW,GACNxC,EAAI,EAAGA,EAAIuC,EAAWvC,IAC3BwC,EAASxC,GAAKlC,KAAKqC,cAEvB,IAAIsC,EAAcJ,EAAuBvE,KAAK2C,qBAC1CiC,EAAc5E,KAAK0C,OAAOmC,MAAM,EAAGF,GACnCG,EAAa9E,KAAK0C,OAAOmC,MAAMF,EAAa3E,KAAK0C,OAAOK,OAAS0B,GACjEM,EAAe/E,KAAK0C,OAAOmC,MAAM7E,KAAK0C,OAAOK,OAAS0B,EAAWzE,KAAK0C,OAAOK,QAEjF,OADA/C,KAAK0C,OAASkC,EAAYI,OAAON,GAAUM,OAAOF,GAC3CC,GAEX5C,EAAwBjC,UAAU+E,gBAAkB,SAAUC,GAC1D,GAAwB,IAApBlF,KAAKgD,WAEL,OAAO,EAKX,IAHA,IAAIQ,EAAkBxD,KAAK6C,qBACvBY,EAAgBzD,KAAK8C,mBACrBqC,GAAkB,EACbjD,EAAI,EAAGkD,EAAMF,EAAOnC,OAAQb,EAAIkD,EAAKlD,IAAK,CAC/C,IAAImD,EAAMH,EAAOhD,GACjB,KAAImD,EAAIC,aAAe9B,GAAmB6B,EAAIE,eAAiB9B,GAM/D,IAFA,IAAI+B,EAAOC,KAAKC,IAAIlC,EAAiB6B,EAAIE,gBACrCI,EAAKF,KAAKG,IAAInC,EAAe4B,EAAIC,cAC5BpC,EAAasC,EAAMtC,GAAcyC,EAAIzC,IAAc,CACxD,IAAIC,EAAYD,EAAalD,KAAK2C,qBAClC3C,KAAK0C,OAAOS,GAAW8B,kBACvBE,GAAkB,GAG1B,OAAOA,GAEJhD,EAxKiC,GA2KxC0D,EAAwC,WACxC,SAASA,EAAuBC,GAC5B,IAAIvF,EAAQP,KACZA,KAAK+F,MAAQD,EACb9F,KAAKgG,QAAUhG,KAAKiG,iBACpBjG,KAAKkG,iBAAmB,IAAI/D,GAAwB,WAAc,OAAO5B,EAAMwF,MAAMI,uBAkFzF,OAhFAN,EAAuB3F,UAAU+F,eAAiB,WAC9C,IAAID,EAAU,eAAkBpE,SAASwE,cAAc,QAKvD,OAJAJ,EAAQK,aAAa,cACrBL,EAAQM,YAAY,YACpBN,EAAQA,QAAQ/E,aAAa,OAAQ,gBACrC+E,EAAQA,QAAQ/E,aAAa,cAAe,QACrC+E,GAGXH,EAAuB3F,UAAUqG,uBAAyB,SAAUC,GAChE,QAAIA,EAAEC,WAAW,MAKrBZ,EAAuB3F,UAAUwG,UAAY,SAAUF,GAGnD,OAFAxG,KAAKkG,iBAAiB3D,SAEf,GAEXsD,EAAuB3F,UAAU8D,eAAiB,SAAUwC,GACxD,OAAOxG,KAAKkG,iBAAiBlC,eAAewC,EAAEjB,eAAgBiB,EAAElB,eAEpEO,EAAuB3F,UAAUmD,eAAiB,SAAUmD,GACxD,IAAI1C,EAAU9D,KAAKkG,iBAAiB7C,eAAemD,EAAEjB,eAAgBiB,EAAElB,cACvE,GAAIxB,EAEA,IAAK,IAAI5B,EAAI,EAAGkD,EAAMtB,EAAQf,OAAQb,EAAIkD,EAAKlD,IAAK,CAChD,IAAIyE,EAAc7C,EAAQ5B,GAAG0E,aACzBD,GACA3G,KAAKgG,QAAQA,QAAQa,YAAYF,GAI7C,OAAO,GAEXd,EAAuB3F,UAAUoE,gBAAkB,SAAUkC,GACzD,IAAI1C,EAAU9D,KAAKkG,iBAAiB5B,gBAAgBkC,EAAEjB,eAAgBiB,EAAElB,cACxE,GAAIxB,EAEA,IAAK,IAAI5B,EAAI,EAAGkD,EAAMtB,EAAQf,OAAQb,EAAIkD,EAAKlD,IAAK,CAChD,IAAIyE,EAAc7C,EAAQ5B,GAAG0E,aACzBD,GACA3G,KAAKgG,QAAQA,QAAQa,YAAYF,GAI7C,OAAO,GAEXd,EAAuB3F,UAAU4G,gBAAkB,SAAUN,GACzD,OAAOA,EAAEO,kBAEblB,EAAuB3F,UAAU+E,gBAAkB,SAAUuB,GACzD,OAAOxG,KAAKkG,iBAAiBjB,gBAAgBuB,EAAEtB,SAEnDW,EAAuB3F,UAAU8G,eAAiB,SAAUR,GACxD,OAAO,GAGXX,EAAuB3F,UAAU2C,mBAAqB,WAClD,OAAO7C,KAAKkG,iBAAiBrD,sBAEjCgD,EAAuB3F,UAAU4C,iBAAmB,WAChD,OAAO9C,KAAKkG,iBAAiBpD,oBAEjC+C,EAAuB3F,UAAU+G,eAAiB,SAAU/D,GACxD,OAAOlD,KAAKkG,iBAAiBjD,QAAQC,IAEzC2C,EAAuB3F,UAAUgH,YAAc,SAAUC,GACrD,IAAIC,EAAMpH,KAAKkG,iBAAiBtD,OAC5ByE,EAAW,IAAIC,EAAkBtH,KAAKgG,QAAQA,QAAShG,KAAK+F,MAAOoB,GACnEI,EAAM,CACN/E,oBAAqB4E,EAAI5E,oBACzBC,MAAO2E,EAAI3E,MACX+E,YAAaJ,EAAI3E,MAAMM,QAGvB0E,EAASJ,EAASK,OAAOH,EAAKJ,EAAa3D,gBAAiB2D,EAAa1D,cAAe0D,EAAaQ,wBACzG3H,KAAKkG,iBAAiB5D,KAAKmF,EAAOjF,oBAAqBiF,EAAOhF,QAE3DoD,EAvFgC,GA0FvCyB,EAAmC,WACnC,SAASA,EAAkBtB,EAASF,EAAMqB,GACtCnH,KAAKgG,QAAUA,EACfhG,KAAK8F,KAAOA,EACZ9F,KAAKmH,aAAeA,EA4LxB,OA1LAG,EAAkBpH,UAAUwH,OAAS,SAAUE,EAAWpE,EAAiBqE,EAAgBC,GACvF,IAAIP,EAAM,CACN/E,oBAAqBoF,EAAUpF,oBAC/BC,MAAOmF,EAAUnF,MAAMoC,MAAM,GAC7B2C,YAAaI,EAAUJ,aAE3B,GAAKD,EAAI/E,oBAAsB+E,EAAIC,YAAc,EAAIhE,GAAqBqE,EAAiBN,EAAI/E,oBAAsB,CAEjH+E,EAAI/E,oBAAsBgB,EAC1B+D,EAAIC,YAAcK,EAAiBrE,EAAkB,EACrD+D,EAAI9E,MAAQ,GACZ,IAAK,IAAIsF,EAAIvE,EAAiBuE,GAAKF,EAAgBE,IAC/CR,EAAI9E,MAAMsF,EAAIvE,GAAmBxD,KAAK8F,KAAKK,oBAG/C,OADAnG,KAAKgI,iBAAiBT,GAAK,EAAMO,GAC1BP,EAIX,GADAvH,KAAKiI,sBAAsBV,EAAK9B,KAAKC,IAAIlC,EAAkB+D,EAAI/E,oBAAqB,GAAIiD,KAAKG,IAAIiC,EAAiBN,EAAI/E,oBAAqB+E,EAAIC,YAAc,GAAIM,EAAUtE,GACvK+D,EAAI/E,oBAAsBgB,EAAiB,CAE3C,IAAI+B,EAAiB/B,EACjB8B,EAAeG,KAAKG,IAAIiC,EAAgBN,EAAI/E,oBAAsB,GAClE+C,GAAkBD,IAClBtF,KAAKkI,mBAAmBX,EAAKhC,EAAgBD,EAAcwC,EAAUtE,GACrE+D,EAAIC,aAAelC,EAAeC,EAAiB,QAGtD,GAAIgC,EAAI/E,oBAAsBgB,EAAiB,CAEhD,IAAI2E,EAAY1C,KAAKG,IAAI2B,EAAIC,YAAahE,EAAkB+D,EAAI/E,qBAC5D2F,EAAY,IACZnI,KAAKoI,mBAAmBb,EAAKY,GAC7BZ,EAAIC,aAAeW,GAI3B,GADAZ,EAAI/E,oBAAsBgB,EACtB+D,EAAI/E,oBAAsB+E,EAAIC,YAAc,EAAIK,EAAgB,CAE5DtC,EAAiBgC,EAAI/E,oBAAsB+E,EAAIC,YAC/ClC,EAAeuC,EACftC,GAAkBD,IAClBtF,KAAKqI,kBAAkBd,EAAKhC,EAAgBD,EAAcwC,EAAUtE,GACpE+D,EAAIC,aAAelC,EAAeC,EAAiB,QAGtD,GAAIgC,EAAI/E,oBAAsB+E,EAAIC,YAAc,EAAIK,EAAgB,CAEjEtC,EAAiBE,KAAKC,IAAI,EAAGmC,EAAiBN,EAAI/E,oBAAsB,GACxE8C,EAAeiC,EAAIC,YAAc,EACjCW,EAAY7C,EAAeC,EAAiB,EAC5C4C,EAAY,IACZnI,KAAKsI,kBAAkBf,EAAKY,GAC5BZ,EAAIC,aAAeW,GAI3B,OADAnI,KAAKgI,iBAAiBT,GAAK,EAAOO,GAC3BP,GAEXD,EAAkBpH,UAAU+H,sBAAwB,SAAUV,EAAKgB,EAAYC,EAAUV,EAAUW,GAG/F,IAFA,IAAIjG,EAAsB+E,EAAI/E,oBAC1BC,EAAQ8E,EAAI9E,MACPP,EAAIqG,EAAYrG,GAAKsG,EAAUtG,IAAK,CACzC,IAAIgB,EAAaV,EAAsBN,EACvCO,EAAMP,GAAGwG,WAAWxF,EAAY4E,EAAS5E,EAAauF,MAG9DnB,EAAkBpH,UAAUgI,mBAAqB,SAAUX,EAAKhC,EAAgBD,EAAcwC,EAAUW,GAGpG,IAFA,IAAI/D,EAAW,GACXiE,EAAc,EACTzF,EAAaqC,EAAgBrC,GAAcoC,EAAcpC,IAC9DwB,EAASiE,KAAiB3I,KAAK8F,KAAKK,oBAExCoB,EAAI9E,MAAQiC,EAASM,OAAOuC,EAAI9E,QAEpC6E,EAAkBpH,UAAUkI,mBAAqB,SAAUb,EAAKqB,GAC5D,IAAK,IAAI1G,EAAI,EAAGA,EAAI0G,EAAa1G,IAAK,CAClC,IAAIyE,EAAcY,EAAI9E,MAAMP,GAAG0E,aAC3BD,GACA3G,KAAKgG,QAAQa,YAAYF,GAGjCY,EAAI9E,MAAMsB,OAAO,EAAG6E,IAExBtB,EAAkBpH,UAAUmI,kBAAoB,SAAUd,EAAKhC,EAAgBD,EAAcwC,EAAUW,GAGnG,IAFA,IAAI/D,EAAW,GACXiE,EAAc,EACTzF,EAAaqC,EAAgBrC,GAAcoC,EAAcpC,IAC9DwB,EAASiE,KAAiB3I,KAAK8F,KAAKK,oBAExCoB,EAAI9E,MAAQ8E,EAAI9E,MAAMuC,OAAON,IAEjC4C,EAAkBpH,UAAUoI,kBAAoB,SAAUf,EAAKqB,GAE3D,IADA,IAAIC,EAActB,EAAIC,YAAcoB,EAC3B1G,EAAI,EAAGA,EAAI0G,EAAa1G,IAAK,CAClC,IAAIyE,EAAcY,EAAI9E,MAAMoG,EAAc3G,GAAG0E,aACzCD,GACA3G,KAAKgG,QAAQa,YAAYF,GAGjCY,EAAI9E,MAAMsB,OAAO8E,EAAaD,IAElCtB,EAAkBpH,UAAU4I,yBAA2B,SAAUvB,EAAKwB,EAAgBC,EAAcC,GAChG,IAAIC,EAAYlJ,KAAKgG,QAAQkD,UACzBH,IAAmBG,EACnBlJ,KAAKgG,QAAQmD,UAAYH,EAGzBE,EAAUE,mBAAmB,WAAYJ,GAG7C,IADA,IAAIK,EAAYrJ,KAAKgG,QAAQkD,UACpBhH,EAAIqF,EAAIC,YAAc,EAAGtF,GAAK,EAAGA,IAAK,CAC3C,IAAIoH,EAAO/B,EAAI9E,MAAMP,GACjB+G,EAAO/G,KACPoH,EAAKC,WAAWF,GAChBA,EAAYA,EAAUG,mBAIlClC,EAAkBpH,UAAUuJ,6BAA+B,SAAUlC,EAAKmC,EAAkBC,GACxF,IAAIC,EAAchI,SAASwE,cAAc,OACzCwD,EAAYT,UAAYO,EACxB,IAAK,IAAIxH,EAAI,EAAGA,EAAIqF,EAAIC,YAAatF,IAAK,CACtC,IAAIoH,EAAO/B,EAAI9E,MAAMP,GACrB,GAAIyH,EAAWzH,GAAI,CACf,IAAI2H,EAASD,EAAYE,WACrBnD,EAAc2C,EAAK1C,aACvBD,EAAYoD,WAAWC,aAAaH,EAAQlD,GAC5C2C,EAAKC,WAAWM,MAI5BvC,EAAkBpH,UAAU8H,iBAAmB,SAAUT,EAAKwB,EAAgBjB,GAC1E,IAAImC,EAAK3C,EAAkB4C,IACvB1C,EAAcD,EAAIC,YAClB/E,EAAQ8E,EAAI9E,MACZD,EAAsB+E,EAAI/E,oBAC1ByG,EAAS,GAETgB,EAAGE,QAEH,IADA,IAAIC,GAAa,EACRlI,EAAI,EAAGA,EAAIsF,EAAatF,IAAK,CAClC,IAAIoH,EAAO7G,EAAMP,GACjB+G,EAAO/G,IAAK,EACZ,IAAIyE,EAAc2C,EAAK1C,aACvB,IAAID,EAAJ,CAIA,IAAI0D,EAAef,EAAKgB,WAAWpI,EAAIM,EAAqBsF,EAAS5F,GAAIlC,KAAKmH,aAAc8C,GACvFI,IAILpB,EAAO/G,IAAK,EACZkI,GAAa,IAEbA,GACApK,KAAK8I,yBAAyBvB,EAAKwB,EAAgBkB,EAAGM,QAAStB,GAInEgB,EAAGE,QACH,IAAIK,GAAiB,EACjBb,EAAa,GACjB,IAASzH,EAAI,EAAGA,EAAIsF,EAAatF,IAAK,CAC9BoH,EAAO7G,EAAMP,GAEjB,GADAyH,EAAWzH,IAAK,GACZ+G,EAAO/G,GAAX,CAIImI,EAAef,EAAKgB,WAAWpI,EAAIM,EAAqBsF,EAAS5F,GAAIlC,KAAKmH,aAAc8C,GACvFI,IAILV,EAAWzH,IAAK,EAChBsI,GAAiB,IAEjBA,GACAxK,KAAKyJ,6BAA6BlC,EAAK0C,EAAGM,QAASZ,IAI/DrC,EAAkB4C,IAAM,eAAoB,KACrC5C,EAhM2B,I,kCC3QtC,8DAIIjI,EAAwC,WACxC,IAAIC,EAAgB,SAAUC,EAAGC,GAI7B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,KAClEP,EAAcC,EAAGC,IAE5B,OAAO,SAAUD,EAAGC,GAEhB,SAASO,IAAOC,KAAKC,YAAcV,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEW,UAAkB,OAANV,EAAaC,OAAOU,OAAOX,IAAMO,EAAGG,UAAYV,EAAEU,UAAW,IAAIH,IAV3C,GAexC0K,EAAoC,SAAUpK,GAE9C,SAASoK,EAAmBC,GACxB,IAAInK,EAAQF,EAAOG,KAAKR,OAASA,KAgBjC,OAfAO,EAAMoK,uBAAyB,KAC/BpK,EAAMqK,YAAc,KACpBrK,EAAMsK,eAAiB,KACvBtK,EAAMuK,eAAiB,KACvBvK,EAAMwK,UAAY,KAClBxK,EAAMyK,QAAU,KAChBzK,EAAM0K,cAAgB,KACtB1K,EAAM2K,YAAc,KACpB3K,EAAM4K,aAAe,KACrB5K,EAAM6K,UAAY,KAClB7K,EAAM8K,YAAc,KACpB9K,EAAM+K,YAAc,KACpB/K,EAAMgL,YAAc,KACpBhL,EAAMiL,aAAe,KACrBjL,EAAMkL,WAAaf,EACZnK,EAuFX,OAzGAlB,EAAUoL,EAAoBpK,GAoB9BoK,EAAmBvK,UAAUwL,sBAAwB,SAAUlF,GACvDxG,KAAK2K,wBACL3K,KAAK2K,uBAAuBnE,IAGpCiE,EAAmBvK,UAAUyL,kBAAoB,SAAUnF,GACnDxG,KAAK4K,aACL5K,KAAK4K,YAAYpE,IAGzBiE,EAAmBvK,UAAU0L,oBAAsB,WAC3C5L,KAAK6K,gBACL7K,KAAK6K,oBAAegB,IAG5BpB,EAAmBvK,UAAU4L,kBAAoB,WACzC9L,KAAK8K,gBACL9K,KAAK8K,oBAAee,IAG5BpB,EAAmBvK,UAAU6L,YAAc,SAAUvF,GAC7CxG,KAAK+K,WACL/K,KAAK+K,UAAUvE,IAGvBiE,EAAmBvK,UAAU8L,UAAY,SAAUxF,GAC3CxG,KAAKgL,SACLhL,KAAKgL,QAAQxE,IAGrBiE,EAAmBvK,UAAU+L,gBAAkB,SAAUzF,GACjDxG,KAAKiL,eACLjL,KAAKiL,cAAcjL,KAAKkM,8BAA8B1F,KAG9DiE,EAAmBvK,UAAUiM,cAAgB,SAAU3F,GAC/CxG,KAAKkL,aACLlL,KAAKkL,YAAYlL,KAAKkM,8BAA8B1F,KAG5DiE,EAAmBvK,UAAUkM,eAAiB,SAAU5F,GAChDxG,KAAKmL,cACLnL,KAAKmL,aAAanL,KAAKkM,8BAA8B1F,KAG7DiE,EAAmBvK,UAAUmM,YAAc,SAAU7F,GAC7CxG,KAAKoL,WACLpL,KAAKoL,UAAUpL,KAAKkM,8BAA8B1F,KAG1DiE,EAAmBvK,UAAUoM,cAAgB,SAAU9F,GAC/CxG,KAAKqL,aACLrL,KAAKqL,YAAYrL,KAAKkM,8BAA8B1F,KAG5DiE,EAAmBvK,UAAUqM,cAAgB,SAAU/F,GAC/CxG,KAAKsL,aACLtL,KAAKsL,YAAYtL,KAAKkM,8BAA8B1F,KAG5DiE,EAAmBvK,UAAUsM,cAAgB,SAAUhG,GAC/CxG,KAAKuL,aACLvL,KAAKuL,YAAYvL,KAAKkM,8BAA8B1F,KAG5DiE,EAAmBvK,UAAUuM,eAAiB,SAAUjG,GAChDxG,KAAKwL,cACLxL,KAAKwL,aAAahF,IAG1BiE,EAAmBvK,UAAUgM,8BAAgC,SAAU1F,GACnE,OAAIA,EAAEzF,OACK,CACH2L,MAAOlG,EAAEkG,MACT3L,OAAQf,KAAK2M,+BAA+BnG,EAAEzF,SAG/CyF,GAEXiE,EAAmBvK,UAAUyM,+BAAiC,SAAU5L,GACpE,OAAO0J,EAAmBmC,8BAA8B7L,EAAQf,KAAKyL,WAAWoB,uBAEpFpC,EAAmBmC,8BAAgC,SAAU7L,EAAQ8L,GACjE,OAAO,IAAIC,EAAoB/L,EAAOgM,QAAShM,EAAOiM,KAAMjM,EAAOkM,YAAalM,EAAOmM,SAAWL,EAAqBM,mCAAmCpM,EAAOmM,UAAY,KAAMnM,EAAOqM,MAAQP,EAAqBQ,6BAA6BtM,EAAOqM,OAAS,KAAMrM,EAAOuM,SAE9Q7C,EA1G4B,CA2GrC,QAEEqC,EAAqC,WACrC,SAASA,EAAoBC,EAASC,EAAMC,EAAaC,EAAUE,EAAOE,GACtEtN,KAAK+M,QAAUA,EACf/M,KAAKgN,KAAOA,EACZhN,KAAKiN,YAAcA,EACnBjN,KAAKkN,SAAWA,EAChBlN,KAAKoN,MAAQA,EACbpN,KAAKsN,OAASA,EAKlB,OAHAR,EAAoB5M,UAAUqN,SAAW,WACrC,OAAO,OAAYA,SAASvN,OAEzB8M,EAZ6B,I,0KCzHpC,EAAgC,WAChC,SAASU,EAAeC,EAAe/C,EAAWgD,EAAgBC,GAC9D3N,KAAKyN,cAAgBA,EACrBzN,KAAK0K,UAAYA,EACjB1K,KAAK0N,eAAiBA,EACtB1N,KAAK2N,gBAAkBA,EAgP3B,OA9OAH,EAAetN,UAAU0N,kBAAoB,SAAUC,EAAeC,GAClEA,EAAKjE,OAAS,QACd7J,KAAK2N,gBAAgBI,qBAAqBF,EAAeC,IAE7DN,EAAetN,UAAU8N,MAAQ,SAAUnE,EAAQoE,EAAMC,EAAgBC,EAAiBC,GACtFpO,KAAK2N,gBAAgBK,MAAMnE,EAAQoE,EAAMC,EAAgBC,EAAiBC,IAE9EZ,EAAetN,UAAU8M,KAAO,SAAUnD,EAAQoE,GAC9CjO,KAAK2N,gBAAgBX,KAAKnD,EAAQoE,IAEtCT,EAAetN,UAAUmO,oBAAsB,SAAUxE,EAAQoE,EAAMK,GACnEtO,KAAK2N,gBAAgBU,oBAAoBxE,EAAQoE,EAAMK,IAE3Dd,EAAetN,UAAUqO,iBAAmB,SAAU1E,GAClD7J,KAAK2N,gBAAgBY,iBAAiB1E,IAE1C2D,EAAetN,UAAUsO,eAAiB,SAAU3E,GAChD7J,KAAK2N,gBAAgBa,eAAe3E,IAExC2D,EAAetN,UAAUuO,IAAM,SAAU5E,GACrC7J,KAAK2N,gBAAgBc,IAAI5E,IAE7B2D,EAAetN,UAAUwO,aAAe,SAAU7E,EAAQ8E,GACtD3O,KAAK2N,gBAAgBI,qBAAqB,4BAAuBa,aAAc,CAC3E/E,OAAQA,EACRgF,UAAWF,KAGnBnB,EAAetN,UAAU4O,oBAAsB,SAAUC,GACrD,IAAIC,EAAYhP,KAAK0K,UAAUuE,iBAAiBF,EAAa7L,YAC7D,OAAI6L,EAAaG,OAASF,EACf,IAAI,OAASD,EAAa7L,WAAY8L,GAE1CD,GAEXvB,EAAetN,UAAUiP,wBAA0B,SAAUC,GACzD,OAAQpP,KAAKyN,cAAc4B,QAAQC,IAAI,KACnC,IAAK,SACD,OAAOF,EAAKG,OAChB,IAAK,UACD,OAAOH,EAAKI,QAChB,IAAK,UACD,OAAOJ,EAAKK,QAEpB,OAAO,GAEXjC,EAAetN,UAAUwP,2BAA6B,SAAUN,GAC5D,OAAQpP,KAAKyN,cAAc4B,QAAQC,IAAI,KACnC,IAAK,SACD,OAAOF,EAAKI,SAAWJ,EAAKK,QAChC,IAAK,UACD,OAAOL,EAAKG,QAAUH,EAAKK,QAC/B,IAAK,UACD,OAAOL,EAAKI,SAAWJ,EAAKG,OAEpC,OAAO,GAEX/B,EAAetN,UAAUyP,cAAgB,SAAUP,GAC/C,IAAIQ,EAA0BC,EAAA,MAAoB7P,KAAKyN,cAAc4B,QAAQC,IAAI,IAC7EF,EAAKU,eAAiBF,EACtB5P,KAAK+P,cAAcX,EAAKlC,SAAUkC,EAAKnC,YAAamC,EAAKY,iBAEpDZ,EAAKa,qBAENjQ,KAAKmP,wBAAwBC,GACzBA,EAAKY,gBACLhQ,KAAKkQ,sBAAsBd,EAAKlC,UAGhClN,KAAKmQ,cAAcf,EAAKlC,UAAU,GAIlCkC,EAAKY,gBACLhQ,KAAKoQ,gBAAgBhB,EAAKlC,UAG1BlN,KAAKqQ,YAAYjB,EAAKlC,UAIzBkC,EAAKkB,gBAAkB,EAC5BtQ,KAAKuQ,aAEwB,IAAxBnB,EAAKkB,eACNtQ,KAAKmP,wBAAwBC,GACzBA,EAAKY,gBACLhQ,KAAKwQ,0BAA0BpB,EAAKlC,UAGpClN,KAAKkQ,sBAAsBd,EAAKlC,UAIhCkC,EAAKY,gBACLhQ,KAAKoQ,gBAAgBhB,EAAKlC,UAG1BlN,KAAKqQ,YAAYjB,EAAKlC,UAID,IAAxBkC,EAAKkB,eACNtQ,KAAKmP,wBAAwBC,GAC7BpP,KAAKyQ,sBAAsBrB,EAAKlC,UAG5BkC,EAAKY,gBACLhQ,KAAK0Q,gBAAgBtB,EAAKlC,UAG1BlN,KAAK2Q,YAAYvB,EAAKlC,UAK1BlN,KAAKmP,wBAAwBC,GACxBpP,KAAK0P,2BAA2BN,KAC7BA,EAAKwB,SACL5Q,KAAK+P,cAAcX,EAAKlC,SAAUkC,EAAKnC,aAAa,GAIhDmC,EAAKY,gBACLhQ,KAAK6Q,wBAAwBzB,EAAKlC,UAGlClN,KAAKmQ,cAAcf,EAAKlC,UAAU,IAM1CkC,EAAKY,gBACDZ,EAAKG,OACLvP,KAAK+P,cAAcX,EAAKlC,SAAUkC,EAAKnC,aAAa,GAGpDjN,KAAK8Q,cAAc1B,EAAKlC,UAI5BlN,KAAK+Q,OAAO3B,EAAKlC,WAKjCM,EAAetN,UAAU8Q,WAAa,SAAUjC,GAE5C,OADAA,EAAe/O,KAAK8O,oBAAoBC,GACjC,CACH7B,SAAUlN,KAAKiR,4BAA4BlC,GAC3CA,aAAcA,IAGtBvB,EAAetN,UAAU6Q,OAAS,SAAUhC,GACxC/O,KAAK4N,kBAAkB,4BAAuBsD,OAAQlR,KAAKgR,WAAWjC,KAE1EvB,EAAetN,UAAU4Q,cAAgB,SAAU/B,GAC/C/O,KAAK4N,kBAAkB,4BAAuBuD,aAAcnR,KAAKgR,WAAWjC,KAEhFvB,EAAetN,UAAU6P,cAAgB,SAAUhB,EAAc9B,EAAamE,GAC1ErC,EAAe/O,KAAK8O,oBAAoBC,GACxC/O,KAAK4N,kBAAkB,4BAAuByD,aAAc,CACxDnE,SAAUlN,KAAKiR,4BAA4BlC,GAC3CA,aAAcA,EACd9B,YAAaA,EACbmE,eAAgBA,KAGxB5D,EAAetN,UAAUiQ,cAAgB,SAAUpB,EAAcuC,GAC7DvC,EAAe/O,KAAK8O,oBAAoBC,GACxC/O,KAAK4N,kBAAkB,4BAAuB2D,aAAc,CACxDrE,SAAUlN,KAAKiR,4BAA4BlC,GAC3CA,aAAcA,EACduC,UAAWA,KAGnB9D,EAAetN,UAAU2Q,wBAA0B,SAAU9B,GACzD/O,KAAK4N,kBAAkB,4BAAuB4D,uBAAwBxR,KAAKgR,WAAWjC,KAE1FvB,EAAetN,UAAUyQ,YAAc,SAAU5B,GAC7C/O,KAAK4N,kBAAkB,4BAAuB6D,WAAYzR,KAAKgR,WAAWjC,KAE9EvB,EAAetN,UAAUwQ,gBAAkB,SAAU3B,GACjD/O,KAAK4N,kBAAkB,4BAAuB8D,eAAgB1R,KAAKgR,WAAWjC,KAElFvB,EAAetN,UAAUuQ,sBAAwB,SAAU1B,GACvD/O,KAAK4N,kBAAkB,4BAAuB+D,qBAAsB3R,KAAKgR,WAAWjC,KAExFvB,EAAetN,UAAUmQ,YAAc,SAAUtB,GAC7C/O,KAAK4N,kBAAkB,4BAAuBgE,WAAY5R,KAAKgR,WAAWjC,KAE9EvB,EAAetN,UAAUkQ,gBAAkB,SAAUrB,GACjD/O,KAAK4N,kBAAkB,4BAAuBiE,eAAgB7R,KAAKgR,WAAWjC,KAElFvB,EAAetN,UAAUgQ,sBAAwB,SAAUnB,GACvD/O,KAAK4N,kBAAkB,4BAAuBkE,qBAAsB9R,KAAKgR,WAAWjC,KAExFvB,EAAetN,UAAUsQ,0BAA4B,SAAUzB,GAC3D/O,KAAK4N,kBAAkB,4BAAuBmE,yBAA0B/R,KAAKgR,WAAWjC,KAE5FvB,EAAetN,UAAUqQ,WAAa,WAClCvQ,KAAK4N,kBAAkB,4BAAuBoE,UAAW,KAG7DxE,EAAetN,UAAU+Q,4BAA8B,SAAUlC,GAC7D,OAAO/O,KAAK0K,UAAUmC,qBAAqBM,mCAAmC4B,IAElFvB,EAAetN,UAAU6L,YAAc,SAAUvF,GAC7CxG,KAAK0N,eAAe3B,YAAYvF,IAEpCgH,EAAetN,UAAU8L,UAAY,SAAUxF,GAC3CxG,KAAK0N,eAAe1B,UAAUxF,IAElCgH,EAAetN,UAAU+L,gBAAkB,SAAUzF,GACjDxG,KAAK0N,eAAezB,gBAAgBzF,IAExCgH,EAAetN,UAAUiM,cAAgB,SAAU3F,GAC/CxG,KAAK0N,eAAevB,cAAc3F,IAEtCgH,EAAetN,UAAUkM,eAAiB,SAAU5F,GAChDxG,KAAK0N,eAAetB,eAAe5F,IAEvCgH,EAAetN,UAAUmM,YAAc,SAAU7F,GAC7CxG,KAAK0N,eAAerB,YAAY7F,IAEpCgH,EAAetN,UAAUoM,cAAgB,SAAU9F,GAC/CxG,KAAK0N,eAAepB,cAAc9F,IAEtCgH,EAAetN,UAAUqM,cAAgB,SAAU/F,GAC/CxG,KAAK0N,eAAenB,cAAc/F,IAEtCgH,EAAetN,UAAUsM,cAAgB,SAAUhG,GAC/CxG,KAAK0N,eAAelB,cAAchG,IAEtCgH,EAAetN,UAAUuM,eAAiB,SAAUjG,GAChDxG,KAAK0N,eAAejB,eAAejG,IAEhCgH,EArPwB,G,gDCH/BnO,EAAwC,WACxC,IAAIC,EAAgB,SAAUC,EAAGC,GAI7B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,KAClEP,EAAcC,EAAGC,IAE5B,OAAO,SAAUD,EAAGC,GAEhB,SAASO,IAAOC,KAAKC,YAAcV,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEW,UAAkB,OAANV,EAAaC,OAAOU,OAAOX,IAAMO,EAAGG,UAAYV,EAAEU,UAAW,IAAIH,IAV3C,GAiBxC,EAA8B,SAAUM,GAExC,SAAS4R,EAAa3R,GAClB,IAAIC,EAAQF,EAAOG,KAAKR,KAAMM,IAAYN,KAM1C,OALAO,EAAM2R,cAAgB,IAAI,OAAuB3R,GACjDA,EAAMyF,QAAUzF,EAAM2R,cAAclM,QACpCzF,EAAM4R,iBAAmB,GACzB5R,EAAM6R,YAAa,EACnB7R,EAAMyF,QAAQK,aAAa,iBACpB9F,EAsFX,OA9FAlB,EAAU4S,EAAc5R,GAUxB4R,EAAa/R,UAAUmS,aAAe,WAClC,GAAIhS,EAAOH,UAAUmS,aAAa7R,KAAKR,MACnC,OAAO,EAEX,IAAK,IAAIkC,EAAI,EAAGkD,EAAMpF,KAAKmS,iBAAiBpP,OAAQb,EAAIkD,EAAKlD,IAAK,CAC9D,IAAIoQ,EAAiBtS,KAAKmS,iBAAiBjQ,GAC3C,GAAIoQ,EAAeD,eACf,OAAO,EAGf,OAAO,GAEXJ,EAAa/R,UAAUS,QAAU,WAC7BN,EAAOH,UAAUS,QAAQH,KAAKR,MAC9B,IAAK,IAAIkC,EAAI,EAAGkD,EAAMpF,KAAKmS,iBAAiBpP,OAAQb,EAAIkD,EAAKlD,IAAK,CAC9D,IAAIoQ,EAAiBtS,KAAKmS,iBAAiBjQ,GAC3CoQ,EAAe3R,UAEnBX,KAAKmS,iBAAmB,IAE5BF,EAAa/R,UAAU0G,WAAa,WAChC,OAAO5G,KAAKgG,SAGhBiM,EAAa/R,UAAUiG,kBAAoB,WACvC,OAAO,IAAI,EAAgBnG,KAAKS,SAASgN,cAAezN,KAAKmS,mBAGjEF,EAAa/R,UAAUqS,kBAAoB,SAAUC,GACjDxS,KAAKmS,iBAAiBM,KAAKD,IAG/BP,EAAa/R,UAAUqG,uBAAyB,SAAUC,GACtDxG,KAAKkS,cAAc3L,uBAAuBC,GAG1C,IAFA,IAAIhD,EAAkBxD,KAAKkS,cAAcrP,qBACrCY,EAAgBzD,KAAKkS,cAAcpP,mBAC9BI,EAAaM,EAAiBN,GAAcO,EAAeP,IAAc,CAC9E,IAAIoG,EAAOtJ,KAAKkS,cAAcjL,eAAe/D,GAC7CoG,EAAK/C,uBAAuBC,GAEhC,OAAO,GAEXyL,EAAa/R,UAAUwG,UAAY,SAAUF,GACzC,OAAOxG,KAAKkS,cAAcxL,UAAUF,IAExCyL,EAAa/R,UAAUwS,eAAiB,SAAUlM,GAE9C,OADAxG,KAAKoS,WAAa5L,EAAEmM,WACb,GAEXV,EAAa/R,UAAU8D,eAAiB,SAAUwC,GAC9C,OAAOxG,KAAKkS,cAAclO,eAAewC,IAE7CyL,EAAa/R,UAAUmD,eAAiB,SAAUmD,GAC9C,OAAOxG,KAAKkS,cAAc7O,eAAemD,IAE7CyL,EAAa/R,UAAUoE,gBAAkB,SAAUkC,GAC/C,OAAOxG,KAAKkS,cAAc5N,gBAAgBkC,IAE9CyL,EAAa/R,UAAU4G,gBAAkB,SAAUN,GAC/C,OAAOxG,KAAKkS,cAAcpL,gBAAgBN,KAAM,GAEpDyL,EAAa/R,UAAU+E,gBAAkB,SAAUuB,GAC/C,OAAOxG,KAAKkS,cAAcjN,gBAAgBuB,IAE9CyL,EAAa/R,UAAU8G,eAAiB,SAAUR,GAC9C,OAAOxG,KAAKkS,cAAclL,eAAeR,IAG7CyL,EAAa/R,UAAU0S,cAAgB,SAAUrL,GAE7C,IADA,IAAIsL,EAAW7S,KAAKmS,iBAAiBW,QAAO,SAAUN,GAAW,OAAOA,EAAQH,kBACvEnQ,EAAI,EAAGkD,EAAMyN,EAAS9P,OAAQb,EAAIkD,EAAKlD,IAAK,CACjD,IAAIoQ,EAAiBO,EAAS3Q,GAC9BoQ,EAAeM,cAAcrL,GAC7B+K,EAAeS,gBAGvBd,EAAa/R,UAAUwH,OAAS,SAAUH,GAEtCvH,KAAKgT,oBAAoBzL,GACzBvH,KAAKgG,QAAQiN,gBAAgB,UAAWjT,KAAKoS,aAEjDH,EAAa/R,UAAU8S,oBAAsB,SAAUzL,GACnDvH,KAAKkS,cAAchL,YAAYK,EAAIJ,eAEhC8K,EA/FsB,CAgG/B,QAEE,EAAiC,WACjC,SAASiB,EAAgBzF,EAAe0F,GACpCnT,KAAKoT,eAAiB3F,EACtBzN,KAAKqT,YAAcrT,KAAKoT,eAAe/D,QAAQC,IAAI,IACnDtP,KAAKmS,iBAAmBgB,EACxBnT,KAAKsT,SAAW,KAChBtT,KAAKuT,iBAAmB,KA8C5B,OA5CAL,EAAgBhT,UAAU0G,WAAa,WACnC,OAAK5G,KAAKsT,SAGHtT,KAAKsT,SAAStN,QAFV,MAIfkN,EAAgBhT,UAAUqJ,WAAa,SAAUvD,GAC7ChG,KAAKsT,SAAW,eAAkBtN,IAEtCkN,EAAgBhT,UAAUmE,iBAAmB,aAG7C6O,EAAgBhT,UAAU+E,gBAAkB,aAG5CiO,EAAgBhT,UAAUqG,uBAAyB,SAAUC,GACzDxG,KAAKqT,YAAcrT,KAAKoT,eAAe/D,QAAQC,IAAI,KAEvD4D,EAAgBhT,UAAUoK,WAAa,SAAUpH,EAAY4E,EAAUX,EAAc8C,GAEjF,IADA,IAAIvI,EAAS,GACJQ,EAAI,EAAGkD,EAAMpF,KAAKmS,iBAAiBpP,OAAQb,EAAIkD,EAAKlD,IAAK,CAC9D,IAAIoQ,EAAiBtS,KAAKmS,iBAAiBjQ,GAC3CR,GAAU4Q,EAAe5K,OAAOP,EAAa3D,gBAAiBN,GAElE,OAAIlD,KAAKuT,mBAAqB7R,IAI9B1B,KAAKuT,iBAAmB7R,EACxBuI,EAAGuJ,kBAAkB,sCACrBvJ,EAAGuJ,kBAAkBtS,OAAO4G,IAC5BmC,EAAGuJ,kBAAkB,yBACrBvJ,EAAGuJ,kBAAkBtS,OAAOlB,KAAKqT,cACjCpJ,EAAGuJ,kBAAkB,SACrBvJ,EAAGuJ,kBAAkB9R,GACrBuI,EAAGuJ,kBAAkB,WACd,IAEXN,EAAgBhT,UAAUwI,WAAa,SAAUxF,EAAY4E,GACrD9H,KAAKsT,WACLtT,KAAKsT,SAASG,OAAO3L,GACrB9H,KAAKsT,SAASI,UAAU1T,KAAKqT,eAG9BH,EApDyB,GAuDhCS,EAAqC,SAAUtT,GAE/C,SAASsT,EAAoBrT,GACzB,IAAIC,EAAQF,EAAOG,KAAKR,KAAMM,IAAYN,KACtCqP,EAAU9O,EAAME,SAASgN,cAAc4B,QACvCuE,EAAavE,EAAQC,IAAI,KAG7B,OAFA/O,EAAMsT,cAAgBD,EAAWE,aACjCvT,EAAMyF,QAAQ0N,UAAU,GACjBnT,EAiBX,OAxBAlB,EAAUsU,EAAqBtT,GAU/BsT,EAAoBzT,UAAUqG,uBAAyB,SAAUC,GAC7D,IAAI6I,EAAUrP,KAAKS,SAASgN,cAAc4B,QACtCuE,EAAavE,EAAQC,IAAI,KAE7B,OADAtP,KAAK6T,cAAgBD,EAAWE,aACzBzT,EAAOH,UAAUqG,uBAAuB/F,KAAKR,KAAMwG,KAAM,GAEpEmN,EAAoBzT,UAAU4G,gBAAkB,SAAUN,GACtD,OAAOnG,EAAOH,UAAU4G,gBAAgBtG,KAAKR,KAAMwG,IAAMA,EAAEuN,oBAG/DJ,EAAoBzT,UAAU8S,oBAAsB,SAAUzL,GAC1DlH,EAAOH,UAAU8S,oBAAoBxS,KAAKR,KAAMuH,GAChDvH,KAAKgG,QAAQgO,SAASvO,KAAKC,IAAI6B,EAAI0M,YAAajU,KAAK6T,iBAElDF,EAzB6B,CA0BtC,GAEE,EAAoC,SAAUtT,GAE9C,SAAS6T,EAAmB5T,GACxB,IAAIC,EAAQF,EAAOG,KAAKR,KAAMM,IAAYN,KACtCqP,EAAU9O,EAAME,SAASgN,cAAc4B,QACvCuE,EAAavE,EAAQC,IAAI,KAK7B,OAJA/O,EAAM4T,aAAeP,EAAWQ,YAChC7T,EAAMyF,QAAQK,aAAa,wBAC3B9F,EAAMyF,QAAQgO,SAAS,GACvB,OAAcK,cAAc9T,EAAMyF,QAASqJ,EAAQC,IAAI,KAChD/O,EAkBX,OA3BAlB,EAAU6U,EAAoB7T,GAW9B6T,EAAmBhU,UAAUqG,uBAAyB,SAAUC,GAC5D,IAAI6I,EAAUrP,KAAKS,SAASgN,cAAc4B,QAC1C,OAAcgF,cAAcrU,KAAKgG,QAASqJ,EAAQC,IAAI,KACtD,IAAIsE,EAAavE,EAAQC,IAAI,KAE7B,OADAtP,KAAKmU,aAAeP,EAAWQ,YACxB/T,EAAOH,UAAUqG,uBAAuB/F,KAAKR,KAAMwG,KAAM,GAEpE0N,EAAmBhU,UAAU4G,gBAAkB,SAAUN,GACrD,OAAOnG,EAAOH,UAAU4G,gBAAgBtG,KAAKR,KAAMwG,IAAMA,EAAE8N,qBAE/DJ,EAAmBhU,UAAU8S,oBAAsB,SAAUzL,GACzDlH,EAAOH,UAAU8S,oBAAoBxS,KAAKR,KAAMuH,GAChD,IAAIgN,EAAS9O,KAAKG,IAAI2B,EAAIiN,aAAc,KACxCxU,KAAKgG,QAAQ0N,UAAUa,GACvBvU,KAAKgG,QAAQgO,SAAShU,KAAKmU,eAExBD,EA5B4B,CA6BrC,G,6VCnOE,EAAwC,WACxC,IAAI5U,EAAgB,SAAUC,EAAGC,GAI7B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,KAClEP,EAAcC,EAAGC,IAE5B,OAAO,SAAUD,EAAGC,GAEhB,SAASO,IAAOC,KAAKC,YAAcV,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEW,UAAkB,OAANV,EAAaC,OAAOU,OAAOX,IAAMO,EAAGG,UAAYV,EAAEU,UAAW,IAAIH,IAV3C,GAoDxC,EAAsB,SAAUM,GAEhC,SAASoU,EAAK9G,EAAiBF,EAAeiH,EAAcC,EAAOC,EAAQlH,GACvE,IAAInN,EAAQF,EAAOG,KAAKR,OAASA,KACjCO,EAAMsU,QAAUD,EAChBrU,EAAMuU,sBAAwB,KAC9BvU,EAAMmN,eAAiBA,EACvB,IAAIqH,EAAiB,IAAI,EAAetH,EAAekH,EAAOpU,EAAMmN,eAAgBC,GAEpFpN,EAAMyU,gBAAkB,IAAI,QAAoB,SAAUC,GAAY,OAAO1U,EAAM2U,YAAYD,MAE/F1U,EAAMyU,gBAAgBtU,gBAAgBH,GAEtCA,EAAME,SAAW,IAAI,OAAYgN,EAAeiH,EAAaS,WAAYR,EAAOpU,EAAMyU,iBACtFzU,EAAM6U,UAAUV,EAAaW,eAAc,SAAUC,GACjD/U,EAAME,SAAS6U,MAAQA,EACvB/U,EAAMyU,gBAAgBO,KAAK,IAAIC,EAAA,MAC/BjV,EAAMmH,QAAO,GAAM,OAEvBnH,EAAMkV,UAAY,GAElBlV,EAAMmV,iBAAmB,IAAI,OAAgBnV,EAAME,SAAUsU,EAAgBxU,EAAMoV,+BACnFpV,EAAMkV,UAAUhD,KAAKlS,EAAMmV,kBAE3BnV,EAAMqV,aAAe,eAAkBhU,SAASwE,cAAc,QAC9D7F,EAAMqV,aAAavP,aAAa,0CAChC9F,EAAMqV,aAAatP,YAAY,YAC/B/F,EAAMyF,QAAU,eAAkBpE,SAASwE,cAAc,QACzD7F,EAAMyF,QAAQK,aAAa9F,EAAMsV,sBACjCtV,EAAMuV,uBAAyB,eAAkBlU,SAASwE,cAAc,QACxE,OAAiBtF,MAAMP,EAAMuV,uBAAwB,GACrDvV,EAAMuV,uBAAuBzP,aAAa,kBAC1C9F,EAAMwV,WAAa,IAAI,OAAgBxV,EAAME,SAAUF,EAAMqV,aAAcrV,EAAMyF,QAASzF,EAAMuV,wBAChGvV,EAAMkV,UAAUhD,KAAKlS,EAAMwV,YAE3BxV,EAAMyV,UAAY,IAAI,OAAUzV,EAAME,SAAUF,EAAMqV,cAEtDrV,EAAM0V,UAAY,IAAI,OAAU1V,EAAME,UACtCF,EAAMkV,UAAUhD,KAAKlS,EAAM0V,WAE3B,IAAIC,EAA2B,IAAI,OAAyB3V,EAAME,UAClEF,EAAMkV,UAAUhD,KAAKyD,GACrB,IAAIC,EAAmB,IAAI,OAAyB5V,EAAME,UAC1DF,EAAMkV,UAAUhD,KAAK0D,GACrB,IAAIC,EAAsB,IAAIzC,EAAoBpT,EAAME,UACxDF,EAAMkV,UAAUhD,KAAK2D,GACrBA,EAAoB7D,kBAAkB,IAAI,OAA4BhS,EAAME,WAC5E2V,EAAoB7D,kBAAkB,IAAI,OAAkBhS,EAAME,WAClE2V,EAAoB7D,kBAAkB,IAAI,OAAoBhS,EAAME,WACpE2V,EAAoB7D,kBAAkB,IAAI,OAAmBhS,EAAME,WACnE,IAAI4V,EAAqB,IAAI,EAAmB9V,EAAME,UACtDF,EAAMkV,UAAUhD,KAAK4D,GACrBA,EAAmB9D,kBAAkB,IAAI,OAAkChS,EAAME,WACjF4V,EAAmB9D,kBAAkB,IAAI,OAAmBhS,EAAME,WAClE4V,EAAmB9D,kBAAkB,IAAI,OAAiChS,EAAME,WAChF4V,EAAmB9D,kBAAkB,IAAI,OAAwBhS,EAAME,WACvE4V,EAAmB9D,kBAAkB,IAAI,OAAmBhS,EAAME,WAClE,IAAI6V,EAAS,IAAI,OAAO/V,EAAME,UAC9B6V,EAAO1P,aAAa2P,YAAYhW,EAAM0V,UAAUO,eAChDF,EAAO1P,aAAa2P,YAAYF,EAAmBzP,cACnDrG,EAAMkV,UAAUhD,KAAK6D,GAErB/V,EAAMkW,eAAiB,IAAI,OAAmBlW,EAAME,SAAUF,EAAMyF,SACpEzF,EAAMkV,UAAUhD,KAAKlS,EAAMkW,gBAC3BlW,EAAMmW,YAAc,IAAI,OAAYnW,EAAME,UAC1CF,EAAMkV,UAAUhD,KAAKlS,EAAMmW,aAE3BnW,EAAMoW,eAAiB,IAAI,OAAmBpW,EAAME,UACpDF,EAAMkV,UAAUhD,KAAKlS,EAAMoW,gBAC3B,IAAIC,EAAS,IAAI,OAAOrW,EAAME,UAC9BF,EAAMkV,UAAUhD,KAAKmE,GACrB,IAAIC,EAAU,IAAI,OAAQtW,EAAME,UAGhC,GAFAF,EAAMkV,UAAUhD,KAAKoE,GAEjBX,EAA0B,CAC1B,IAAIY,EAAoBvW,EAAMwV,WAAWgB,6BACzCD,EAAkBE,OAAOC,aAAaf,EAAyBtP,aAAckQ,EAAkBG,cA0BnG,OAxBA1W,EAAMqV,aAAaW,YAAYH,EAAoBxP,cACnDrG,EAAMqV,aAAaW,YAAYK,EAAO5Q,SACtCzF,EAAMqV,aAAaW,YAAYhW,EAAM0V,UAAUjQ,SAC/CzF,EAAMqV,aAAaW,YAAYhW,EAAMyV,UAAUpP,cAC/CrG,EAAMqV,aAAaW,YAAYhW,EAAMkW,eAAezQ,SACpDzF,EAAMqV,aAAaW,YAAYhW,EAAMmW,YAAY9P,cACjDrG,EAAMuV,uBAAuBS,YAAYD,EAAO1P,cAChDrG,EAAMuV,uBAAuBS,YAAYhW,EAAMwV,WAAWnP,cAC1DrG,EAAMuV,uBAAuBS,YAAYJ,EAAiBvP,cAC1DrG,EAAMuV,uBAAuBS,YAAYhW,EAAMmV,iBAAiBwB,UAChE3W,EAAMuV,uBAAuBS,YAAYhW,EAAMmV,iBAAiByB,eAChE5W,EAAMuV,uBAAuBS,YAAYhW,EAAMoW,eAAe/P,cAC9DrG,EAAMuV,uBAAuBS,YAAYM,EAAQjQ,cACjDrG,EAAMyF,QAAQuQ,YAAYhW,EAAMuV,wBAChCvV,EAAMyF,QAAQuQ,YAAYhW,EAAMkW,eAAeW,kCAC/C7W,EAAM8W,eAEN9W,EAAM+W,eAAiB/W,EAAM6U,UAAU,IAAI,OAAe7U,EAAME,SAAUsU,EAAgBxU,EAAMgX,+BAChGhX,EAAM6U,UAAUT,EAAM6C,kBAAiB,SAAUC,GAC7ClX,EAAMyU,gBAAgB0C,SAASD,OAEnClX,EAAM6U,UAAU7U,EAAMsU,QAAQ2C,kBAAiB,SAAUC,GACrDlX,EAAMyU,gBAAgB0C,SAASD,OAE5BlX,EAmRX,OAxXA,EAAUkU,EAAMpU,GAuGhBoU,EAAKvU,UAAUyX,8BAAgC,WAC3C3X,KAAK4X,cAETnD,EAAKvU,UAAUqX,2BAA6B,WACxC,IAAIhX,EAAQP,KACZ,MAAO,CACH6X,YAAa7X,KAAKgG,QAAQA,QAC1B8R,oBAAqB9X,KAAK4V,aAAa5P,QACvC+R,cAAe,WACXxX,EAAMyX,SAEVC,kBAAmB,WACf,IAAIC,EAA4B3X,EAAMmW,YAAYuB,qBAAuB,GACrEE,EAAuB5X,EAAMmV,iBAAiBuC,oBAClD,OAAO,IAAI,OAA6BC,EAA2BC,IAEvEC,kCAAmC,SAAUC,GACzC,OAAO9X,EAAM0V,UAAUmC,kCAAkCC,IAE7DC,gCAAiC,SAAUC,GACvC,OAAOhY,EAAMkW,eAAe6B,gCAAgCC,IAEhEC,uBAAwB,SAAUC,EAAUC,GAExC,OADAnY,EAAMoX,gCACCpX,EAAMyV,UAAUwC,uBAAuBC,EAAUC,IAE5DC,wBAAyB,SAAUzV,EAAYgM,GAE3C,OADA3O,EAAMoX,gCACCpX,EAAMyV,UAAU2C,wBAAwB,IAAI,OAASzV,EAAYgM,KAE5E0J,aAAc,SAAU1V,GAEpB,OADA3C,EAAMoX,gCACCpX,EAAMyV,UAAU4C,aAAa1V,MAIhDuR,EAAKvU,UAAUyV,4BAA8B,WACzC,IAAIpV,EAAQP,KACZ,MAAO,CACH6Y,wCAAyC,SAAU3V,EAAYgM,GAE3D,OADA3O,EAAMoX,gCACCpX,EAAMyV,UAAU2C,wBAAwB,IAAI,OAASzV,EAAYgM,OAIpFuF,EAAKvU,UAAUmX,aAAe,WAC1B,IAAIhI,EAAUrP,KAAKS,SAASgN,cAAc4B,QACtCuE,EAAavE,EAAQC,IAAI,KAC7BtP,KAAKgG,QAAQgO,SAASJ,EAAWkF,OACjC9Y,KAAKgG,QAAQ0N,UAAUE,EAAWW,QAClCvU,KAAK8V,uBAAuB9B,SAASJ,EAAWkF,OAChD9Y,KAAK8V,uBAAuBpC,UAAUE,EAAWW,QACjDvU,KAAK4V,aAAa5B,SAAS,KAC3BhU,KAAK4V,aAAalC,UAAU,MAEhCe,EAAKvU,UAAU2V,mBAAqB,WAChC,IAAIkD,EAAU/Y,KAAK0V,iBAAiB/C,YAAc,WAAa,GAC/D,OAAO3S,KAAKS,SAASgN,cAAc4B,QAAQC,IAAI,KAA6B,IAAM,eAAqBtP,KAAKS,SAAS6U,MAAMtI,MAAQ+L,GAGvItE,EAAKvU,UAAUqG,uBAAyB,SAAUC,GAG9C,OAFAxG,KAAKgG,QAAQK,aAAarG,KAAK6V,sBAC/B7V,KAAKqX,gBACE,GAEX5C,EAAKvU,UAAU8Y,qBAAuB,SAAUxS,GAE5C,OADAxG,KAAK0N,eAAehC,sBAAsBlF,IACnC,GAEXiO,EAAKvU,UAAUwS,eAAiB,SAAUlM,GAStC,OARAxG,KAAKgG,QAAQK,aAAarG,KAAK6V,sBAC/B7V,KAAKS,SAASkU,MAAMsE,YAAYzS,EAAEmM,WAC9BnM,EAAEmM,UACF3S,KAAK0N,eAAe9B,sBAGpB5L,KAAK0N,eAAe5B,qBAEjB,GAEX2I,EAAKvU,UAAU4G,gBAAkB,SAAUN,GAEvC,OADAxG,KAAK0N,eAAe/B,kBAAkBnF,IAC/B,GAEXiO,EAAKvU,UAAUgZ,eAAiB,SAAU1S,GAEtC,OADAxG,KAAKgG,QAAQK,aAAarG,KAAK6V,uBACxB,GAGXpB,EAAKvU,UAAUS,QAAU,WACc,OAA/BX,KAAK8U,wBACL9U,KAAK8U,sBAAsBnU,UAC3BX,KAAK8U,sBAAwB,MAEjC9U,KAAKgV,gBAAgBpU,mBAAmBZ,MACxCA,KAAK0N,eAAe/M,UACpBX,KAAKgW,UAAUrV,UAEf,IAAK,IAAIuB,EAAI,EAAGkD,EAAMpF,KAAKyV,UAAU1S,OAAQb,EAAIkD,EAAKlD,IAClDlC,KAAKyV,UAAUvT,GAAGvB,UAEtBX,KAAKyV,UAAY,GACjBpV,EAAOH,UAAUS,QAAQH,KAAKR,OAElCyU,EAAKvU,UAAUgV,YAAc,SAAUD,GACnC,IAAI7T,EAAI+X,EAAgBlE,GAExB,OADAjV,KAAKoZ,kBACEhY,GAEXqT,EAAKvU,UAAUkZ,gBAAkB,WACM,OAA/BpZ,KAAK8U,wBACL9U,KAAK8U,sBAAwBuE,EAAA,KAA4CrZ,KAAKsZ,mBAAmBC,KAAKvZ,MAAO,OAGrHyU,EAAKvU,UAAUoZ,mBAAqB,WAChCtZ,KAAK8U,sBAAwB,KAC7B9U,KAAK2X,iCAETlD,EAAKvU,UAAU0X,WAAa,WACxB,IAAIrX,EAAQP,KACZmZ,GAAgB,WAAc,OAAO5Y,EAAMiZ,oBAE/C/E,EAAKvU,UAAUuZ,sBAAwB,WAEnC,IADA,IAAI/X,EAAS,GAAIC,EAAY,EACpBO,EAAI,EAAGkD,EAAMpF,KAAKyV,UAAU1S,OAAQb,EAAIkD,EAAKlD,IAAK,CACvD,IAAIwX,EAAW1Z,KAAKyV,UAAUvT,GAC1BwX,EAASrH,iBACT3Q,EAAOC,KAAe+X,GAG9B,OAAOhY,GAEX+S,EAAKvU,UAAUsZ,cAAgB,WAC3B,GAAKH,EAAA,KAAYrZ,KAAKgG,QAAQA,SAA9B,CAGA,IAAI2T,EAAoB3Z,KAAKyZ,wBAC7B,GAAKzZ,KAAKgW,UAAU3D,gBAA+C,IAA7BsH,EAAkB5W,OAAxD,CAIA,IAAI6W,EAAsB5Z,KAAKS,SAASoZ,WAAWC,uBACnD9Z,KAAKS,SAASkU,MAAMoF,YAAYH,EAAoBpW,gBAAiBoW,EAAoBnW,cAAemW,EAAoBI,oBAC5H,IAAI7S,EAAe,IAAI,OAAanH,KAAK6U,QAAQoF,oBAAqBL,EAAqB5Z,KAAKS,SAASoZ,WAAWK,4BAA6Bla,KAAKS,SAASkU,OAC3J3U,KAAKyW,eAAepE,gBAEpBrS,KAAKyW,eAAe0D,eAAehT,GAEnCnH,KAAKgW,UAAU3D,iBACfrS,KAAKgW,UAAUoE,WAAWjT,GAC1BnH,KAAKgW,UAAUjD,cAEf4G,EAAoB3Z,KAAKyZ,yBAI7B,IAFA,IAAIY,EAAmB,IAAI,OAAiBra,KAAKS,SAASoZ,WAAY1S,EAAcnH,KAAKgW,WAEhF9T,EAAI,EAAGkD,EAAMuU,EAAkB5W,OAAQb,EAAIkD,EAAKlD,IAAK,CAC1D,IAAIwX,EAAWC,EAAkBzX,GACjCwX,EAAS9G,cAAcyH,GAE3B,IAASnY,EAAI,EAAGkD,EAAMuU,EAAkB5W,OAAQb,EAAIkD,EAAKlD,IAAK,CACtDwX,EAAWC,EAAkBzX,GACjCwX,EAAShS,OAAO2S,GAChBX,EAAS3G,kBAIjB0B,EAAKvU,UAAUoa,mCAAqC,SAAUC,GAC1Dva,KAAK+V,WAAWuE,mCAAmCC,IAEvD9F,EAAKvU,UAAUsa,aAAe,SAAUC,GACpCza,KAAKS,SAASoZ,WAAWa,qBAAqB,CAAEC,UAAWF,EAAeE,YAC1E3a,KAAKS,SAASkU,MAAMiG,mBACpB5a,KAAK4X,aACL5X,KAAKgW,UAAU6E,mBACf7a,KAAKS,SAASoZ,WAAWa,qBAAqB,CAAEI,WAAYL,EAAeK,cAE/ErG,EAAKvU,UAAU6a,mBAAqB,SAAUC,EAAiBC,GAC3D,IAAIC,EAAgBlb,KAAKS,SAASkU,MAAMwG,sBAAsB,CAC1DjY,WAAY8X,EACZ9L,OAAQ+L,IAERlM,EAAe/O,KAAKS,SAASkU,MAAM9H,qBAAqBuO,mCAAmCF,GAC/Flb,KAAK2X,gCACL,IAAI0D,EAAerb,KAAKgW,UAAU2C,wBAAwB,IAAI,OAAS5J,EAAa7L,WAAY6L,EAAaG,SAC7G,OAAKmM,EAGEA,EAAaC,MAFR,GAIhB7G,EAAKvU,UAAUqb,uBAAyB,SAAUC,EAASC,GACvD,IAAIC,EAAc1b,KAAKsX,eAAeiE,uBAAuBC,EAASC,GACtE,OAAKC,EAGE,OAAmB9O,8BAA8B8O,EAAa1b,KAAKS,SAASkU,MAAM9H,sBAF9E,MAIf4H,EAAKvU,UAAUyb,oBAAsB,SAAUC,GAC3C,OAAO,IAAI,OAAc5b,KAAKS,SAAUmb,IAE5CnH,EAAKvU,UAAU2b,OAAS,SAAU5G,GAC9B,IAAI1U,EAAQP,KACZ,OAAOA,KAAKkV,aAAY,WACpB,IAAI4G,EAAmBvb,EAAM0V,UAAU8F,gBAAgB9G,GAKvD,OAJI6G,IACAvb,EAAME,SAASoZ,WAAWmC,uBAC1Bzb,EAAME,SAASwb,oBAAoB1G,KAAK,IAAIC,EAAA,OAEzCsG,MAGfrH,EAAKvU,UAAUwH,OAAS,SAAUwU,EAAKC,GACnC,GAAIA,EAAY,CAEZnc,KAAKgW,UAAUoG,oBACf,IAAK,IAAIla,EAAI,EAAGkD,EAAMpF,KAAKyV,UAAU1S,OAAQb,EAAIkD,EAAKlD,IAAK,CACvD,IAAIwX,EAAW1Z,KAAKyV,UAAUvT,GAC9BwX,EAAS0C,qBAGbF,EACAlc,KAAK2X,gCAGL3X,KAAKoZ,mBAGb3E,EAAKvU,UAAU8X,MAAQ,WACnBhY,KAAK0V,iBAAiBqC,iBAE1BtD,EAAKvU,UAAUyS,UAAY,WACvB,OAAO3S,KAAK0V,iBAAiB/C,aAEjC8B,EAAKvU,UAAUmc,eAAiB,SAAUhN,GACtCrP,KAAK0V,iBAAiB2G,eAAehN,IAEzCoF,EAAKvU,UAAUoc,iBAAmB,SAAUC,GACxCvc,KAAKyW,eAAe+F,UAAUD,EAAWE,QACzCzc,KAAK0c,oBAAoBH,GACzBvc,KAAKoZ,mBAET3E,EAAKvU,UAAUwc,oBAAsB,SAAUH,GAC3C,IAAII,EAAWJ,EAAWrP,UAAWqP,EAAWrP,SAASE,OAAgB,KACzE,GAAiB,OAAbuP,EAAmB,CACnB,IAAIC,EAAcL,EAAWrP,SAAWqP,EAAWrP,SAASA,SAAW,KACnD,OAAhB0P,IACAD,EAAW,IAAI,OAAMC,EAAY1Z,WAAY0Z,EAAY1N,OAAQ0N,EAAY1Z,WAAY0Z,EAAY1N,SAG7G,IAAI2N,EAAgBN,EAAWrP,SAAWqP,EAAWrP,SAAS4P,WAAa,KAC3E9c,KAAKyW,eAAesG,kBAAkBR,EAAWE,OAAQE,EAAUE,GACnE7c,KAAKoZ,mBAET3E,EAAKvU,UAAU8c,oBAAsB,SAAUT,GAC3Cvc,KAAKyW,eAAewG,aAAaV,EAAWE,QAC5Czc,KAAKoZ,mBAET3E,EAAKvU,UAAUgd,iBAAmB,SAAUX,GACxCvc,KAAK2W,eAAe6F,UAAUD,EAAWE,QACzCzc,KAAKmd,oBAAoBZ,GACzBvc,KAAKoZ,mBAET3E,EAAKvU,UAAUid,oBAAsB,SAAUZ,GAC3C,IAAIM,EAAgBN,EAAWrP,SAAWqP,EAAWrP,SAAS4P,WAAa,KACvEzK,EAAerS,KAAK2W,eAAeoG,kBAAkBR,EAAWE,OAAQI,GACxExK,GACArS,KAAKoZ,mBAGb3E,EAAKvU,UAAUkd,oBAAsB,SAAUb,GAC3Cvc,KAAK2W,eAAesG,aAAaV,EAAWE,QAC5Czc,KAAKoZ,mBAEF3E,EAzXc,CA0XvB,QAEF,SAAS0E,EAAgBkE,GACrB,IACI,OAAOA,IAEX,MAAO7W,GACH,eAAkBA","file":"js/chunk-vendors~988ffb2d.f0f3b5ac.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { FastDomNode } from '../../../base/browser/fastDomNode.js';\r\nimport { ViewEventHandler } from '../../common/viewModel/viewEventHandler.js';\r\nvar ViewPart = /** @class */ (function (_super) {\r\n    __extends(ViewPart, _super);\r\n    function ViewPart(context) {\r\n        var _this = _super.call(this) || this;\r\n        _this._context = context;\r\n        _this._context.addEventHandler(_this);\r\n        return _this;\r\n    }\r\n    ViewPart.prototype.dispose = function () {\r\n        this._context.removeEventHandler(this);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    return ViewPart;\r\n}(ViewEventHandler));\r\nexport { ViewPart };\r\nvar PartFingerprints = /** @class */ (function () {\r\n    function PartFingerprints() {\r\n    }\r\n    PartFingerprints.write = function (target, partId) {\r\n        if (target instanceof FastDomNode) {\r\n            target.setAttribute('data-mprt', String(partId));\r\n        }\r\n        else {\r\n            target.setAttribute('data-mprt', String(partId));\r\n        }\r\n    };\r\n    PartFingerprints.read = function (target) {\r\n        var r = target.getAttribute('data-mprt');\r\n        if (r === null) {\r\n            return 0 /* None */;\r\n        }\r\n        return parseInt(r, 10);\r\n    };\r\n    PartFingerprints.collect = function (child, stopAt) {\r\n        var result = [], resultLen = 0;\r\n        while (child && child !== document.body) {\r\n            if (child === stopAt) {\r\n                break;\r\n            }\r\n            if (child.nodeType === child.ELEMENT_NODE) {\r\n                result[resultLen++] = this.read(child);\r\n            }\r\n            child = child.parentElement;\r\n        }\r\n        var r = new Uint8Array(resultLen);\r\n        for (var i = 0; i < resultLen; i++) {\r\n            r[i] = result[resultLen - i - 1];\r\n        }\r\n        return r;\r\n    };\r\n    return PartFingerprints;\r\n}());\r\nexport { PartFingerprints };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { createFastDomNode } from '../../../base/browser/fastDomNode.js';\r\nimport { createStringBuilder } from '../../common/core/stringBuilder.js';\r\nvar RenderedLinesCollection = /** @class */ (function () {\r\n    function RenderedLinesCollection(createLine) {\r\n        this._createLine = createLine;\r\n        this._set(1, []);\r\n    }\r\n    RenderedLinesCollection.prototype.flush = function () {\r\n        this._set(1, []);\r\n    };\r\n    RenderedLinesCollection.prototype._set = function (rendLineNumberStart, lines) {\r\n        this._lines = lines;\r\n        this._rendLineNumberStart = rendLineNumberStart;\r\n    };\r\n    RenderedLinesCollection.prototype._get = function () {\r\n        return {\r\n            rendLineNumberStart: this._rendLineNumberStart,\r\n            lines: this._lines\r\n        };\r\n    };\r\n    /**\r\n     * @returns Inclusive line number that is inside this collection\r\n     */\r\n    RenderedLinesCollection.prototype.getStartLineNumber = function () {\r\n        return this._rendLineNumberStart;\r\n    };\r\n    /**\r\n     * @returns Inclusive line number that is inside this collection\r\n     */\r\n    RenderedLinesCollection.prototype.getEndLineNumber = function () {\r\n        return this._rendLineNumberStart + this._lines.length - 1;\r\n    };\r\n    RenderedLinesCollection.prototype.getCount = function () {\r\n        return this._lines.length;\r\n    };\r\n    RenderedLinesCollection.prototype.getLine = function (lineNumber) {\r\n        var lineIndex = lineNumber - this._rendLineNumberStart;\r\n        if (lineIndex < 0 || lineIndex >= this._lines.length) {\r\n            throw new Error('Illegal value for lineNumber');\r\n        }\r\n        return this._lines[lineIndex];\r\n    };\r\n    /**\r\n     * @returns Lines that were removed from this collection\r\n     */\r\n    RenderedLinesCollection.prototype.onLinesDeleted = function (deleteFromLineNumber, deleteToLineNumber) {\r\n        if (this.getCount() === 0) {\r\n            // no lines\r\n            return null;\r\n        }\r\n        var startLineNumber = this.getStartLineNumber();\r\n        var endLineNumber = this.getEndLineNumber();\r\n        if (deleteToLineNumber < startLineNumber) {\r\n            // deleting above the viewport\r\n            var deleteCnt = deleteToLineNumber - deleteFromLineNumber + 1;\r\n            this._rendLineNumberStart -= deleteCnt;\r\n            return null;\r\n        }\r\n        if (deleteFromLineNumber > endLineNumber) {\r\n            // deleted below the viewport\r\n            return null;\r\n        }\r\n        // Record what needs to be deleted\r\n        var deleteStartIndex = 0;\r\n        var deleteCount = 0;\r\n        for (var lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++) {\r\n            var lineIndex = lineNumber - this._rendLineNumberStart;\r\n            if (deleteFromLineNumber <= lineNumber && lineNumber <= deleteToLineNumber) {\r\n                // this is a line to be deleted\r\n                if (deleteCount === 0) {\r\n                    // this is the first line to be deleted\r\n                    deleteStartIndex = lineIndex;\r\n                    deleteCount = 1;\r\n                }\r\n                else {\r\n                    deleteCount++;\r\n                }\r\n            }\r\n        }\r\n        // Adjust this._rendLineNumberStart for lines deleted above\r\n        if (deleteFromLineNumber < startLineNumber) {\r\n            // Something was deleted above\r\n            var deleteAboveCount = 0;\r\n            if (deleteToLineNumber < startLineNumber) {\r\n                // the entire deleted lines are above\r\n                deleteAboveCount = deleteToLineNumber - deleteFromLineNumber + 1;\r\n            }\r\n            else {\r\n                deleteAboveCount = startLineNumber - deleteFromLineNumber;\r\n            }\r\n            this._rendLineNumberStart -= deleteAboveCount;\r\n        }\r\n        var deleted = this._lines.splice(deleteStartIndex, deleteCount);\r\n        return deleted;\r\n    };\r\n    RenderedLinesCollection.prototype.onLinesChanged = function (changeFromLineNumber, changeToLineNumber) {\r\n        if (this.getCount() === 0) {\r\n            // no lines\r\n            return false;\r\n        }\r\n        var startLineNumber = this.getStartLineNumber();\r\n        var endLineNumber = this.getEndLineNumber();\r\n        var someoneNotified = false;\r\n        for (var changedLineNumber = changeFromLineNumber; changedLineNumber <= changeToLineNumber; changedLineNumber++) {\r\n            if (changedLineNumber >= startLineNumber && changedLineNumber <= endLineNumber) {\r\n                // Notify the line\r\n                this._lines[changedLineNumber - this._rendLineNumberStart].onContentChanged();\r\n                someoneNotified = true;\r\n            }\r\n        }\r\n        return someoneNotified;\r\n    };\r\n    RenderedLinesCollection.prototype.onLinesInserted = function (insertFromLineNumber, insertToLineNumber) {\r\n        if (this.getCount() === 0) {\r\n            // no lines\r\n            return null;\r\n        }\r\n        var insertCnt = insertToLineNumber - insertFromLineNumber + 1;\r\n        var startLineNumber = this.getStartLineNumber();\r\n        var endLineNumber = this.getEndLineNumber();\r\n        if (insertFromLineNumber <= startLineNumber) {\r\n            // inserting above the viewport\r\n            this._rendLineNumberStart += insertCnt;\r\n            return null;\r\n        }\r\n        if (insertFromLineNumber > endLineNumber) {\r\n            // inserting below the viewport\r\n            return null;\r\n        }\r\n        if (insertCnt + insertFromLineNumber > endLineNumber) {\r\n            // insert inside the viewport in such a way that all remaining lines are pushed outside\r\n            var deleted = this._lines.splice(insertFromLineNumber - this._rendLineNumberStart, endLineNumber - insertFromLineNumber + 1);\r\n            return deleted;\r\n        }\r\n        // insert inside the viewport, push out some lines, but not all remaining lines\r\n        var newLines = [];\r\n        for (var i = 0; i < insertCnt; i++) {\r\n            newLines[i] = this._createLine();\r\n        }\r\n        var insertIndex = insertFromLineNumber - this._rendLineNumberStart;\r\n        var beforeLines = this._lines.slice(0, insertIndex);\r\n        var afterLines = this._lines.slice(insertIndex, this._lines.length - insertCnt);\r\n        var deletedLines = this._lines.slice(this._lines.length - insertCnt, this._lines.length);\r\n        this._lines = beforeLines.concat(newLines).concat(afterLines);\r\n        return deletedLines;\r\n    };\r\n    RenderedLinesCollection.prototype.onTokensChanged = function (ranges) {\r\n        if (this.getCount() === 0) {\r\n            // no lines\r\n            return false;\r\n        }\r\n        var startLineNumber = this.getStartLineNumber();\r\n        var endLineNumber = this.getEndLineNumber();\r\n        var notifiedSomeone = false;\r\n        for (var i = 0, len = ranges.length; i < len; i++) {\r\n            var rng = ranges[i];\r\n            if (rng.toLineNumber < startLineNumber || rng.fromLineNumber > endLineNumber) {\r\n                // range outside viewport\r\n                continue;\r\n            }\r\n            var from = Math.max(startLineNumber, rng.fromLineNumber);\r\n            var to = Math.min(endLineNumber, rng.toLineNumber);\r\n            for (var lineNumber = from; lineNumber <= to; lineNumber++) {\r\n                var lineIndex = lineNumber - this._rendLineNumberStart;\r\n                this._lines[lineIndex].onTokensChanged();\r\n                notifiedSomeone = true;\r\n            }\r\n        }\r\n        return notifiedSomeone;\r\n    };\r\n    return RenderedLinesCollection;\r\n}());\r\nexport { RenderedLinesCollection };\r\nvar VisibleLinesCollection = /** @class */ (function () {\r\n    function VisibleLinesCollection(host) {\r\n        var _this = this;\r\n        this._host = host;\r\n        this.domNode = this._createDomNode();\r\n        this._linesCollection = new RenderedLinesCollection(function () { return _this._host.createVisibleLine(); });\r\n    }\r\n    VisibleLinesCollection.prototype._createDomNode = function () {\r\n        var domNode = createFastDomNode(document.createElement('div'));\r\n        domNode.setClassName('view-layer');\r\n        domNode.setPosition('absolute');\r\n        domNode.domNode.setAttribute('role', 'presentation');\r\n        domNode.domNode.setAttribute('aria-hidden', 'true');\r\n        return domNode;\r\n    };\r\n    // ---- begin view event handlers\r\n    VisibleLinesCollection.prototype.onConfigurationChanged = function (e) {\r\n        if (e.hasChanged(107 /* layoutInfo */)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    VisibleLinesCollection.prototype.onFlushed = function (e) {\r\n        this._linesCollection.flush();\r\n        // No need to clear the dom node because a full .innerHTML will occur in ViewLayerRenderer._render\r\n        return true;\r\n    };\r\n    VisibleLinesCollection.prototype.onLinesChanged = function (e) {\r\n        return this._linesCollection.onLinesChanged(e.fromLineNumber, e.toLineNumber);\r\n    };\r\n    VisibleLinesCollection.prototype.onLinesDeleted = function (e) {\r\n        var deleted = this._linesCollection.onLinesDeleted(e.fromLineNumber, e.toLineNumber);\r\n        if (deleted) {\r\n            // Remove from DOM\r\n            for (var i = 0, len = deleted.length; i < len; i++) {\r\n                var lineDomNode = deleted[i].getDomNode();\r\n                if (lineDomNode) {\r\n                    this.domNode.domNode.removeChild(lineDomNode);\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    VisibleLinesCollection.prototype.onLinesInserted = function (e) {\r\n        var deleted = this._linesCollection.onLinesInserted(e.fromLineNumber, e.toLineNumber);\r\n        if (deleted) {\r\n            // Remove from DOM\r\n            for (var i = 0, len = deleted.length; i < len; i++) {\r\n                var lineDomNode = deleted[i].getDomNode();\r\n                if (lineDomNode) {\r\n                    this.domNode.domNode.removeChild(lineDomNode);\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    VisibleLinesCollection.prototype.onScrollChanged = function (e) {\r\n        return e.scrollTopChanged;\r\n    };\r\n    VisibleLinesCollection.prototype.onTokensChanged = function (e) {\r\n        return this._linesCollection.onTokensChanged(e.ranges);\r\n    };\r\n    VisibleLinesCollection.prototype.onZonesChanged = function (e) {\r\n        return true;\r\n    };\r\n    // ---- end view event handlers\r\n    VisibleLinesCollection.prototype.getStartLineNumber = function () {\r\n        return this._linesCollection.getStartLineNumber();\r\n    };\r\n    VisibleLinesCollection.prototype.getEndLineNumber = function () {\r\n        return this._linesCollection.getEndLineNumber();\r\n    };\r\n    VisibleLinesCollection.prototype.getVisibleLine = function (lineNumber) {\r\n        return this._linesCollection.getLine(lineNumber);\r\n    };\r\n    VisibleLinesCollection.prototype.renderLines = function (viewportData) {\r\n        var inp = this._linesCollection._get();\r\n        var renderer = new ViewLayerRenderer(this.domNode.domNode, this._host, viewportData);\r\n        var ctx = {\r\n            rendLineNumberStart: inp.rendLineNumberStart,\r\n            lines: inp.lines,\r\n            linesLength: inp.lines.length\r\n        };\r\n        // Decide if this render will do a single update (single large .innerHTML) or many updates (inserting/removing dom nodes)\r\n        var resCtx = renderer.render(ctx, viewportData.startLineNumber, viewportData.endLineNumber, viewportData.relativeVerticalOffset);\r\n        this._linesCollection._set(resCtx.rendLineNumberStart, resCtx.lines);\r\n    };\r\n    return VisibleLinesCollection;\r\n}());\r\nexport { VisibleLinesCollection };\r\nvar ViewLayerRenderer = /** @class */ (function () {\r\n    function ViewLayerRenderer(domNode, host, viewportData) {\r\n        this.domNode = domNode;\r\n        this.host = host;\r\n        this.viewportData = viewportData;\r\n    }\r\n    ViewLayerRenderer.prototype.render = function (inContext, startLineNumber, stopLineNumber, deltaTop) {\r\n        var ctx = {\r\n            rendLineNumberStart: inContext.rendLineNumberStart,\r\n            lines: inContext.lines.slice(0),\r\n            linesLength: inContext.linesLength\r\n        };\r\n        if ((ctx.rendLineNumberStart + ctx.linesLength - 1 < startLineNumber) || (stopLineNumber < ctx.rendLineNumberStart)) {\r\n            // There is no overlap whatsoever\r\n            ctx.rendLineNumberStart = startLineNumber;\r\n            ctx.linesLength = stopLineNumber - startLineNumber + 1;\r\n            ctx.lines = [];\r\n            for (var x = startLineNumber; x <= stopLineNumber; x++) {\r\n                ctx.lines[x - startLineNumber] = this.host.createVisibleLine();\r\n            }\r\n            this._finishRendering(ctx, true, deltaTop);\r\n            return ctx;\r\n        }\r\n        // Update lines which will remain untouched\r\n        this._renderUntouchedLines(ctx, Math.max(startLineNumber - ctx.rendLineNumberStart, 0), Math.min(stopLineNumber - ctx.rendLineNumberStart, ctx.linesLength - 1), deltaTop, startLineNumber);\r\n        if (ctx.rendLineNumberStart > startLineNumber) {\r\n            // Insert lines before\r\n            var fromLineNumber = startLineNumber;\r\n            var toLineNumber = Math.min(stopLineNumber, ctx.rendLineNumberStart - 1);\r\n            if (fromLineNumber <= toLineNumber) {\r\n                this._insertLinesBefore(ctx, fromLineNumber, toLineNumber, deltaTop, startLineNumber);\r\n                ctx.linesLength += toLineNumber - fromLineNumber + 1;\r\n            }\r\n        }\r\n        else if (ctx.rendLineNumberStart < startLineNumber) {\r\n            // Remove lines before\r\n            var removeCnt = Math.min(ctx.linesLength, startLineNumber - ctx.rendLineNumberStart);\r\n            if (removeCnt > 0) {\r\n                this._removeLinesBefore(ctx, removeCnt);\r\n                ctx.linesLength -= removeCnt;\r\n            }\r\n        }\r\n        ctx.rendLineNumberStart = startLineNumber;\r\n        if (ctx.rendLineNumberStart + ctx.linesLength - 1 < stopLineNumber) {\r\n            // Insert lines after\r\n            var fromLineNumber = ctx.rendLineNumberStart + ctx.linesLength;\r\n            var toLineNumber = stopLineNumber;\r\n            if (fromLineNumber <= toLineNumber) {\r\n                this._insertLinesAfter(ctx, fromLineNumber, toLineNumber, deltaTop, startLineNumber);\r\n                ctx.linesLength += toLineNumber - fromLineNumber + 1;\r\n            }\r\n        }\r\n        else if (ctx.rendLineNumberStart + ctx.linesLength - 1 > stopLineNumber) {\r\n            // Remove lines after\r\n            var fromLineNumber = Math.max(0, stopLineNumber - ctx.rendLineNumberStart + 1);\r\n            var toLineNumber = ctx.linesLength - 1;\r\n            var removeCnt = toLineNumber - fromLineNumber + 1;\r\n            if (removeCnt > 0) {\r\n                this._removeLinesAfter(ctx, removeCnt);\r\n                ctx.linesLength -= removeCnt;\r\n            }\r\n        }\r\n        this._finishRendering(ctx, false, deltaTop);\r\n        return ctx;\r\n    };\r\n    ViewLayerRenderer.prototype._renderUntouchedLines = function (ctx, startIndex, endIndex, deltaTop, deltaLN) {\r\n        var rendLineNumberStart = ctx.rendLineNumberStart;\r\n        var lines = ctx.lines;\r\n        for (var i = startIndex; i <= endIndex; i++) {\r\n            var lineNumber = rendLineNumberStart + i;\r\n            lines[i].layoutLine(lineNumber, deltaTop[lineNumber - deltaLN]);\r\n        }\r\n    };\r\n    ViewLayerRenderer.prototype._insertLinesBefore = function (ctx, fromLineNumber, toLineNumber, deltaTop, deltaLN) {\r\n        var newLines = [];\r\n        var newLinesLen = 0;\r\n        for (var lineNumber = fromLineNumber; lineNumber <= toLineNumber; lineNumber++) {\r\n            newLines[newLinesLen++] = this.host.createVisibleLine();\r\n        }\r\n        ctx.lines = newLines.concat(ctx.lines);\r\n    };\r\n    ViewLayerRenderer.prototype._removeLinesBefore = function (ctx, removeCount) {\r\n        for (var i = 0; i < removeCount; i++) {\r\n            var lineDomNode = ctx.lines[i].getDomNode();\r\n            if (lineDomNode) {\r\n                this.domNode.removeChild(lineDomNode);\r\n            }\r\n        }\r\n        ctx.lines.splice(0, removeCount);\r\n    };\r\n    ViewLayerRenderer.prototype._insertLinesAfter = function (ctx, fromLineNumber, toLineNumber, deltaTop, deltaLN) {\r\n        var newLines = [];\r\n        var newLinesLen = 0;\r\n        for (var lineNumber = fromLineNumber; lineNumber <= toLineNumber; lineNumber++) {\r\n            newLines[newLinesLen++] = this.host.createVisibleLine();\r\n        }\r\n        ctx.lines = ctx.lines.concat(newLines);\r\n    };\r\n    ViewLayerRenderer.prototype._removeLinesAfter = function (ctx, removeCount) {\r\n        var removeIndex = ctx.linesLength - removeCount;\r\n        for (var i = 0; i < removeCount; i++) {\r\n            var lineDomNode = ctx.lines[removeIndex + i].getDomNode();\r\n            if (lineDomNode) {\r\n                this.domNode.removeChild(lineDomNode);\r\n            }\r\n        }\r\n        ctx.lines.splice(removeIndex, removeCount);\r\n    };\r\n    ViewLayerRenderer.prototype._finishRenderingNewLines = function (ctx, domNodeIsEmpty, newLinesHTML, wasNew) {\r\n        var lastChild = this.domNode.lastChild;\r\n        if (domNodeIsEmpty || !lastChild) {\r\n            this.domNode.innerHTML = newLinesHTML;\r\n        }\r\n        else {\r\n            lastChild.insertAdjacentHTML('afterend', newLinesHTML);\r\n        }\r\n        var currChild = this.domNode.lastChild;\r\n        for (var i = ctx.linesLength - 1; i >= 0; i--) {\r\n            var line = ctx.lines[i];\r\n            if (wasNew[i]) {\r\n                line.setDomNode(currChild);\r\n                currChild = currChild.previousSibling;\r\n            }\r\n        }\r\n    };\r\n    ViewLayerRenderer.prototype._finishRenderingInvalidLines = function (ctx, invalidLinesHTML, wasInvalid) {\r\n        var hugeDomNode = document.createElement('div');\r\n        hugeDomNode.innerHTML = invalidLinesHTML;\r\n        for (var i = 0; i < ctx.linesLength; i++) {\r\n            var line = ctx.lines[i];\r\n            if (wasInvalid[i]) {\r\n                var source = hugeDomNode.firstChild;\r\n                var lineDomNode = line.getDomNode();\r\n                lineDomNode.parentNode.replaceChild(source, lineDomNode);\r\n                line.setDomNode(source);\r\n            }\r\n        }\r\n    };\r\n    ViewLayerRenderer.prototype._finishRendering = function (ctx, domNodeIsEmpty, deltaTop) {\r\n        var sb = ViewLayerRenderer._sb;\r\n        var linesLength = ctx.linesLength;\r\n        var lines = ctx.lines;\r\n        var rendLineNumberStart = ctx.rendLineNumberStart;\r\n        var wasNew = [];\r\n        {\r\n            sb.reset();\r\n            var hadNewLine = false;\r\n            for (var i = 0; i < linesLength; i++) {\r\n                var line = lines[i];\r\n                wasNew[i] = false;\r\n                var lineDomNode = line.getDomNode();\r\n                if (lineDomNode) {\r\n                    // line is not new\r\n                    continue;\r\n                }\r\n                var renderResult = line.renderLine(i + rendLineNumberStart, deltaTop[i], this.viewportData, sb);\r\n                if (!renderResult) {\r\n                    // line does not need rendering\r\n                    continue;\r\n                }\r\n                wasNew[i] = true;\r\n                hadNewLine = true;\r\n            }\r\n            if (hadNewLine) {\r\n                this._finishRenderingNewLines(ctx, domNodeIsEmpty, sb.build(), wasNew);\r\n            }\r\n        }\r\n        {\r\n            sb.reset();\r\n            var hadInvalidLine = false;\r\n            var wasInvalid = [];\r\n            for (var i = 0; i < linesLength; i++) {\r\n                var line = lines[i];\r\n                wasInvalid[i] = false;\r\n                if (wasNew[i]) {\r\n                    // line was new\r\n                    continue;\r\n                }\r\n                var renderResult = line.renderLine(i + rendLineNumberStart, deltaTop[i], this.viewportData, sb);\r\n                if (!renderResult) {\r\n                    // line does not need rendering\r\n                    continue;\r\n                }\r\n                wasInvalid[i] = true;\r\n                hadInvalidLine = true;\r\n            }\r\n            if (hadInvalidLine) {\r\n                this._finishRenderingInvalidLines(ctx, sb.build(), wasInvalid);\r\n            }\r\n        }\r\n    };\r\n    ViewLayerRenderer._sb = createStringBuilder(100000);\r\n    return ViewLayerRenderer;\r\n}());\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { MouseTarget } from '../controller/mouseTarget.js';\r\nvar ViewOutgoingEvents = /** @class */ (function (_super) {\r\n    __extends(ViewOutgoingEvents, _super);\r\n    function ViewOutgoingEvents(viewModel) {\r\n        var _this = _super.call(this) || this;\r\n        _this.onDidContentSizeChange = null;\r\n        _this.onDidScroll = null;\r\n        _this.onDidGainFocus = null;\r\n        _this.onDidLoseFocus = null;\r\n        _this.onKeyDown = null;\r\n        _this.onKeyUp = null;\r\n        _this.onContextMenu = null;\r\n        _this.onMouseMove = null;\r\n        _this.onMouseLeave = null;\r\n        _this.onMouseUp = null;\r\n        _this.onMouseDown = null;\r\n        _this.onMouseDrag = null;\r\n        _this.onMouseDrop = null;\r\n        _this.onMouseWheel = null;\r\n        _this._viewModel = viewModel;\r\n        return _this;\r\n    }\r\n    ViewOutgoingEvents.prototype.emitContentSizeChange = function (e) {\r\n        if (this.onDidContentSizeChange) {\r\n            this.onDidContentSizeChange(e);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitScrollChanged = function (e) {\r\n        if (this.onDidScroll) {\r\n            this.onDidScroll(e);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitViewFocusGained = function () {\r\n        if (this.onDidGainFocus) {\r\n            this.onDidGainFocus(undefined);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitViewFocusLost = function () {\r\n        if (this.onDidLoseFocus) {\r\n            this.onDidLoseFocus(undefined);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitKeyDown = function (e) {\r\n        if (this.onKeyDown) {\r\n            this.onKeyDown(e);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitKeyUp = function (e) {\r\n        if (this.onKeyUp) {\r\n            this.onKeyUp(e);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitContextMenu = function (e) {\r\n        if (this.onContextMenu) {\r\n            this.onContextMenu(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseMove = function (e) {\r\n        if (this.onMouseMove) {\r\n            this.onMouseMove(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseLeave = function (e) {\r\n        if (this.onMouseLeave) {\r\n            this.onMouseLeave(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseUp = function (e) {\r\n        if (this.onMouseUp) {\r\n            this.onMouseUp(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseDown = function (e) {\r\n        if (this.onMouseDown) {\r\n            this.onMouseDown(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseDrag = function (e) {\r\n        if (this.onMouseDrag) {\r\n            this.onMouseDrag(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseDrop = function (e) {\r\n        if (this.onMouseDrop) {\r\n            this.onMouseDrop(this._convertViewToModelMouseEvent(e));\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype.emitMouseWheel = function (e) {\r\n        if (this.onMouseWheel) {\r\n            this.onMouseWheel(e);\r\n        }\r\n    };\r\n    ViewOutgoingEvents.prototype._convertViewToModelMouseEvent = function (e) {\r\n        if (e.target) {\r\n            return {\r\n                event: e.event,\r\n                target: this._convertViewToModelMouseTarget(e.target)\r\n            };\r\n        }\r\n        return e;\r\n    };\r\n    ViewOutgoingEvents.prototype._convertViewToModelMouseTarget = function (target) {\r\n        return ViewOutgoingEvents.convertViewToModelMouseTarget(target, this._viewModel.coordinatesConverter);\r\n    };\r\n    ViewOutgoingEvents.convertViewToModelMouseTarget = function (target, coordinatesConverter) {\r\n        return new ExternalMouseTarget(target.element, target.type, target.mouseColumn, target.position ? coordinatesConverter.convertViewPositionToModelPosition(target.position) : null, target.range ? coordinatesConverter.convertViewRangeToModelRange(target.range) : null, target.detail);\r\n    };\r\n    return ViewOutgoingEvents;\r\n}(Disposable));\r\nexport { ViewOutgoingEvents };\r\nvar ExternalMouseTarget = /** @class */ (function () {\r\n    function ExternalMouseTarget(element, type, mouseColumn, position, range, detail) {\r\n        this.element = element;\r\n        this.type = type;\r\n        this.mouseColumn = mouseColumn;\r\n        this.position = position;\r\n        this.range = range;\r\n        this.detail = detail;\r\n    }\r\n    ExternalMouseTarget.prototype.toString = function () {\r\n        return MouseTarget.toString(this);\r\n    };\r\n    return ExternalMouseTarget;\r\n}());\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { CoreNavigationCommands } from '../controller/coreCommands.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nvar ViewController = /** @class */ (function () {\r\n    function ViewController(configuration, viewModel, outgoingEvents, commandDelegate) {\r\n        this.configuration = configuration;\r\n        this.viewModel = viewModel;\r\n        this.outgoingEvents = outgoingEvents;\r\n        this.commandDelegate = commandDelegate;\r\n    }\r\n    ViewController.prototype._execMouseCommand = function (editorCommand, args) {\r\n        args.source = 'mouse';\r\n        this.commandDelegate.executeEditorCommand(editorCommand, args);\r\n    };\r\n    ViewController.prototype.paste = function (source, text, pasteOnNewLine, multicursorText, mode) {\r\n        this.commandDelegate.paste(source, text, pasteOnNewLine, multicursorText, mode);\r\n    };\r\n    ViewController.prototype.type = function (source, text) {\r\n        this.commandDelegate.type(source, text);\r\n    };\r\n    ViewController.prototype.replacePreviousChar = function (source, text, replaceCharCnt) {\r\n        this.commandDelegate.replacePreviousChar(source, text, replaceCharCnt);\r\n    };\r\n    ViewController.prototype.compositionStart = function (source) {\r\n        this.commandDelegate.compositionStart(source);\r\n    };\r\n    ViewController.prototype.compositionEnd = function (source) {\r\n        this.commandDelegate.compositionEnd(source);\r\n    };\r\n    ViewController.prototype.cut = function (source) {\r\n        this.commandDelegate.cut(source);\r\n    };\r\n    ViewController.prototype.setSelection = function (source, modelSelection) {\r\n        this.commandDelegate.executeEditorCommand(CoreNavigationCommands.SetSelection, {\r\n            source: source,\r\n            selection: modelSelection\r\n        });\r\n    };\r\n    ViewController.prototype._validateViewColumn = function (viewPosition) {\r\n        var minColumn = this.viewModel.getLineMinColumn(viewPosition.lineNumber);\r\n        if (viewPosition.column < minColumn) {\r\n            return new Position(viewPosition.lineNumber, minColumn);\r\n        }\r\n        return viewPosition;\r\n    };\r\n    ViewController.prototype._hasMulticursorModifier = function (data) {\r\n        switch (this.configuration.options.get(59 /* multiCursorModifier */)) {\r\n            case 'altKey':\r\n                return data.altKey;\r\n            case 'ctrlKey':\r\n                return data.ctrlKey;\r\n            case 'metaKey':\r\n                return data.metaKey;\r\n        }\r\n        return false;\r\n    };\r\n    ViewController.prototype._hasNonMulticursorModifier = function (data) {\r\n        switch (this.configuration.options.get(59 /* multiCursorModifier */)) {\r\n            case 'altKey':\r\n                return data.ctrlKey || data.metaKey;\r\n            case 'ctrlKey':\r\n                return data.altKey || data.metaKey;\r\n            case 'metaKey':\r\n                return data.ctrlKey || data.altKey;\r\n        }\r\n        return false;\r\n    };\r\n    ViewController.prototype.dispatchMouse = function (data) {\r\n        var selectionClipboardIsOn = (platform.isLinux && this.configuration.options.get(81 /* selectionClipboard */));\r\n        if (data.middleButton && !selectionClipboardIsOn) {\r\n            this._columnSelect(data.position, data.mouseColumn, data.inSelectionMode);\r\n        }\r\n        else if (data.startedOnLineNumbers) {\r\n            // If the dragging started on the gutter, then have operations work on the entire line\r\n            if (this._hasMulticursorModifier(data)) {\r\n                if (data.inSelectionMode) {\r\n                    this._lastCursorLineSelect(data.position);\r\n                }\r\n                else {\r\n                    this._createCursor(data.position, true);\r\n                }\r\n            }\r\n            else {\r\n                if (data.inSelectionMode) {\r\n                    this._lineSelectDrag(data.position);\r\n                }\r\n                else {\r\n                    this._lineSelect(data.position);\r\n                }\r\n            }\r\n        }\r\n        else if (data.mouseDownCount >= 4) {\r\n            this._selectAll();\r\n        }\r\n        else if (data.mouseDownCount === 3) {\r\n            if (this._hasMulticursorModifier(data)) {\r\n                if (data.inSelectionMode) {\r\n                    this._lastCursorLineSelectDrag(data.position);\r\n                }\r\n                else {\r\n                    this._lastCursorLineSelect(data.position);\r\n                }\r\n            }\r\n            else {\r\n                if (data.inSelectionMode) {\r\n                    this._lineSelectDrag(data.position);\r\n                }\r\n                else {\r\n                    this._lineSelect(data.position);\r\n                }\r\n            }\r\n        }\r\n        else if (data.mouseDownCount === 2) {\r\n            if (this._hasMulticursorModifier(data)) {\r\n                this._lastCursorWordSelect(data.position);\r\n            }\r\n            else {\r\n                if (data.inSelectionMode) {\r\n                    this._wordSelectDrag(data.position);\r\n                }\r\n                else {\r\n                    this._wordSelect(data.position);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._hasMulticursorModifier(data)) {\r\n                if (!this._hasNonMulticursorModifier(data)) {\r\n                    if (data.shiftKey) {\r\n                        this._columnSelect(data.position, data.mouseColumn, true);\r\n                    }\r\n                    else {\r\n                        // Do multi-cursor operations only when purely alt is pressed\r\n                        if (data.inSelectionMode) {\r\n                            this._lastCursorMoveToSelect(data.position);\r\n                        }\r\n                        else {\r\n                            this._createCursor(data.position, false);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (data.inSelectionMode) {\r\n                    if (data.altKey) {\r\n                        this._columnSelect(data.position, data.mouseColumn, true);\r\n                    }\r\n                    else {\r\n                        this._moveToSelect(data.position);\r\n                    }\r\n                }\r\n                else {\r\n                    this.moveTo(data.position);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ViewController.prototype._usualArgs = function (viewPosition) {\r\n        viewPosition = this._validateViewColumn(viewPosition);\r\n        return {\r\n            position: this._convertViewToModelPosition(viewPosition),\r\n            viewPosition: viewPosition\r\n        };\r\n    };\r\n    ViewController.prototype.moveTo = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.MoveTo, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._moveToSelect = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.MoveToSelect, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._columnSelect = function (viewPosition, mouseColumn, doColumnSelect) {\r\n        viewPosition = this._validateViewColumn(viewPosition);\r\n        this._execMouseCommand(CoreNavigationCommands.ColumnSelect, {\r\n            position: this._convertViewToModelPosition(viewPosition),\r\n            viewPosition: viewPosition,\r\n            mouseColumn: mouseColumn,\r\n            doColumnSelect: doColumnSelect\r\n        });\r\n    };\r\n    ViewController.prototype._createCursor = function (viewPosition, wholeLine) {\r\n        viewPosition = this._validateViewColumn(viewPosition);\r\n        this._execMouseCommand(CoreNavigationCommands.CreateCursor, {\r\n            position: this._convertViewToModelPosition(viewPosition),\r\n            viewPosition: viewPosition,\r\n            wholeLine: wholeLine\r\n        });\r\n    };\r\n    ViewController.prototype._lastCursorMoveToSelect = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.LastCursorMoveToSelect, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._wordSelect = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.WordSelect, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._wordSelectDrag = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.WordSelectDrag, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._lastCursorWordSelect = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.LastCursorWordSelect, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._lineSelect = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.LineSelect, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._lineSelectDrag = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.LineSelectDrag, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._lastCursorLineSelect = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.LastCursorLineSelect, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._lastCursorLineSelectDrag = function (viewPosition) {\r\n        this._execMouseCommand(CoreNavigationCommands.LastCursorLineSelectDrag, this._usualArgs(viewPosition));\r\n    };\r\n    ViewController.prototype._selectAll = function () {\r\n        this._execMouseCommand(CoreNavigationCommands.SelectAll, {});\r\n    };\r\n    // ----------------------\r\n    ViewController.prototype._convertViewToModelPosition = function (viewPosition) {\r\n        return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(viewPosition);\r\n    };\r\n    ViewController.prototype.emitKeyDown = function (e) {\r\n        this.outgoingEvents.emitKeyDown(e);\r\n    };\r\n    ViewController.prototype.emitKeyUp = function (e) {\r\n        this.outgoingEvents.emitKeyUp(e);\r\n    };\r\n    ViewController.prototype.emitContextMenu = function (e) {\r\n        this.outgoingEvents.emitContextMenu(e);\r\n    };\r\n    ViewController.prototype.emitMouseMove = function (e) {\r\n        this.outgoingEvents.emitMouseMove(e);\r\n    };\r\n    ViewController.prototype.emitMouseLeave = function (e) {\r\n        this.outgoingEvents.emitMouseLeave(e);\r\n    };\r\n    ViewController.prototype.emitMouseUp = function (e) {\r\n        this.outgoingEvents.emitMouseUp(e);\r\n    };\r\n    ViewController.prototype.emitMouseDown = function (e) {\r\n        this.outgoingEvents.emitMouseDown(e);\r\n    };\r\n    ViewController.prototype.emitMouseDrag = function (e) {\r\n        this.outgoingEvents.emitMouseDrag(e);\r\n    };\r\n    ViewController.prototype.emitMouseDrop = function (e) {\r\n        this.outgoingEvents.emitMouseDrop(e);\r\n    };\r\n    ViewController.prototype.emitMouseWheel = function (e) {\r\n        this.outgoingEvents.emitMouseWheel(e);\r\n    };\r\n    return ViewController;\r\n}());\r\nexport { ViewController };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { createFastDomNode } from '../../../base/browser/fastDomNode.js';\r\nimport { Configuration } from '../config/configuration.js';\r\nimport { VisibleLinesCollection } from './viewLayer.js';\r\nimport { ViewPart } from './viewPart.js';\r\nvar ViewOverlays = /** @class */ (function (_super) {\r\n    __extends(ViewOverlays, _super);\r\n    function ViewOverlays(context) {\r\n        var _this = _super.call(this, context) || this;\r\n        _this._visibleLines = new VisibleLinesCollection(_this);\r\n        _this.domNode = _this._visibleLines.domNode;\r\n        _this._dynamicOverlays = [];\r\n        _this._isFocused = false;\r\n        _this.domNode.setClassName('view-overlays');\r\n        return _this;\r\n    }\r\n    ViewOverlays.prototype.shouldRender = function () {\r\n        if (_super.prototype.shouldRender.call(this)) {\r\n            return true;\r\n        }\r\n        for (var i = 0, len = this._dynamicOverlays.length; i < len; i++) {\r\n            var dynamicOverlay = this._dynamicOverlays[i];\r\n            if (dynamicOverlay.shouldRender()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    ViewOverlays.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        for (var i = 0, len = this._dynamicOverlays.length; i < len; i++) {\r\n            var dynamicOverlay = this._dynamicOverlays[i];\r\n            dynamicOverlay.dispose();\r\n        }\r\n        this._dynamicOverlays = [];\r\n    };\r\n    ViewOverlays.prototype.getDomNode = function () {\r\n        return this.domNode;\r\n    };\r\n    // ---- begin IVisibleLinesHost\r\n    ViewOverlays.prototype.createVisibleLine = function () {\r\n        return new ViewOverlayLine(this._context.configuration, this._dynamicOverlays);\r\n    };\r\n    // ---- end IVisibleLinesHost\r\n    ViewOverlays.prototype.addDynamicOverlay = function (overlay) {\r\n        this._dynamicOverlays.push(overlay);\r\n    };\r\n    // ----- event handlers\r\n    ViewOverlays.prototype.onConfigurationChanged = function (e) {\r\n        this._visibleLines.onConfigurationChanged(e);\r\n        var startLineNumber = this._visibleLines.getStartLineNumber();\r\n        var endLineNumber = this._visibleLines.getEndLineNumber();\r\n        for (var lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++) {\r\n            var line = this._visibleLines.getVisibleLine(lineNumber);\r\n            line.onConfigurationChanged(e);\r\n        }\r\n        return true;\r\n    };\r\n    ViewOverlays.prototype.onFlushed = function (e) {\r\n        return this._visibleLines.onFlushed(e);\r\n    };\r\n    ViewOverlays.prototype.onFocusChanged = function (e) {\r\n        this._isFocused = e.isFocused;\r\n        return true;\r\n    };\r\n    ViewOverlays.prototype.onLinesChanged = function (e) {\r\n        return this._visibleLines.onLinesChanged(e);\r\n    };\r\n    ViewOverlays.prototype.onLinesDeleted = function (e) {\r\n        return this._visibleLines.onLinesDeleted(e);\r\n    };\r\n    ViewOverlays.prototype.onLinesInserted = function (e) {\r\n        return this._visibleLines.onLinesInserted(e);\r\n    };\r\n    ViewOverlays.prototype.onScrollChanged = function (e) {\r\n        return this._visibleLines.onScrollChanged(e) || true;\r\n    };\r\n    ViewOverlays.prototype.onTokensChanged = function (e) {\r\n        return this._visibleLines.onTokensChanged(e);\r\n    };\r\n    ViewOverlays.prototype.onZonesChanged = function (e) {\r\n        return this._visibleLines.onZonesChanged(e);\r\n    };\r\n    // ----- end event handlers\r\n    ViewOverlays.prototype.prepareRender = function (ctx) {\r\n        var toRender = this._dynamicOverlays.filter(function (overlay) { return overlay.shouldRender(); });\r\n        for (var i = 0, len = toRender.length; i < len; i++) {\r\n            var dynamicOverlay = toRender[i];\r\n            dynamicOverlay.prepareRender(ctx);\r\n            dynamicOverlay.onDidRender();\r\n        }\r\n    };\r\n    ViewOverlays.prototype.render = function (ctx) {\r\n        // Overwriting to bypass `shouldRender` flag\r\n        this._viewOverlaysRender(ctx);\r\n        this.domNode.toggleClassName('focused', this._isFocused);\r\n    };\r\n    ViewOverlays.prototype._viewOverlaysRender = function (ctx) {\r\n        this._visibleLines.renderLines(ctx.viewportData);\r\n    };\r\n    return ViewOverlays;\r\n}(ViewPart));\r\nexport { ViewOverlays };\r\nvar ViewOverlayLine = /** @class */ (function () {\r\n    function ViewOverlayLine(configuration, dynamicOverlays) {\r\n        this._configuration = configuration;\r\n        this._lineHeight = this._configuration.options.get(49 /* lineHeight */);\r\n        this._dynamicOverlays = dynamicOverlays;\r\n        this._domNode = null;\r\n        this._renderedContent = null;\r\n    }\r\n    ViewOverlayLine.prototype.getDomNode = function () {\r\n        if (!this._domNode) {\r\n            return null;\r\n        }\r\n        return this._domNode.domNode;\r\n    };\r\n    ViewOverlayLine.prototype.setDomNode = function (domNode) {\r\n        this._domNode = createFastDomNode(domNode);\r\n    };\r\n    ViewOverlayLine.prototype.onContentChanged = function () {\r\n        // Nothing\r\n    };\r\n    ViewOverlayLine.prototype.onTokensChanged = function () {\r\n        // Nothing\r\n    };\r\n    ViewOverlayLine.prototype.onConfigurationChanged = function (e) {\r\n        this._lineHeight = this._configuration.options.get(49 /* lineHeight */);\r\n    };\r\n    ViewOverlayLine.prototype.renderLine = function (lineNumber, deltaTop, viewportData, sb) {\r\n        var result = '';\r\n        for (var i = 0, len = this._dynamicOverlays.length; i < len; i++) {\r\n            var dynamicOverlay = this._dynamicOverlays[i];\r\n            result += dynamicOverlay.render(viewportData.startLineNumber, lineNumber);\r\n        }\r\n        if (this._renderedContent === result) {\r\n            // No rendering needed\r\n            return false;\r\n        }\r\n        this._renderedContent = result;\r\n        sb.appendASCIIString('<div style=\"position:absolute;top:');\r\n        sb.appendASCIIString(String(deltaTop));\r\n        sb.appendASCIIString('px;width:100%;height:');\r\n        sb.appendASCIIString(String(this._lineHeight));\r\n        sb.appendASCIIString('px;\">');\r\n        sb.appendASCIIString(result);\r\n        sb.appendASCIIString('</div>');\r\n        return true;\r\n    };\r\n    ViewOverlayLine.prototype.layoutLine = function (lineNumber, deltaTop) {\r\n        if (this._domNode) {\r\n            this._domNode.setTop(deltaTop);\r\n            this._domNode.setHeight(this._lineHeight);\r\n        }\r\n    };\r\n    return ViewOverlayLine;\r\n}());\r\nexport { ViewOverlayLine };\r\nvar ContentViewOverlays = /** @class */ (function (_super) {\r\n    __extends(ContentViewOverlays, _super);\r\n    function ContentViewOverlays(context) {\r\n        var _this = _super.call(this, context) || this;\r\n        var options = _this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        _this._contentWidth = layoutInfo.contentWidth;\r\n        _this.domNode.setHeight(0);\r\n        return _this;\r\n    }\r\n    // --- begin event handlers\r\n    ContentViewOverlays.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        this._contentWidth = layoutInfo.contentWidth;\r\n        return _super.prototype.onConfigurationChanged.call(this, e) || true;\r\n    };\r\n    ContentViewOverlays.prototype.onScrollChanged = function (e) {\r\n        return _super.prototype.onScrollChanged.call(this, e) || e.scrollWidthChanged;\r\n    };\r\n    // --- end event handlers\r\n    ContentViewOverlays.prototype._viewOverlaysRender = function (ctx) {\r\n        _super.prototype._viewOverlaysRender.call(this, ctx);\r\n        this.domNode.setWidth(Math.max(ctx.scrollWidth, this._contentWidth));\r\n    };\r\n    return ContentViewOverlays;\r\n}(ViewOverlays));\r\nexport { ContentViewOverlays };\r\nvar MarginViewOverlays = /** @class */ (function (_super) {\r\n    __extends(MarginViewOverlays, _super);\r\n    function MarginViewOverlays(context) {\r\n        var _this = _super.call(this, context) || this;\r\n        var options = _this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        _this._contentLeft = layoutInfo.contentLeft;\r\n        _this.domNode.setClassName('margin-view-overlays');\r\n        _this.domNode.setWidth(1);\r\n        Configuration.applyFontInfo(_this.domNode, options.get(34 /* fontInfo */));\r\n        return _this;\r\n    }\r\n    MarginViewOverlays.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._context.configuration.options;\r\n        Configuration.applyFontInfo(this.domNode, options.get(34 /* fontInfo */));\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        this._contentLeft = layoutInfo.contentLeft;\r\n        return _super.prototype.onConfigurationChanged.call(this, e) || true;\r\n    };\r\n    MarginViewOverlays.prototype.onScrollChanged = function (e) {\r\n        return _super.prototype.onScrollChanged.call(this, e) || e.scrollHeightChanged;\r\n    };\r\n    MarginViewOverlays.prototype._viewOverlaysRender = function (ctx) {\r\n        _super.prototype._viewOverlaysRender.call(this, ctx);\r\n        var height = Math.min(ctx.scrollHeight, 1000000);\r\n        this.domNode.setHeight(height);\r\n        this.domNode.setWidth(this._contentLeft);\r\n    };\r\n    return MarginViewOverlays;\r\n}(ViewOverlays));\r\nexport { MarginViewOverlays };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { createFastDomNode } from '../../../base/browser/fastDomNode.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { PointerHandler } from '../controller/pointerHandler.js';\r\nimport { TextAreaHandler } from '../controller/textAreaHandler.js';\r\nimport { ViewController } from './viewController.js';\r\nimport { ViewOutgoingEvents } from './viewOutgoingEvents.js';\r\nimport { ContentViewOverlays, MarginViewOverlays } from './viewOverlays.js';\r\nimport { PartFingerprints } from './viewPart.js';\r\nimport { ViewContentWidgets } from '../viewParts/contentWidgets/contentWidgets.js';\r\nimport { CurrentLineHighlightOverlay, CurrentLineMarginHighlightOverlay } from '../viewParts/currentLineHighlight/currentLineHighlight.js';\r\nimport { DecorationsOverlay } from '../viewParts/decorations/decorations.js';\r\nimport { EditorScrollbar } from '../viewParts/editorScrollbar/editorScrollbar.js';\r\nimport { GlyphMarginOverlay } from '../viewParts/glyphMargin/glyphMargin.js';\r\nimport { IndentGuidesOverlay } from '../viewParts/indentGuides/indentGuides.js';\r\nimport { LineNumbersOverlay } from '../viewParts/lineNumbers/lineNumbers.js';\r\nimport { ViewLines } from '../viewParts/lines/viewLines.js';\r\nimport { LinesDecorationsOverlay } from '../viewParts/linesDecorations/linesDecorations.js';\r\nimport { Margin } from '../viewParts/margin/margin.js';\r\nimport { MarginViewLineDecorationsOverlay } from '../viewParts/marginDecorations/marginDecorations.js';\r\nimport { Minimap } from '../viewParts/minimap/minimap.js';\r\nimport { ViewOverlayWidgets } from '../viewParts/overlayWidgets/overlayWidgets.js';\r\nimport { DecorationsOverviewRuler } from '../viewParts/overviewRuler/decorationsOverviewRuler.js';\r\nimport { OverviewRuler } from '../viewParts/overviewRuler/overviewRuler.js';\r\nimport { Rulers } from '../viewParts/rulers/rulers.js';\r\nimport { ScrollDecorationViewPart } from '../viewParts/scrollDecoration/scrollDecoration.js';\r\nimport { SelectionsOverlay } from '../viewParts/selections/selections.js';\r\nimport { ViewCursors } from '../viewParts/viewCursors/viewCursors.js';\r\nimport { ViewZones } from '../viewParts/viewZones/viewZones.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { RenderingContext } from '../../common/view/renderingContext.js';\r\nimport { ViewContext } from '../../common/view/viewContext.js';\r\nimport { ViewEventDispatcher } from '../../common/view/viewEventDispatcher.js';\r\nimport * as viewEvents from '../../common/view/viewEvents.js';\r\nimport { ViewportData } from '../../common/viewLayout/viewLinesViewportData.js';\r\nimport { ViewEventHandler } from '../../common/viewModel/viewEventHandler.js';\r\nimport { getThemeTypeSelector } from '../../../platform/theme/common/themeService.js';\r\nimport { PointerHandlerLastRenderData } from '../controller/mouseTarget.js';\r\nvar View = /** @class */ (function (_super) {\r\n    __extends(View, _super);\r\n    function View(commandDelegate, configuration, themeService, model, cursor, outgoingEvents) {\r\n        var _this = _super.call(this) || this;\r\n        _this._cursor = cursor;\r\n        _this._renderAnimationFrame = null;\r\n        _this.outgoingEvents = outgoingEvents;\r\n        var viewController = new ViewController(configuration, model, _this.outgoingEvents, commandDelegate);\r\n        // The event dispatcher will always go through _renderOnce before dispatching any events\r\n        _this.eventDispatcher = new ViewEventDispatcher(function (callback) { return _this._renderOnce(callback); });\r\n        // Ensure the view is the first event handler in order to update the layout\r\n        _this.eventDispatcher.addEventHandler(_this);\r\n        // The view context is passed on to most classes (basically to reduce param. counts in ctors)\r\n        _this._context = new ViewContext(configuration, themeService.getTheme(), model, _this.eventDispatcher);\r\n        _this._register(themeService.onThemeChange(function (theme) {\r\n            _this._context.theme = theme;\r\n            _this.eventDispatcher.emit(new viewEvents.ViewThemeChangedEvent());\r\n            _this.render(true, false);\r\n        }));\r\n        _this.viewParts = [];\r\n        // Keyboard handler\r\n        _this._textAreaHandler = new TextAreaHandler(_this._context, viewController, _this.createTextAreaHandlerHelper());\r\n        _this.viewParts.push(_this._textAreaHandler);\r\n        // These two dom nodes must be constructed up front, since references are needed in the layout provider (scrolling & co.)\r\n        _this.linesContent = createFastDomNode(document.createElement('div'));\r\n        _this.linesContent.setClassName('lines-content' + ' monaco-editor-background');\r\n        _this.linesContent.setPosition('absolute');\r\n        _this.domNode = createFastDomNode(document.createElement('div'));\r\n        _this.domNode.setClassName(_this.getEditorClassName());\r\n        _this.overflowGuardContainer = createFastDomNode(document.createElement('div'));\r\n        PartFingerprints.write(_this.overflowGuardContainer, 3 /* OverflowGuard */);\r\n        _this.overflowGuardContainer.setClassName('overflow-guard');\r\n        _this._scrollbar = new EditorScrollbar(_this._context, _this.linesContent, _this.domNode, _this.overflowGuardContainer);\r\n        _this.viewParts.push(_this._scrollbar);\r\n        // View Lines\r\n        _this.viewLines = new ViewLines(_this._context, _this.linesContent);\r\n        // View Zones\r\n        _this.viewZones = new ViewZones(_this._context);\r\n        _this.viewParts.push(_this.viewZones);\r\n        // Decorations overview ruler\r\n        var decorationsOverviewRuler = new DecorationsOverviewRuler(_this._context);\r\n        _this.viewParts.push(decorationsOverviewRuler);\r\n        var scrollDecoration = new ScrollDecorationViewPart(_this._context);\r\n        _this.viewParts.push(scrollDecoration);\r\n        var contentViewOverlays = new ContentViewOverlays(_this._context);\r\n        _this.viewParts.push(contentViewOverlays);\r\n        contentViewOverlays.addDynamicOverlay(new CurrentLineHighlightOverlay(_this._context));\r\n        contentViewOverlays.addDynamicOverlay(new SelectionsOverlay(_this._context));\r\n        contentViewOverlays.addDynamicOverlay(new IndentGuidesOverlay(_this._context));\r\n        contentViewOverlays.addDynamicOverlay(new DecorationsOverlay(_this._context));\r\n        var marginViewOverlays = new MarginViewOverlays(_this._context);\r\n        _this.viewParts.push(marginViewOverlays);\r\n        marginViewOverlays.addDynamicOverlay(new CurrentLineMarginHighlightOverlay(_this._context));\r\n        marginViewOverlays.addDynamicOverlay(new GlyphMarginOverlay(_this._context));\r\n        marginViewOverlays.addDynamicOverlay(new MarginViewLineDecorationsOverlay(_this._context));\r\n        marginViewOverlays.addDynamicOverlay(new LinesDecorationsOverlay(_this._context));\r\n        marginViewOverlays.addDynamicOverlay(new LineNumbersOverlay(_this._context));\r\n        var margin = new Margin(_this._context);\r\n        margin.getDomNode().appendChild(_this.viewZones.marginDomNode);\r\n        margin.getDomNode().appendChild(marginViewOverlays.getDomNode());\r\n        _this.viewParts.push(margin);\r\n        // Content widgets\r\n        _this.contentWidgets = new ViewContentWidgets(_this._context, _this.domNode);\r\n        _this.viewParts.push(_this.contentWidgets);\r\n        _this.viewCursors = new ViewCursors(_this._context);\r\n        _this.viewParts.push(_this.viewCursors);\r\n        // Overlay widgets\r\n        _this.overlayWidgets = new ViewOverlayWidgets(_this._context);\r\n        _this.viewParts.push(_this.overlayWidgets);\r\n        var rulers = new Rulers(_this._context);\r\n        _this.viewParts.push(rulers);\r\n        var minimap = new Minimap(_this._context);\r\n        _this.viewParts.push(minimap);\r\n        // -------------- Wire dom nodes up\r\n        if (decorationsOverviewRuler) {\r\n            var overviewRulerData = _this._scrollbar.getOverviewRulerLayoutInfo();\r\n            overviewRulerData.parent.insertBefore(decorationsOverviewRuler.getDomNode(), overviewRulerData.insertBefore);\r\n        }\r\n        _this.linesContent.appendChild(contentViewOverlays.getDomNode());\r\n        _this.linesContent.appendChild(rulers.domNode);\r\n        _this.linesContent.appendChild(_this.viewZones.domNode);\r\n        _this.linesContent.appendChild(_this.viewLines.getDomNode());\r\n        _this.linesContent.appendChild(_this.contentWidgets.domNode);\r\n        _this.linesContent.appendChild(_this.viewCursors.getDomNode());\r\n        _this.overflowGuardContainer.appendChild(margin.getDomNode());\r\n        _this.overflowGuardContainer.appendChild(_this._scrollbar.getDomNode());\r\n        _this.overflowGuardContainer.appendChild(scrollDecoration.getDomNode());\r\n        _this.overflowGuardContainer.appendChild(_this._textAreaHandler.textArea);\r\n        _this.overflowGuardContainer.appendChild(_this._textAreaHandler.textAreaCover);\r\n        _this.overflowGuardContainer.appendChild(_this.overlayWidgets.getDomNode());\r\n        _this.overflowGuardContainer.appendChild(minimap.getDomNode());\r\n        _this.domNode.appendChild(_this.overflowGuardContainer);\r\n        _this.domNode.appendChild(_this.contentWidgets.overflowingContentWidgetsDomNode);\r\n        _this._applyLayout();\r\n        // Pointer handler\r\n        _this.pointerHandler = _this._register(new PointerHandler(_this._context, viewController, _this.createPointerHandlerHelper()));\r\n        _this._register(model.addEventListener(function (events) {\r\n            _this.eventDispatcher.emitMany(events);\r\n        }));\r\n        _this._register(_this._cursor.addEventListener(function (events) {\r\n            _this.eventDispatcher.emitMany(events);\r\n        }));\r\n        return _this;\r\n    }\r\n    View.prototype._flushAccumulatedAndRenderNow = function () {\r\n        this._renderNow();\r\n    };\r\n    View.prototype.createPointerHandlerHelper = function () {\r\n        var _this = this;\r\n        return {\r\n            viewDomNode: this.domNode.domNode,\r\n            linesContentDomNode: this.linesContent.domNode,\r\n            focusTextArea: function () {\r\n                _this.focus();\r\n            },\r\n            getLastRenderData: function () {\r\n                var lastViewCursorsRenderData = _this.viewCursors.getLastRenderData() || [];\r\n                var lastTextareaPosition = _this._textAreaHandler.getLastRenderData();\r\n                return new PointerHandlerLastRenderData(lastViewCursorsRenderData, lastTextareaPosition);\r\n            },\r\n            shouldSuppressMouseDownOnViewZone: function (viewZoneId) {\r\n                return _this.viewZones.shouldSuppressMouseDownOnViewZone(viewZoneId);\r\n            },\r\n            shouldSuppressMouseDownOnWidget: function (widgetId) {\r\n                return _this.contentWidgets.shouldSuppressMouseDownOnWidget(widgetId);\r\n            },\r\n            getPositionFromDOMInfo: function (spanNode, offset) {\r\n                _this._flushAccumulatedAndRenderNow();\r\n                return _this.viewLines.getPositionFromDOMInfo(spanNode, offset);\r\n            },\r\n            visibleRangeForPosition: function (lineNumber, column) {\r\n                _this._flushAccumulatedAndRenderNow();\r\n                return _this.viewLines.visibleRangeForPosition(new Position(lineNumber, column));\r\n            },\r\n            getLineWidth: function (lineNumber) {\r\n                _this._flushAccumulatedAndRenderNow();\r\n                return _this.viewLines.getLineWidth(lineNumber);\r\n            }\r\n        };\r\n    };\r\n    View.prototype.createTextAreaHandlerHelper = function () {\r\n        var _this = this;\r\n        return {\r\n            visibleRangeForPositionRelativeToEditor: function (lineNumber, column) {\r\n                _this._flushAccumulatedAndRenderNow();\r\n                return _this.viewLines.visibleRangeForPosition(new Position(lineNumber, column));\r\n            }\r\n        };\r\n    };\r\n    View.prototype._applyLayout = function () {\r\n        var options = this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        this.domNode.setWidth(layoutInfo.width);\r\n        this.domNode.setHeight(layoutInfo.height);\r\n        this.overflowGuardContainer.setWidth(layoutInfo.width);\r\n        this.overflowGuardContainer.setHeight(layoutInfo.height);\r\n        this.linesContent.setWidth(1000000);\r\n        this.linesContent.setHeight(1000000);\r\n    };\r\n    View.prototype.getEditorClassName = function () {\r\n        var focused = this._textAreaHandler.isFocused() ? ' focused' : '';\r\n        return this._context.configuration.options.get(104 /* editorClassName */) + ' ' + getThemeTypeSelector(this._context.theme.type) + focused;\r\n    };\r\n    // --- begin event handlers\r\n    View.prototype.onConfigurationChanged = function (e) {\r\n        this.domNode.setClassName(this.getEditorClassName());\r\n        this._applyLayout();\r\n        return false;\r\n    };\r\n    View.prototype.onContentSizeChanged = function (e) {\r\n        this.outgoingEvents.emitContentSizeChange(e);\r\n        return false;\r\n    };\r\n    View.prototype.onFocusChanged = function (e) {\r\n        this.domNode.setClassName(this.getEditorClassName());\r\n        this._context.model.setHasFocus(e.isFocused);\r\n        if (e.isFocused) {\r\n            this.outgoingEvents.emitViewFocusGained();\r\n        }\r\n        else {\r\n            this.outgoingEvents.emitViewFocusLost();\r\n        }\r\n        return false;\r\n    };\r\n    View.prototype.onScrollChanged = function (e) {\r\n        this.outgoingEvents.emitScrollChanged(e);\r\n        return false;\r\n    };\r\n    View.prototype.onThemeChanged = function (e) {\r\n        this.domNode.setClassName(this.getEditorClassName());\r\n        return false;\r\n    };\r\n    // --- end event handlers\r\n    View.prototype.dispose = function () {\r\n        if (this._renderAnimationFrame !== null) {\r\n            this._renderAnimationFrame.dispose();\r\n            this._renderAnimationFrame = null;\r\n        }\r\n        this.eventDispatcher.removeEventHandler(this);\r\n        this.outgoingEvents.dispose();\r\n        this.viewLines.dispose();\r\n        // Destroy view parts\r\n        for (var i = 0, len = this.viewParts.length; i < len; i++) {\r\n            this.viewParts[i].dispose();\r\n        }\r\n        this.viewParts = [];\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    View.prototype._renderOnce = function (callback) {\r\n        var r = safeInvokeNoArg(callback);\r\n        this._scheduleRender();\r\n        return r;\r\n    };\r\n    View.prototype._scheduleRender = function () {\r\n        if (this._renderAnimationFrame === null) {\r\n            this._renderAnimationFrame = dom.runAtThisOrScheduleAtNextAnimationFrame(this._onRenderScheduled.bind(this), 100);\r\n        }\r\n    };\r\n    View.prototype._onRenderScheduled = function () {\r\n        this._renderAnimationFrame = null;\r\n        this._flushAccumulatedAndRenderNow();\r\n    };\r\n    View.prototype._renderNow = function () {\r\n        var _this = this;\r\n        safeInvokeNoArg(function () { return _this._actualRender(); });\r\n    };\r\n    View.prototype._getViewPartsToRender = function () {\r\n        var result = [], resultLen = 0;\r\n        for (var i = 0, len = this.viewParts.length; i < len; i++) {\r\n            var viewPart = this.viewParts[i];\r\n            if (viewPart.shouldRender()) {\r\n                result[resultLen++] = viewPart;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    View.prototype._actualRender = function () {\r\n        if (!dom.isInDOM(this.domNode.domNode)) {\r\n            return;\r\n        }\r\n        var viewPartsToRender = this._getViewPartsToRender();\r\n        if (!this.viewLines.shouldRender() && viewPartsToRender.length === 0) {\r\n            // Nothing to render\r\n            return;\r\n        }\r\n        var partialViewportData = this._context.viewLayout.getLinesViewportData();\r\n        this._context.model.setViewport(partialViewportData.startLineNumber, partialViewportData.endLineNumber, partialViewportData.centeredLineNumber);\r\n        var viewportData = new ViewportData(this._cursor.getViewSelections(), partialViewportData, this._context.viewLayout.getWhitespaceViewportData(), this._context.model);\r\n        if (this.contentWidgets.shouldRender()) {\r\n            // Give the content widgets a chance to set their max width before a possible synchronous layout\r\n            this.contentWidgets.onBeforeRender(viewportData);\r\n        }\r\n        if (this.viewLines.shouldRender()) {\r\n            this.viewLines.renderText(viewportData);\r\n            this.viewLines.onDidRender();\r\n            // Rendering of viewLines might cause scroll events to occur, so collect view parts to render again\r\n            viewPartsToRender = this._getViewPartsToRender();\r\n        }\r\n        var renderingContext = new RenderingContext(this._context.viewLayout, viewportData, this.viewLines);\r\n        // Render the rest of the parts\r\n        for (var i = 0, len = viewPartsToRender.length; i < len; i++) {\r\n            var viewPart = viewPartsToRender[i];\r\n            viewPart.prepareRender(renderingContext);\r\n        }\r\n        for (var i = 0, len = viewPartsToRender.length; i < len; i++) {\r\n            var viewPart = viewPartsToRender[i];\r\n            viewPart.render(renderingContext);\r\n            viewPart.onDidRender();\r\n        }\r\n    };\r\n    // --- BEGIN CodeEditor helpers\r\n    View.prototype.delegateVerticalScrollbarMouseDown = function (browserEvent) {\r\n        this._scrollbar.delegateVerticalScrollbarMouseDown(browserEvent);\r\n    };\r\n    View.prototype.restoreState = function (scrollPosition) {\r\n        this._context.viewLayout.setScrollPositionNow({ scrollTop: scrollPosition.scrollTop });\r\n        this._context.model.tokenizeViewport();\r\n        this._renderNow();\r\n        this.viewLines.updateLineWidths();\r\n        this._context.viewLayout.setScrollPositionNow({ scrollLeft: scrollPosition.scrollLeft });\r\n    };\r\n    View.prototype.getOffsetForColumn = function (modelLineNumber, modelColumn) {\r\n        var modelPosition = this._context.model.validateModelPosition({\r\n            lineNumber: modelLineNumber,\r\n            column: modelColumn\r\n        });\r\n        var viewPosition = this._context.model.coordinatesConverter.convertModelPositionToViewPosition(modelPosition);\r\n        this._flushAccumulatedAndRenderNow();\r\n        var visibleRange = this.viewLines.visibleRangeForPosition(new Position(viewPosition.lineNumber, viewPosition.column));\r\n        if (!visibleRange) {\r\n            return -1;\r\n        }\r\n        return visibleRange.left;\r\n    };\r\n    View.prototype.getTargetAtClientPoint = function (clientX, clientY) {\r\n        var mouseTarget = this.pointerHandler.getTargetAtClientPoint(clientX, clientY);\r\n        if (!mouseTarget) {\r\n            return null;\r\n        }\r\n        return ViewOutgoingEvents.convertViewToModelMouseTarget(mouseTarget, this._context.model.coordinatesConverter);\r\n    };\r\n    View.prototype.createOverviewRuler = function (cssClassName) {\r\n        return new OverviewRuler(this._context, cssClassName);\r\n    };\r\n    View.prototype.change = function (callback) {\r\n        var _this = this;\r\n        return this._renderOnce(function () {\r\n            var zonesHaveChanged = _this.viewZones.changeViewZones(callback);\r\n            if (zonesHaveChanged) {\r\n                _this._context.viewLayout.onHeightMaybeChanged();\r\n                _this._context.privateViewEventBus.emit(new viewEvents.ViewZonesChangedEvent());\r\n            }\r\n            return zonesHaveChanged;\r\n        });\r\n    };\r\n    View.prototype.render = function (now, everything) {\r\n        if (everything) {\r\n            // Force everything to render...\r\n            this.viewLines.forceShouldRender();\r\n            for (var i = 0, len = this.viewParts.length; i < len; i++) {\r\n                var viewPart = this.viewParts[i];\r\n                viewPart.forceShouldRender();\r\n            }\r\n        }\r\n        if (now) {\r\n            this._flushAccumulatedAndRenderNow();\r\n        }\r\n        else {\r\n            this._scheduleRender();\r\n        }\r\n    };\r\n    View.prototype.focus = function () {\r\n        this._textAreaHandler.focusTextArea();\r\n    };\r\n    View.prototype.isFocused = function () {\r\n        return this._textAreaHandler.isFocused();\r\n    };\r\n    View.prototype.setAriaOptions = function (options) {\r\n        this._textAreaHandler.setAriaOptions(options);\r\n    };\r\n    View.prototype.addContentWidget = function (widgetData) {\r\n        this.contentWidgets.addWidget(widgetData.widget);\r\n        this.layoutContentWidget(widgetData);\r\n        this._scheduleRender();\r\n    };\r\n    View.prototype.layoutContentWidget = function (widgetData) {\r\n        var newRange = widgetData.position ? widgetData.position.range || null : null;\r\n        if (newRange === null) {\r\n            var newPosition = widgetData.position ? widgetData.position.position : null;\r\n            if (newPosition !== null) {\r\n                newRange = new Range(newPosition.lineNumber, newPosition.column, newPosition.lineNumber, newPosition.column);\r\n            }\r\n        }\r\n        var newPreference = widgetData.position ? widgetData.position.preference : null;\r\n        this.contentWidgets.setWidgetPosition(widgetData.widget, newRange, newPreference);\r\n        this._scheduleRender();\r\n    };\r\n    View.prototype.removeContentWidget = function (widgetData) {\r\n        this.contentWidgets.removeWidget(widgetData.widget);\r\n        this._scheduleRender();\r\n    };\r\n    View.prototype.addOverlayWidget = function (widgetData) {\r\n        this.overlayWidgets.addWidget(widgetData.widget);\r\n        this.layoutOverlayWidget(widgetData);\r\n        this._scheduleRender();\r\n    };\r\n    View.prototype.layoutOverlayWidget = function (widgetData) {\r\n        var newPreference = widgetData.position ? widgetData.position.preference : null;\r\n        var shouldRender = this.overlayWidgets.setWidgetPosition(widgetData.widget, newPreference);\r\n        if (shouldRender) {\r\n            this._scheduleRender();\r\n        }\r\n    };\r\n    View.prototype.removeOverlayWidget = function (widgetData) {\r\n        this.overlayWidgets.removeWidget(widgetData.widget);\r\n        this._scheduleRender();\r\n    };\r\n    return View;\r\n}(ViewEventHandler));\r\nexport { View };\r\nfunction safeInvokeNoArg(func) {\r\n    try {\r\n        return func();\r\n    }\r\n    catch (e) {\r\n        onUnexpectedError(e);\r\n    }\r\n}\r\n"],"sourceRoot":""}