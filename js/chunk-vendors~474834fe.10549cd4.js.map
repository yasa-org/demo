{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggest.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestMemory.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestAlternatives.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestModel.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestWidget.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestCommitCharacters.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestRangeHighlighter.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestController.js"],"names":["_snippetSuggestSupport","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","Context","Visible","MultipleSuggestions","MakesTextEdit","AcceptSuggestionsOnEnter","CompletionItem","position","completion","container","provider","model","_this","isResolved","score","Default","distance","textLabel","name","labelLow","toLowerCase","sortTextLow","sortText","filterTextLow","filterText","isIRange","range","editStart","startLineNumber","startColumn","editInsertEnd","endLineNumber","endColumn","editReplaceEnd","insert","replace","cached_1","resolveCompletionItem","token","err","undefined","onCancellationRequested","CompletionOptions","snippetSortOrder","kindFilter","providerFilter","Set","default","getSnippetSuggestSupport","provideSuggestionItems","options","context","triggerKind","None","word","getWordAtPosition","defaultReplaceRange","lineNumber","fromPositions","defaultInsertRange","setEndPosition","column","clone","supports","orderedGroups","has","unshift","allSuggestions","disposables","hasResult","factory","map","all","size","provideCompletionItems","len","_i","_a","suggestions","suggestion","kind","add","isCancellationRequested","dispose","sort","getSuggestionComparator","defaultComparator","a","b","snippetUpComparator","snippetDownComparator","_snippetComparators","Map","snippetConfig","get","set","args","resolving","maxItemsToResolve","items","items_1","item","incomplete","setTimeout","_provider","class_1","onlyOnceSuggestions","prototype","slice","showSimpleSuggestions","editor","getContribution","triggerSuggest","register","__extends","extendStatics","d","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","create","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","Memory","select","pos","topScore","preselect","NoMemory","_super","memorize","toJSON","fromJSON","LRUMemory","_cache","_seq","getLanguageIdentifier","language","touch","type","insertText","lineSuffix","getLineContent","substr","test","indexPreselect","indexRecency","seq","peek","data","forEach","clear","data_1","PrefixMemory","_trie","forStrings","getWordUntilPosition","findSubstr","entries","data_2","SuggestMemoryService","_storageService","_configService","_storagePrefix","update","mode","getValue","share","_update","_persistSoon","_register","_saveState","onWillSaveState","reason","SHUTDOWN","onDidChangeConfiguration","affectsConfiguration","onDidChangeStorage","scope","indexOf","document","hasFocus","_mode","_shareMem","shareMem","force","_strategy","raw","JSON","parse","schedule","stringify","store","ISuggestMemoryService","SuggestAlternatives","_editor","contextKeyService","_index","_ckOtherSuggestions","OtherSuggestions","bindTo","reset","_listener","_model","_acceptNext","_ignore","acceptNext","index","nextIndex","_moveIndex","onDidChangeCursorPosition","fwd","newIndex","additionalTextEdits","_move","prev","LineContext","auto","shy","leadingLineContent","leadingWord","shouldAutoTrigger","hasModel","getModel","getPosition","tokenizeIfCheap","isNaN","Number","SuggestModel","_editorWorker","_toDispose","_quickSuggestDelay","_triggerCharacterListener","_triggerQuickSuggest","_state","_completionDisposables","_onDidCancel","_onDidTrigger","_onDidSuggest","onDidCancel","event","onDidTrigger","onDidSuggest","_currentSelection","getSelection","onDidChangeModel","_updateTriggerCharacters","cancel","onDidChangeModelLanguage","_updateQuickSuggest","onDidChange","_updateActiveSuggestSession","onDidChangeCursorSelection","_onCursorChange","editorIsComposing","onDidCompositionStart","onDidCompositionEnd","_refilterCompletionItems","onDidChangeModelContent","getOption","supportsByTriggerCharacter","support","_b","_c","triggerCharacters","ch","checkTriggerCharacter","text","lastChar","charCodeAt","charAt","_completionModel","trigger","triggerCharacter","Boolean","onDidType","enumerable","configurable","retrigger","_requestToken","_context","fire","prevSelection","selection","isEmpty","source","containsRange","getEndPosition","isBeforeOrEqual","snippetsPreventQuickSuggestions","isInSnippet","cancelAndSet","quickSuggestions","lineTokens","getLineTokens","tokenType","getStandardTokenType","findTokenIndexAtOffset","Math","max","inValidScope","other","comments","strings","ctx","_onNewContext","onlyFrom","existingItems","suggestCtx","snippetSuggestions","itemKindFilter","_createItemKindFilter","wordDistance","cmpFn","concat","characterCountDelta","catch","suggestOptions","showMethods","showFunctions","showConstructors","showFields","showVariables","showClasses","showStructs","showInterfaces","showModules","showProperties","showEvents","showOperators","showUnits","showValues","showConstants","showEnums","showEnumMembers","showKeywords","showWords","showColors","showFiles","showReferences","showFolders","showTypeParameters","showSnippets","adopted","oldLineContext","lineContext","isFrozen","completionModel","__assign","assign","s","expandSuggestionDocsByDefault","editorSuggestWidgetBackground","dark","light","hc","nls","editorSuggestWidgetBorder","editorSuggestWidgetForeground","editorSuggestWidgetSelectedBackground","editorSuggestWidgetHighlightForeground","colorRegExp","extractColor","out","match","documentation","canExpandCompletionItem","detail","getAriaId","ItemRenderer","widget","triggerKeybindingLabel","_modelService","_modeService","_themeService","renderTemplate","root","icon","colorspan","main","left","right","iconContainer","iconLabel","supportHighlights","supportCodicons","signatureLabel","qualifierLabel","detailsLabel","readMore","title","configureFont","getOptions","fontInfo","fontFamily","fontFeatureSettings","fontSize","lineHeight","fontWeight","fontSizePx","lineHeightPx","style","height","width","chain","bind","filter","hasChanged","on","renderElement","element","templateData","id","className","backgroundColor","labelOptions","labelEscapeNewLines","matches","color","getIconTheme","hasFileIcons","labelClasses","getIconClasses","from","scheme","path","FILE","detailClasses","extraClasses","hasFolderIcons","FOLDER","tags","setLabel","textContent","signature","qualifier","onmousedown","stopPropagation","preventDefault","onclick","toggleDetails","disposeTemplate","SuggestionDetails","markdownRenderer","kbToggleDetails","borderWidth","el","removeChild","scrollbar","getDomNode","header","close","docs","onDidRenderCodeBlock","scanDomNode","renderLoading","renderItem","explainMode","renderDisposeable","md","idx","appendCodeblock","_debugDisplayName","innerHTML","renderedContents","render","appendChild","innerText","offsetHeight","userSelect","tabIndex","scrollTop","scrollDown","much","scrollUp","scrollBottom","scrollHeight","pageDown","pageUp","setBorderWidth","SuggestWidget","telemetryService","keybindingService","themeService","storageService","modeService","openerService","instantiationService","allowEditorOverflow","suppressMouseDown","state","isAuto","loadingTimeout","currentSuggestionDetails","ignoreFocusEvents","showTimeout","toDispose","onDidSelectEmitter","onDidFocusEmitter","onDidHideEmitter","onDidShowEmitter","onDidSelect","onDidFocus","onDidHide","onDidShow","maxWidgetWidth","listWidth","firstFocusInCurrentList","preferDocPositionTop","docsPositionPreviousWidgetY","_onDetailsKeydown","onDetailsKeyDown","lookupKeybinding","getLabel","msgDetailsLess","msgDetailMore","focusedItem","hideWidget","messageElement","listElement","applyStatusBarStyle","hideStatusBar","statusBarElement","statusBarLeftSpan","statusBarRightSpan","setStatusBarLeftText","setStatusBarRightText","details","createInstance","applyIconStyle","showIcons","renderer","list","useShadows","openController","shouldOpen","mouseSupport","accessibilityProvider","getAriaLabel","expandDocsSettingFromStorage","listInactiveFocusBackground","listInactiveFocusOutline","onThemeChange","onDidLayoutChange","onEditorLayoutChange","onMouseDown","onListMouseDownOrTap","onTap","onSelectionChange","onListSelection","onFocusChange","onListFocus","onCursorSelectionChanged","suggestWidgetVisible","suggestWidgetMultipleSuggestions","addContentWidget","setState","getTheme","onEditorMouseDown","mouseEvent","contains","focus","layoutContentWidget","expandSideOrBelow","browserEvent","elements","indexes","theme","getColor","toString","borderColor","detailsBorderColor","focusBorderColor","detailsFocusBorderColor","setAriaOptions","activeDescendant","wantsInsert","insertMode","kbAccept","kbAcceptAlt","equals","reveal","loading","showDetails","splice","setFocus","stateChanged","hide","listHeight","LOADING_MESSAGE","show","NO_SUGGESTIONS_MESSAGE","showTriggered","delay","showSuggestions","selectionIndex","visibleCount","stats","publicLog","selectNextPage","focusNextPage","selectNext","focusNext","selectLast","focusLast","selectPreviousPage","focusPreviousPage","selectPrevious","focusPrevious","selectFirst","focusFirst","getFocusedItem","getFocusedElements","getFocus","toggleDetailsFocus","publicLog2","updateExpandDocsSetting","maxHeight","maxWidgetHeight","marginTop","adjustDocsPosition","toggleExplainMode","newHeight","updateListHeight","preference","getId","ID","unfocusedHeight","suggestionCount","contentHeight","maxVisibleSuggestions","min","top","layout","cursorCoords","getScrolledVisiblePosition","editorCoords","cursorX","cursorY","widgetCoords","widgetX","widgetY","maxWidth","getHeight","getTemplateId","getBoolean","collector","matchHighlight","addRule","foreground","link","codeBackground","CommitCharacterController","accept","_disposables","_onItem","onWillType","_active","acceptCharacters","selected","commitCharacters","SuggestRangeHighlighter","_controller","_decorations","focused","_highlight","_widgetListener","_reset","_shiftKeyListener","deltaDecorations","_currentItem","opts","newDeco","insertHighlight","shiftKey","info","getOverwriteInfo","isPressed","overwriteAfter","inlineClassName","wordInfo","ShiftKey","_subscriptions","_isPressed","__spreadArrays","il","k","j","jl","_sticky","LineSuffix","_position","maxColumn","getLineMaxColumn","offset","getOffsetAt","end","getPositionAt","_marker","stickiness","isDisposed","delta","getDecorationRange","getStartPosition","SuggestController","editorWorker","_memoryService","_commandService","_contextKeyService","_instantiationService","_lineSuffix","_insertSuggestion","commitCharacterController","makesTextEdit","command","insertTextRules","oldText","getValueInRange","toKeybinding","platform","isModifierKey","_alternatives","onDidBlurEditorWidget","acceptSuggestionsOnEnter","updateFromConfig","acceptSuggestionOnEnter","flags","modelVersionNow","getAlternativeVersionId","pushUndoStop","isArray","executeEdits","edit","lift","escape","overwriteBefore","undoStopBefore","undoStopAfter","adjustWhitespace","executeCommand","finally","canUndo","undo","_alertCompletionItem","toggleMode","columnDelta","suffixDelta","msg","revealLine","triggerSuggestAndAcceptBest","arg","positionNow","fallback","textNow","once","listener","any","acceptSelectedSuggestion","keepAlternativeSuggestions","alternativeOverwriteConfig","acceptNextSuggestion","acceptPrevSuggestion","cancelSuggestWidget","selectNextSuggestion","selectNextPageSuggestion","selectLastSuggestion","selectPrevSuggestion","selectPrevPageSuggestion","selectFirstSuggestion","toggleSuggestionDetails","toggleSuggestionFocus","TriggerSuggestAction","alias","precondition","and","writable","hasCompletionItemProvider","kbOpts","kbExpr","textInputFocus","primary","mac","secondary","weight","run","accessor","controller","SuggestCommand","bindToContribution","handler","x","registerKeybindingRule","when","registerCommandAlias","AtEnd","toNegated","InSnippetMode"],"mappings":"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","file":"js/chunk-vendors~474834fe.10549cd4.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { first } from '../../../base/common/async.js';\r\nimport { assign } from '../../../base/common/objects.js';\r\nimport { onUnexpectedExternalError, canceled, isPromiseCanceledError } from '../../../base/common/errors.js';\r\nimport { registerDefaultLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport * as modes from '../../common/modes.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { FuzzyScore } from '../../../base/common/filters.js';\r\nimport { isDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nexport var Context = {\r\n    Visible: new RawContextKey('suggestWidgetVisible', false),\r\n    MultipleSuggestions: new RawContextKey('suggestWidgetMultipleSuggestions', false),\r\n    MakesTextEdit: new RawContextKey('suggestionMakesTextEdit', true),\r\n    AcceptSuggestionsOnEnter: new RawContextKey('acceptSuggestionOnEnter', true)\r\n};\r\nvar CompletionItem = /** @class */ (function () {\r\n    function CompletionItem(position, completion, container, provider, model) {\r\n        var _this = this;\r\n        this.position = position;\r\n        this.completion = completion;\r\n        this.container = container;\r\n        this.provider = provider;\r\n        this.isResolved = false;\r\n        // sorting, filtering\r\n        this.score = FuzzyScore.Default;\r\n        this.distance = 0;\r\n        this.textLabel = typeof completion.label === 'string'\r\n            ? completion.label\r\n            : completion.label.name;\r\n        // ensure lower-variants (perf)\r\n        this.labelLow = this.textLabel.toLowerCase();\r\n        this.sortTextLow = completion.sortText && completion.sortText.toLowerCase();\r\n        this.filterTextLow = completion.filterText && completion.filterText.toLowerCase();\r\n        // normalize ranges\r\n        if (Range.isIRange(completion.range)) {\r\n            this.editStart = new Position(completion.range.startLineNumber, completion.range.startColumn);\r\n            this.editInsertEnd = new Position(completion.range.endLineNumber, completion.range.endColumn);\r\n            this.editReplaceEnd = new Position(completion.range.endLineNumber, completion.range.endColumn);\r\n        }\r\n        else {\r\n            this.editStart = new Position(completion.range.insert.startLineNumber, completion.range.insert.startColumn);\r\n            this.editInsertEnd = new Position(completion.range.insert.endLineNumber, completion.range.insert.endColumn);\r\n            this.editReplaceEnd = new Position(completion.range.replace.endLineNumber, completion.range.replace.endColumn);\r\n        }\r\n        // create the suggestion resolver\r\n        var resolveCompletionItem = provider.resolveCompletionItem;\r\n        if (typeof resolveCompletionItem !== 'function') {\r\n            this.resolve = function () { return Promise.resolve(); };\r\n            this.isResolved = true;\r\n        }\r\n        else {\r\n            var cached_1;\r\n            this.resolve = function (token) {\r\n                if (!cached_1) {\r\n                    cached_1 = Promise.resolve(resolveCompletionItem.call(provider, model, position, completion, token)).then(function (value) {\r\n                        assign(completion, value);\r\n                        _this.isResolved = true;\r\n                    }, function (err) {\r\n                        if (isPromiseCanceledError(err)) {\r\n                            // the IPC queue will reject the request with the\r\n                            // cancellation error -> reset cached\r\n                            cached_1 = undefined;\r\n                        }\r\n                    });\r\n                    token.onCancellationRequested(function () {\r\n                        if (!_this.isResolved) {\r\n                            // cancellation after the request has been\r\n                            // dispatched -> reset cache\r\n                            cached_1 = undefined;\r\n                        }\r\n                    });\r\n                }\r\n                return cached_1;\r\n            };\r\n        }\r\n    }\r\n    return CompletionItem;\r\n}());\r\nexport { CompletionItem };\r\nvar CompletionOptions = /** @class */ (function () {\r\n    function CompletionOptions(snippetSortOrder, kindFilter, providerFilter) {\r\n        if (snippetSortOrder === void 0) { snippetSortOrder = 2 /* Bottom */; }\r\n        if (kindFilter === void 0) { kindFilter = new Set(); }\r\n        if (providerFilter === void 0) { providerFilter = new Set(); }\r\n        this.snippetSortOrder = snippetSortOrder;\r\n        this.kindFilter = kindFilter;\r\n        this.providerFilter = providerFilter;\r\n    }\r\n    CompletionOptions.default = new CompletionOptions();\r\n    return CompletionOptions;\r\n}());\r\nexport { CompletionOptions };\r\nvar _snippetSuggestSupport;\r\nexport function getSnippetSuggestSupport() {\r\n    return _snippetSuggestSupport;\r\n}\r\nexport function provideSuggestionItems(model, position, options, context, token) {\r\n    if (options === void 0) { options = CompletionOptions.default; }\r\n    if (context === void 0) { context = { triggerKind: 0 /* Invoke */ }; }\r\n    if (token === void 0) { token = CancellationToken.None; }\r\n    var word = model.getWordAtPosition(position);\r\n    var defaultReplaceRange = word ? new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn) : Range.fromPositions(position);\r\n    var defaultInsertRange = defaultReplaceRange.setEndPosition(position.lineNumber, position.column);\r\n    // const wordUntil = model.getWordUntilPosition(position);\r\n    // const defaultRange = new Range(position.lineNumber, wordUntil.startColumn, position.lineNumber, wordUntil.endColumn);\r\n    position = position.clone();\r\n    // get provider groups, always add snippet suggestion provider\r\n    var supports = modes.CompletionProviderRegistry.orderedGroups(model);\r\n    // add snippets provider unless turned off\r\n    if (!options.kindFilter.has(25 /* Snippet */) && _snippetSuggestSupport) {\r\n        supports.unshift([_snippetSuggestSupport]);\r\n    }\r\n    var allSuggestions = [];\r\n    var disposables = new DisposableStore();\r\n    var hasResult = false;\r\n    // add suggestions from contributed providers - providers are ordered in groups of\r\n    // equal score and once a group produces a result the process stops\r\n    var factory = supports.map(function (supports) { return function () {\r\n        // for each support in the group ask for suggestions\r\n        return Promise.all(supports.map(function (provider) {\r\n            if (options.providerFilter.size > 0 && !options.providerFilter.has(provider)) {\r\n                return undefined;\r\n            }\r\n            return Promise.resolve(provider.provideCompletionItems(model, position, context, token)).then(function (container) {\r\n                var len = allSuggestions.length;\r\n                if (container) {\r\n                    for (var _i = 0, _a = container.suggestions || []; _i < _a.length; _i++) {\r\n                        var suggestion = _a[_i];\r\n                        if (!options.kindFilter.has(suggestion.kind)) {\r\n                            // fill in default range when missing\r\n                            if (!suggestion.range) {\r\n                                suggestion.range = { insert: defaultInsertRange, replace: defaultReplaceRange };\r\n                            }\r\n                            // fill in default sortText when missing\r\n                            if (!suggestion.sortText) {\r\n                                suggestion.sortText = typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.name;\r\n                            }\r\n                            allSuggestions.push(new CompletionItem(position, suggestion, container, provider, model));\r\n                        }\r\n                    }\r\n                    if (isDisposable(container)) {\r\n                        disposables.add(container);\r\n                    }\r\n                }\r\n                if (len !== allSuggestions.length && provider !== _snippetSuggestSupport) {\r\n                    hasResult = true;\r\n                }\r\n            }, onUnexpectedExternalError);\r\n        }));\r\n    }; });\r\n    var result = first(factory, function () {\r\n        // stop on result or cancellation\r\n        return hasResult || token.isCancellationRequested;\r\n    }).then(function () {\r\n        if (token.isCancellationRequested) {\r\n            disposables.dispose();\r\n            return Promise.reject(canceled());\r\n        }\r\n        return allSuggestions.sort(getSuggestionComparator(options.snippetSortOrder));\r\n    });\r\n    // result.then(items => {\r\n    // \tconsole.log(model.getWordUntilPosition(position), items.map(item => `${item.suggestion.label}, type=${item.suggestion.type}, incomplete?${item.container.incomplete}, overwriteBefore=${item.suggestion.overwriteBefore}`));\r\n    // \treturn items;\r\n    // }, err => {\r\n    // \tconsole.warn(model.getWordUntilPosition(position), err);\r\n    // });\r\n    return result;\r\n}\r\nfunction defaultComparator(a, b) {\r\n    // check with 'sortText'\r\n    if (a.sortTextLow && b.sortTextLow) {\r\n        if (a.sortTextLow < b.sortTextLow) {\r\n            return -1;\r\n        }\r\n        else if (a.sortTextLow > b.sortTextLow) {\r\n            return 1;\r\n        }\r\n    }\r\n    // check with 'label'\r\n    if (a.completion.label < b.completion.label) {\r\n        return -1;\r\n    }\r\n    else if (a.completion.label > b.completion.label) {\r\n        return 1;\r\n    }\r\n    // check with 'type'\r\n    return a.completion.kind - b.completion.kind;\r\n}\r\nfunction snippetUpComparator(a, b) {\r\n    if (a.completion.kind !== b.completion.kind) {\r\n        if (a.completion.kind === 25 /* Snippet */) {\r\n            return -1;\r\n        }\r\n        else if (b.completion.kind === 25 /* Snippet */) {\r\n            return 1;\r\n        }\r\n    }\r\n    return defaultComparator(a, b);\r\n}\r\nfunction snippetDownComparator(a, b) {\r\n    if (a.completion.kind !== b.completion.kind) {\r\n        if (a.completion.kind === 25 /* Snippet */) {\r\n            return 1;\r\n        }\r\n        else if (b.completion.kind === 25 /* Snippet */) {\r\n            return -1;\r\n        }\r\n    }\r\n    return defaultComparator(a, b);\r\n}\r\nvar _snippetComparators = new Map();\r\n_snippetComparators.set(0 /* Top */, snippetUpComparator);\r\n_snippetComparators.set(2 /* Bottom */, snippetDownComparator);\r\n_snippetComparators.set(1 /* Inline */, defaultComparator);\r\nexport function getSuggestionComparator(snippetConfig) {\r\n    return _snippetComparators.get(snippetConfig);\r\n}\r\nregisterDefaultLanguageCommand('_executeCompletionItemProvider', function (model, position, args) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var result, disposables, resolving, maxItemsToResolve, items, _i, items_1, item;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                result = {\r\n                    incomplete: false,\r\n                    suggestions: []\r\n                };\r\n                disposables = new DisposableStore();\r\n                resolving = [];\r\n                maxItemsToResolve = args['maxItemsToResolve'] || 0;\r\n                return [4 /*yield*/, provideSuggestionItems(model, position)];\r\n            case 1:\r\n                items = _a.sent();\r\n                for (_i = 0, items_1 = items; _i < items_1.length; _i++) {\r\n                    item = items_1[_i];\r\n                    if (resolving.length < maxItemsToResolve) {\r\n                        resolving.push(item.resolve(CancellationToken.None));\r\n                    }\r\n                    result.incomplete = result.incomplete || item.container.incomplete;\r\n                    result.suggestions.push(item.completion);\r\n                    if (isDisposable(item.container)) {\r\n                        disposables.add(item.container);\r\n                    }\r\n                }\r\n                _a.label = 2;\r\n            case 2:\r\n                _a.trys.push([2, , 4, 5]);\r\n                return [4 /*yield*/, Promise.all(resolving)];\r\n            case 3:\r\n                _a.sent();\r\n                return [2 /*return*/, result];\r\n            case 4:\r\n                setTimeout(function () { return disposables.dispose(); }, 100);\r\n                return [7 /*endfinally*/];\r\n            case 5: return [2 /*return*/];\r\n        }\r\n    });\r\n}); });\r\nvar _provider = new /** @class */ (function () {\r\n    function class_1() {\r\n        this.onlyOnceSuggestions = [];\r\n    }\r\n    class_1.prototype.provideCompletionItems = function () {\r\n        var suggestions = this.onlyOnceSuggestions.slice(0);\r\n        var result = { suggestions: suggestions };\r\n        this.onlyOnceSuggestions.length = 0;\r\n        return result;\r\n    };\r\n    return class_1;\r\n}());\r\nmodes.CompletionProviderRegistry.register('*', _provider);\r\nexport function showSimpleSuggestions(editor, suggestions) {\r\n    setTimeout(function () {\r\n        var _a;\r\n        (_a = _provider.onlyOnceSuggestions).push.apply(_a, suggestions);\r\n        editor.getContribution('editor.contrib.suggestController').triggerSuggest(new Set().add(_provider));\r\n    }, 0);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { LRUCache, TernarySearchTree } from '../../../base/common/map.js';\r\nimport { IStorageService, WillSaveStateReason } from '../../../platform/storage/common/storage.js';\r\nimport { completionKindFromString } from '../../common/modes.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { RunOnceScheduler } from '../../../base/common/async.js';\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\r\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\r\nvar Memory = /** @class */ (function () {\r\n    function Memory() {\r\n    }\r\n    Memory.prototype.select = function (model, pos, items) {\r\n        if (items.length === 0) {\r\n            return 0;\r\n        }\r\n        var topScore = items[0].score[0];\r\n        for (var i = 1; i < items.length; i++) {\r\n            var _a = items[i], score = _a.score, suggestion = _a.completion;\r\n            if (score[0] !== topScore) {\r\n                // stop when leaving the group of top matches\r\n                break;\r\n            }\r\n            if (suggestion.preselect) {\r\n                // stop when seeing an auto-select-item\r\n                return i;\r\n            }\r\n        }\r\n        return 0;\r\n    };\r\n    return Memory;\r\n}());\r\nexport { Memory };\r\nvar NoMemory = /** @class */ (function (_super) {\r\n    __extends(NoMemory, _super);\r\n    function NoMemory() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    NoMemory.prototype.memorize = function (model, pos, item) {\r\n        // no-op\r\n    };\r\n    NoMemory.prototype.toJSON = function () {\r\n        return undefined;\r\n    };\r\n    NoMemory.prototype.fromJSON = function () {\r\n        //\r\n    };\r\n    return NoMemory;\r\n}(Memory));\r\nexport { NoMemory };\r\nvar LRUMemory = /** @class */ (function (_super) {\r\n    __extends(LRUMemory, _super);\r\n    function LRUMemory() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this._cache = new LRUCache(300, 0.66);\r\n        _this._seq = 0;\r\n        return _this;\r\n    }\r\n    LRUMemory.prototype.memorize = function (model, pos, item) {\r\n        var label = item.completion.label;\r\n        var key = model.getLanguageIdentifier().language + \"/\" + label;\r\n        this._cache.set(key, {\r\n            touch: this._seq++,\r\n            type: item.completion.kind,\r\n            insertText: item.completion.insertText\r\n        });\r\n    };\r\n    LRUMemory.prototype.select = function (model, pos, items) {\r\n        if (items.length === 0) {\r\n            return 0;\r\n        }\r\n        var lineSuffix = model.getLineContent(pos.lineNumber).substr(pos.column - 10, pos.column - 1);\r\n        if (/\\s$/.test(lineSuffix)) {\r\n            return _super.prototype.select.call(this, model, pos, items);\r\n        }\r\n        var topScore = items[0].score[0];\r\n        var indexPreselect = -1;\r\n        var indexRecency = -1;\r\n        var seq = -1;\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (items[i].score[0] !== topScore) {\r\n                // consider only top items\r\n                break;\r\n            }\r\n            var key = model.getLanguageIdentifier().language + \"/\" + items[i].completion.label;\r\n            var item = this._cache.peek(key);\r\n            if (item && item.touch > seq && item.type === items[i].completion.kind && item.insertText === items[i].completion.insertText) {\r\n                seq = item.touch;\r\n                indexRecency = i;\r\n            }\r\n            if (items[i].completion.preselect && indexPreselect === -1) {\r\n                // stop when seeing an auto-select-item\r\n                return indexPreselect = i;\r\n            }\r\n        }\r\n        if (indexRecency !== -1) {\r\n            return indexRecency;\r\n        }\r\n        else if (indexPreselect !== -1) {\r\n            return indexPreselect;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    };\r\n    LRUMemory.prototype.toJSON = function () {\r\n        var data = [];\r\n        this._cache.forEach(function (value, key) {\r\n            data.push([key, value]);\r\n        });\r\n        return data;\r\n    };\r\n    LRUMemory.prototype.fromJSON = function (data) {\r\n        this._cache.clear();\r\n        var seq = 0;\r\n        for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {\r\n            var _a = data_1[_i], key = _a[0], value = _a[1];\r\n            value.touch = seq;\r\n            value.type = typeof value.type === 'number' ? value.type : completionKindFromString(value.type);\r\n            this._cache.set(key, value);\r\n        }\r\n        this._seq = this._cache.size;\r\n    };\r\n    return LRUMemory;\r\n}(Memory));\r\nexport { LRUMemory };\r\nvar PrefixMemory = /** @class */ (function (_super) {\r\n    __extends(PrefixMemory, _super);\r\n    function PrefixMemory() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this._trie = TernarySearchTree.forStrings();\r\n        _this._seq = 0;\r\n        return _this;\r\n    }\r\n    PrefixMemory.prototype.memorize = function (model, pos, item) {\r\n        var word = model.getWordUntilPosition(pos).word;\r\n        var key = model.getLanguageIdentifier().language + \"/\" + word;\r\n        this._trie.set(key, {\r\n            type: item.completion.kind,\r\n            insertText: item.completion.insertText,\r\n            touch: this._seq++\r\n        });\r\n    };\r\n    PrefixMemory.prototype.select = function (model, pos, items) {\r\n        var word = model.getWordUntilPosition(pos).word;\r\n        if (!word) {\r\n            return _super.prototype.select.call(this, model, pos, items);\r\n        }\r\n        var key = model.getLanguageIdentifier().language + \"/\" + word;\r\n        var item = this._trie.get(key);\r\n        if (!item) {\r\n            item = this._trie.findSubstr(key);\r\n        }\r\n        if (item) {\r\n            for (var i = 0; i < items.length; i++) {\r\n                var _a = items[i].completion, kind = _a.kind, insertText = _a.insertText;\r\n                if (kind === item.type && insertText === item.insertText) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return _super.prototype.select.call(this, model, pos, items);\r\n    };\r\n    PrefixMemory.prototype.toJSON = function () {\r\n        var entries = [];\r\n        this._trie.forEach(function (value, key) { return entries.push([key, value]); });\r\n        // sort by last recently used (touch), then\r\n        // take the top 200 item and normalize their\r\n        // touch\r\n        entries\r\n            .sort(function (a, b) { return -(a[1].touch - b[1].touch); })\r\n            .forEach(function (value, i) { return value[1].touch = i; });\r\n        return entries.slice(0, 200);\r\n    };\r\n    PrefixMemory.prototype.fromJSON = function (data) {\r\n        this._trie.clear();\r\n        if (data.length > 0) {\r\n            this._seq = data[0][1].touch + 1;\r\n            for (var _i = 0, data_2 = data; _i < data_2.length; _i++) {\r\n                var _a = data_2[_i], key = _a[0], value = _a[1];\r\n                value.type = typeof value.type === 'number' ? value.type : completionKindFromString(value.type);\r\n                this._trie.set(key, value);\r\n            }\r\n        }\r\n    };\r\n    return PrefixMemory;\r\n}(Memory));\r\nexport { PrefixMemory };\r\nvar SuggestMemoryService = /** @class */ (function (_super) {\r\n    __extends(SuggestMemoryService, _super);\r\n    function SuggestMemoryService(_storageService, _configService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._storageService = _storageService;\r\n        _this._configService = _configService;\r\n        _this._storagePrefix = 'suggest/memories';\r\n        var update = function () {\r\n            var mode = _this._configService.getValue('editor.suggestSelection');\r\n            var share = _this._configService.getValue('editor.suggest.shareSuggestSelections');\r\n            _this._update(mode, share, false);\r\n        };\r\n        _this._persistSoon = _this._register(new RunOnceScheduler(function () { return _this._saveState(); }, 500));\r\n        _this._register(_storageService.onWillSaveState(function (e) {\r\n            if (e.reason === WillSaveStateReason.SHUTDOWN) {\r\n                _this._saveState();\r\n            }\r\n        }));\r\n        _this._register(_this._configService.onDidChangeConfiguration(function (e) {\r\n            if (e.affectsConfiguration('editor.suggestSelection') || e.affectsConfiguration('editor.suggest.shareSuggestSelections')) {\r\n                update();\r\n            }\r\n        }));\r\n        _this._register(_this._storageService.onDidChangeStorage(function (e) {\r\n            if (e.scope === 0 /* GLOBAL */ && e.key.indexOf(_this._storagePrefix) === 0) {\r\n                if (!document.hasFocus()) {\r\n                    // windows that aren't focused have to drop their current\r\n                    // storage value and accept what's stored now\r\n                    _this._update(_this._mode, _this._shareMem, true);\r\n                }\r\n            }\r\n        }));\r\n        update();\r\n        return _this;\r\n    }\r\n    SuggestMemoryService.prototype._update = function (mode, shareMem, force) {\r\n        if (!force && this._mode === mode && this._shareMem === shareMem) {\r\n            return;\r\n        }\r\n        this._shareMem = shareMem;\r\n        this._mode = mode;\r\n        this._strategy = mode === 'recentlyUsedByPrefix' ? new PrefixMemory() : mode === 'recentlyUsed' ? new LRUMemory() : new NoMemory();\r\n        try {\r\n            var scope = shareMem ? 0 /* GLOBAL */ : 1 /* WORKSPACE */;\r\n            var raw = this._storageService.get(this._storagePrefix + \"/\" + this._mode, scope);\r\n            if (raw) {\r\n                this._strategy.fromJSON(JSON.parse(raw));\r\n            }\r\n        }\r\n        catch (e) {\r\n            // things can go wrong with JSON...\r\n        }\r\n    };\r\n    SuggestMemoryService.prototype.memorize = function (model, pos, item) {\r\n        this._strategy.memorize(model, pos, item);\r\n        this._persistSoon.schedule();\r\n    };\r\n    SuggestMemoryService.prototype.select = function (model, pos, items) {\r\n        return this._strategy.select(model, pos, items);\r\n    };\r\n    SuggestMemoryService.prototype._saveState = function () {\r\n        var raw = JSON.stringify(this._strategy);\r\n        var scope = this._shareMem ? 0 /* GLOBAL */ : 1 /* WORKSPACE */;\r\n        this._storageService.store(this._storagePrefix + \"/\" + this._mode, raw, scope);\r\n    };\r\n    SuggestMemoryService = __decorate([\r\n        __param(0, IStorageService),\r\n        __param(1, IConfigurationService)\r\n    ], SuggestMemoryService);\r\n    return SuggestMemoryService;\r\n}(Disposable));\r\nexport { SuggestMemoryService };\r\nexport var ISuggestMemoryService = createDecorator('ISuggestMemories');\r\nregisterSingleton(ISuggestMemoryService, SuggestMemoryService, true);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { dispose } from '../../../base/common/lifecycle.js';\r\nimport { IContextKeyService, RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\r\nvar SuggestAlternatives = /** @class */ (function () {\r\n    function SuggestAlternatives(_editor, contextKeyService) {\r\n        this._editor = _editor;\r\n        this._index = 0;\r\n        this._ckOtherSuggestions = SuggestAlternatives.OtherSuggestions.bindTo(contextKeyService);\r\n    }\r\n    SuggestAlternatives.prototype.dispose = function () {\r\n        this.reset();\r\n    };\r\n    SuggestAlternatives.prototype.reset = function () {\r\n        this._ckOtherSuggestions.reset();\r\n        dispose(this._listener);\r\n        this._model = undefined;\r\n        this._acceptNext = undefined;\r\n        this._ignore = false;\r\n    };\r\n    SuggestAlternatives.prototype.set = function (_a, acceptNext) {\r\n        var _this = this;\r\n        var model = _a.model, index = _a.index;\r\n        // no suggestions -> nothing to do\r\n        if (model.items.length === 0) {\r\n            this.reset();\r\n            return;\r\n        }\r\n        // no alternative suggestions -> nothing to do\r\n        var nextIndex = SuggestAlternatives._moveIndex(true, model, index);\r\n        if (nextIndex === index) {\r\n            this.reset();\r\n            return;\r\n        }\r\n        this._acceptNext = acceptNext;\r\n        this._model = model;\r\n        this._index = index;\r\n        this._listener = this._editor.onDidChangeCursorPosition(function () {\r\n            if (!_this._ignore) {\r\n                _this.reset();\r\n            }\r\n        });\r\n        this._ckOtherSuggestions.set(true);\r\n    };\r\n    SuggestAlternatives._moveIndex = function (fwd, model, index) {\r\n        var newIndex = index;\r\n        while (true) {\r\n            newIndex = (newIndex + model.items.length + (fwd ? +1 : -1)) % model.items.length;\r\n            if (newIndex === index) {\r\n                break;\r\n            }\r\n            if (!model.items[newIndex].completion.additionalTextEdits) {\r\n                break;\r\n            }\r\n        }\r\n        return newIndex;\r\n    };\r\n    SuggestAlternatives.prototype.next = function () {\r\n        this._move(true);\r\n    };\r\n    SuggestAlternatives.prototype.prev = function () {\r\n        this._move(false);\r\n    };\r\n    SuggestAlternatives.prototype._move = function (fwd) {\r\n        if (!this._model) {\r\n            // nothing to reason about\r\n            return;\r\n        }\r\n        try {\r\n            this._ignore = true;\r\n            this._index = SuggestAlternatives._moveIndex(fwd, this._model, this._index);\r\n            this._acceptNext({ index: this._index, item: this._model.items[this._index], model: this._model });\r\n        }\r\n        finally {\r\n            this._ignore = false;\r\n        }\r\n    };\r\n    SuggestAlternatives.OtherSuggestions = new RawContextKey('hasOtherSuggestions', false);\r\n    SuggestAlternatives = __decorate([\r\n        __param(1, IContextKeyService)\r\n    ], SuggestAlternatives);\r\n    return SuggestAlternatives;\r\n}());\r\nexport { SuggestAlternatives };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\r\nimport { TimeoutTimer } from '../../../base/common/async.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { dispose, DisposableStore, isDisposable } from '../../../base/common/lifecycle.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { CompletionProviderRegistry } from '../../common/modes.js';\r\nimport { CompletionModel } from './completionModel.js';\r\nimport { getSuggestionComparator, provideSuggestionItems, getSnippetSuggestSupport, CompletionOptions } from './suggest.js';\r\nimport { SnippetController2 } from '../snippet/snippetController2.js';\r\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\r\nimport { WordDistance } from './wordDistance.js';\r\nimport { isLowSurrogate, isHighSurrogate } from '../../../base/common/strings.js';\r\nvar LineContext = /** @class */ (function () {\r\n    function LineContext(model, position, auto, shy) {\r\n        this.leadingLineContent = model.getLineContent(position.lineNumber).substr(0, position.column - 1);\r\n        this.leadingWord = model.getWordUntilPosition(position);\r\n        this.lineNumber = position.lineNumber;\r\n        this.column = position.column;\r\n        this.auto = auto;\r\n        this.shy = shy;\r\n    }\r\n    LineContext.shouldAutoTrigger = function (editor) {\r\n        if (!editor.hasModel()) {\r\n            return false;\r\n        }\r\n        var model = editor.getModel();\r\n        var pos = editor.getPosition();\r\n        model.tokenizeIfCheap(pos.lineNumber);\r\n        var word = model.getWordAtPosition(pos);\r\n        if (!word) {\r\n            return false;\r\n        }\r\n        if (word.endColumn !== pos.column) {\r\n            return false;\r\n        }\r\n        if (!isNaN(Number(word.word))) {\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    return LineContext;\r\n}());\r\nexport { LineContext };\r\nvar SuggestModel = /** @class */ (function () {\r\n    function SuggestModel(_editor, _editorWorker) {\r\n        var _this = this;\r\n        this._editor = _editor;\r\n        this._editorWorker = _editorWorker;\r\n        this._toDispose = new DisposableStore();\r\n        this._quickSuggestDelay = 10;\r\n        this._triggerCharacterListener = new DisposableStore();\r\n        this._triggerQuickSuggest = new TimeoutTimer();\r\n        this._state = 0 /* Idle */;\r\n        this._completionDisposables = new DisposableStore();\r\n        this._onDidCancel = new Emitter();\r\n        this._onDidTrigger = new Emitter();\r\n        this._onDidSuggest = new Emitter();\r\n        this.onDidCancel = this._onDidCancel.event;\r\n        this.onDidTrigger = this._onDidTrigger.event;\r\n        this.onDidSuggest = this._onDidSuggest.event;\r\n        this._currentSelection = this._editor.getSelection() || new Selection(1, 1, 1, 1);\r\n        // wire up various listeners\r\n        this._toDispose.add(this._editor.onDidChangeModel(function () {\r\n            _this._updateTriggerCharacters();\r\n            _this.cancel();\r\n        }));\r\n        this._toDispose.add(this._editor.onDidChangeModelLanguage(function () {\r\n            _this._updateTriggerCharacters();\r\n            _this.cancel();\r\n        }));\r\n        this._toDispose.add(this._editor.onDidChangeConfiguration(function () {\r\n            _this._updateTriggerCharacters();\r\n            _this._updateQuickSuggest();\r\n        }));\r\n        this._toDispose.add(CompletionProviderRegistry.onDidChange(function () {\r\n            _this._updateTriggerCharacters();\r\n            _this._updateActiveSuggestSession();\r\n        }));\r\n        this._toDispose.add(this._editor.onDidChangeCursorSelection(function (e) {\r\n            _this._onCursorChange(e);\r\n        }));\r\n        var editorIsComposing = false;\r\n        this._toDispose.add(this._editor.onDidCompositionStart(function () {\r\n            editorIsComposing = true;\r\n        }));\r\n        this._toDispose.add(this._editor.onDidCompositionEnd(function () {\r\n            // refilter when composition ends\r\n            editorIsComposing = false;\r\n            _this._refilterCompletionItems();\r\n        }));\r\n        this._toDispose.add(this._editor.onDidChangeModelContent(function () {\r\n            // only filter completions when the editor isn't\r\n            // composing a character, e.g. ¨ + u makes ü but just\r\n            // ¨ cannot be used for filtering\r\n            if (!editorIsComposing) {\r\n                _this._refilterCompletionItems();\r\n            }\r\n        }));\r\n        this._updateTriggerCharacters();\r\n        this._updateQuickSuggest();\r\n    }\r\n    SuggestModel.prototype.dispose = function () {\r\n        dispose(this._triggerCharacterListener);\r\n        dispose([this._onDidCancel, this._onDidSuggest, this._onDidTrigger, this._triggerQuickSuggest]);\r\n        this._toDispose.dispose();\r\n        this._completionDisposables.dispose();\r\n        this.cancel();\r\n    };\r\n    // --- handle configuration & precondition changes\r\n    SuggestModel.prototype._updateQuickSuggest = function () {\r\n        this._quickSuggestDelay = this._editor.getOption(67 /* quickSuggestionsDelay */);\r\n        if (isNaN(this._quickSuggestDelay) || (!this._quickSuggestDelay && this._quickSuggestDelay !== 0) || this._quickSuggestDelay < 0) {\r\n            this._quickSuggestDelay = 10;\r\n        }\r\n    };\r\n    SuggestModel.prototype._updateTriggerCharacters = function () {\r\n        var _this = this;\r\n        this._triggerCharacterListener.clear();\r\n        if (this._editor.getOption(68 /* readOnly */)\r\n            || !this._editor.hasModel()\r\n            || !this._editor.getOption(92 /* suggestOnTriggerCharacters */)) {\r\n            return;\r\n        }\r\n        var supportsByTriggerCharacter = new Map();\r\n        for (var _i = 0, _a = CompletionProviderRegistry.all(this._editor.getModel()); _i < _a.length; _i++) {\r\n            var support = _a[_i];\r\n            for (var _b = 0, _c = support.triggerCharacters || []; _b < _c.length; _b++) {\r\n                var ch = _c[_b];\r\n                var set = supportsByTriggerCharacter.get(ch);\r\n                if (!set) {\r\n                    set = new Set();\r\n                    set.add(getSnippetSuggestSupport());\r\n                    supportsByTriggerCharacter.set(ch, set);\r\n                }\r\n                set.add(support);\r\n            }\r\n        }\r\n        var checkTriggerCharacter = function (text) {\r\n            if (!text) {\r\n                // came here from the compositionEnd-event\r\n                var position = _this._editor.getPosition();\r\n                var model = _this._editor.getModel();\r\n                text = model.getLineContent(position.lineNumber).substr(0, position.column - 1);\r\n            }\r\n            var lastChar = '';\r\n            if (isLowSurrogate(text.charCodeAt(text.length - 1))) {\r\n                if (isHighSurrogate(text.charCodeAt(text.length - 2))) {\r\n                    lastChar = text.substr(text.length - 2);\r\n                }\r\n            }\r\n            else {\r\n                lastChar = text.charAt(text.length - 1);\r\n            }\r\n            var supports = supportsByTriggerCharacter.get(lastChar);\r\n            if (supports) {\r\n                // keep existing items that where not computed by the\r\n                // supports/providers that want to trigger now\r\n                var items = _this._completionModel ? _this._completionModel.adopt(supports) : undefined;\r\n                _this.trigger({ auto: true, shy: false, triggerCharacter: lastChar }, Boolean(_this._completionModel), supports, items);\r\n            }\r\n        };\r\n        this._triggerCharacterListener.add(this._editor.onDidType(checkTriggerCharacter));\r\n        this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(checkTriggerCharacter));\r\n    };\r\n    Object.defineProperty(SuggestModel.prototype, \"state\", {\r\n        // --- trigger/retrigger/cancel suggest\r\n        get: function () {\r\n            return this._state;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SuggestModel.prototype.cancel = function (retrigger) {\r\n        if (retrigger === void 0) { retrigger = false; }\r\n        if (this._state !== 0 /* Idle */) {\r\n            this._triggerQuickSuggest.cancel();\r\n            if (this._requestToken) {\r\n                this._requestToken.cancel();\r\n                this._requestToken = undefined;\r\n            }\r\n            this._state = 0 /* Idle */;\r\n            this._completionModel = undefined;\r\n            this._context = undefined;\r\n            this._onDidCancel.fire({ retrigger: retrigger });\r\n        }\r\n    };\r\n    SuggestModel.prototype.clear = function () {\r\n        this._completionDisposables.clear();\r\n    };\r\n    SuggestModel.prototype._updateActiveSuggestSession = function () {\r\n        if (this._state !== 0 /* Idle */) {\r\n            if (!this._editor.hasModel() || !CompletionProviderRegistry.has(this._editor.getModel())) {\r\n                this.cancel();\r\n            }\r\n            else {\r\n                this.trigger({ auto: this._state === 2 /* Auto */, shy: false }, true);\r\n            }\r\n        }\r\n    };\r\n    SuggestModel.prototype._onCursorChange = function (e) {\r\n        var _this = this;\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var prevSelection = this._currentSelection;\r\n        this._currentSelection = this._editor.getSelection();\r\n        if (!e.selection.isEmpty()\r\n            || e.reason !== 0 /* NotSet */\r\n            || (e.source !== 'keyboard' && e.source !== 'deleteLeft')) {\r\n            // Early exit if nothing needs to be done!\r\n            // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\r\n            this.cancel();\r\n            return;\r\n        }\r\n        if (!CompletionProviderRegistry.has(model)) {\r\n            return;\r\n        }\r\n        if (this._state === 0 /* Idle */) {\r\n            if (this._editor.getOption(66 /* quickSuggestions */) === false) {\r\n                // not enabled\r\n                return;\r\n            }\r\n            if (!prevSelection.containsRange(this._currentSelection) && !prevSelection.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition())) {\r\n                // cursor didn't move RIGHT\r\n                return;\r\n            }\r\n            if (this._editor.getOption(89 /* suggest */).snippetsPreventQuickSuggestions && SnippetController2.get(this._editor).isInSnippet()) {\r\n                // no quick suggestion when in snippet mode\r\n                return;\r\n            }\r\n            this.cancel();\r\n            this._triggerQuickSuggest.cancelAndSet(function () {\r\n                if (_this._state !== 0 /* Idle */) {\r\n                    return;\r\n                }\r\n                if (!LineContext.shouldAutoTrigger(_this._editor)) {\r\n                    return;\r\n                }\r\n                if (!_this._editor.hasModel()) {\r\n                    return;\r\n                }\r\n                var model = _this._editor.getModel();\r\n                var pos = _this._editor.getPosition();\r\n                // validate enabled now\r\n                var quickSuggestions = _this._editor.getOption(66 /* quickSuggestions */);\r\n                if (quickSuggestions === false) {\r\n                    return;\r\n                }\r\n                else if (quickSuggestions === true) {\r\n                    // all good\r\n                }\r\n                else {\r\n                    // Check the type of the token that triggered this\r\n                    model.tokenizeIfCheap(pos.lineNumber);\r\n                    var lineTokens = model.getLineTokens(pos.lineNumber);\r\n                    var tokenType = lineTokens.getStandardTokenType(lineTokens.findTokenIndexAtOffset(Math.max(pos.column - 1 - 1, 0)));\r\n                    var inValidScope = quickSuggestions.other && tokenType === 0 /* Other */\r\n                        || quickSuggestions.comments && tokenType === 1 /* Comment */\r\n                        || quickSuggestions.strings && tokenType === 2 /* String */;\r\n                    if (!inValidScope) {\r\n                        return;\r\n                    }\r\n                }\r\n                // we made it till here -> trigger now\r\n                _this.trigger({ auto: true, shy: false });\r\n            }, this._quickSuggestDelay);\r\n        }\r\n    };\r\n    SuggestModel.prototype._refilterCompletionItems = function () {\r\n        var _this = this;\r\n        // Re-filter suggestions. This MUST run async because filtering/scoring\r\n        // uses the model content AND the cursor position. The latter is NOT\r\n        // updated when the document has changed (the event which drives this method)\r\n        // and therefore a little pause (next mirco task) is needed. See:\r\n        // https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context#25933985\r\n        Promise.resolve().then(function () {\r\n            if (_this._state === 0 /* Idle */) {\r\n                return;\r\n            }\r\n            if (!_this._editor.hasModel()) {\r\n                return;\r\n            }\r\n            var model = _this._editor.getModel();\r\n            var position = _this._editor.getPosition();\r\n            var ctx = new LineContext(model, position, _this._state === 2 /* Auto */, false);\r\n            _this._onNewContext(ctx);\r\n        });\r\n    };\r\n    SuggestModel.prototype.trigger = function (context, retrigger, onlyFrom, existingItems) {\r\n        var _this = this;\r\n        if (retrigger === void 0) { retrigger = false; }\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var auto = context.auto;\r\n        var ctx = new LineContext(model, this._editor.getPosition(), auto, context.shy);\r\n        // Cancel previous requests, change state & update UI\r\n        this.cancel(retrigger);\r\n        this._state = auto ? 2 /* Auto */ : 1 /* Manual */;\r\n        this._onDidTrigger.fire({ auto: auto, shy: context.shy, position: this._editor.getPosition() });\r\n        // Capture context when request was sent\r\n        this._context = ctx;\r\n        // Build context for request\r\n        var suggestCtx;\r\n        if (context.triggerCharacter) {\r\n            suggestCtx = {\r\n                triggerKind: 1 /* TriggerCharacter */,\r\n                triggerCharacter: context.triggerCharacter\r\n            };\r\n        }\r\n        else if (onlyFrom && onlyFrom.size > 0) {\r\n            suggestCtx = { triggerKind: 2 /* TriggerForIncompleteCompletions */ };\r\n        }\r\n        else {\r\n            suggestCtx = { triggerKind: 0 /* Invoke */ };\r\n        }\r\n        this._requestToken = new CancellationTokenSource();\r\n        // kind filter and snippet sort rules\r\n        var snippetSuggestions = this._editor.getOption(86 /* snippetSuggestions */);\r\n        var snippetSortOrder = 1 /* Inline */;\r\n        switch (snippetSuggestions) {\r\n            case 'top':\r\n                snippetSortOrder = 0 /* Top */;\r\n                break;\r\n            // \t↓ that's the default anyways...\r\n            // case 'inline':\r\n            // \tsnippetSortOrder = SnippetSortOrder.Inline;\r\n            // \tbreak;\r\n            case 'bottom':\r\n                snippetSortOrder = 2 /* Bottom */;\r\n                break;\r\n        }\r\n        var itemKindFilter = SuggestModel._createItemKindFilter(this._editor);\r\n        var wordDistance = WordDistance.create(this._editorWorker, this._editor);\r\n        var items = provideSuggestionItems(model, this._editor.getPosition(), new CompletionOptions(snippetSortOrder, itemKindFilter, onlyFrom), suggestCtx, this._requestToken.token);\r\n        Promise.all([items, wordDistance]).then(function (_a) {\r\n            var items = _a[0], wordDistance = _a[1];\r\n            dispose(_this._requestToken);\r\n            if (_this._state === 0 /* Idle */) {\r\n                return;\r\n            }\r\n            if (!_this._editor.hasModel()) {\r\n                return;\r\n            }\r\n            var model = _this._editor.getModel();\r\n            if (isNonEmptyArray(existingItems)) {\r\n                var cmpFn = getSuggestionComparator(snippetSortOrder);\r\n                items = items.concat(existingItems).sort(cmpFn);\r\n            }\r\n            var ctx = new LineContext(model, _this._editor.getPosition(), auto, context.shy);\r\n            _this._completionModel = new CompletionModel(items, _this._context.column, {\r\n                leadingLineContent: ctx.leadingLineContent,\r\n                characterCountDelta: ctx.column - _this._context.column\r\n            }, wordDistance, _this._editor.getOption(89 /* suggest */), _this._editor.getOption(86 /* snippetSuggestions */));\r\n            // store containers so that they can be disposed later\r\n            for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\r\n                var item = items_1[_i];\r\n                if (isDisposable(item.container)) {\r\n                    _this._completionDisposables.add(item.container);\r\n                }\r\n            }\r\n            _this._onNewContext(ctx);\r\n        }).catch(onUnexpectedError);\r\n    };\r\n    SuggestModel._createItemKindFilter = function (editor) {\r\n        // kind filter and snippet sort rules\r\n        var result = new Set();\r\n        // snippet setting\r\n        var snippetSuggestions = editor.getOption(86 /* snippetSuggestions */);\r\n        if (snippetSuggestions === 'none') {\r\n            result.add(25 /* Snippet */);\r\n        }\r\n        // type setting\r\n        var suggestOptions = editor.getOption(89 /* suggest */);\r\n        if (!suggestOptions.showMethods) {\r\n            result.add(0 /* Method */);\r\n        }\r\n        if (!suggestOptions.showFunctions) {\r\n            result.add(1 /* Function */);\r\n        }\r\n        if (!suggestOptions.showConstructors) {\r\n            result.add(2 /* Constructor */);\r\n        }\r\n        if (!suggestOptions.showFields) {\r\n            result.add(3 /* Field */);\r\n        }\r\n        if (!suggestOptions.showVariables) {\r\n            result.add(4 /* Variable */);\r\n        }\r\n        if (!suggestOptions.showClasses) {\r\n            result.add(5 /* Class */);\r\n        }\r\n        if (!suggestOptions.showStructs) {\r\n            result.add(6 /* Struct */);\r\n        }\r\n        if (!suggestOptions.showInterfaces) {\r\n            result.add(7 /* Interface */);\r\n        }\r\n        if (!suggestOptions.showModules) {\r\n            result.add(8 /* Module */);\r\n        }\r\n        if (!suggestOptions.showProperties) {\r\n            result.add(9 /* Property */);\r\n        }\r\n        if (!suggestOptions.showEvents) {\r\n            result.add(10 /* Event */);\r\n        }\r\n        if (!suggestOptions.showOperators) {\r\n            result.add(11 /* Operator */);\r\n        }\r\n        if (!suggestOptions.showUnits) {\r\n            result.add(12 /* Unit */);\r\n        }\r\n        if (!suggestOptions.showValues) {\r\n            result.add(13 /* Value */);\r\n        }\r\n        if (!suggestOptions.showConstants) {\r\n            result.add(14 /* Constant */);\r\n        }\r\n        if (!suggestOptions.showEnums) {\r\n            result.add(15 /* Enum */);\r\n        }\r\n        if (!suggestOptions.showEnumMembers) {\r\n            result.add(16 /* EnumMember */);\r\n        }\r\n        if (!suggestOptions.showKeywords) {\r\n            result.add(17 /* Keyword */);\r\n        }\r\n        if (!suggestOptions.showWords) {\r\n            result.add(18 /* Text */);\r\n        }\r\n        if (!suggestOptions.showColors) {\r\n            result.add(19 /* Color */);\r\n        }\r\n        if (!suggestOptions.showFiles) {\r\n            result.add(20 /* File */);\r\n        }\r\n        if (!suggestOptions.showReferences) {\r\n            result.add(21 /* Reference */);\r\n        }\r\n        if (!suggestOptions.showColors) {\r\n            result.add(22 /* Customcolor */);\r\n        }\r\n        if (!suggestOptions.showFolders) {\r\n            result.add(23 /* Folder */);\r\n        }\r\n        if (!suggestOptions.showTypeParameters) {\r\n            result.add(24 /* TypeParameter */);\r\n        }\r\n        if (!suggestOptions.showSnippets) {\r\n            result.add(25 /* Snippet */);\r\n        }\r\n        return result;\r\n    };\r\n    SuggestModel.prototype._onNewContext = function (ctx) {\r\n        if (!this._context) {\r\n            // happens when 24x7 IntelliSense is enabled and still in its delay\r\n            return;\r\n        }\r\n        if (ctx.lineNumber !== this._context.lineNumber) {\r\n            // e.g. happens when pressing Enter while IntelliSense is computed\r\n            this.cancel();\r\n            return;\r\n        }\r\n        if (ctx.leadingWord.startColumn < this._context.leadingWord.startColumn) {\r\n            // happens when the current word gets outdented\r\n            this.cancel();\r\n            return;\r\n        }\r\n        if (ctx.column < this._context.column) {\r\n            // typed -> moved cursor LEFT -> retrigger if still on a word\r\n            if (ctx.leadingWord.word) {\r\n                this.trigger({ auto: this._context.auto, shy: false }, true);\r\n            }\r\n            else {\r\n                this.cancel();\r\n            }\r\n            return;\r\n        }\r\n        if (!this._completionModel) {\r\n            // happens when IntelliSense is not yet computed\r\n            return;\r\n        }\r\n        if (ctx.column > this._context.column && this._completionModel.incomplete.size > 0 && ctx.leadingWord.word.length !== 0) {\r\n            // typed -> moved cursor RIGHT & incomple model & still on a word -> retrigger\r\n            var incomplete = this._completionModel.incomplete;\r\n            var adopted = this._completionModel.adopt(incomplete);\r\n            this.trigger({ auto: this._state === 2 /* Auto */, shy: false }, true, incomplete, adopted);\r\n        }\r\n        else {\r\n            // typed -> moved cursor RIGHT -> update UI\r\n            var oldLineContext = this._completionModel.lineContext;\r\n            var isFrozen = false;\r\n            this._completionModel.lineContext = {\r\n                leadingLineContent: ctx.leadingLineContent,\r\n                characterCountDelta: ctx.column - this._context.column\r\n            };\r\n            if (this._completionModel.items.length === 0) {\r\n                if (LineContext.shouldAutoTrigger(this._editor) && this._context.leadingWord.endColumn < ctx.leadingWord.startColumn) {\r\n                    // retrigger when heading into a new word\r\n                    this.trigger({ auto: this._context.auto, shy: false }, true);\r\n                    return;\r\n                }\r\n                if (!this._context.auto) {\r\n                    // freeze when IntelliSense was manually requested\r\n                    this._completionModel.lineContext = oldLineContext;\r\n                    isFrozen = this._completionModel.items.length > 0;\r\n                    if (isFrozen && ctx.leadingWord.word.length === 0) {\r\n                        // there were results before but now there aren't\r\n                        // and also we are not on a word anymore -> cancel\r\n                        this.cancel();\r\n                        return;\r\n                    }\r\n                }\r\n                else {\r\n                    // nothing left\r\n                    this.cancel();\r\n                    return;\r\n                }\r\n            }\r\n            this._onDidSuggest.fire({\r\n                completionModel: this._completionModel,\r\n                auto: this._context.auto,\r\n                shy: this._context.shy,\r\n                isFrozen: isFrozen,\r\n            });\r\n        }\r\n    };\r\n    return SuggestModel;\r\n}());\r\nexport { SuggestModel };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport './media/suggest.css';\r\nimport './media/suggestStatusBar.css';\r\nimport '../../../base/browser/ui/codiconLabel/codiconLabel.js'; // The codicon symbol styles are defined here and must be loaded\r\nimport '../documentSymbols/outlineTree.js'; // The codicon symbol colors are defined here and must be loaded\r\nimport * as nls from '../../../nls.js';\r\nimport { createMatches } from '../../../base/common/filters.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { Event, Emitter } from '../../../base/common/event.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { dispose, toDisposable, DisposableStore, Disposable } from '../../../base/common/lifecycle.js';\r\nimport { addClass, append, $, hide, removeClass, show, toggleClass, getDomNodePagePosition, hasClass, addDisposableListener, addStandardDisposableListener, addClasses } from '../../../base/browser/dom.js';\r\nimport { List } from '../../../base/browser/ui/list/listWidget.js';\r\nimport { DomScrollableElement } from '../../../base/browser/ui/scrollbar/scrollableElement.js';\r\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\r\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { Context as SuggestContext } from './suggest.js';\r\nimport { ITelemetryService } from '../../../platform/telemetry/common/telemetry.js';\r\nimport { attachListStyler } from '../../../platform/theme/common/styler.js';\r\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { registerColor, editorWidgetBackground, listFocusBackground, activeContrastBorder, listHighlightForeground, editorForeground, editorWidgetBorder, focusBorder, textLinkForeground, textCodeBlockBackground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { IStorageService } from '../../../platform/storage/common/storage.js';\r\nimport { MarkdownRenderer } from '../markdown/markdownRenderer.js';\r\nimport { IModeService } from '../../common/services/modeService.js';\r\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\r\nimport { TimeoutTimer, createCancelablePromise, disposableTimeout } from '../../../base/common/async.js';\r\nimport { completionKindToCssClass } from '../../common/modes.js';\r\nimport { IconLabel } from '../../../base/browser/ui/iconLabel/iconLabel.js';\r\nimport { getIconClasses } from '../../common/services/getIconClasses.js';\r\nimport { IModelService } from '../../common/services/modelService.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { FileKind } from '../../../platform/files/common/files.js';\r\nimport { MarkdownString } from '../../../base/common/htmlContent.js';\r\nimport { flatten } from '../../../base/common/arrays.js';\r\nimport { Position } from '../../common/core/position.js';\r\nvar expandSuggestionDocsByDefault = false;\r\n/**\r\n * Suggest widget colors\r\n */\r\nexport var editorSuggestWidgetBackground = registerColor('editorSuggestWidget.background', { dark: editorWidgetBackground, light: editorWidgetBackground, hc: editorWidgetBackground }, nls.localize('editorSuggestWidgetBackground', 'Background color of the suggest widget.'));\r\nexport var editorSuggestWidgetBorder = registerColor('editorSuggestWidget.border', { dark: editorWidgetBorder, light: editorWidgetBorder, hc: editorWidgetBorder }, nls.localize('editorSuggestWidgetBorder', 'Border color of the suggest widget.'));\r\nexport var editorSuggestWidgetForeground = registerColor('editorSuggestWidget.foreground', { dark: editorForeground, light: editorForeground, hc: editorForeground }, nls.localize('editorSuggestWidgetForeground', 'Foreground color of the suggest widget.'));\r\nexport var editorSuggestWidgetSelectedBackground = registerColor('editorSuggestWidget.selectedBackground', { dark: listFocusBackground, light: listFocusBackground, hc: listFocusBackground }, nls.localize('editorSuggestWidgetSelectedBackground', 'Background color of the selected entry in the suggest widget.'));\r\nexport var editorSuggestWidgetHighlightForeground = registerColor('editorSuggestWidget.highlightForeground', { dark: listHighlightForeground, light: listHighlightForeground, hc: listHighlightForeground }, nls.localize('editorSuggestWidgetHighlightForeground', 'Color of the match highlights in the suggest widget.'));\r\nvar colorRegExp = /^(#([\\da-f]{3}){1,2}|(rgb|hsl)a\\(\\s*(\\d{1,3}%?\\s*,\\s*){3}(1|0?\\.\\d+)\\)|(rgb|hsl)\\(\\s*\\d{1,3}%?(\\s*,\\s*\\d{1,3}%?){2}\\s*\\))$/i;\r\nfunction extractColor(item, out) {\r\n    var label = typeof item.completion.label === 'string'\r\n        ? item.completion.label\r\n        : item.completion.label.name;\r\n    if (label.match(colorRegExp)) {\r\n        out[0] = label;\r\n        return true;\r\n    }\r\n    if (typeof item.completion.documentation === 'string' && item.completion.documentation.match(colorRegExp)) {\r\n        out[0] = item.completion.documentation;\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\nfunction canExpandCompletionItem(item) {\r\n    if (!item) {\r\n        return false;\r\n    }\r\n    var suggestion = item.completion;\r\n    if (suggestion.documentation) {\r\n        return true;\r\n    }\r\n    return (suggestion.detail && suggestion.detail !== suggestion.label);\r\n}\r\nfunction getAriaId(index) {\r\n    return \"suggest-aria-id:\" + index;\r\n}\r\nvar ItemRenderer = /** @class */ (function () {\r\n    function ItemRenderer(widget, editor, triggerKeybindingLabel, _modelService, _modeService, _themeService) {\r\n        this.widget = widget;\r\n        this.editor = editor;\r\n        this.triggerKeybindingLabel = triggerKeybindingLabel;\r\n        this._modelService = _modelService;\r\n        this._modeService = _modeService;\r\n        this._themeService = _themeService;\r\n    }\r\n    Object.defineProperty(ItemRenderer.prototype, \"templateId\", {\r\n        get: function () {\r\n            return 'suggestion';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ItemRenderer.prototype.renderTemplate = function (container) {\r\n        var _this = this;\r\n        var data = Object.create(null);\r\n        data.disposables = new DisposableStore();\r\n        data.root = container;\r\n        addClass(data.root, 'show-file-icons');\r\n        data.icon = append(container, $('.icon'));\r\n        data.colorspan = append(data.icon, $('span.colorspan'));\r\n        var text = append(container, $('.contents'));\r\n        var main = append(text, $('.main'));\r\n        data.left = append(main, $('span.left'));\r\n        data.right = append(main, $('span.right'));\r\n        data.iconContainer = append(data.left, $('.icon-label.codicon'));\r\n        data.iconLabel = new IconLabel(data.left, { supportHighlights: true, supportCodicons: true });\r\n        data.disposables.add(data.iconLabel);\r\n        data.signatureLabel = append(data.left, $('span.signature-label'));\r\n        data.qualifierLabel = append(data.left, $('span.qualifier-label'));\r\n        data.detailsLabel = append(data.right, $('span.details-label'));\r\n        data.readMore = append(data.right, $('span.readMore.codicon.codicon-info'));\r\n        data.readMore.title = nls.localize('readMore', \"Read More...{0}\", this.triggerKeybindingLabel);\r\n        var configureFont = function () {\r\n            var options = _this.editor.getOptions();\r\n            var fontInfo = options.get(34 /* fontInfo */);\r\n            var fontFamily = fontInfo.fontFamily;\r\n            var fontFeatureSettings = fontInfo.fontFeatureSettings;\r\n            var fontSize = options.get(90 /* suggestFontSize */) || fontInfo.fontSize;\r\n            var lineHeight = options.get(91 /* suggestLineHeight */) || fontInfo.lineHeight;\r\n            var fontWeight = fontInfo.fontWeight;\r\n            var fontSizePx = fontSize + \"px\";\r\n            var lineHeightPx = lineHeight + \"px\";\r\n            data.root.style.fontSize = fontSizePx;\r\n            data.root.style.fontWeight = fontWeight;\r\n            main.style.fontFamily = fontFamily;\r\n            main.style.fontFeatureSettings = fontFeatureSettings;\r\n            main.style.lineHeight = lineHeightPx;\r\n            data.icon.style.height = lineHeightPx;\r\n            data.icon.style.width = lineHeightPx;\r\n            data.readMore.style.height = lineHeightPx;\r\n            data.readMore.style.width = lineHeightPx;\r\n        };\r\n        configureFont();\r\n        data.disposables.add(Event.chain(this.editor.onDidChangeConfiguration.bind(this.editor))\r\n            .filter(function (e) { return e.hasChanged(34 /* fontInfo */) || e.hasChanged(90 /* suggestFontSize */) || e.hasChanged(91 /* suggestLineHeight */); })\r\n            .on(configureFont, null));\r\n        return data;\r\n    };\r\n    ItemRenderer.prototype.renderElement = function (element, index, templateData) {\r\n        var _this = this;\r\n        var data = templateData;\r\n        var suggestion = element.completion;\r\n        var textLabel = typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.name;\r\n        data.root.id = getAriaId(index);\r\n        data.icon.className = 'icon ' + completionKindToCssClass(suggestion.kind);\r\n        data.colorspan.style.backgroundColor = '';\r\n        var labelOptions = {\r\n            labelEscapeNewLines: true,\r\n            matches: createMatches(element.score)\r\n        };\r\n        var color = [];\r\n        if (suggestion.kind === 19 /* Color */ && extractColor(element, color)) {\r\n            // special logic for 'color' completion items\r\n            data.icon.className = 'icon customcolor';\r\n            data.iconContainer.className = 'icon hide';\r\n            data.colorspan.style.backgroundColor = color[0];\r\n        }\r\n        else if (suggestion.kind === 20 /* File */ && this._themeService.getIconTheme().hasFileIcons) {\r\n            // special logic for 'file' completion items\r\n            data.icon.className = 'icon hide';\r\n            data.iconContainer.className = 'icon hide';\r\n            var labelClasses = getIconClasses(this._modelService, this._modeService, URI.from({ scheme: 'fake', path: textLabel }), FileKind.FILE);\r\n            var detailClasses = getIconClasses(this._modelService, this._modeService, URI.from({ scheme: 'fake', path: suggestion.detail }), FileKind.FILE);\r\n            labelOptions.extraClasses = labelClasses.length > detailClasses.length ? labelClasses : detailClasses;\r\n        }\r\n        else if (suggestion.kind === 23 /* Folder */ && this._themeService.getIconTheme().hasFolderIcons) {\r\n            // special logic for 'folder' completion items\r\n            data.icon.className = 'icon hide';\r\n            data.iconContainer.className = 'icon hide';\r\n            labelOptions.extraClasses = flatten([\r\n                getIconClasses(this._modelService, this._modeService, URI.from({ scheme: 'fake', path: textLabel }), FileKind.FOLDER),\r\n                getIconClasses(this._modelService, this._modeService, URI.from({ scheme: 'fake', path: suggestion.detail }), FileKind.FOLDER)\r\n            ]);\r\n        }\r\n        else {\r\n            // normal icon\r\n            data.icon.className = 'icon hide';\r\n            data.iconContainer.className = '';\r\n            addClasses(data.iconContainer, \"suggest-icon codicon codicon-symbol-\" + completionKindToCssClass(suggestion.kind));\r\n        }\r\n        if (suggestion.tags && suggestion.tags.indexOf(1 /* Deprecated */) >= 0) {\r\n            labelOptions.extraClasses = (labelOptions.extraClasses || []).concat(['deprecated']);\r\n            labelOptions.matches = [];\r\n        }\r\n        data.iconLabel.setLabel(textLabel, undefined, labelOptions);\r\n        if (typeof suggestion.label === 'string') {\r\n            data.signatureLabel.textContent = '';\r\n            data.qualifierLabel.textContent = '';\r\n            data.detailsLabel.textContent = (suggestion.detail || '').replace(/\\n.*$/m, '');\r\n            removeClass(data.right, 'always-show-details');\r\n        }\r\n        else {\r\n            data.signatureLabel.textContent = (suggestion.label.signature || '').replace(/\\n.*$/m, '');\r\n            data.qualifierLabel.textContent = (suggestion.label.qualifier || '').replace(/\\n.*$/m, '');\r\n            data.detailsLabel.textContent = (suggestion.label.type || '').replace(/\\n.*$/m, '');\r\n            addClass(data.right, 'always-show-details');\r\n        }\r\n        if (canExpandCompletionItem(element)) {\r\n            addClass(data.right, 'can-expand-details');\r\n            show(data.readMore);\r\n            data.readMore.onmousedown = function (e) {\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n            };\r\n            data.readMore.onclick = function (e) {\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n                _this.widget.toggleDetails();\r\n            };\r\n        }\r\n        else {\r\n            removeClass(data.right, 'can-expand-details');\r\n            hide(data.readMore);\r\n            data.readMore.onmousedown = null;\r\n            data.readMore.onclick = null;\r\n        }\r\n    };\r\n    ItemRenderer.prototype.disposeTemplate = function (templateData) {\r\n        templateData.disposables.dispose();\r\n    };\r\n    ItemRenderer = __decorate([\r\n        __param(3, IModelService),\r\n        __param(4, IModeService),\r\n        __param(5, IThemeService)\r\n    ], ItemRenderer);\r\n    return ItemRenderer;\r\n}());\r\nvar SuggestionDetails = /** @class */ (function () {\r\n    function SuggestionDetails(container, widget, editor, markdownRenderer, kbToggleDetails) {\r\n        var _this = this;\r\n        this.widget = widget;\r\n        this.editor = editor;\r\n        this.markdownRenderer = markdownRenderer;\r\n        this.kbToggleDetails = kbToggleDetails;\r\n        this.borderWidth = 1;\r\n        this.disposables = new DisposableStore();\r\n        this.el = append(container, $('.details'));\r\n        this.disposables.add(toDisposable(function () { return container.removeChild(_this.el); }));\r\n        this.body = $('.body');\r\n        this.scrollbar = new DomScrollableElement(this.body, {});\r\n        append(this.el, this.scrollbar.getDomNode());\r\n        this.disposables.add(this.scrollbar);\r\n        this.header = append(this.body, $('.header'));\r\n        this.close = append(this.header, $('span.codicon.codicon-close'));\r\n        this.close.title = nls.localize('readLess', \"Read less...{0}\", this.kbToggleDetails);\r\n        this.type = append(this.header, $('p.type'));\r\n        this.docs = append(this.body, $('p.docs'));\r\n        this.configureFont();\r\n        Event.chain(this.editor.onDidChangeConfiguration.bind(this.editor))\r\n            .filter(function (e) { return e.hasChanged(34 /* fontInfo */); })\r\n            .on(this.configureFont, this, this.disposables);\r\n        markdownRenderer.onDidRenderCodeBlock(function () { return _this.scrollbar.scanDomNode(); }, this, this.disposables);\r\n    }\r\n    Object.defineProperty(SuggestionDetails.prototype, \"element\", {\r\n        get: function () {\r\n            return this.el;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SuggestionDetails.prototype.renderLoading = function () {\r\n        this.type.textContent = nls.localize('loading', \"Loading...\");\r\n        this.docs.textContent = '';\r\n    };\r\n    SuggestionDetails.prototype.renderItem = function (item, explainMode) {\r\n        var _this = this;\r\n        this.renderDisposeable = dispose(this.renderDisposeable);\r\n        var _a = item.completion, documentation = _a.documentation, detail = _a.detail;\r\n        // --- documentation\r\n        if (explainMode) {\r\n            var md = '';\r\n            md += \"score: \" + item.score[0] + (item.word ? \", compared '\" + (item.completion.filterText && (item.completion.filterText + ' (filterText)') || item.completion.label) + \"' with '\" + item.word + \"'\" : ' (no prefix)') + \"\\n\";\r\n            md += \"distance: \" + item.distance + \", see localityBonus-setting\\n\";\r\n            md += \"index: \" + item.idx + \", based on \" + (item.completion.sortText && \"sortText: \\\"\" + item.completion.sortText + \"\\\"\" || 'label') + \"\\n\";\r\n            documentation = new MarkdownString().appendCodeblock('empty', md);\r\n            detail = \"Provider: \" + item.provider._debugDisplayName;\r\n        }\r\n        if (!explainMode && !canExpandCompletionItem(item)) {\r\n            this.type.textContent = '';\r\n            this.docs.textContent = '';\r\n            addClass(this.el, 'no-docs');\r\n            return;\r\n        }\r\n        removeClass(this.el, 'no-docs');\r\n        if (typeof documentation === 'string') {\r\n            removeClass(this.docs, 'markdown-docs');\r\n            this.docs.textContent = documentation;\r\n        }\r\n        else {\r\n            addClass(this.docs, 'markdown-docs');\r\n            this.docs.innerHTML = '';\r\n            var renderedContents = this.markdownRenderer.render(documentation);\r\n            this.renderDisposeable = renderedContents;\r\n            this.docs.appendChild(renderedContents.element);\r\n        }\r\n        // --- details\r\n        if (detail) {\r\n            this.type.innerText = detail;\r\n            show(this.type);\r\n        }\r\n        else {\r\n            this.type.innerText = '';\r\n            hide(this.type);\r\n        }\r\n        this.el.style.height = this.header.offsetHeight + this.docs.offsetHeight + (this.borderWidth * 2) + 'px';\r\n        this.el.style.userSelect = 'text';\r\n        this.el.tabIndex = -1;\r\n        this.close.onmousedown = function (e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        };\r\n        this.close.onclick = function (e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            _this.widget.toggleDetails();\r\n        };\r\n        this.body.scrollTop = 0;\r\n        this.scrollbar.scanDomNode();\r\n    };\r\n    SuggestionDetails.prototype.scrollDown = function (much) {\r\n        if (much === void 0) { much = 8; }\r\n        this.body.scrollTop += much;\r\n    };\r\n    SuggestionDetails.prototype.scrollUp = function (much) {\r\n        if (much === void 0) { much = 8; }\r\n        this.body.scrollTop -= much;\r\n    };\r\n    SuggestionDetails.prototype.scrollTop = function () {\r\n        this.body.scrollTop = 0;\r\n    };\r\n    SuggestionDetails.prototype.scrollBottom = function () {\r\n        this.body.scrollTop = this.body.scrollHeight;\r\n    };\r\n    SuggestionDetails.prototype.pageDown = function () {\r\n        this.scrollDown(80);\r\n    };\r\n    SuggestionDetails.prototype.pageUp = function () {\r\n        this.scrollUp(80);\r\n    };\r\n    SuggestionDetails.prototype.setBorderWidth = function (width) {\r\n        this.borderWidth = width;\r\n    };\r\n    SuggestionDetails.prototype.configureFont = function () {\r\n        var options = this.editor.getOptions();\r\n        var fontInfo = options.get(34 /* fontInfo */);\r\n        var fontFamily = fontInfo.fontFamily;\r\n        var fontSize = options.get(90 /* suggestFontSize */) || fontInfo.fontSize;\r\n        var lineHeight = options.get(91 /* suggestLineHeight */) || fontInfo.lineHeight;\r\n        var fontWeight = fontInfo.fontWeight;\r\n        var fontSizePx = fontSize + \"px\";\r\n        var lineHeightPx = lineHeight + \"px\";\r\n        this.el.style.fontSize = fontSizePx;\r\n        this.el.style.fontWeight = fontWeight;\r\n        this.el.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\r\n        this.type.style.fontFamily = fontFamily;\r\n        this.close.style.height = lineHeightPx;\r\n        this.close.style.width = lineHeightPx;\r\n    };\r\n    SuggestionDetails.prototype.dispose = function () {\r\n        this.disposables.dispose();\r\n        this.renderDisposeable = dispose(this.renderDisposeable);\r\n    };\r\n    return SuggestionDetails;\r\n}());\r\nvar SuggestWidget = /** @class */ (function () {\r\n    function SuggestWidget(editor, telemetryService, keybindingService, contextKeyService, themeService, storageService, modeService, openerService, instantiationService) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        this.editor = editor;\r\n        this.telemetryService = telemetryService;\r\n        this.keybindingService = keybindingService;\r\n        // Editor.IContentWidget.allowEditorOverflow\r\n        this.allowEditorOverflow = true;\r\n        this.suppressMouseDown = false;\r\n        this.state = null;\r\n        this.isAuto = false;\r\n        this.loadingTimeout = Disposable.None;\r\n        this.currentSuggestionDetails = null;\r\n        this.ignoreFocusEvents = false;\r\n        this.completionModel = null;\r\n        this.showTimeout = new TimeoutTimer();\r\n        this.toDispose = new DisposableStore();\r\n        this.onDidSelectEmitter = new Emitter();\r\n        this.onDidFocusEmitter = new Emitter();\r\n        this.onDidHideEmitter = new Emitter();\r\n        this.onDidShowEmitter = new Emitter();\r\n        this.onDidSelect = this.onDidSelectEmitter.event;\r\n        this.onDidFocus = this.onDidFocusEmitter.event;\r\n        this.onDidHide = this.onDidHideEmitter.event;\r\n        this.onDidShow = this.onDidShowEmitter.event;\r\n        this.maxWidgetWidth = 660;\r\n        this.listWidth = 330;\r\n        this.firstFocusInCurrentList = false;\r\n        this.preferDocPositionTop = false;\r\n        this.docsPositionPreviousWidgetY = null;\r\n        this.explainMode = false;\r\n        this._onDetailsKeydown = new Emitter();\r\n        this.onDetailsKeyDown = this._onDetailsKeydown.event;\r\n        var markdownRenderer = this.toDispose.add(new MarkdownRenderer(editor, modeService, openerService));\r\n        var kbToggleDetails = (_b = (_a = keybindingService.lookupKeybinding('toggleSuggestionDetails')) === null || _a === void 0 ? void 0 : _a.getLabel()) !== null && _b !== void 0 ? _b : '';\r\n        this.msgDetailsLess = nls.localize('detail.less', \"{0} for less...\", kbToggleDetails);\r\n        this.msgDetailMore = nls.localize('detail.more', \"{0} for more...\", kbToggleDetails);\r\n        this.isAuto = false;\r\n        this.focusedItem = null;\r\n        this.storageService = storageService;\r\n        this.element = $('.editor-widget.suggest-widget');\r\n        this.toDispose.add(addDisposableListener(this.element, 'click', function (e) {\r\n            if (e.target === _this.element) {\r\n                _this.hideWidget();\r\n            }\r\n        }));\r\n        this.messageElement = append(this.element, $('.message'));\r\n        this.listElement = append(this.element, $('.tree'));\r\n        var applyStatusBarStyle = function () { return toggleClass(_this.element, 'with-status-bar', !_this.editor.getOption(89 /* suggest */).hideStatusBar); };\r\n        applyStatusBarStyle();\r\n        this.statusBarElement = append(this.element, $('.suggest-status-bar'));\r\n        this.statusBarLeftSpan = append(this.statusBarElement, $('span'));\r\n        this.statusBarRightSpan = append(this.statusBarElement, $('span'));\r\n        this.setStatusBarLeftText('');\r\n        this.setStatusBarRightText('');\r\n        this.details = instantiationService.createInstance(SuggestionDetails, this.element, this, this.editor, markdownRenderer, kbToggleDetails);\r\n        var applyIconStyle = function () { return toggleClass(_this.element, 'no-icons', !_this.editor.getOption(89 /* suggest */).showIcons); };\r\n        applyIconStyle();\r\n        var renderer = instantiationService.createInstance(ItemRenderer, this, this.editor, kbToggleDetails);\r\n        this.list = new List('SuggestWidget', this.listElement, this, [renderer], {\r\n            useShadows: false,\r\n            openController: { shouldOpen: function () { return false; } },\r\n            mouseSupport: false,\r\n            accessibilityProvider: {\r\n                getAriaLabel: function (item) {\r\n                    var textLabel = typeof item.completion.label === 'string' ? item.completion.label : item.completion.label.name;\r\n                    if (item.isResolved && _this.expandDocsSettingFromStorage()) {\r\n                        var _a = item.completion, documentation = _a.documentation, detail = _a.detail;\r\n                        var docs = strings.format('{0}{1}', detail || '', documentation ? (typeof documentation === 'string' ? documentation : documentation.value) : '');\r\n                        return nls.localize('ariaCurrenttSuggestionReadDetails', \"Item {0}, docs: {1}\", textLabel, docs);\r\n                    }\r\n                    else {\r\n                        return textLabel;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        this.toDispose.add(attachListStyler(this.list, themeService, {\r\n            listInactiveFocusBackground: editorSuggestWidgetSelectedBackground,\r\n            listInactiveFocusOutline: activeContrastBorder\r\n        }));\r\n        this.toDispose.add(themeService.onThemeChange(function (t) { return _this.onThemeChange(t); }));\r\n        this.toDispose.add(editor.onDidLayoutChange(function () { return _this.onEditorLayoutChange(); }));\r\n        this.toDispose.add(this.list.onMouseDown(function (e) { return _this.onListMouseDownOrTap(e); }));\r\n        this.toDispose.add(this.list.onTap(function (e) { return _this.onListMouseDownOrTap(e); }));\r\n        this.toDispose.add(this.list.onSelectionChange(function (e) { return _this.onListSelection(e); }));\r\n        this.toDispose.add(this.list.onFocusChange(function (e) { return _this.onListFocus(e); }));\r\n        this.toDispose.add(this.editor.onDidChangeCursorSelection(function () { return _this.onCursorSelectionChanged(); }));\r\n        this.toDispose.add(this.editor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(89 /* suggest */)) {\r\n                applyStatusBarStyle();\r\n                applyIconStyle();\r\n            }\r\n        }));\r\n        this.suggestWidgetVisible = SuggestContext.Visible.bindTo(contextKeyService);\r\n        this.suggestWidgetMultipleSuggestions = SuggestContext.MultipleSuggestions.bindTo(contextKeyService);\r\n        this.editor.addContentWidget(this);\r\n        this.setState(0 /* Hidden */);\r\n        this.onThemeChange(themeService.getTheme());\r\n        this.toDispose.add(addStandardDisposableListener(this.details.element, 'keydown', function (e) {\r\n            _this._onDetailsKeydown.fire(e);\r\n        }));\r\n        this.toDispose.add(this.editor.onMouseDown(function (e) { return _this.onEditorMouseDown(e); }));\r\n    }\r\n    SuggestWidget.prototype.onEditorMouseDown = function (mouseEvent) {\r\n        // Clicking inside details\r\n        if (this.details.element.contains(mouseEvent.target.element)) {\r\n            this.details.element.focus();\r\n        }\r\n        // Clicking outside details and inside suggest\r\n        else {\r\n            if (this.element.contains(mouseEvent.target.element)) {\r\n                this.editor.focus();\r\n            }\r\n        }\r\n    };\r\n    SuggestWidget.prototype.onCursorSelectionChanged = function () {\r\n        if (this.state === 0 /* Hidden */) {\r\n            return;\r\n        }\r\n        this.editor.layoutContentWidget(this);\r\n    };\r\n    SuggestWidget.prototype.onEditorLayoutChange = function () {\r\n        if ((this.state === 3 /* Open */ || this.state === 5 /* Details */) && this.expandDocsSettingFromStorage()) {\r\n            this.expandSideOrBelow();\r\n        }\r\n    };\r\n    SuggestWidget.prototype.onListMouseDownOrTap = function (e) {\r\n        if (typeof e.element === 'undefined' || typeof e.index === 'undefined') {\r\n            return;\r\n        }\r\n        // prevent stealing browser focus from the editor\r\n        e.browserEvent.preventDefault();\r\n        e.browserEvent.stopPropagation();\r\n        this.select(e.element, e.index);\r\n    };\r\n    SuggestWidget.prototype.onListSelection = function (e) {\r\n        if (!e.elements.length) {\r\n            return;\r\n        }\r\n        this.select(e.elements[0], e.indexes[0]);\r\n    };\r\n    SuggestWidget.prototype.select = function (item, index) {\r\n        var completionModel = this.completionModel;\r\n        if (!completionModel) {\r\n            return;\r\n        }\r\n        this.onDidSelectEmitter.fire({ item: item, index: index, model: completionModel });\r\n        this.editor.focus();\r\n    };\r\n    SuggestWidget.prototype.onThemeChange = function (theme) {\r\n        var backgroundColor = theme.getColor(editorSuggestWidgetBackground);\r\n        if (backgroundColor) {\r\n            this.listElement.style.backgroundColor = backgroundColor.toString();\r\n            this.statusBarElement.style.backgroundColor = backgroundColor.toString();\r\n            this.details.element.style.backgroundColor = backgroundColor.toString();\r\n            this.messageElement.style.backgroundColor = backgroundColor.toString();\r\n        }\r\n        var borderColor = theme.getColor(editorSuggestWidgetBorder);\r\n        if (borderColor) {\r\n            this.listElement.style.borderColor = borderColor.toString();\r\n            this.statusBarElement.style.borderColor = borderColor.toString();\r\n            this.details.element.style.borderColor = borderColor.toString();\r\n            this.messageElement.style.borderColor = borderColor.toString();\r\n            this.detailsBorderColor = borderColor.toString();\r\n        }\r\n        var focusBorderColor = theme.getColor(focusBorder);\r\n        if (focusBorderColor) {\r\n            this.detailsFocusBorderColor = focusBorderColor.toString();\r\n        }\r\n        this.details.setBorderWidth(theme.type === 'hc' ? 2 : 1);\r\n    };\r\n    SuggestWidget.prototype.onListFocus = function (e) {\r\n        var _this = this;\r\n        var _a, _b;\r\n        if (this.ignoreFocusEvents) {\r\n            return;\r\n        }\r\n        if (!e.elements.length) {\r\n            if (this.currentSuggestionDetails) {\r\n                this.currentSuggestionDetails.cancel();\r\n                this.currentSuggestionDetails = null;\r\n                this.focusedItem = null;\r\n            }\r\n            this.editor.setAriaOptions({ activeDescendant: undefined });\r\n            return;\r\n        }\r\n        if (!this.completionModel) {\r\n            return;\r\n        }\r\n        var item = e.elements[0];\r\n        var index = e.indexes[0];\r\n        this.firstFocusInCurrentList = !this.focusedItem;\r\n        if (item !== this.focusedItem) {\r\n            // update statusbar\r\n            // todo@joh,pine -> this should a toolbar with actions so that these things become\r\n            // mouse clickable and fit for accessibility...\r\n            var wantsInsert = this.editor.getOption(89 /* suggest */).insertMode === 'insert';\r\n            var kbAccept = (_a = this.keybindingService.lookupKeybinding('acceptSelectedSuggestion')) === null || _a === void 0 ? void 0 : _a.getLabel();\r\n            var kbAcceptAlt = (_b = this.keybindingService.lookupKeybinding('acceptAlternativeSelectedSuggestion')) === null || _b === void 0 ? void 0 : _b.getLabel();\r\n            if (!Position.equals(item.editInsertEnd, item.editReplaceEnd)) {\r\n                // insert AND replace\r\n                if (wantsInsert) {\r\n                    this.setStatusBarLeftText(nls.localize('insert', \"{0} to insert, {1} to replace\", kbAccept, kbAcceptAlt));\r\n                }\r\n                else {\r\n                    this.setStatusBarLeftText(nls.localize('replace', \"{0} to replace, {1} to insert\", kbAccept, kbAcceptAlt));\r\n                }\r\n            }\r\n            else {\r\n                this.setStatusBarLeftText(nls.localize('accept', \"{0} to accept\", kbAccept));\r\n            }\r\n            if (this.currentSuggestionDetails) {\r\n                this.currentSuggestionDetails.cancel();\r\n                this.currentSuggestionDetails = null;\r\n            }\r\n            this.focusedItem = item;\r\n            this.list.reveal(index);\r\n            this.currentSuggestionDetails = createCancelablePromise(function (token) { return __awaiter(_this, void 0, void 0, function () {\r\n                var loading, result;\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            loading = disposableTimeout(function () { return _this.showDetails(true); }, 250);\r\n                            token.onCancellationRequested(function () { return loading.dispose(); });\r\n                            return [4 /*yield*/, item.resolve(token)];\r\n                        case 1:\r\n                            result = _a.sent();\r\n                            loading.dispose();\r\n                            return [2 /*return*/, result];\r\n                    }\r\n                });\r\n            }); });\r\n            this.currentSuggestionDetails.then(function () {\r\n                if (index >= _this.list.length || item !== _this.list.element(index)) {\r\n                    return;\r\n                }\r\n                // item can have extra information, so re-render\r\n                _this.ignoreFocusEvents = true;\r\n                _this.list.splice(index, 1, [item]);\r\n                _this.list.setFocus([index]);\r\n                _this.ignoreFocusEvents = false;\r\n                if (_this.expandDocsSettingFromStorage()) {\r\n                    _this.showDetails(false);\r\n                }\r\n                else {\r\n                    removeClass(_this.element, 'docs-side');\r\n                }\r\n                if (canExpandCompletionItem(_this.focusedItem)) {\r\n                    if (_this.expandDocsSettingFromStorage()) {\r\n                        _this.setStatusBarRightText(_this.msgDetailsLess);\r\n                    }\r\n                    else {\r\n                        _this.setStatusBarRightText(_this.msgDetailMore);\r\n                    }\r\n                }\r\n                else {\r\n                    _this.statusBarRightSpan.innerText = '';\r\n                }\r\n                _this.editor.setAriaOptions({ activeDescendant: getAriaId(index) });\r\n            }).catch(onUnexpectedError);\r\n        }\r\n        // emit an event\r\n        this.onDidFocusEmitter.fire({ item: item, index: index, model: this.completionModel });\r\n    };\r\n    SuggestWidget.prototype.setState = function (state) {\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        var stateChanged = this.state !== state;\r\n        this.state = state;\r\n        toggleClass(this.element, 'frozen', state === 4 /* Frozen */);\r\n        switch (state) {\r\n            case 0 /* Hidden */:\r\n                hide(this.messageElement, this.details.element, this.listElement, this.statusBarElement);\r\n                this.hide();\r\n                this.listHeight = 0;\r\n                if (stateChanged) {\r\n                    this.list.splice(0, this.list.length);\r\n                }\r\n                this.focusedItem = null;\r\n                break;\r\n            case 1 /* Loading */:\r\n                this.messageElement.textContent = SuggestWidget.LOADING_MESSAGE;\r\n                hide(this.listElement, this.details.element, this.statusBarElement);\r\n                show(this.messageElement);\r\n                removeClass(this.element, 'docs-side');\r\n                this.show();\r\n                this.focusedItem = null;\r\n                break;\r\n            case 2 /* Empty */:\r\n                this.messageElement.textContent = SuggestWidget.NO_SUGGESTIONS_MESSAGE;\r\n                hide(this.listElement, this.details.element, this.statusBarElement);\r\n                show(this.messageElement);\r\n                removeClass(this.element, 'docs-side');\r\n                this.show();\r\n                this.focusedItem = null;\r\n                break;\r\n            case 3 /* Open */:\r\n                hide(this.messageElement);\r\n                show(this.listElement, this.statusBarElement);\r\n                this.show();\r\n                break;\r\n            case 4 /* Frozen */:\r\n                hide(this.messageElement);\r\n                show(this.listElement);\r\n                this.show();\r\n                break;\r\n            case 5 /* Details */:\r\n                hide(this.messageElement);\r\n                show(this.details.element, this.listElement, this.statusBarElement);\r\n                this.show();\r\n                break;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.showTriggered = function (auto, delay) {\r\n        var _this = this;\r\n        if (this.state !== 0 /* Hidden */) {\r\n            return;\r\n        }\r\n        this.isAuto = !!auto;\r\n        if (!this.isAuto) {\r\n            this.loadingTimeout = disposableTimeout(function () { return _this.setState(1 /* Loading */); }, delay);\r\n        }\r\n    };\r\n    SuggestWidget.prototype.showSuggestions = function (completionModel, selectionIndex, isFrozen, isAuto) {\r\n        this.preferDocPositionTop = false;\r\n        this.docsPositionPreviousWidgetY = null;\r\n        this.loadingTimeout.dispose();\r\n        if (this.currentSuggestionDetails) {\r\n            this.currentSuggestionDetails.cancel();\r\n            this.currentSuggestionDetails = null;\r\n        }\r\n        if (this.completionModel !== completionModel) {\r\n            this.completionModel = completionModel;\r\n        }\r\n        if (isFrozen && this.state !== 2 /* Empty */ && this.state !== 0 /* Hidden */) {\r\n            this.setState(4 /* Frozen */);\r\n            return;\r\n        }\r\n        var visibleCount = this.completionModel.items.length;\r\n        var isEmpty = visibleCount === 0;\r\n        this.suggestWidgetMultipleSuggestions.set(visibleCount > 1);\r\n        if (isEmpty) {\r\n            if (isAuto) {\r\n                this.setState(0 /* Hidden */);\r\n            }\r\n            else {\r\n                this.setState(2 /* Empty */);\r\n            }\r\n            this.completionModel = null;\r\n        }\r\n        else {\r\n            if (this.state !== 3 /* Open */) {\r\n                var stats = this.completionModel.stats;\r\n                stats['wasAutomaticallyTriggered'] = !!isAuto;\r\n                /* __GDPR__\r\n                    \"suggestWidget\" : {\r\n                        \"wasAutomaticallyTriggered\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\r\n                        \"${include}\": [\r\n                            \"${ICompletionStats}\"\r\n                        ]\r\n                    }\r\n                */\r\n                this.telemetryService.publicLog('suggestWidget', __assign({}, stats));\r\n            }\r\n            this.focusedItem = null;\r\n            this.list.splice(0, this.list.length, this.completionModel.items);\r\n            if (isFrozen) {\r\n                this.setState(4 /* Frozen */);\r\n            }\r\n            else {\r\n                this.setState(3 /* Open */);\r\n            }\r\n            this.list.reveal(selectionIndex, 0);\r\n            this.list.setFocus([selectionIndex]);\r\n            // Reset focus border\r\n            if (this.detailsBorderColor) {\r\n                this.details.element.style.borderColor = this.detailsBorderColor;\r\n            }\r\n        }\r\n    };\r\n    SuggestWidget.prototype.selectNextPage = function () {\r\n        switch (this.state) {\r\n            case 0 /* Hidden */:\r\n                return false;\r\n            case 5 /* Details */:\r\n                this.details.pageDown();\r\n                return true;\r\n            case 1 /* Loading */:\r\n                return !this.isAuto;\r\n            default:\r\n                this.list.focusNextPage();\r\n                return true;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.selectNext = function () {\r\n        switch (this.state) {\r\n            case 0 /* Hidden */:\r\n                return false;\r\n            case 1 /* Loading */:\r\n                return !this.isAuto;\r\n            default:\r\n                this.list.focusNext(1, true);\r\n                return true;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.selectLast = function () {\r\n        switch (this.state) {\r\n            case 0 /* Hidden */:\r\n                return false;\r\n            case 5 /* Details */:\r\n                this.details.scrollBottom();\r\n                return true;\r\n            case 1 /* Loading */:\r\n                return !this.isAuto;\r\n            default:\r\n                this.list.focusLast();\r\n                return true;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.selectPreviousPage = function () {\r\n        switch (this.state) {\r\n            case 0 /* Hidden */:\r\n                return false;\r\n            case 5 /* Details */:\r\n                this.details.pageUp();\r\n                return true;\r\n            case 1 /* Loading */:\r\n                return !this.isAuto;\r\n            default:\r\n                this.list.focusPreviousPage();\r\n                return true;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.selectPrevious = function () {\r\n        switch (this.state) {\r\n            case 0 /* Hidden */:\r\n                return false;\r\n            case 1 /* Loading */:\r\n                return !this.isAuto;\r\n            default:\r\n                this.list.focusPrevious(1, true);\r\n                return false;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.selectFirst = function () {\r\n        switch (this.state) {\r\n            case 0 /* Hidden */:\r\n                return false;\r\n            case 5 /* Details */:\r\n                this.details.scrollTop();\r\n                return true;\r\n            case 1 /* Loading */:\r\n                return !this.isAuto;\r\n            default:\r\n                this.list.focusFirst();\r\n                return true;\r\n        }\r\n    };\r\n    SuggestWidget.prototype.getFocusedItem = function () {\r\n        if (this.state !== 0 /* Hidden */\r\n            && this.state !== 2 /* Empty */\r\n            && this.state !== 1 /* Loading */\r\n            && this.completionModel) {\r\n            return {\r\n                item: this.list.getFocusedElements()[0],\r\n                index: this.list.getFocus()[0],\r\n                model: this.completionModel\r\n            };\r\n        }\r\n        return undefined;\r\n    };\r\n    SuggestWidget.prototype.toggleDetailsFocus = function () {\r\n        if (this.state === 5 /* Details */) {\r\n            this.setState(3 /* Open */);\r\n            if (this.detailsBorderColor) {\r\n                this.details.element.style.borderColor = this.detailsBorderColor;\r\n            }\r\n        }\r\n        else if (this.state === 3 /* Open */ && this.expandDocsSettingFromStorage()) {\r\n            this.setState(5 /* Details */);\r\n            if (this.detailsFocusBorderColor) {\r\n                this.details.element.style.borderColor = this.detailsFocusBorderColor;\r\n            }\r\n        }\r\n        this.telemetryService.publicLog2('suggestWidget:toggleDetailsFocus');\r\n    };\r\n    SuggestWidget.prototype.toggleDetails = function () {\r\n        if (!canExpandCompletionItem(this.list.getFocusedElements()[0])) {\r\n            return;\r\n        }\r\n        if (this.expandDocsSettingFromStorage()) {\r\n            this.updateExpandDocsSetting(false);\r\n            hide(this.details.element);\r\n            removeClass(this.element, 'docs-side');\r\n            removeClass(this.element, 'docs-below');\r\n            this.editor.layoutContentWidget(this);\r\n            this.setStatusBarRightText(this.msgDetailMore);\r\n            this.telemetryService.publicLog2('suggestWidget:collapseDetails');\r\n        }\r\n        else {\r\n            if (this.state !== 3 /* Open */ && this.state !== 5 /* Details */ && this.state !== 4 /* Frozen */) {\r\n                return;\r\n            }\r\n            this.updateExpandDocsSetting(true);\r\n            this.showDetails(false);\r\n            this.setStatusBarRightText(this.msgDetailsLess);\r\n            this.telemetryService.publicLog2('suggestWidget:expandDetails');\r\n        }\r\n    };\r\n    SuggestWidget.prototype.showDetails = function (loading) {\r\n        if (!loading) {\r\n            // When loading, don't re-layout docs, as item is not resolved yet #88731\r\n            this.expandSideOrBelow();\r\n        }\r\n        show(this.details.element);\r\n        this.details.element.style.maxHeight = this.maxWidgetHeight + 'px';\r\n        if (loading) {\r\n            this.details.renderLoading();\r\n        }\r\n        else {\r\n            this.details.renderItem(this.list.getFocusedElements()[0], this.explainMode);\r\n        }\r\n        // Reset margin-top that was set as Fix for #26416\r\n        this.listElement.style.marginTop = '0px';\r\n        // with docs showing up widget width/height may change, so reposition the widget\r\n        this.editor.layoutContentWidget(this);\r\n        this.adjustDocsPosition();\r\n        this.editor.focus();\r\n    };\r\n    SuggestWidget.prototype.toggleExplainMode = function () {\r\n        if (this.list.getFocusedElements()[0] && this.expandDocsSettingFromStorage()) {\r\n            this.explainMode = !this.explainMode;\r\n            this.showDetails(false);\r\n        }\r\n    };\r\n    SuggestWidget.prototype.show = function () {\r\n        var _this = this;\r\n        var newHeight = this.updateListHeight();\r\n        if (newHeight !== this.listHeight) {\r\n            this.editor.layoutContentWidget(this);\r\n            this.listHeight = newHeight;\r\n        }\r\n        this.suggestWidgetVisible.set(true);\r\n        this.showTimeout.cancelAndSet(function () {\r\n            addClass(_this.element, 'visible');\r\n            _this.onDidShowEmitter.fire(_this);\r\n        }, 100);\r\n    };\r\n    SuggestWidget.prototype.hide = function () {\r\n        this.suggestWidgetVisible.reset();\r\n        this.suggestWidgetMultipleSuggestions.reset();\r\n        removeClass(this.element, 'visible');\r\n    };\r\n    SuggestWidget.prototype.hideWidget = function () {\r\n        this.loadingTimeout.dispose();\r\n        this.setState(0 /* Hidden */);\r\n        this.onDidHideEmitter.fire(this);\r\n    };\r\n    SuggestWidget.prototype.getPosition = function () {\r\n        if (this.state === 0 /* Hidden */) {\r\n            return null;\r\n        }\r\n        var preference = [2 /* BELOW */, 1 /* ABOVE */];\r\n        if (this.preferDocPositionTop) {\r\n            preference = [1 /* ABOVE */];\r\n        }\r\n        return {\r\n            position: this.editor.getPosition(),\r\n            preference: preference\r\n        };\r\n    };\r\n    SuggestWidget.prototype.getDomNode = function () {\r\n        return this.element;\r\n    };\r\n    SuggestWidget.prototype.getId = function () {\r\n        return SuggestWidget.ID;\r\n    };\r\n    SuggestWidget.prototype.isFrozen = function () {\r\n        return this.state === 4 /* Frozen */;\r\n    };\r\n    SuggestWidget.prototype.updateListHeight = function () {\r\n        var height = 0;\r\n        if (this.state === 2 /* Empty */ || this.state === 1 /* Loading */) {\r\n            height = this.unfocusedHeight;\r\n        }\r\n        else {\r\n            var suggestionCount = this.list.contentHeight / this.unfocusedHeight;\r\n            var maxVisibleSuggestions = this.editor.getOption(89 /* suggest */).maxVisibleSuggestions;\r\n            height = Math.min(suggestionCount, maxVisibleSuggestions) * this.unfocusedHeight;\r\n        }\r\n        this.element.style.lineHeight = this.unfocusedHeight + \"px\";\r\n        this.listElement.style.height = height + \"px\";\r\n        this.statusBarElement.style.top = height + \"px\";\r\n        this.list.layout(height);\r\n        return height;\r\n    };\r\n    /**\r\n     * Adds the propert classes, margins when positioning the docs to the side\r\n     */\r\n    SuggestWidget.prototype.adjustDocsPosition = function () {\r\n        if (!this.editor.hasModel()) {\r\n            return;\r\n        }\r\n        var lineHeight = this.editor.getOption(49 /* lineHeight */);\r\n        var cursorCoords = this.editor.getScrolledVisiblePosition(this.editor.getPosition());\r\n        var editorCoords = getDomNodePagePosition(this.editor.getDomNode());\r\n        var cursorX = editorCoords.left + cursorCoords.left;\r\n        var cursorY = editorCoords.top + cursorCoords.top + cursorCoords.height;\r\n        var widgetCoords = getDomNodePagePosition(this.element);\r\n        var widgetX = widgetCoords.left;\r\n        var widgetY = widgetCoords.top;\r\n        // Fixes #27649\r\n        // Check if the Y changed to the top of the cursor and keep the widget flagged to prefer top\r\n        if (this.docsPositionPreviousWidgetY &&\r\n            this.docsPositionPreviousWidgetY < widgetY &&\r\n            !this.preferDocPositionTop) {\r\n            this.preferDocPositionTop = true;\r\n            this.adjustDocsPosition();\r\n            return;\r\n        }\r\n        this.docsPositionPreviousWidgetY = widgetY;\r\n        if (widgetX < cursorX - this.listWidth) {\r\n            // Widget is too far to the left of cursor, swap list and docs\r\n            addClass(this.element, 'list-right');\r\n        }\r\n        else {\r\n            removeClass(this.element, 'list-right');\r\n        }\r\n        // Compare top of the cursor (cursorY - lineheight) with widgetTop to determine if\r\n        // margin-top needs to be applied on list to make it appear right above the cursor\r\n        // Cannot compare cursorY directly as it may be a few decimals off due to zoooming\r\n        if (hasClass(this.element, 'docs-side')\r\n            && cursorY - lineHeight > widgetY\r\n            && this.details.element.offsetHeight > this.listElement.offsetHeight) {\r\n            // Fix for #26416\r\n            // Docs is bigger than list and widget is above cursor, apply margin-top so that list appears right above cursor\r\n            this.listElement.style.marginTop = this.details.element.offsetHeight - this.listElement.offsetHeight + \"px\";\r\n        }\r\n    };\r\n    /**\r\n     * Adds the proper classes for positioning the docs to the side or below depending on item\r\n     */\r\n    SuggestWidget.prototype.expandSideOrBelow = function () {\r\n        if (!canExpandCompletionItem(this.focusedItem) && this.firstFocusInCurrentList) {\r\n            removeClass(this.element, 'docs-side');\r\n            removeClass(this.element, 'docs-below');\r\n            return;\r\n        }\r\n        var matches = this.element.style.maxWidth.match(/(\\d+)px/);\r\n        if (!matches || Number(matches[1]) < this.maxWidgetWidth) {\r\n            addClass(this.element, 'docs-below');\r\n            removeClass(this.element, 'docs-side');\r\n        }\r\n        else if (canExpandCompletionItem(this.focusedItem)) {\r\n            addClass(this.element, 'docs-side');\r\n            removeClass(this.element, 'docs-below');\r\n        }\r\n    };\r\n    Object.defineProperty(SuggestWidget.prototype, \"maxWidgetHeight\", {\r\n        // Heights\r\n        get: function () {\r\n            return this.unfocusedHeight * this.editor.getOption(89 /* suggest */).maxVisibleSuggestions;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(SuggestWidget.prototype, \"unfocusedHeight\", {\r\n        get: function () {\r\n            var options = this.editor.getOptions();\r\n            return options.get(91 /* suggestLineHeight */) || options.get(34 /* fontInfo */).lineHeight;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    // IDelegate\r\n    SuggestWidget.prototype.getHeight = function (element) {\r\n        return this.unfocusedHeight;\r\n    };\r\n    SuggestWidget.prototype.getTemplateId = function (element) {\r\n        return 'suggestion';\r\n    };\r\n    SuggestWidget.prototype.expandDocsSettingFromStorage = function () {\r\n        return this.storageService.getBoolean('expandSuggestionDocs', 0 /* GLOBAL */, expandSuggestionDocsByDefault);\r\n    };\r\n    SuggestWidget.prototype.updateExpandDocsSetting = function (value) {\r\n        this.storageService.store('expandSuggestionDocs', value, 0 /* GLOBAL */);\r\n    };\r\n    SuggestWidget.prototype.setStatusBarLeftText = function (s) {\r\n        this.statusBarLeftSpan.innerText = s;\r\n    };\r\n    SuggestWidget.prototype.setStatusBarRightText = function (s) {\r\n        this.statusBarRightSpan.innerText = s;\r\n    };\r\n    SuggestWidget.prototype.dispose = function () {\r\n        this.details.dispose();\r\n        this.list.dispose();\r\n        this.toDispose.dispose();\r\n        this.loadingTimeout.dispose();\r\n        this.showTimeout.dispose();\r\n    };\r\n    SuggestWidget.ID = 'editor.widget.suggestWidget';\r\n    SuggestWidget.LOADING_MESSAGE = nls.localize('suggestWidget.loading', \"Loading...\");\r\n    SuggestWidget.NO_SUGGESTIONS_MESSAGE = nls.localize('suggestWidget.noSuggestions', \"No suggestions.\");\r\n    SuggestWidget = __decorate([\r\n        __param(1, ITelemetryService),\r\n        __param(2, IKeybindingService),\r\n        __param(3, IContextKeyService),\r\n        __param(4, IThemeService),\r\n        __param(5, IStorageService),\r\n        __param(6, IModeService),\r\n        __param(7, IOpenerService),\r\n        __param(8, IInstantiationService)\r\n    ], SuggestWidget);\r\n    return SuggestWidget;\r\n}());\r\nexport { SuggestWidget };\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var matchHighlight = theme.getColor(editorSuggestWidgetHighlightForeground);\r\n    if (matchHighlight) {\r\n        collector.addRule(\".monaco-editor .suggest-widget .monaco-list .monaco-list-row .monaco-highlighted-label .highlight { color: \" + matchHighlight + \"; }\");\r\n    }\r\n    var foreground = theme.getColor(editorSuggestWidgetForeground);\r\n    if (foreground) {\r\n        collector.addRule(\".monaco-editor .suggest-widget { color: \" + foreground + \"; }\");\r\n    }\r\n    var link = theme.getColor(textLinkForeground);\r\n    if (link) {\r\n        collector.addRule(\".monaco-editor .suggest-widget a { color: \" + link + \"; }\");\r\n    }\r\n    var codeBackground = theme.getColor(textCodeBlockBackground);\r\n    if (codeBackground) {\r\n        collector.addRule(\".monaco-editor .suggest-widget code { background-color: \" + codeBackground + \"; }\");\r\n    }\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { CharacterSet } from '../../common/core/characterClassifier.js';\r\nvar CommitCharacterController = /** @class */ (function () {\r\n    function CommitCharacterController(editor, widget, accept) {\r\n        var _this = this;\r\n        this._disposables = new DisposableStore();\r\n        this._disposables.add(widget.onDidShow(function () { return _this._onItem(widget.getFocusedItem()); }));\r\n        this._disposables.add(widget.onDidFocus(this._onItem, this));\r\n        this._disposables.add(widget.onDidHide(this.reset, this));\r\n        this._disposables.add(editor.onWillType(function (text) {\r\n            if (_this._active && !widget.isFrozen()) {\r\n                var ch = text.charCodeAt(text.length - 1);\r\n                if (_this._active.acceptCharacters.has(ch) && editor.getOption(0 /* acceptSuggestionOnCommitCharacter */)) {\r\n                    accept(_this._active.item);\r\n                }\r\n            }\r\n        }));\r\n    }\r\n    CommitCharacterController.prototype._onItem = function (selected) {\r\n        if (!selected || !isNonEmptyArray(selected.item.completion.commitCharacters)) {\r\n            // no item or no commit characters\r\n            this.reset();\r\n            return;\r\n        }\r\n        if (this._active && this._active.item.item === selected.item) {\r\n            // still the same item\r\n            return;\r\n        }\r\n        // keep item and its commit characters\r\n        var acceptCharacters = new CharacterSet();\r\n        for (var _i = 0, _a = selected.item.completion.commitCharacters; _i < _a.length; _i++) {\r\n            var ch = _a[_i];\r\n            if (ch.length > 0) {\r\n                acceptCharacters.add(ch.charCodeAt(0));\r\n            }\r\n        }\r\n        this._active = { acceptCharacters: acceptCharacters, item: selected };\r\n    };\r\n    CommitCharacterController.prototype.reset = function () {\r\n        this._active = undefined;\r\n    };\r\n    CommitCharacterController.prototype.dispose = function () {\r\n        this._disposables.dispose();\r\n    };\r\n    return CommitCharacterController;\r\n}());\r\nexport { CommitCharacterController };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { DisposableStore, dispose } from '../../../base/common/lifecycle.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { domEvent } from '../../../base/browser/event.js';\r\nvar SuggestRangeHighlighter = /** @class */ (function () {\r\n    function SuggestRangeHighlighter(_controller) {\r\n        var _this = this;\r\n        this._controller = _controller;\r\n        this._disposables = new DisposableStore();\r\n        this._decorations = [];\r\n        this._disposables.add(_controller.model.onDidSuggest(function (e) {\r\n            if (!e.shy) {\r\n                var widget = _this._controller.widget.getValue();\r\n                var focused = widget.getFocusedItem();\r\n                if (focused) {\r\n                    _this._highlight(focused.item);\r\n                }\r\n                if (!_this._widgetListener) {\r\n                    _this._widgetListener = widget.onDidFocus(function (e) { return _this._highlight(e.item); });\r\n                }\r\n            }\r\n        }));\r\n        this._disposables.add(_controller.model.onDidCancel(function () {\r\n            _this._reset();\r\n        }));\r\n    }\r\n    SuggestRangeHighlighter.prototype.dispose = function () {\r\n        this._reset();\r\n        this._disposables.dispose();\r\n        dispose(this._widgetListener);\r\n        dispose(this._shiftKeyListener);\r\n    };\r\n    SuggestRangeHighlighter.prototype._reset = function () {\r\n        this._decorations = this._controller.editor.deltaDecorations(this._decorations, []);\r\n        if (this._shiftKeyListener) {\r\n            this._shiftKeyListener.dispose();\r\n            this._shiftKeyListener = undefined;\r\n        }\r\n    };\r\n    SuggestRangeHighlighter.prototype._highlight = function (item) {\r\n        var _this = this;\r\n        var _a;\r\n        this._currentItem = item;\r\n        var opts = this._controller.editor.getOption(89 /* suggest */);\r\n        var newDeco = [];\r\n        if (opts.insertHighlight) {\r\n            if (!this._shiftKeyListener) {\r\n                this._shiftKeyListener = shiftKey.event(function () { return _this._highlight(_this._currentItem); });\r\n            }\r\n            var info = this._controller.getOverwriteInfo(item, shiftKey.isPressed);\r\n            var position = this._controller.editor.getPosition();\r\n            if (opts.insertMode === 'insert' && info.overwriteAfter > 0) {\r\n                // wants inserts but got replace-mode -> highlight AFTER range\r\n                newDeco = [{\r\n                        range: new Range(position.lineNumber, position.column, position.lineNumber, position.column + info.overwriteAfter),\r\n                        options: { inlineClassName: 'suggest-insert-unexpected' }\r\n                    }];\r\n            }\r\n            else if (opts.insertMode === 'replace' && info.overwriteAfter === 0) {\r\n                // want replace but likely got insert -> highlight AFTER range\r\n                var wordInfo = (_a = this._controller.editor.getModel()) === null || _a === void 0 ? void 0 : _a.getWordAtPosition(position);\r\n                if (wordInfo && wordInfo.endColumn > position.column) {\r\n                    newDeco = [{\r\n                            range: new Range(position.lineNumber, position.column, position.lineNumber, wordInfo.endColumn),\r\n                            options: { inlineClassName: 'suggest-insert-unexpected' }\r\n                        }];\r\n                }\r\n            }\r\n        }\r\n        // update editor decorations\r\n        this._decorations = this._controller.editor.deltaDecorations(this._decorations, newDeco);\r\n    };\r\n    return SuggestRangeHighlighter;\r\n}());\r\nexport { SuggestRangeHighlighter };\r\nvar shiftKey = new /** @class */ (function (_super) {\r\n    __extends(ShiftKey, _super);\r\n    function ShiftKey() {\r\n        var _this = _super.call(this) || this;\r\n        _this._subscriptions = new DisposableStore();\r\n        _this._isPressed = false;\r\n        _this._subscriptions.add(domEvent(document.body, 'keydown')(function (e) { return _this.isPressed = e.shiftKey; }));\r\n        _this._subscriptions.add(domEvent(document.body, 'keyup')(function () { return _this.isPressed = false; }));\r\n        _this._subscriptions.add(domEvent(document.body, 'mouseleave')(function () { return _this.isPressed = false; }));\r\n        _this._subscriptions.add(domEvent(document.body, 'blur')(function () { return _this.isPressed = false; }));\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ShiftKey.prototype, \"isPressed\", {\r\n        get: function () {\r\n            return this._isPressed;\r\n        },\r\n        set: function (value) {\r\n            if (this._isPressed !== value) {\r\n                this._isPressed = value;\r\n                this.fire(value);\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ShiftKey.prototype.dispose = function () {\r\n        this._subscriptions.dispose();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    return ShiftKey;\r\n}(Emitter));\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\r\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { SimpleKeybinding } from '../../../base/common/keyCodes.js';\r\nimport { dispose, DisposableStore, toDisposable, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, EditorCommand, registerEditorAction, registerEditorCommand, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { EditOperation } from '../../common/core/editOperation.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { SnippetController2 } from '../snippet/snippetController2.js';\r\nimport { SnippetParser } from '../snippet/snippetParser.js';\r\nimport { ISuggestMemoryService } from './suggestMemory.js';\r\nimport * as nls from '../../../nls.js';\r\nimport { ICommandService, CommandsRegistry } from '../../../platform/commands/common/commands.js';\r\nimport { ContextKeyExpr, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { KeybindingsRegistry } from '../../../platform/keybinding/common/keybindingsRegistry.js';\r\nimport { Context as SuggestContext } from './suggest.js';\r\nimport { SuggestAlternatives } from './suggestAlternatives.js';\r\nimport { SuggestModel } from './suggestModel.js';\r\nimport { SuggestWidget } from './suggestWidget.js';\r\nimport { WordContextKey } from './wordContextKey.js';\r\nimport { Event } from '../../../base/common/event.js';\r\nimport { IEditorWorkerService } from '../../common/services/editorWorkerService.js';\r\nimport { IdleValue } from '../../../base/common/async.js';\r\nimport { isObject, assertType } from '../../../base/common/types.js';\r\nimport { CommitCharacterController } from './suggestCommitCharacters.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { SuggestRangeHighlighter } from './suggestRangeHighlighter.js';\r\n/**\r\n * Stop suggest widget from disappearing when clicking into other areas\r\n * For development purpose only\r\n */\r\nvar _sticky = false;\r\nvar LineSuffix = /** @class */ (function () {\r\n    function LineSuffix(_model, _position) {\r\n        this._model = _model;\r\n        this._position = _position;\r\n        // spy on what's happening right of the cursor. two cases:\r\n        // 1. end of line -> check that it's still end of line\r\n        // 2. mid of line -> add a marker and compute the delta\r\n        var maxColumn = _model.getLineMaxColumn(_position.lineNumber);\r\n        if (maxColumn !== _position.column) {\r\n            var offset = _model.getOffsetAt(_position);\r\n            var end = _model.getPositionAt(offset + 1);\r\n            this._marker = _model.deltaDecorations([], [{\r\n                    range: Range.fromPositions(_position, end),\r\n                    options: { stickiness: 1 /* NeverGrowsWhenTypingAtEdges */ }\r\n                }]);\r\n        }\r\n    }\r\n    LineSuffix.prototype.dispose = function () {\r\n        if (this._marker && !this._model.isDisposed()) {\r\n            this._model.deltaDecorations(this._marker, []);\r\n        }\r\n    };\r\n    LineSuffix.prototype.delta = function (position) {\r\n        if (this._model.isDisposed() || this._position.lineNumber !== position.lineNumber) {\r\n            // bail out early if things seems fishy\r\n            return 0;\r\n        }\r\n        // read the marker (in case suggest was triggered at line end) or compare\r\n        // the cursor to the line end.\r\n        if (this._marker) {\r\n            var range = this._model.getDecorationRange(this._marker[0]);\r\n            var end = this._model.getOffsetAt(range.getStartPosition());\r\n            return end - this._model.getOffsetAt(position);\r\n        }\r\n        else {\r\n            return this._model.getLineMaxColumn(position.lineNumber) - position.column;\r\n        }\r\n    };\r\n    return LineSuffix;\r\n}());\r\nvar SuggestController = /** @class */ (function () {\r\n    function SuggestController(editor, editorWorker, _memoryService, _commandService, _contextKeyService, _instantiationService) {\r\n        var _this = this;\r\n        this._memoryService = _memoryService;\r\n        this._commandService = _commandService;\r\n        this._contextKeyService = _contextKeyService;\r\n        this._instantiationService = _instantiationService;\r\n        this._lineSuffix = new MutableDisposable();\r\n        this._toDispose = new DisposableStore();\r\n        this.editor = editor;\r\n        this.model = new SuggestModel(this.editor, editorWorker);\r\n        this.widget = this._toDispose.add(new IdleValue(function () {\r\n            var widget = _this._instantiationService.createInstance(SuggestWidget, _this.editor);\r\n            _this._toDispose.add(widget);\r\n            _this._toDispose.add(widget.onDidSelect(function (item) { return _this._insertSuggestion(item, 0); }, _this));\r\n            // Wire up logic to accept a suggestion on certain characters\r\n            var commitCharacterController = new CommitCharacterController(_this.editor, widget, function (item) { return _this._insertSuggestion(item, 2 /* NoAfterUndoStop */); });\r\n            _this._toDispose.add(commitCharacterController);\r\n            _this._toDispose.add(_this.model.onDidSuggest(function (e) {\r\n                if (e.completionModel.items.length === 0) {\r\n                    commitCharacterController.reset();\r\n                }\r\n            }));\r\n            // Wire up makes text edit context key\r\n            var makesTextEdit = SuggestContext.MakesTextEdit.bindTo(_this._contextKeyService);\r\n            _this._toDispose.add(widget.onDidFocus(function (_a) {\r\n                var item = _a.item;\r\n                var position = _this.editor.getPosition();\r\n                var startColumn = item.editStart.column;\r\n                var endColumn = position.column;\r\n                var value = true;\r\n                if (_this.editor.getOption(1 /* acceptSuggestionOnEnter */) === 'smart'\r\n                    && _this.model.state === 2 /* Auto */\r\n                    && !item.completion.command\r\n                    && !item.completion.additionalTextEdits\r\n                    && !(item.completion.insertTextRules & 4 /* InsertAsSnippet */)\r\n                    && endColumn - startColumn === item.completion.insertText.length) {\r\n                    var oldText = _this.editor.getModel().getValueInRange({\r\n                        startLineNumber: position.lineNumber,\r\n                        startColumn: startColumn,\r\n                        endLineNumber: position.lineNumber,\r\n                        endColumn: endColumn\r\n                    });\r\n                    value = oldText !== item.completion.insertText;\r\n                }\r\n                makesTextEdit.set(value);\r\n            }));\r\n            _this._toDispose.add(toDisposable(function () { return makesTextEdit.reset(); }));\r\n            _this._toDispose.add(widget.onDetailsKeyDown(function (e) {\r\n                // cmd + c on macOS, ctrl + c on Win / Linux\r\n                if (e.toKeybinding().equals(new SimpleKeybinding(true, false, false, false, 33 /* KEY_C */)) ||\r\n                    (platform.isMacintosh && e.toKeybinding().equals(new SimpleKeybinding(false, false, false, true, 33 /* KEY_C */)))) {\r\n                    e.stopPropagation();\r\n                    return;\r\n                }\r\n                if (!e.toKeybinding().isModifierKey()) {\r\n                    _this.editor.focus();\r\n                }\r\n            }));\r\n            return widget;\r\n        }));\r\n        this._alternatives = this._toDispose.add(new IdleValue(function () {\r\n            return _this._toDispose.add(new SuggestAlternatives(_this.editor, _this._contextKeyService));\r\n        }));\r\n        this._toDispose.add(_instantiationService.createInstance(WordContextKey, editor));\r\n        this._toDispose.add(this.model.onDidTrigger(function (e) {\r\n            _this.widget.getValue().showTriggered(e.auto, e.shy ? 250 : 50);\r\n            _this._lineSuffix.value = new LineSuffix(_this.editor.getModel(), e.position);\r\n        }));\r\n        this._toDispose.add(this.model.onDidSuggest(function (e) {\r\n            if (!e.shy) {\r\n                var index = _this._memoryService.select(_this.editor.getModel(), _this.editor.getPosition(), e.completionModel.items);\r\n                _this.widget.getValue().showSuggestions(e.completionModel, index, e.isFrozen, e.auto);\r\n            }\r\n        }));\r\n        this._toDispose.add(this.model.onDidCancel(function (e) {\r\n            if (!e.retrigger) {\r\n                _this.widget.getValue().hideWidget();\r\n            }\r\n        }));\r\n        this._toDispose.add(this.editor.onDidBlurEditorWidget(function () {\r\n            if (!_sticky) {\r\n                _this.model.cancel();\r\n                _this.model.clear();\r\n            }\r\n        }));\r\n        // Manage the acceptSuggestionsOnEnter context key\r\n        var acceptSuggestionsOnEnter = SuggestContext.AcceptSuggestionsOnEnter.bindTo(_contextKeyService);\r\n        var updateFromConfig = function () {\r\n            var acceptSuggestionOnEnter = _this.editor.getOption(1 /* acceptSuggestionOnEnter */);\r\n            acceptSuggestionsOnEnter.set(acceptSuggestionOnEnter === 'on' || acceptSuggestionOnEnter === 'smart');\r\n        };\r\n        this._toDispose.add(this.editor.onDidChangeConfiguration(function () { return updateFromConfig(); }));\r\n        updateFromConfig();\r\n        // create range highlighter\r\n        this._toDispose.add(new SuggestRangeHighlighter(this));\r\n    }\r\n    SuggestController.get = function (editor) {\r\n        return editor.getContribution(SuggestController.ID);\r\n    };\r\n    SuggestController.prototype.dispose = function () {\r\n        this._alternatives.dispose();\r\n        this._toDispose.dispose();\r\n        this.widget.dispose();\r\n        this.model.dispose();\r\n        this._lineSuffix.dispose();\r\n    };\r\n    SuggestController.prototype._insertSuggestion = function (event, flags) {\r\n        var _a;\r\n        var _this = this;\r\n        if (!event || !event.item) {\r\n            this._alternatives.getValue().reset();\r\n            this.model.cancel();\r\n            this.model.clear();\r\n            return;\r\n        }\r\n        if (!this.editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = this.editor.getModel();\r\n        var modelVersionNow = model.getAlternativeVersionId();\r\n        var item = event.item;\r\n        var suggestion = item.completion;\r\n        // pushing undo stops *before* additional text edits and\r\n        // *after* the main edit\r\n        if (!(flags & 1 /* NoBeforeUndoStop */)) {\r\n            this.editor.pushUndoStop();\r\n        }\r\n        // compute overwrite[Before|After] deltas BEFORE applying extra edits\r\n        var info = this.getOverwriteInfo(item, Boolean(flags & 8 /* AlternativeOverwriteConfig */));\r\n        // keep item in memory\r\n        this._memoryService.memorize(model, this.editor.getPosition(), item);\r\n        if (Array.isArray(suggestion.additionalTextEdits)) {\r\n            this.editor.executeEdits('suggestController.additionalTextEdits', suggestion.additionalTextEdits.map(function (edit) { return EditOperation.replace(Range.lift(edit.range), edit.text); }));\r\n        }\r\n        var insertText = suggestion.insertText;\r\n        if (!(suggestion.insertTextRules & 4 /* InsertAsSnippet */)) {\r\n            insertText = SnippetParser.escape(insertText);\r\n        }\r\n        SnippetController2.get(this.editor).insert(insertText, {\r\n            overwriteBefore: info.overwriteBefore,\r\n            overwriteAfter: info.overwriteAfter,\r\n            undoStopBefore: false,\r\n            undoStopAfter: false,\r\n            adjustWhitespace: !(suggestion.insertTextRules & 1 /* KeepWhitespace */)\r\n        });\r\n        if (!(flags & 2 /* NoAfterUndoStop */)) {\r\n            this.editor.pushUndoStop();\r\n        }\r\n        if (!suggestion.command) {\r\n            // done\r\n            this.model.cancel();\r\n            this.model.clear();\r\n        }\r\n        else if (suggestion.command.id === TriggerSuggestAction.id) {\r\n            // retigger\r\n            this.model.trigger({ auto: true, shy: false }, true);\r\n        }\r\n        else {\r\n            // exec command, done\r\n            (_a = this._commandService).executeCommand.apply(_a, __spreadArrays([suggestion.command.id], (suggestion.command.arguments ? __spreadArrays(suggestion.command.arguments) : []))).catch(onUnexpectedError)\r\n                .finally(function () { return _this.model.clear(); }); // <- clear only now, keep commands alive\r\n            this.model.cancel();\r\n        }\r\n        if (flags & 4 /* KeepAlternativeSuggestions */) {\r\n            this._alternatives.getValue().set(event, function (next) {\r\n                // this is not so pretty. when inserting the 'next'\r\n                // suggestion we undo until we are at the state at\r\n                // which we were before inserting the previous suggestion...\r\n                while (model.canUndo()) {\r\n                    if (modelVersionNow !== model.getAlternativeVersionId()) {\r\n                        model.undo();\r\n                    }\r\n                    _this._insertSuggestion(next, 1 /* NoBeforeUndoStop */ | 2 /* NoAfterUndoStop */ | (flags & 8 /* AlternativeOverwriteConfig */ ? 8 /* AlternativeOverwriteConfig */ : 0));\r\n                    break;\r\n                }\r\n            });\r\n        }\r\n        this._alertCompletionItem(event.item);\r\n    };\r\n    SuggestController.prototype.getOverwriteInfo = function (item, toggleMode) {\r\n        assertType(this.editor.hasModel());\r\n        var replace = this.editor.getOption(89 /* suggest */).insertMode === 'replace';\r\n        if (toggleMode) {\r\n            replace = !replace;\r\n        }\r\n        var overwriteBefore = item.position.column - item.editStart.column;\r\n        var overwriteAfter = (replace ? item.editReplaceEnd.column : item.editInsertEnd.column) - item.position.column;\r\n        var columnDelta = this.editor.getPosition().column - item.position.column;\r\n        var suffixDelta = this._lineSuffix.value ? this._lineSuffix.value.delta(this.editor.getPosition()) : 0;\r\n        return {\r\n            overwriteBefore: overwriteBefore + columnDelta,\r\n            overwriteAfter: overwriteAfter + suffixDelta\r\n        };\r\n    };\r\n    SuggestController.prototype._alertCompletionItem = function (_a) {\r\n        var suggestion = _a.completion;\r\n        var textLabel = typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.name;\r\n        if (isNonEmptyArray(suggestion.additionalTextEdits)) {\r\n            var msg = nls.localize('arai.alert.snippet', \"Accepting '{0}' made {1} additional edits\", textLabel, suggestion.additionalTextEdits.length);\r\n            alert(msg);\r\n        }\r\n    };\r\n    SuggestController.prototype.triggerSuggest = function (onlyFrom) {\r\n        if (this.editor.hasModel()) {\r\n            this.model.trigger({ auto: false, shy: false }, false, onlyFrom);\r\n            this.editor.revealLine(this.editor.getPosition().lineNumber, 0 /* Smooth */);\r\n            this.editor.focus();\r\n        }\r\n    };\r\n    SuggestController.prototype.triggerSuggestAndAcceptBest = function (arg) {\r\n        var _this = this;\r\n        if (!this.editor.hasModel()) {\r\n            return;\r\n        }\r\n        var positionNow = this.editor.getPosition();\r\n        var fallback = function () {\r\n            if (positionNow.equals(_this.editor.getPosition())) {\r\n                _this._commandService.executeCommand(arg.fallback);\r\n            }\r\n        };\r\n        var makesTextEdit = function (item) {\r\n            if (item.completion.insertTextRules & 4 /* InsertAsSnippet */ || item.completion.additionalTextEdits) {\r\n                // snippet, other editor -> makes edit\r\n                return true;\r\n            }\r\n            var position = _this.editor.getPosition();\r\n            var startColumn = item.editStart.column;\r\n            var endColumn = position.column;\r\n            if (endColumn - startColumn !== item.completion.insertText.length) {\r\n                // unequal lengths -> makes edit\r\n                return true;\r\n            }\r\n            var textNow = _this.editor.getModel().getValueInRange({\r\n                startLineNumber: position.lineNumber,\r\n                startColumn: startColumn,\r\n                endLineNumber: position.lineNumber,\r\n                endColumn: endColumn\r\n            });\r\n            // unequal text -> makes edit\r\n            return textNow !== item.completion.insertText;\r\n        };\r\n        Event.once(this.model.onDidTrigger)(function (_) {\r\n            // wait for trigger because only then the cancel-event is trustworthy\r\n            var listener = [];\r\n            Event.any(_this.model.onDidTrigger, _this.model.onDidCancel)(function () {\r\n                // retrigger or cancel -> try to type default text\r\n                dispose(listener);\r\n                fallback();\r\n            }, undefined, listener);\r\n            _this.model.onDidSuggest(function (_a) {\r\n                var completionModel = _a.completionModel;\r\n                dispose(listener);\r\n                if (completionModel.items.length === 0) {\r\n                    fallback();\r\n                    return;\r\n                }\r\n                var index = _this._memoryService.select(_this.editor.getModel(), _this.editor.getPosition(), completionModel.items);\r\n                var item = completionModel.items[index];\r\n                if (!makesTextEdit(item)) {\r\n                    fallback();\r\n                    return;\r\n                }\r\n                _this.editor.pushUndoStop();\r\n                _this._insertSuggestion({ index: index, item: item, model: completionModel }, 4 /* KeepAlternativeSuggestions */ | 1 /* NoBeforeUndoStop */ | 2 /* NoAfterUndoStop */);\r\n            }, undefined, listener);\r\n        });\r\n        this.model.trigger({ auto: false, shy: true });\r\n        this.editor.revealLine(positionNow.lineNumber, 0 /* Smooth */);\r\n        this.editor.focus();\r\n    };\r\n    SuggestController.prototype.acceptSelectedSuggestion = function (keepAlternativeSuggestions, alternativeOverwriteConfig) {\r\n        var item = this.widget.getValue().getFocusedItem();\r\n        var flags = 0;\r\n        if (keepAlternativeSuggestions) {\r\n            flags |= 4 /* KeepAlternativeSuggestions */;\r\n        }\r\n        if (alternativeOverwriteConfig) {\r\n            flags |= 8 /* AlternativeOverwriteConfig */;\r\n        }\r\n        this._insertSuggestion(item, flags);\r\n    };\r\n    SuggestController.prototype.acceptNextSuggestion = function () {\r\n        this._alternatives.getValue().next();\r\n    };\r\n    SuggestController.prototype.acceptPrevSuggestion = function () {\r\n        this._alternatives.getValue().prev();\r\n    };\r\n    SuggestController.prototype.cancelSuggestWidget = function () {\r\n        this.model.cancel();\r\n        this.model.clear();\r\n        this.widget.getValue().hideWidget();\r\n    };\r\n    SuggestController.prototype.selectNextSuggestion = function () {\r\n        this.widget.getValue().selectNext();\r\n    };\r\n    SuggestController.prototype.selectNextPageSuggestion = function () {\r\n        this.widget.getValue().selectNextPage();\r\n    };\r\n    SuggestController.prototype.selectLastSuggestion = function () {\r\n        this.widget.getValue().selectLast();\r\n    };\r\n    SuggestController.prototype.selectPrevSuggestion = function () {\r\n        this.widget.getValue().selectPrevious();\r\n    };\r\n    SuggestController.prototype.selectPrevPageSuggestion = function () {\r\n        this.widget.getValue().selectPreviousPage();\r\n    };\r\n    SuggestController.prototype.selectFirstSuggestion = function () {\r\n        this.widget.getValue().selectFirst();\r\n    };\r\n    SuggestController.prototype.toggleSuggestionDetails = function () {\r\n        this.widget.getValue().toggleDetails();\r\n    };\r\n    SuggestController.prototype.toggleExplainMode = function () {\r\n        this.widget.getValue().toggleExplainMode();\r\n    };\r\n    SuggestController.prototype.toggleSuggestionFocus = function () {\r\n        this.widget.getValue().toggleDetailsFocus();\r\n    };\r\n    SuggestController.ID = 'editor.contrib.suggestController';\r\n    SuggestController = __decorate([\r\n        __param(1, IEditorWorkerService),\r\n        __param(2, ISuggestMemoryService),\r\n        __param(3, ICommandService),\r\n        __param(4, IContextKeyService),\r\n        __param(5, IInstantiationService)\r\n    ], SuggestController);\r\n    return SuggestController;\r\n}());\r\nexport { SuggestController };\r\nvar TriggerSuggestAction = /** @class */ (function (_super) {\r\n    __extends(TriggerSuggestAction, _super);\r\n    function TriggerSuggestAction() {\r\n        return _super.call(this, {\r\n            id: TriggerSuggestAction.id,\r\n            label: nls.localize('suggest.trigger.label', \"Trigger Suggest\"),\r\n            alias: 'Trigger Suggest',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCompletionItemProvider),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.textInputFocus,\r\n                primary: 2048 /* CtrlCmd */ | 10 /* Space */,\r\n                mac: { primary: 256 /* WinCtrl */ | 10 /* Space */, secondary: [512 /* Alt */ | 9 /* Escape */] },\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    TriggerSuggestAction.prototype.run = function (accessor, editor) {\r\n        var controller = SuggestController.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        controller.triggerSuggest();\r\n    };\r\n    TriggerSuggestAction.id = 'editor.action.triggerSuggest';\r\n    return TriggerSuggestAction;\r\n}(EditorAction));\r\nexport { TriggerSuggestAction };\r\nregisterEditorContribution(SuggestController.ID, SuggestController);\r\nregisterEditorAction(TriggerSuggestAction);\r\nvar weight = 100 /* EditorContrib */ + 90;\r\nvar SuggestCommand = EditorCommand.bindToContribution(SuggestController.get);\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'acceptSelectedSuggestion',\r\n    precondition: SuggestContext.Visible,\r\n    handler: function (x) {\r\n        x.acceptSelectedSuggestion(true, false);\r\n    }\r\n}));\r\n// normal tab\r\nKeybindingsRegistry.registerKeybindingRule({\r\n    id: 'acceptSelectedSuggestion',\r\n    when: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus),\r\n    primary: 2 /* Tab */,\r\n    weight: weight\r\n});\r\n// accept on enter has special rules\r\nKeybindingsRegistry.registerKeybindingRule({\r\n    id: 'acceptSelectedSuggestion',\r\n    when: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus, SuggestContext.AcceptSuggestionsOnEnter, SuggestContext.MakesTextEdit),\r\n    primary: 3 /* Enter */,\r\n    weight: weight\r\n});\r\n// todo@joh control enablement via context key\r\n// shift+enter and shift+tab use the alternative-flag so that the suggest controller\r\n// is doing the opposite of the editor.suggest.overwriteOnAccept-configuration\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'acceptAlternativeSelectedSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus),\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 1024 /* Shift */ | 3 /* Enter */,\r\n        secondary: [1024 /* Shift */ | 2 /* Tab */],\r\n    },\r\n    handler: function (x) {\r\n        x.acceptSelectedSuggestion(false, true);\r\n    },\r\n}));\r\n// continue to support the old command\r\nCommandsRegistry.registerCommandAlias('acceptSelectedSuggestionOnEnter', 'acceptSelectedSuggestion');\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'hideSuggestWidget',\r\n    precondition: SuggestContext.Visible,\r\n    handler: function (x) { return x.cancelSuggestWidget(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 9 /* Escape */,\r\n        secondary: [1024 /* Shift */ | 9 /* Escape */]\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'selectNextSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\r\n    handler: function (c) { return c.selectNextSuggestion(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 18 /* DownArrow */,\r\n        secondary: [2048 /* CtrlCmd */ | 18 /* DownArrow */],\r\n        mac: { primary: 18 /* DownArrow */, secondary: [2048 /* CtrlCmd */ | 18 /* DownArrow */, 256 /* WinCtrl */ | 44 /* KEY_N */] }\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'selectNextPageSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\r\n    handler: function (c) { return c.selectNextPageSuggestion(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 12 /* PageDown */,\r\n        secondary: [2048 /* CtrlCmd */ | 12 /* PageDown */]\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'selectLastSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\r\n    handler: function (c) { return c.selectLastSuggestion(); }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'selectPrevSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\r\n    handler: function (c) { return c.selectPrevSuggestion(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 16 /* UpArrow */,\r\n        secondary: [2048 /* CtrlCmd */ | 16 /* UpArrow */],\r\n        mac: { primary: 16 /* UpArrow */, secondary: [2048 /* CtrlCmd */ | 16 /* UpArrow */, 256 /* WinCtrl */ | 46 /* KEY_P */] }\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'selectPrevPageSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\r\n    handler: function (c) { return c.selectPrevPageSuggestion(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 11 /* PageUp */,\r\n        secondary: [2048 /* CtrlCmd */ | 11 /* PageUp */]\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'selectFirstSuggestion',\r\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\r\n    handler: function (c) { return c.selectFirstSuggestion(); }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'toggleSuggestionDetails',\r\n    precondition: SuggestContext.Visible,\r\n    handler: function (x) { return x.toggleSuggestionDetails(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 2048 /* CtrlCmd */ | 10 /* Space */,\r\n        mac: { primary: 256 /* WinCtrl */ | 10 /* Space */ }\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'toggleExplainMode',\r\n    precondition: SuggestContext.Visible,\r\n    handler: function (x) { return x.toggleExplainMode(); },\r\n    kbOpts: {\r\n        weight: 100 /* EditorContrib */,\r\n        primary: 2048 /* CtrlCmd */ | 85 /* US_SLASH */,\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'toggleSuggestionFocus',\r\n    precondition: SuggestContext.Visible,\r\n    handler: function (x) { return x.toggleSuggestionFocus(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 10 /* Space */,\r\n        mac: { primary: 256 /* WinCtrl */ | 512 /* Alt */ | 10 /* Space */ }\r\n    }\r\n}));\r\n//#region tab completions\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'insertBestCompletion',\r\n    precondition: ContextKeyExpr.and(ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), WordContextKey.AtEnd, SuggestContext.Visible.toNegated(), SuggestAlternatives.OtherSuggestions.toNegated(), SnippetController2.InSnippetMode.toNegated()),\r\n    handler: function (x, arg) {\r\n        x.triggerSuggestAndAcceptBest(isObject(arg) ? __assign({ fallback: 'tab' }, arg) : { fallback: 'tab' });\r\n    },\r\n    kbOpts: {\r\n        weight: weight,\r\n        primary: 2 /* Tab */\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'insertNextSuggestion',\r\n    precondition: ContextKeyExpr.and(ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), SuggestAlternatives.OtherSuggestions, SuggestContext.Visible.toNegated(), SnippetController2.InSnippetMode.toNegated()),\r\n    handler: function (x) { return x.acceptNextSuggestion(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 2 /* Tab */\r\n    }\r\n}));\r\nregisterEditorCommand(new SuggestCommand({\r\n    id: 'insertPrevSuggestion',\r\n    precondition: ContextKeyExpr.and(ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), SuggestAlternatives.OtherSuggestions, SuggestContext.Visible.toNegated(), SnippetController2.InSnippetMode.toNegated()),\r\n    handler: function (x) { return x.acceptPrevSuggestion(); },\r\n    kbOpts: {\r\n        weight: weight,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 1024 /* Shift */ | 2 /* Tab */\r\n    }\r\n}));\r\n"],"sourceRoot":""}