{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/base/browser/touch.js"],"names":["EventType","__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","this","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","Tap","Change","Start","End","Contextmenu","Gesture","_super","_this","call","dispatched","activeTouches","handle","targets","ignoreTargets","_lastSetTapCountTime","_register","document","e","onTouchStart","onTouchEnd","onTouchMove","addTarget","element","isTouchDevice","INSTANCE","push","dispose","filter","t","None","ignoreTarget","window","navigator","maxTouchPoints","msMaxTouchPoints","timestamp","Date","now","len","targetTouches","touch","item","identifier","id","initialTarget","initialTimeStamp","initialPageX","pageX","initialPageY","pageY","rollingTimestamps","rollingPageX","rollingPageY","evt","newGestureEvent","dispatchEvent","preventDefault","stopPropagation","activeTouchCount","keys","_loop_1","changedTouches","this_1","String","console","warn","data","holdTime","HOLD_DELAY","Math","abs","finalX","finalY","deltaT","deltaX","deltaY","dispatchTo","Node","contains","inertia","type","event","createEvent","initEvent","tapCount","currentTime","getTime","setTapCount","CLEAR_TAP_COUNT_TIME","forEach","t1","vX","dirX","x","vY","dirY","y","delta_pos_x","delta_pos_y","stopped","SCROLL_FRICTION","translationX","translationY","shift"],"mappings":"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","file":"js/chunk-vendors~7a0edc8e.54cbfefb.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport * as arrays from '../common/arrays.js';\r\nimport { Disposable } from '../common/lifecycle.js';\r\nimport * as DomUtils from './dom.js';\r\nimport { memoize } from '../common/decorators.js';\r\nexport var EventType;\r\n(function (EventType) {\r\n    EventType.Tap = '-monaco-gesturetap';\r\n    EventType.Change = '-monaco-gesturechange';\r\n    EventType.Start = '-monaco-gesturestart';\r\n    EventType.End = '-monaco-gesturesend';\r\n    EventType.Contextmenu = '-monaco-gesturecontextmenu';\r\n})(EventType || (EventType = {}));\r\nvar Gesture = /** @class */ (function (_super) {\r\n    __extends(Gesture, _super);\r\n    function Gesture() {\r\n        var _this = _super.call(this) || this;\r\n        _this.dispatched = false;\r\n        _this.activeTouches = {};\r\n        _this.handle = null;\r\n        _this.targets = [];\r\n        _this.ignoreTargets = [];\r\n        _this._lastSetTapCountTime = 0;\r\n        _this._register(DomUtils.addDisposableListener(document, 'touchstart', function (e) { return _this.onTouchStart(e); }));\r\n        _this._register(DomUtils.addDisposableListener(document, 'touchend', function (e) { return _this.onTouchEnd(e); }));\r\n        _this._register(DomUtils.addDisposableListener(document, 'touchmove', function (e) { return _this.onTouchMove(e); }));\r\n        return _this;\r\n    }\r\n    Gesture.addTarget = function (element) {\r\n        if (!Gesture.isTouchDevice()) {\r\n            return Disposable.None;\r\n        }\r\n        if (!Gesture.INSTANCE) {\r\n            Gesture.INSTANCE = new Gesture();\r\n        }\r\n        Gesture.INSTANCE.targets.push(element);\r\n        return {\r\n            dispose: function () {\r\n                Gesture.INSTANCE.targets = Gesture.INSTANCE.targets.filter(function (t) { return t !== element; });\r\n            }\r\n        };\r\n    };\r\n    Gesture.ignoreTarget = function (element) {\r\n        if (!Gesture.isTouchDevice()) {\r\n            return Disposable.None;\r\n        }\r\n        if (!Gesture.INSTANCE) {\r\n            Gesture.INSTANCE = new Gesture();\r\n        }\r\n        Gesture.INSTANCE.ignoreTargets.push(element);\r\n        return {\r\n            dispose: function () {\r\n                Gesture.INSTANCE.ignoreTargets = Gesture.INSTANCE.ignoreTargets.filter(function (t) { return t !== element; });\r\n            }\r\n        };\r\n    };\r\n    Gesture.isTouchDevice = function () {\r\n        return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0;\r\n    };\r\n    Gesture.prototype.dispose = function () {\r\n        if (this.handle) {\r\n            this.handle.dispose();\r\n            this.handle = null;\r\n        }\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    Gesture.prototype.onTouchStart = function (e) {\r\n        var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        if (this.handle) {\r\n            this.handle.dispose();\r\n            this.handle = null;\r\n        }\r\n        for (var i = 0, len = e.targetTouches.length; i < len; i++) {\r\n            var touch = e.targetTouches.item(i);\r\n            this.activeTouches[touch.identifier] = {\r\n                id: touch.identifier,\r\n                initialTarget: touch.target,\r\n                initialTimeStamp: timestamp,\r\n                initialPageX: touch.pageX,\r\n                initialPageY: touch.pageY,\r\n                rollingTimestamps: [timestamp],\r\n                rollingPageX: [touch.pageX],\r\n                rollingPageY: [touch.pageY]\r\n            };\r\n            var evt = this.newGestureEvent(EventType.Start, touch.target);\r\n            evt.pageX = touch.pageX;\r\n            evt.pageY = touch.pageY;\r\n            this.dispatchEvent(evt);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    };\r\n    Gesture.prototype.onTouchEnd = function (e) {\r\n        var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        var activeTouchCount = Object.keys(this.activeTouches).length;\r\n        var _loop_1 = function (i, len) {\r\n            var touch = e.changedTouches.item(i);\r\n            if (!this_1.activeTouches.hasOwnProperty(String(touch.identifier))) {\r\n                console.warn('move of an UNKNOWN touch', touch);\r\n                return \"continue\";\r\n            }\r\n            var data = this_1.activeTouches[touch.identifier], holdTime = Date.now() - data.initialTimeStamp;\r\n            if (holdTime < Gesture.HOLD_DELAY\r\n                && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30\r\n                && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\r\n                var evt = this_1.newGestureEvent(EventType.Tap, data.initialTarget);\r\n                evt.pageX = arrays.tail(data.rollingPageX);\r\n                evt.pageY = arrays.tail(data.rollingPageY);\r\n                this_1.dispatchEvent(evt);\r\n            }\r\n            else if (holdTime >= Gesture.HOLD_DELAY\r\n                && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30\r\n                && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\r\n                var evt = this_1.newGestureEvent(EventType.Contextmenu, data.initialTarget);\r\n                evt.pageX = arrays.tail(data.rollingPageX);\r\n                evt.pageY = arrays.tail(data.rollingPageY);\r\n                this_1.dispatchEvent(evt);\r\n            }\r\n            else if (activeTouchCount === 1) {\r\n                var finalX = arrays.tail(data.rollingPageX);\r\n                var finalY = arrays.tail(data.rollingPageY);\r\n                var deltaT = arrays.tail(data.rollingTimestamps) - data.rollingTimestamps[0];\r\n                var deltaX = finalX - data.rollingPageX[0];\r\n                var deltaY = finalY - data.rollingPageY[0];\r\n                // We need to get all the dispatch targets on the start of the inertia event\r\n                var dispatchTo = this_1.targets.filter(function (t) { return data.initialTarget instanceof Node && t.contains(data.initialTarget); });\r\n                this_1.inertia(dispatchTo, timestamp, // time now\r\n                Math.abs(deltaX) / deltaT, // speed\r\n                deltaX > 0 ? 1 : -1, // x direction\r\n                finalX, // x now\r\n                Math.abs(deltaY) / deltaT, // y speed\r\n                deltaY > 0 ? 1 : -1, // y direction\r\n                finalY // y now\r\n                );\r\n            }\r\n            this_1.dispatchEvent(this_1.newGestureEvent(EventType.End, data.initialTarget));\r\n            // forget about this touch\r\n            delete this_1.activeTouches[touch.identifier];\r\n        };\r\n        var this_1 = this;\r\n        for (var i = 0, len = e.changedTouches.length; i < len; i++) {\r\n            _loop_1(i, len);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    };\r\n    Gesture.prototype.newGestureEvent = function (type, initialTarget) {\r\n        var event = document.createEvent('CustomEvent');\r\n        event.initEvent(type, false, true);\r\n        event.initialTarget = initialTarget;\r\n        event.tapCount = 0;\r\n        return event;\r\n    };\r\n    Gesture.prototype.dispatchEvent = function (event) {\r\n        var _this = this;\r\n        if (event.type === EventType.Tap) {\r\n            var currentTime = (new Date()).getTime();\r\n            var setTapCount = 0;\r\n            if (currentTime - this._lastSetTapCountTime > Gesture.CLEAR_TAP_COUNT_TIME) {\r\n                setTapCount = 1;\r\n            }\r\n            else {\r\n                setTapCount = 2;\r\n            }\r\n            this._lastSetTapCountTime = currentTime;\r\n            event.tapCount = setTapCount;\r\n        }\r\n        else if (event.type === EventType.Change || event.type === EventType.Contextmenu) {\r\n            // tap is canceled by scrolling or context menu\r\n            this._lastSetTapCountTime = 0;\r\n        }\r\n        for (var i = 0; i < this.ignoreTargets.length; i++) {\r\n            if (event.initialTarget instanceof Node && this.ignoreTargets[i].contains(event.initialTarget)) {\r\n                return;\r\n            }\r\n        }\r\n        this.targets.forEach(function (target) {\r\n            if (event.initialTarget instanceof Node && target.contains(event.initialTarget)) {\r\n                target.dispatchEvent(event);\r\n                _this.dispatched = true;\r\n            }\r\n        });\r\n    };\r\n    Gesture.prototype.inertia = function (dispatchTo, t1, vX, dirX, x, vY, dirY, y) {\r\n        var _this = this;\r\n        this.handle = DomUtils.scheduleAtNextAnimationFrame(function () {\r\n            var now = Date.now();\r\n            // velocity: old speed + accel_over_time\r\n            var deltaT = now - t1, delta_pos_x = 0, delta_pos_y = 0, stopped = true;\r\n            vX += Gesture.SCROLL_FRICTION * deltaT;\r\n            vY += Gesture.SCROLL_FRICTION * deltaT;\r\n            if (vX > 0) {\r\n                stopped = false;\r\n                delta_pos_x = dirX * vX * deltaT;\r\n            }\r\n            if (vY > 0) {\r\n                stopped = false;\r\n                delta_pos_y = dirY * vY * deltaT;\r\n            }\r\n            // dispatch translation event\r\n            var evt = _this.newGestureEvent(EventType.Change);\r\n            evt.translationX = delta_pos_x;\r\n            evt.translationY = delta_pos_y;\r\n            dispatchTo.forEach(function (d) { return d.dispatchEvent(evt); });\r\n            if (!stopped) {\r\n                _this.inertia(dispatchTo, now, vX, dirX, x + delta_pos_x, vY, dirY, y + delta_pos_y);\r\n            }\r\n        });\r\n    };\r\n    Gesture.prototype.onTouchMove = function (e) {\r\n        var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        for (var i = 0, len = e.changedTouches.length; i < len; i++) {\r\n            var touch = e.changedTouches.item(i);\r\n            if (!this.activeTouches.hasOwnProperty(String(touch.identifier))) {\r\n                console.warn('end of an UNKNOWN touch', touch);\r\n                continue;\r\n            }\r\n            var data = this.activeTouches[touch.identifier];\r\n            var evt = this.newGestureEvent(EventType.Change, data.initialTarget);\r\n            evt.translationX = touch.pageX - arrays.tail(data.rollingPageX);\r\n            evt.translationY = touch.pageY - arrays.tail(data.rollingPageY);\r\n            evt.pageX = touch.pageX;\r\n            evt.pageY = touch.pageY;\r\n            this.dispatchEvent(evt);\r\n            // only keep a few data points, to average the final speed\r\n            if (data.rollingPageX.length > 3) {\r\n                data.rollingPageX.shift();\r\n                data.rollingPageY.shift();\r\n                data.rollingTimestamps.shift();\r\n            }\r\n            data.rollingPageX.push(touch.pageX);\r\n            data.rollingPageY.push(touch.pageY);\r\n            data.rollingTimestamps.push(timestamp);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    };\r\n    Gesture.SCROLL_FRICTION = -0.005;\r\n    Gesture.HOLD_DELAY = 700;\r\n    Gesture.CLEAR_TAP_COUNT_TIME = 400; // ms\r\n    __decorate([\r\n        memoize\r\n    ], Gesture, \"isTouchDevice\", null);\r\n    return Gesture;\r\n}(Disposable));\r\nexport { Gesture };\r\n"],"sourceRoot":""}