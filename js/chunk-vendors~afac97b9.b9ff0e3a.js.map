{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/widget.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/asyncDataTree.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/compressedObjectTreeModel.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/objectTree.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/objectTreeModel.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/indexTreeModel.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/abstractTree.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/tree.js","webpack:///./node_modules/monaco-editor/esm/vs/base/browser/ui/tree/dataTree.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","this","constructor","prototype","create","Widget","_super","apply","arguments","onclick","domNode","listener","_register","CLICK","e","onmousedown","MOUSE_DOWN","onmouseover","MOUSE_OVER","onnonbubblingmouseout","onkeydown","KEY_DOWN","onkeyup","KEY_UP","oninput","INPUT","onblur","BLUR","onfocus","FOCUS","ignoreGesture","ignoreTarget","__assign","assign","t","s","i","n","length","call","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","createAsyncDataTreeNode","props","children","refreshPromise","undefined","stale","slow","collapsedByDefault","isAncestor","ancestor","descendant","parent","intersects","node","other","AsyncDataTreeNodeWrapper","defineProperty","get","element","enumerable","configurable","map","depth","visibleChildrenCount","visibleChildIndex","collapsible","collapsed","visible","filterData","AsyncDataTreeRenderer","renderer","nodeMapper","onDidChangeTwistieState","renderedNodes","Map","templateId","renderTemplate","container","templateData","renderElement","index","height","renderTwistie","twistieElement","disposeElement","disposeTemplate","dispose","clear","asTreeEvent","browserEvent","elements","AsyncDataTreeElementsDragAndDropData","data","_this","asAsyncDataTreeDragAndDropData","AsyncDataTreeNodeListDragAndDrop","dnd","getDragURI","getDragLabel","nodes","originalEvent","onDragStart","onDragOver","targetNode","targetIndex","raw","drop","onDragEnd","asObjectTreeOptions","options","collapseByDefault","identityProvider","getId","el","multipleSelectionController","isSelectionSingleChangeEvent","isSelectionRangeChangeEvent","accessibilityProvider","getAriaLabel","getAriaLevel","getActiveDescendantId","filter","parentVisibility","keyboardNavigationLabelProvider","getKeyboardNavigationLabel","sorter","expandOnlyOnTwistieClick","ariaProvider","getPosInSet","getSetSize","listLength","getRole","isChecked","_a","additionalScrollHeight","dfs","fn","forEach","child","AsyncDataTree","user","delegate","renderers","dataSource","subTreeRefreshPromises","refreshPromises","_onDidRender","_onDidChangeNodeSlowState","disposables","autoExpandSingleChildren","tree","createTree","root","hasChildren","id","set","onDidChangeCollapseState","_onDidChangeCollapseState","onDidChangeFocus","onDidChangeSelection","onDidOpen","onDidFocus","onDidDispose","objectTreeDelegate","objectTreeRenderers","event","objectTreeOptions","updateOptions","getHTMLElement","scrollTop","domFocus","layout","width","style","styles","getInput","setInput","input","viewState","viewStateContext","promise","cancel","focus","selection","_updateChildren","setFocus","setSelection","recursive","rerender","toPromise","getDataNode","refreshAndRenderNode","_b","collapse","expand","hasElement","isCollapsible","isCollapsed","getSelection","getFocus","reveal","relativeTop","refreshNode","render","doRefreshSubTree","childrenToRefresh","c","finally","delete","doRefreshNode","all","childrenPromise","slowTimeout_1","err_1","fire","doGetChildren","setChildren","getChildren","processChildren","deep","catch","childrenElements","nodesToForget","childrenTreeNodesById","_i","asyncDataTreeNode","toString","splice","childAsyncDataTreeNode","indexOf","expanded","_c","_d","node_1","_e","children_1","asTreeElement","setCollapsible","fromArray","sort","compare","bind","CompressibleAsyncDataTreeNodeWrapper","incompressible","CompressibleAsyncDataTreeRenderer","compressibleNodeMapperProvider","renderCompressedElements","disposeCompressedElements","asCompressibleObjectTreeOptions","getCompressedNodeKeyboardNavigationLabel","els","CompressibleAsyncDataTree","virtualDelegate","compressionDelegate","compressibleNodeMapper","isIncompressible","getUncompressedIds","Set","nodes_1","node_2","compressedNode","getCompressedTreeNode","node_3","add","oldSelection","oldFocus","didChangeSelection","didChangeFocus","visit","has","visibility","getVisibility","Error","filterResult","noCompress","from","compress","childrenIterator","collect","concat","_decompress","single","decompress","treeElement","CompressedObjectTreeModel","list","model","enabled","compressionEnabled","onDidSplice","getNode","compressedParentNode","getParentNodeLocation","decompressedElement","splicedElement","recompressedElement","parentChildren","_setChildren","compressedChildren","setCompressionEnabled","rootChildren","decompressedRootChildren","recompressedRootChildren","insertedElements","_onDidCreateNode","_onDidDeleteNode","getListIndex","location","getCompressedNode","getListRenderCount","getNodeLocation","parentNode","setCollapsed","expandTo","refilter","DefaultElementMapper","CompressedTreeNodeWrapper","unwrapper","mapList","start","deleteCount","toInsert","mapOptions","compressedNodeUnwrapper","otherNode","CompressibleObjectTreeModel","elementMapper","insertedNodes","deletedNodes","__decorate","decorators","target","key","desc","getOwnPropertyDescriptor","Reflect","decorate","ObjectTree","view","createModel","CompressibleRenderer","_compressedTreeNodeProvider","compressedTreeNode","compressedTreeNodeProvider","CompressibleObjectTree","compressibleRenderers","optionsUpdate","ObjectTreeModel","nodesByIdentity","onDidChangeRenderNodeCount","onDidCreateNode","onDidDeleteNode","getElementLocation","preserveCollapseState","insertedElementIds","Number","MAX_VALUE","empty","rootRef","parentLocation","isFilterResult","obj","getVisibleState","isCollapsibleStateUpdate","update","IndexTreeModel","rootElement","eventBufferer","wrapEvent","_onDidChangeRenderNodeCount","_onDidSplice","renderNodeCount","getParentNodeWithListIndex","listIndex","revealed","treeListElementsToInsert","nodesToInsertIterator","createTreeNode","lastIndex","visibleChildStartIndex","nodesToInsert","insertedVisibleChildrenCount","deletedVisibleChildrenCount","deletedNodes_1","visibleDeleteCount","reduce","_updateAncestorsRenderNodeCount","visit_1","getTreeNodeWithListIndex","hasTreeNode","getTreeNode","bufferEvents","_setCollapseState","_setListNodeCollapseState","onlyVisibleChildIndex","_setNodeCollapseState","previousRenderNodeCount","updateNodeAfterCollapseChange","slice","updateNodeAfterFilterChange","treeListElements","_filterNode","childElements","childRevealed","childNodes","_updateNodeAfterCollapseChange","_updateNodeAfterFilterChange","resultStartLength","hasVisibleDescendants","diff","rest","indexTreeNode","reverse","TreeElementsDragAndDropData","asTreeDragAndDropData","TreeNodeListDragAndDrop","modelProvider","autoExpandDisposable","None","didChangeAutoExpandNode","autoExpandNode","autoExpand","ref","accept","bubble","feedback","effect","model_1","ref_1","parentRef","parentIndex","asListOptions","enableKeyboardNavigation","simpleKeyboardNavigation","RenderIndentGuides","ComposedTreeDelegate","getHeight","getTemplateId","hasDynamicHeight","setDynamicHeight","EventCollection","onDidChange","_elements","TreeRenderer","activeNodes","renderedElements","indent","DefaultIndent","hideTwistiesOfChildlessElements","shouldRenderIndentGuides","renderedIndentGuides","activeIndentNodes","indentGuidesDisposable","onDidChangeNodeTwistieState","renderIndentGuides","_onDidChangeActiveNodes","twistie","contents","paddingLeft","setAttribute","String","removeAttribute","disposableStore","_loop_1","parent_1","guide","this_1","childElementCount","appendChild","insertBefore","firstElementChild","state_1","line","TypeFilter","_filter","_totalCount","_matchCount","_pattern","_lowercasePattern","onWillRefilter","reset","pattern","toLowerCase","Default","labelStr","score","filterOnType","TypeFilterController","keyboardNavigationDelegate","_enabled","_empty","_onDidChangeEmptyState","positionClassName","automaticKeyboardNavigation","triggered","_onDidChangePattern","enabledDisposables","draggable","messageDomNode","labelDomNode","controls","_filterOnType","filterOnTypeDomNode","type","checked","tabIndex","updateFilterOnTypeTitle","onDidChangeFilterOnType","clearDomNode","title","keyboardNavigationEventFilter","onDidSpliceModel","disable","enable","onEventOrInput","onKeyDown","chain","isInputElement","test","mightProducePrintableCharacter","keyCode","altKey","ctrlKey","metaKey","shiftKey","stopPropagation","preventDefault","onClear","any","remove","onInput","MouseEvent","substr","parentElement","append","focusNext","isDefault","getRelativeTop","left","containerWidth","clientWidth","midContainerWidth","updatePosition","top","x","screenX","dataTransfer","dropEffect","className","document","CurrentDragAndDropData","noMatches","totalCount","matchCount","textContent","innerHTML","shouldAllowFocus","tagName","Trait","_onDidChange","_nodeSet","createNodeSet","_set","silent","that_1","getNodes","nodeSet","onDidModelSplice","set_1","deletedNodesIdSet","deletedNodesVisitor","insertedNodesMap","insertedNodesVisitor","wasDeleted","insertedNode","TreeNodeListMouseController","onPointer","onTwistie","openOnSingleClick","detail","location_1","onDoubleClick","TreeNodeList","focusTrait","selectionTrait","createMouseController","additionalFocus","additionalSelection","indexes","fromAPI","AbstractTree","_options","_onWillRefilter","_onDidUpdateOptions","treeDelegate","onDidChangeCollapseStateRelay","onDidChangeActiveNodes","debounce","keyboardSupport","on","onLeftArrow","onRightArrow","onSpace","delegate_1","typeFilterController","focusNavigationFilter","styleElement","Always","suffix","domId","content","treeIndentGuidesStroke","transparent","newStyles","join","loop","getFocusedElements","didChange","parentListIndex","some","focusedIndex","firstChildIndex","TreeError","message","WeakMapper","_map","WeakMap","DataTree"],"mappings":"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","file":"js/chunk-vendors~afac97b9.b9ff0e3a.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as dom from '../dom.js';\r\nimport { StandardKeyboardEvent } from '../keyboardEvent.js';\r\nimport { StandardMouseEvent } from '../mouseEvent.js';\r\nimport { Disposable } from '../../common/lifecycle.js';\r\nimport { Gesture } from '../touch.js';\r\nvar Widget = /** @class */ (function (_super) {\r\n    __extends(Widget, _super);\r\n    function Widget() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Widget.prototype.onclick = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.CLICK, function (e) { return listener(new StandardMouseEvent(e)); }));\r\n    };\r\n    Widget.prototype.onmousedown = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.MOUSE_DOWN, function (e) { return listener(new StandardMouseEvent(e)); }));\r\n    };\r\n    Widget.prototype.onmouseover = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.MOUSE_OVER, function (e) { return listener(new StandardMouseEvent(e)); }));\r\n    };\r\n    Widget.prototype.onnonbubblingmouseout = function (domNode, listener) {\r\n        this._register(dom.addDisposableNonBubblingMouseOutListener(domNode, function (e) { return listener(new StandardMouseEvent(e)); }));\r\n    };\r\n    Widget.prototype.onkeydown = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.KEY_DOWN, function (e) { return listener(new StandardKeyboardEvent(e)); }));\r\n    };\r\n    Widget.prototype.onkeyup = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.KEY_UP, function (e) { return listener(new StandardKeyboardEvent(e)); }));\r\n    };\r\n    Widget.prototype.oninput = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.INPUT, listener));\r\n    };\r\n    Widget.prototype.onblur = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.BLUR, listener));\r\n    };\r\n    Widget.prototype.onfocus = function (domNode, listener) {\r\n        this._register(dom.addDisposableListener(domNode, dom.EventType.FOCUS, listener));\r\n    };\r\n    Widget.prototype.ignoreGesture = function (domNode) {\r\n        Gesture.ignoreTarget(domNode);\r\n    };\r\n    return Widget;\r\n}(Disposable));\r\nexport { Widget };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { ComposedTreeDelegate } from './abstractTree.js';\r\nimport { ObjectTree, CompressibleObjectTree } from './objectTree.js';\r\nimport { TreeError, WeakMapper } from './tree.js';\r\nimport { dispose, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { Emitter, Event } from '../../../common/event.js';\r\nimport { timeout, createCancelablePromise } from '../../../common/async.js';\r\nimport { Iterator } from '../../../common/iterator.js';\r\nimport { ElementsDragAndDropData } from '../list/listView.js';\r\nimport { isPromiseCanceledError, onUnexpectedError } from '../../../common/errors.js';\r\nimport { toggleClass } from '../../dom.js';\r\nimport { values } from '../../../common/map.js';\r\nimport { isFilterResult, getVisibleState } from './indexTreeModel.js';\r\nfunction createAsyncDataTreeNode(props) {\r\n    return __assign(__assign({}, props), { children: [], refreshPromise: undefined, stale: true, slow: false, collapsedByDefault: undefined });\r\n}\r\nfunction isAncestor(ancestor, descendant) {\r\n    if (!descendant.parent) {\r\n        return false;\r\n    }\r\n    else if (descendant.parent === ancestor) {\r\n        return true;\r\n    }\r\n    else {\r\n        return isAncestor(ancestor, descendant.parent);\r\n    }\r\n}\r\nfunction intersects(node, other) {\r\n    return node === other || isAncestor(node, other) || isAncestor(other, node);\r\n}\r\nvar AsyncDataTreeNodeWrapper = /** @class */ (function () {\r\n    function AsyncDataTreeNodeWrapper(node) {\r\n        this.node = node;\r\n    }\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"element\", {\r\n        get: function () { return this.node.element.element; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"children\", {\r\n        get: function () { return this.node.children.map(function (node) { return new AsyncDataTreeNodeWrapper(node); }); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"depth\", {\r\n        get: function () { return this.node.depth; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\r\n        get: function () { return this.node.visibleChildrenCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visibleChildIndex\", {\r\n        get: function () { return this.node.visibleChildIndex; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"collapsible\", {\r\n        get: function () { return this.node.collapsible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"collapsed\", {\r\n        get: function () { return this.node.collapsed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visible\", {\r\n        get: function () { return this.node.visible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"filterData\", {\r\n        get: function () { return this.node.filterData; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return AsyncDataTreeNodeWrapper;\r\n}());\r\nvar AsyncDataTreeRenderer = /** @class */ (function () {\r\n    function AsyncDataTreeRenderer(renderer, nodeMapper, onDidChangeTwistieState) {\r\n        this.renderer = renderer;\r\n        this.nodeMapper = nodeMapper;\r\n        this.onDidChangeTwistieState = onDidChangeTwistieState;\r\n        this.renderedNodes = new Map();\r\n        this.templateId = renderer.templateId;\r\n    }\r\n    AsyncDataTreeRenderer.prototype.renderTemplate = function (container) {\r\n        var templateData = this.renderer.renderTemplate(container);\r\n        return { templateData: templateData };\r\n    };\r\n    AsyncDataTreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        this.renderer.renderElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n    };\r\n    AsyncDataTreeRenderer.prototype.renderTwistie = function (element, twistieElement) {\r\n        toggleClass(twistieElement, 'codicon-loading', element.slow);\r\n        return false;\r\n    };\r\n    AsyncDataTreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        if (this.renderer.disposeElement) {\r\n            this.renderer.disposeElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n        }\r\n    };\r\n    AsyncDataTreeRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.templateData);\r\n    };\r\n    AsyncDataTreeRenderer.prototype.dispose = function () {\r\n        this.renderedNodes.clear();\r\n    };\r\n    return AsyncDataTreeRenderer;\r\n}());\r\nfunction asTreeEvent(e) {\r\n    return {\r\n        browserEvent: e.browserEvent,\r\n        elements: e.elements.map(function (e) { return e.element; })\r\n    };\r\n}\r\nvar AsyncDataTreeElementsDragAndDropData = /** @class */ (function (_super) {\r\n    __extends(AsyncDataTreeElementsDragAndDropData, _super);\r\n    function AsyncDataTreeElementsDragAndDropData(data) {\r\n        var _this = _super.call(this, data.elements.map(function (node) { return node.element; })) || this;\r\n        _this.data = data;\r\n        return _this;\r\n    }\r\n    return AsyncDataTreeElementsDragAndDropData;\r\n}(ElementsDragAndDropData));\r\nfunction asAsyncDataTreeDragAndDropData(data) {\r\n    if (data instanceof ElementsDragAndDropData) {\r\n        return new AsyncDataTreeElementsDragAndDropData(data);\r\n    }\r\n    return data;\r\n}\r\nvar AsyncDataTreeNodeListDragAndDrop = /** @class */ (function () {\r\n    function AsyncDataTreeNodeListDragAndDrop(dnd) {\r\n        this.dnd = dnd;\r\n    }\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.getDragURI = function (node) {\r\n        return this.dnd.getDragURI(node.element);\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.getDragLabel = function (nodes, originalEvent) {\r\n        if (this.dnd.getDragLabel) {\r\n            return this.dnd.getDragLabel(nodes.map(function (node) { return node.element; }), originalEvent);\r\n        }\r\n        return undefined;\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.onDragStart = function (data, originalEvent) {\r\n        if (this.dnd.onDragStart) {\r\n            this.dnd.onDragStart(asAsyncDataTreeDragAndDropData(data), originalEvent);\r\n        }\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.onDragOver = function (data, targetNode, targetIndex, originalEvent, raw) {\r\n        if (raw === void 0) { raw = true; }\r\n        return this.dnd.onDragOver(asAsyncDataTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.drop = function (data, targetNode, targetIndex, originalEvent) {\r\n        this.dnd.drop(asAsyncDataTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.onDragEnd = function (originalEvent) {\r\n        if (this.dnd.onDragEnd) {\r\n            this.dnd.onDragEnd(originalEvent);\r\n        }\r\n    };\r\n    return AsyncDataTreeNodeListDragAndDrop;\r\n}());\r\nfunction asObjectTreeOptions(options) {\r\n    return options && __assign(__assign({}, options), { collapseByDefault: true, identityProvider: options.identityProvider && {\r\n            getId: function (el) {\r\n                return options.identityProvider.getId(el.element);\r\n            }\r\n        }, dnd: options.dnd && new AsyncDataTreeNodeListDragAndDrop(options.dnd), multipleSelectionController: options.multipleSelectionController && {\r\n            isSelectionSingleChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionSingleChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            },\r\n            isSelectionRangeChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionRangeChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            }\r\n        }, accessibilityProvider: options.accessibilityProvider && __assign(__assign({}, options.accessibilityProvider), { getAriaLabel: function (e) {\r\n                return options.accessibilityProvider.getAriaLabel(e.element);\r\n            }, getAriaLevel: options.accessibilityProvider.getAriaLevel && (function (node) {\r\n                return options.accessibilityProvider.getAriaLevel(node.element);\r\n            }), getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && (function (node) {\r\n                return options.accessibilityProvider.getActiveDescendantId(node.element);\r\n            }) }), filter: options.filter && {\r\n            filter: function (e, parentVisibility) {\r\n                return options.filter.filter(e.element, parentVisibility);\r\n            }\r\n        }, keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && __assign(__assign({}, options.keyboardNavigationLabelProvider), { getKeyboardNavigationLabel: function (e) {\r\n                return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e.element);\r\n            } }), sorter: undefined, expandOnlyOnTwistieClick: typeof options.expandOnlyOnTwistieClick === 'undefined' ? undefined : (typeof options.expandOnlyOnTwistieClick !== 'function' ? options.expandOnlyOnTwistieClick : (function (e) { return options.expandOnlyOnTwistieClick(e.element); })), ariaProvider: options.ariaProvider && {\r\n            getPosInSet: function (el, index) {\r\n                return options.ariaProvider.getPosInSet(el.element, index);\r\n            },\r\n            getSetSize: function (el, index, listLength) {\r\n                return options.ariaProvider.getSetSize(el.element, index, listLength);\r\n            },\r\n            getRole: options.ariaProvider.getRole ? function (el) {\r\n                return options.ariaProvider.getRole(el.element);\r\n            } : undefined,\r\n            isChecked: options.ariaProvider.isChecked ? function (e) {\r\n                var _a;\r\n                return ((_a = options.ariaProvider) === null || _a === void 0 ? void 0 : _a.isChecked)(e.element);\r\n            } : undefined\r\n        }, additionalScrollHeight: options.additionalScrollHeight });\r\n}\r\nfunction dfs(node, fn) {\r\n    fn(node);\r\n    node.children.forEach(function (child) { return dfs(child, fn); });\r\n}\r\nvar AsyncDataTree = /** @class */ (function () {\r\n    function AsyncDataTree(user, container, delegate, renderers, dataSource, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.user = user;\r\n        this.dataSource = dataSource;\r\n        this.nodes = new Map();\r\n        this.subTreeRefreshPromises = new Map();\r\n        this.refreshPromises = new Map();\r\n        this._onDidRender = new Emitter();\r\n        this._onDidChangeNodeSlowState = new Emitter();\r\n        this.nodeMapper = new WeakMapper(function (node) { return new AsyncDataTreeNodeWrapper(node); });\r\n        this.disposables = new DisposableStore();\r\n        this.identityProvider = options.identityProvider;\r\n        this.autoExpandSingleChildren = typeof options.autoExpandSingleChildren === 'undefined' ? false : options.autoExpandSingleChildren;\r\n        this.sorter = options.sorter;\r\n        this.collapseByDefault = options.collapseByDefault;\r\n        this.tree = this.createTree(user, container, delegate, renderers, options);\r\n        this.root = createAsyncDataTreeNode({\r\n            element: undefined,\r\n            parent: null,\r\n            hasChildren: true\r\n        });\r\n        if (this.identityProvider) {\r\n            this.root = __assign(__assign({}, this.root), { id: null });\r\n        }\r\n        this.nodes.set(null, this.root);\r\n        this.tree.onDidChangeCollapseState(this._onDidChangeCollapseState, this, this.disposables);\r\n    }\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidChangeFocus\", {\r\n        get: function () { return Event.map(this.tree.onDidChangeFocus, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidChangeSelection\", {\r\n        get: function () { return Event.map(this.tree.onDidChangeSelection, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidOpen\", {\r\n        get: function () { return Event.map(this.tree.onDidOpen, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidFocus\", {\r\n        get: function () { return this.tree.onDidFocus; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidDispose\", {\r\n        get: function () { return this.tree.onDidDispose; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AsyncDataTree.prototype.createTree = function (user, container, delegate, renderers, options) {\r\n        var _this = this;\r\n        var objectTreeDelegate = new ComposedTreeDelegate(delegate);\r\n        var objectTreeRenderers = renderers.map(function (r) { return new AsyncDataTreeRenderer(r, _this.nodeMapper, _this._onDidChangeNodeSlowState.event); });\r\n        var objectTreeOptions = asObjectTreeOptions(options) || {};\r\n        return new ObjectTree(user, container, objectTreeDelegate, objectTreeRenderers, objectTreeOptions);\r\n    };\r\n    AsyncDataTree.prototype.updateOptions = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.tree.updateOptions(options);\r\n    };\r\n    // Widget\r\n    AsyncDataTree.prototype.getHTMLElement = function () {\r\n        return this.tree.getHTMLElement();\r\n    };\r\n    Object.defineProperty(AsyncDataTree.prototype, \"scrollTop\", {\r\n        get: function () {\r\n            return this.tree.scrollTop;\r\n        },\r\n        set: function (scrollTop) {\r\n            this.tree.scrollTop = scrollTop;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AsyncDataTree.prototype.domFocus = function () {\r\n        this.tree.domFocus();\r\n    };\r\n    AsyncDataTree.prototype.layout = function (height, width) {\r\n        this.tree.layout(height, width);\r\n    };\r\n    AsyncDataTree.prototype.style = function (styles) {\r\n        this.tree.style(styles);\r\n    };\r\n    // Model\r\n    AsyncDataTree.prototype.getInput = function () {\r\n        return this.root.element;\r\n    };\r\n    AsyncDataTree.prototype.setInput = function (input, viewState) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var viewStateContext;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.refreshPromises.forEach(function (promise) { return promise.cancel(); });\r\n                        this.refreshPromises.clear();\r\n                        this.root.element = input;\r\n                        viewStateContext = viewState && { viewState: viewState, focus: [], selection: [] };\r\n                        return [4 /*yield*/, this._updateChildren(input, true, false, viewStateContext)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (viewStateContext) {\r\n                            this.tree.setFocus(viewStateContext.focus);\r\n                            this.tree.setSelection(viewStateContext.selection);\r\n                        }\r\n                        if (viewState && typeof viewState.scrollTop === 'number') {\r\n                            this.scrollTop = viewState.scrollTop;\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype._updateChildren = function (element, recursive, rerender, viewStateContext) {\r\n        if (element === void 0) { element = this.root.element; }\r\n        if (recursive === void 0) { recursive = true; }\r\n        if (rerender === void 0) { rerender = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var node;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof this.root.element === 'undefined') {\r\n                            throw new TreeError(this.user, 'Tree input not set');\r\n                        }\r\n                        if (!this.root.refreshPromise) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        node = this.getDataNode(element);\r\n                        return [4 /*yield*/, this.refreshAndRenderNode(node, recursive, viewStateContext)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        if (rerender) {\r\n                            try {\r\n                                this.tree.rerender(node);\r\n                            }\r\n                            catch (_b) {\r\n                                // missing nodes are fine, this could've resulted from\r\n                                // parallel refresh calls, removing `node` altogether\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // View\r\n    AsyncDataTree.prototype.rerender = function (element) {\r\n        if (element === undefined || element === this.root.element) {\r\n            this.tree.rerender();\r\n            return;\r\n        }\r\n        var node = this.getDataNode(element);\r\n        this.tree.rerender(node);\r\n    };\r\n    AsyncDataTree.prototype.collapse = function (element, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        var node = this.getDataNode(element);\r\n        return this.tree.collapse(node === this.root ? null : node, recursive);\r\n    };\r\n    AsyncDataTree.prototype.expand = function (element, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var node, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof this.root.element === 'undefined') {\r\n                            throw new TreeError(this.user, 'Tree input not set');\r\n                        }\r\n                        if (!this.root.refreshPromise) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        node = this.getDataNode(element);\r\n                        if (this.tree.hasElement(node) && !this.tree.isCollapsible(node)) {\r\n                            return [2 /*return*/, false];\r\n                        }\r\n                        if (!node.refreshPromise) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 5:\r\n                        _a.sent();\r\n                        _a.label = 6;\r\n                    case 6:\r\n                        if (node !== this.root && !node.refreshPromise && !this.tree.isCollapsed(node)) {\r\n                            return [2 /*return*/, false];\r\n                        }\r\n                        result = this.tree.expand(node === this.root ? null : node, recursive);\r\n                        if (!node.refreshPromise) return [3 /*break*/, 9];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 7:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 8:\r\n                        _a.sent();\r\n                        _a.label = 9;\r\n                    case 9: return [2 /*return*/, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.setSelection = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.getDataNode(e); });\r\n        this.tree.setSelection(nodes, browserEvent);\r\n    };\r\n    AsyncDataTree.prototype.getSelection = function () {\r\n        var nodes = this.tree.getSelection();\r\n        return nodes.map(function (n) { return n.element; });\r\n    };\r\n    AsyncDataTree.prototype.setFocus = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.getDataNode(e); });\r\n        this.tree.setFocus(nodes, browserEvent);\r\n    };\r\n    AsyncDataTree.prototype.getFocus = function () {\r\n        var nodes = this.tree.getFocus();\r\n        return nodes.map(function (n) { return n.element; });\r\n    };\r\n    AsyncDataTree.prototype.reveal = function (element, relativeTop) {\r\n        this.tree.reveal(this.getDataNode(element), relativeTop);\r\n    };\r\n    // Implementation\r\n    AsyncDataTree.prototype.getDataNode = function (element) {\r\n        var node = this.nodes.get((element === this.root.element ? null : element));\r\n        if (!node) {\r\n            throw new TreeError(this.user, \"Data tree node not found: \" + element);\r\n        }\r\n        return node;\r\n    };\r\n    AsyncDataTree.prototype.refreshAndRenderNode = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.refreshNode(node, recursive, viewStateContext)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.render(node, viewStateContext);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.refreshNode = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                this.subTreeRefreshPromises.forEach(function (refreshPromise, refreshNode) {\r\n                    if (!result && intersects(refreshNode, node)) {\r\n                        result = refreshPromise.then(function () { return _this.refreshNode(node, recursive, viewStateContext); });\r\n                    }\r\n                });\r\n                if (result) {\r\n                    return [2 /*return*/, result];\r\n                }\r\n                return [2 /*return*/, this.doRefreshSubTree(node, recursive, viewStateContext)];\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.doRefreshSubTree = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var done, childrenToRefresh;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        node.refreshPromise = new Promise(function (c) { return done = c; });\r\n                        this.subTreeRefreshPromises.set(node, node.refreshPromise);\r\n                        node.refreshPromise.finally(function () {\r\n                            node.refreshPromise = undefined;\r\n                            _this.subTreeRefreshPromises.delete(node);\r\n                        });\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, , 4, 5]);\r\n                        return [4 /*yield*/, this.doRefreshNode(node, recursive, viewStateContext)];\r\n                    case 2:\r\n                        childrenToRefresh = _a.sent();\r\n                        node.stale = false;\r\n                        return [4 /*yield*/, Promise.all(childrenToRefresh.map(function (child) { return _this.doRefreshSubTree(child, recursive, viewStateContext); }))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        done();\r\n                        return [7 /*endfinally*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.doRefreshNode = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var childrenPromise, slowTimeout_1, children, err_1;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        node.hasChildren = !!this.dataSource.hasChildren(node.element);\r\n                        if (!node.hasChildren) {\r\n                            childrenPromise = Promise.resolve([]);\r\n                        }\r\n                        else {\r\n                            slowTimeout_1 = timeout(800);\r\n                            slowTimeout_1.then(function () {\r\n                                node.slow = true;\r\n                                _this._onDidChangeNodeSlowState.fire(node);\r\n                            }, function (_) { return null; });\r\n                            childrenPromise = this.doGetChildren(node)\r\n                                .finally(function () { return slowTimeout_1.cancel(); });\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, 4, 5]);\r\n                        return [4 /*yield*/, childrenPromise];\r\n                    case 2:\r\n                        children = _a.sent();\r\n                        return [2 /*return*/, this.setChildren(node, children, recursive, viewStateContext)];\r\n                    case 3:\r\n                        err_1 = _a.sent();\r\n                        if (node !== this.root) {\r\n                            this.tree.collapse(node === this.root ? null : node);\r\n                        }\r\n                        if (isPromiseCanceledError(err_1)) {\r\n                            return [2 /*return*/, []];\r\n                        }\r\n                        throw err_1;\r\n                    case 4:\r\n                        if (node.slow) {\r\n                            node.slow = false;\r\n                            this._onDidChangeNodeSlowState.fire(node);\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.doGetChildren = function (node) {\r\n        var _this = this;\r\n        var result = this.refreshPromises.get(node);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        result = createCancelablePromise(function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var children;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.dataSource.getChildren(node.element)];\r\n                    case 1:\r\n                        children = _a.sent();\r\n                        return [2 /*return*/, this.processChildren(children)];\r\n                }\r\n            });\r\n        }); });\r\n        this.refreshPromises.set(node, result);\r\n        return result.finally(function () { return _this.refreshPromises.delete(node); });\r\n    };\r\n    AsyncDataTree.prototype._onDidChangeCollapseState = function (_a) {\r\n        var node = _a.node, deep = _a.deep;\r\n        if (!node.collapsed && node.element.stale) {\r\n            if (deep) {\r\n                this.collapse(node.element.element);\r\n            }\r\n            else {\r\n                this.refreshAndRenderNode(node.element, false)\r\n                    .catch(onUnexpectedError);\r\n            }\r\n        }\r\n    };\r\n    AsyncDataTree.prototype.setChildren = function (node, childrenElements, recursive, viewStateContext) {\r\n        var _a;\r\n        var _this = this;\r\n        // perf: if the node was and still is a leaf, avoid all this hassle\r\n        if (node.children.length === 0 && childrenElements.length === 0) {\r\n            return [];\r\n        }\r\n        var nodesToForget = new Map();\r\n        var childrenTreeNodesById = new Map();\r\n        for (var _i = 0, _b = node.children; _i < _b.length; _i++) {\r\n            var child = _b[_i];\r\n            nodesToForget.set(child.element, child);\r\n            if (this.identityProvider) {\r\n                var collapsed = this.tree.isCollapsed(child);\r\n                childrenTreeNodesById.set(child.id, { node: child, collapsed: collapsed });\r\n            }\r\n        }\r\n        var childrenToRefresh = [];\r\n        var children = childrenElements.map(function (element) {\r\n            var hasChildren = !!_this.dataSource.hasChildren(element);\r\n            if (!_this.identityProvider) {\r\n                var asyncDataTreeNode = createAsyncDataTreeNode({ element: element, parent: node, hasChildren: hasChildren });\r\n                if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\r\n                    asyncDataTreeNode.collapsedByDefault = false;\r\n                    childrenToRefresh.push(asyncDataTreeNode);\r\n                }\r\n                return asyncDataTreeNode;\r\n            }\r\n            var id = _this.identityProvider.getId(element).toString();\r\n            var result = childrenTreeNodesById.get(id);\r\n            if (result) {\r\n                var asyncDataTreeNode = result.node;\r\n                nodesToForget.delete(asyncDataTreeNode.element);\r\n                _this.nodes.delete(asyncDataTreeNode.element);\r\n                _this.nodes.set(element, asyncDataTreeNode);\r\n                asyncDataTreeNode.element = element;\r\n                asyncDataTreeNode.hasChildren = hasChildren;\r\n                if (recursive) {\r\n                    if (result.collapsed) {\r\n                        asyncDataTreeNode.children.forEach(function (node) { return dfs(node, function (node) { return _this.nodes.delete(node.element); }); });\r\n                        asyncDataTreeNode.children.splice(0, asyncDataTreeNode.children.length);\r\n                        asyncDataTreeNode.stale = true;\r\n                    }\r\n                    else {\r\n                        childrenToRefresh.push(asyncDataTreeNode);\r\n                    }\r\n                }\r\n                else if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\r\n                    asyncDataTreeNode.collapsedByDefault = false;\r\n                    childrenToRefresh.push(asyncDataTreeNode);\r\n                }\r\n                return asyncDataTreeNode;\r\n            }\r\n            var childAsyncDataTreeNode = createAsyncDataTreeNode({ element: element, parent: node, id: id, hasChildren: hasChildren });\r\n            if (viewStateContext && viewStateContext.viewState.focus && viewStateContext.viewState.focus.indexOf(id) > -1) {\r\n                viewStateContext.focus.push(childAsyncDataTreeNode);\r\n            }\r\n            if (viewStateContext && viewStateContext.viewState.selection && viewStateContext.viewState.selection.indexOf(id) > -1) {\r\n                viewStateContext.selection.push(childAsyncDataTreeNode);\r\n            }\r\n            if (viewStateContext && viewStateContext.viewState.expanded && viewStateContext.viewState.expanded.indexOf(id) > -1) {\r\n                childrenToRefresh.push(childAsyncDataTreeNode);\r\n            }\r\n            else if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\r\n                childAsyncDataTreeNode.collapsedByDefault = false;\r\n                childrenToRefresh.push(childAsyncDataTreeNode);\r\n            }\r\n            return childAsyncDataTreeNode;\r\n        });\r\n        for (var _c = 0, _d = values(nodesToForget); _c < _d.length; _c++) {\r\n            var node_1 = _d[_c];\r\n            dfs(node_1, function (node) { return _this.nodes.delete(node.element); });\r\n        }\r\n        for (var _e = 0, children_1 = children; _e < children_1.length; _e++) {\r\n            var child = children_1[_e];\r\n            this.nodes.set(child.element, child);\r\n        }\r\n        (_a = node.children).splice.apply(_a, __spreadArrays([0, node.children.length], children));\r\n        // TODO@joao this doesn't take filter into account\r\n        if (node !== this.root && this.autoExpandSingleChildren && children.length === 1 && childrenToRefresh.length === 0) {\r\n            children[0].collapsedByDefault = false;\r\n            childrenToRefresh.push(children[0]);\r\n        }\r\n        return childrenToRefresh;\r\n    };\r\n    AsyncDataTree.prototype.render = function (node, viewStateContext) {\r\n        var _this = this;\r\n        var children = node.children.map(function (node) { return _this.asTreeElement(node, viewStateContext); });\r\n        this.tree.setChildren(node === this.root ? null : node, children);\r\n        if (node !== this.root) {\r\n            this.tree.setCollapsible(node, node.hasChildren);\r\n        }\r\n        this._onDidRender.fire();\r\n    };\r\n    AsyncDataTree.prototype.asTreeElement = function (node, viewStateContext) {\r\n        var _this = this;\r\n        if (node.stale) {\r\n            return {\r\n                element: node,\r\n                collapsible: node.hasChildren,\r\n                collapsed: true\r\n            };\r\n        }\r\n        var collapsed;\r\n        if (viewStateContext && viewStateContext.viewState.expanded && node.id && viewStateContext.viewState.expanded.indexOf(node.id) > -1) {\r\n            collapsed = false;\r\n        }\r\n        else {\r\n            collapsed = node.collapsedByDefault;\r\n        }\r\n        node.collapsedByDefault = undefined;\r\n        return {\r\n            element: node,\r\n            children: node.hasChildren ? Iterator.map(Iterator.fromArray(node.children), function (child) { return _this.asTreeElement(child, viewStateContext); }) : [],\r\n            collapsible: node.hasChildren,\r\n            collapsed: collapsed\r\n        };\r\n    };\r\n    AsyncDataTree.prototype.processChildren = function (children) {\r\n        if (this.sorter) {\r\n            children.sort(this.sorter.compare.bind(this.sorter));\r\n        }\r\n        return children;\r\n    };\r\n    AsyncDataTree.prototype.dispose = function () {\r\n        this.disposables.dispose();\r\n    };\r\n    return AsyncDataTree;\r\n}());\r\nexport { AsyncDataTree };\r\nvar CompressibleAsyncDataTreeNodeWrapper = /** @class */ (function () {\r\n    function CompressibleAsyncDataTreeNodeWrapper(node) {\r\n        this.node = node;\r\n    }\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"element\", {\r\n        get: function () {\r\n            return {\r\n                elements: this.node.element.elements.map(function (e) { return e.element; }),\r\n                incompressible: this.node.element.incompressible\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"children\", {\r\n        get: function () { return this.node.children.map(function (node) { return new CompressibleAsyncDataTreeNodeWrapper(node); }); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"depth\", {\r\n        get: function () { return this.node.depth; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\r\n        get: function () { return this.node.visibleChildrenCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visibleChildIndex\", {\r\n        get: function () { return this.node.visibleChildIndex; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"collapsible\", {\r\n        get: function () { return this.node.collapsible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"collapsed\", {\r\n        get: function () { return this.node.collapsed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visible\", {\r\n        get: function () { return this.node.visible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"filterData\", {\r\n        get: function () { return this.node.filterData; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return CompressibleAsyncDataTreeNodeWrapper;\r\n}());\r\nvar CompressibleAsyncDataTreeRenderer = /** @class */ (function () {\r\n    function CompressibleAsyncDataTreeRenderer(renderer, nodeMapper, compressibleNodeMapperProvider, onDidChangeTwistieState) {\r\n        this.renderer = renderer;\r\n        this.nodeMapper = nodeMapper;\r\n        this.compressibleNodeMapperProvider = compressibleNodeMapperProvider;\r\n        this.onDidChangeTwistieState = onDidChangeTwistieState;\r\n        this.renderedNodes = new Map();\r\n        this.disposables = [];\r\n        this.templateId = renderer.templateId;\r\n    }\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderTemplate = function (container) {\r\n        var templateData = this.renderer.renderTemplate(container);\r\n        return { templateData: templateData };\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        this.renderer.renderElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderCompressedElements = function (node, index, templateData, height) {\r\n        this.renderer.renderCompressedElements(this.compressibleNodeMapperProvider().map(node), index, templateData.templateData, height);\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderTwistie = function (element, twistieElement) {\r\n        toggleClass(twistieElement, 'codicon-loading', element.slow);\r\n        return false;\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        if (this.renderer.disposeElement) {\r\n            this.renderer.disposeElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n        }\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.disposeCompressedElements = function (node, index, templateData, height) {\r\n        if (this.renderer.disposeCompressedElements) {\r\n            this.renderer.disposeCompressedElements(this.compressibleNodeMapperProvider().map(node), index, templateData.templateData, height);\r\n        }\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.templateData);\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.dispose = function () {\r\n        this.renderedNodes.clear();\r\n        this.disposables = dispose(this.disposables);\r\n    };\r\n    return CompressibleAsyncDataTreeRenderer;\r\n}());\r\nfunction asCompressibleObjectTreeOptions(options) {\r\n    var objectTreeOptions = options && asObjectTreeOptions(options);\r\n    return objectTreeOptions && __assign(__assign({}, objectTreeOptions), { keyboardNavigationLabelProvider: objectTreeOptions.keyboardNavigationLabelProvider && __assign(__assign({}, objectTreeOptions.keyboardNavigationLabelProvider), { getCompressedNodeKeyboardNavigationLabel: function (els) {\r\n                return options.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(els.map(function (e) { return e.element; }));\r\n            } }) });\r\n}\r\nvar CompressibleAsyncDataTree = /** @class */ (function (_super) {\r\n    __extends(CompressibleAsyncDataTree, _super);\r\n    function CompressibleAsyncDataTree(user, container, virtualDelegate, compressionDelegate, renderers, dataSource, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = _super.call(this, user, container, virtualDelegate, renderers, dataSource, options) || this;\r\n        _this.compressionDelegate = compressionDelegate;\r\n        _this.compressibleNodeMapper = new WeakMapper(function (node) { return new CompressibleAsyncDataTreeNodeWrapper(node); });\r\n        _this.filter = options.filter;\r\n        return _this;\r\n    }\r\n    CompressibleAsyncDataTree.prototype.createTree = function (user, container, delegate, renderers, options) {\r\n        var _this = this;\r\n        var objectTreeDelegate = new ComposedTreeDelegate(delegate);\r\n        var objectTreeRenderers = renderers.map(function (r) { return new CompressibleAsyncDataTreeRenderer(r, _this.nodeMapper, function () { return _this.compressibleNodeMapper; }, _this._onDidChangeNodeSlowState.event); });\r\n        var objectTreeOptions = asCompressibleObjectTreeOptions(options) || {};\r\n        return new CompressibleObjectTree(user, container, objectTreeDelegate, objectTreeRenderers, objectTreeOptions);\r\n    };\r\n    CompressibleAsyncDataTree.prototype.asTreeElement = function (node, viewStateContext) {\r\n        return __assign({ incompressible: this.compressionDelegate.isIncompressible(node.element) }, _super.prototype.asTreeElement.call(this, node, viewStateContext));\r\n    };\r\n    CompressibleAsyncDataTree.prototype.updateOptions = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.tree.updateOptions(options);\r\n    };\r\n    CompressibleAsyncDataTree.prototype.render = function (node, viewStateContext) {\r\n        var _this = this;\r\n        if (!this.identityProvider) {\r\n            return _super.prototype.render.call(this, node, viewStateContext);\r\n        }\r\n        // Preserve traits across compressions. Hacky but does the trick.\r\n        // This is hard to fix properly since it requires rewriting the traits\r\n        // across trees and lists. Let's just keep it this way for now.\r\n        var getId = function (element) { return _this.identityProvider.getId(element).toString(); };\r\n        var getUncompressedIds = function (nodes) {\r\n            var result = new Set();\r\n            for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\r\n                var node_2 = nodes_1[_i];\r\n                var compressedNode = _this.tree.getCompressedTreeNode(node_2 === _this.root ? null : node_2);\r\n                if (!compressedNode.element) {\r\n                    continue;\r\n                }\r\n                for (var _a = 0, _b = compressedNode.element.elements; _a < _b.length; _a++) {\r\n                    var node_3 = _b[_a];\r\n                    result.add(getId(node_3.element));\r\n                }\r\n            }\r\n            return result;\r\n        };\r\n        var oldSelection = getUncompressedIds(this.tree.getSelection());\r\n        var oldFocus = getUncompressedIds(this.tree.getFocus());\r\n        _super.prototype.render.call(this, node, viewStateContext);\r\n        var selection = this.getSelection();\r\n        var didChangeSelection = false;\r\n        var focus = this.getFocus();\r\n        var didChangeFocus = false;\r\n        var visit = function (node) {\r\n            var compressedNode = node.element;\r\n            if (compressedNode) {\r\n                for (var i = 0; i < compressedNode.elements.length; i++) {\r\n                    var id = getId(compressedNode.elements[i].element);\r\n                    var element = compressedNode.elements[compressedNode.elements.length - 1].element;\r\n                    // github.com/microsoft/vscode/issues/85938\r\n                    if (oldSelection.has(id) && selection.indexOf(element) === -1) {\r\n                        selection.push(element);\r\n                        didChangeSelection = true;\r\n                    }\r\n                    if (oldFocus.has(id) && focus.indexOf(element) === -1) {\r\n                        focus.push(element);\r\n                        didChangeFocus = true;\r\n                    }\r\n                }\r\n            }\r\n            node.children.forEach(visit);\r\n        };\r\n        visit(this.tree.getCompressedTreeNode(node === this.root ? null : node));\r\n        if (didChangeSelection) {\r\n            this.setSelection(selection);\r\n        }\r\n        if (didChangeFocus) {\r\n            this.setFocus(focus);\r\n        }\r\n    };\r\n    // For compressed async data trees, `TreeVisibility.Recurse` doesn't currently work\r\n    // and we have to filter everything beforehand\r\n    // Related to #85193 and #85835\r\n    CompressibleAsyncDataTree.prototype.processChildren = function (children) {\r\n        var _this = this;\r\n        if (this.filter) {\r\n            children = children.filter(function (e) {\r\n                var result = _this.filter.filter(e, 1 /* Visible */);\r\n                var visibility = getVisibility(result);\r\n                if (visibility === 2 /* Recurse */) {\r\n                    throw new Error('Recursive tree visibility not supported in async data compressed trees');\r\n                }\r\n                return visibility === 1 /* Visible */;\r\n            });\r\n        }\r\n        return _super.prototype.processChildren.call(this, children);\r\n    };\r\n    return CompressibleAsyncDataTree;\r\n}(AsyncDataTree));\r\nexport { CompressibleAsyncDataTree };\r\nfunction getVisibility(filterResult) {\r\n    if (typeof filterResult === 'boolean') {\r\n        return filterResult ? 1 /* Visible */ : 0 /* Hidden */;\r\n    }\r\n    else if (isFilterResult(filterResult)) {\r\n        return getVisibleState(filterResult.visibility);\r\n    }\r\n    else {\r\n        return getVisibleState(filterResult);\r\n    }\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nimport { Iterator } from '../../../common/iterator.js';\r\nimport { Event } from '../../../common/event.js';\r\nimport { TreeError, WeakMapper } from './tree.js';\r\nimport { ObjectTreeModel } from './objectTreeModel.js';\r\nfunction noCompress(element) {\r\n    var elements = [element.element];\r\n    var incompressible = element.incompressible || false;\r\n    return {\r\n        element: { elements: elements, incompressible: incompressible },\r\n        children: Iterator.map(Iterator.from(element.children), noCompress),\r\n        collapsible: element.collapsible,\r\n        collapsed: element.collapsed\r\n    };\r\n}\r\n// Exported only for test reasons, do not use directly\r\nexport function compress(element) {\r\n    var elements = [element.element];\r\n    var incompressible = element.incompressible || false;\r\n    var childrenIterator;\r\n    var children;\r\n    while (true) {\r\n        childrenIterator = Iterator.from(element.children);\r\n        children = Iterator.collect(childrenIterator, 2);\r\n        if (children.length !== 1) {\r\n            break;\r\n        }\r\n        element = children[0];\r\n        if (element.incompressible) {\r\n            break;\r\n        }\r\n        elements.push(element.element);\r\n    }\r\n    return {\r\n        element: { elements: elements, incompressible: incompressible },\r\n        children: Iterator.map(Iterator.concat(Iterator.fromArray(children), childrenIterator), compress),\r\n        collapsible: element.collapsible,\r\n        collapsed: element.collapsed\r\n    };\r\n}\r\nfunction _decompress(element, index) {\r\n    if (index === void 0) { index = 0; }\r\n    var children;\r\n    if (index < element.element.elements.length - 1) {\r\n        children = Iterator.single(_decompress(element, index + 1));\r\n    }\r\n    else {\r\n        children = Iterator.map(Iterator.from(element.children), function (el) { return _decompress(el, 0); });\r\n    }\r\n    if (index === 0 && element.element.incompressible) {\r\n        return {\r\n            element: element.element.elements[index],\r\n            children: children,\r\n            incompressible: true,\r\n            collapsible: element.collapsible,\r\n            collapsed: element.collapsed\r\n        };\r\n    }\r\n    return {\r\n        element: element.element.elements[index],\r\n        children: children,\r\n        collapsible: element.collapsible,\r\n        collapsed: element.collapsed\r\n    };\r\n}\r\n// Exported only for test reasons, do not use directly\r\nexport function decompress(element) {\r\n    return _decompress(element, 0);\r\n}\r\nfunction splice(treeElement, element, children) {\r\n    if (treeElement.element === element) {\r\n        return __assign(__assign({}, treeElement), { children: children });\r\n    }\r\n    return __assign(__assign({}, treeElement), { children: Iterator.map(Iterator.from(treeElement.children), function (e) { return splice(e, element, children); }) });\r\n}\r\n// Exported only for test reasons, do not use directly\r\nvar CompressedObjectTreeModel = /** @class */ (function () {\r\n    function CompressedObjectTreeModel(user, list, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.user = user;\r\n        this.nodes = new Map();\r\n        this.model = new ObjectTreeModel(user, list, options);\r\n        this.enabled = typeof options.compressionEnabled === 'undefined' ? true : options.compressionEnabled;\r\n    }\r\n    Object.defineProperty(CompressedObjectTreeModel.prototype, \"onDidSplice\", {\r\n        get: function () { return this.model.onDidSplice; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedObjectTreeModel.prototype, \"onDidChangeCollapseState\", {\r\n        get: function () { return this.model.onDidChangeCollapseState; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompressedObjectTreeModel.prototype.setChildren = function (element, children) {\r\n        if (element === null) {\r\n            var compressedChildren = Iterator.map(Iterator.from(children), this.enabled ? compress : noCompress);\r\n            this._setChildren(null, compressedChildren);\r\n            return;\r\n        }\r\n        var compressedNode = this.nodes.get(element);\r\n        if (!compressedNode) {\r\n            throw new Error('Unknown compressed tree node');\r\n        }\r\n        var node = this.model.getNode(compressedNode);\r\n        var compressedParentNode = this.model.getParentNodeLocation(compressedNode);\r\n        var parent = this.model.getNode(compressedParentNode);\r\n        var decompressedElement = decompress(node);\r\n        var splicedElement = splice(decompressedElement, element, Iterator.from(children));\r\n        var recompressedElement = (this.enabled ? compress : noCompress)(splicedElement);\r\n        var parentChildren = parent.children\r\n            .map(function (child) { return child === node ? recompressedElement : child; });\r\n        this._setChildren(parent.element, parentChildren);\r\n    };\r\n    CompressedObjectTreeModel.prototype.setCompressionEnabled = function (enabled) {\r\n        if (enabled === this.enabled) {\r\n            return;\r\n        }\r\n        this.enabled = enabled;\r\n        var root = this.model.getNode();\r\n        var rootChildren = Iterator.from(root.children);\r\n        var decompressedRootChildren = Iterator.map(rootChildren, decompress);\r\n        var recompressedRootChildren = Iterator.map(decompressedRootChildren, enabled ? compress : noCompress);\r\n        this._setChildren(null, recompressedRootChildren);\r\n    };\r\n    CompressedObjectTreeModel.prototype._setChildren = function (node, children) {\r\n        var _this = this;\r\n        var insertedElements = new Set();\r\n        var _onDidCreateNode = function (node) {\r\n            for (var _i = 0, _a = node.element.elements; _i < _a.length; _i++) {\r\n                var element = _a[_i];\r\n                insertedElements.add(element);\r\n                _this.nodes.set(element, node.element);\r\n            }\r\n        };\r\n        var _onDidDeleteNode = function (node) {\r\n            for (var _i = 0, _a = node.element.elements; _i < _a.length; _i++) {\r\n                var element = _a[_i];\r\n                if (!insertedElements.has(element)) {\r\n                    _this.nodes.delete(element);\r\n                }\r\n            }\r\n        };\r\n        this.model.setChildren(node, children, _onDidCreateNode, _onDidDeleteNode);\r\n    };\r\n    CompressedObjectTreeModel.prototype.has = function (element) {\r\n        return this.nodes.has(element);\r\n    };\r\n    CompressedObjectTreeModel.prototype.getListIndex = function (location) {\r\n        var node = this.getCompressedNode(location);\r\n        return this.model.getListIndex(node);\r\n    };\r\n    CompressedObjectTreeModel.prototype.getListRenderCount = function (location) {\r\n        var node = this.getCompressedNode(location);\r\n        return this.model.getListRenderCount(node);\r\n    };\r\n    CompressedObjectTreeModel.prototype.getNode = function (location) {\r\n        if (typeof location === 'undefined') {\r\n            return this.model.getNode();\r\n        }\r\n        var node = this.getCompressedNode(location);\r\n        return this.model.getNode(node);\r\n    };\r\n    // TODO: review this\r\n    CompressedObjectTreeModel.prototype.getNodeLocation = function (node) {\r\n        var compressedNode = this.model.getNodeLocation(node);\r\n        if (compressedNode === null) {\r\n            return null;\r\n        }\r\n        return compressedNode.elements[compressedNode.elements.length - 1];\r\n    };\r\n    // TODO: review this\r\n    CompressedObjectTreeModel.prototype.getParentNodeLocation = function (location) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        var parentNode = this.model.getParentNodeLocation(compressedNode);\r\n        if (parentNode === null) {\r\n            return null;\r\n        }\r\n        return parentNode.elements[parentNode.elements.length - 1];\r\n    };\r\n    CompressedObjectTreeModel.prototype.isCollapsible = function (location) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        return this.model.isCollapsible(compressedNode);\r\n    };\r\n    CompressedObjectTreeModel.prototype.setCollapsible = function (location, collapsible) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        return this.model.setCollapsible(compressedNode, collapsible);\r\n    };\r\n    CompressedObjectTreeModel.prototype.isCollapsed = function (location) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        return this.model.isCollapsed(compressedNode);\r\n    };\r\n    CompressedObjectTreeModel.prototype.setCollapsed = function (location, collapsed, recursive) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        return this.model.setCollapsed(compressedNode, collapsed, recursive);\r\n    };\r\n    CompressedObjectTreeModel.prototype.expandTo = function (location) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        this.model.expandTo(compressedNode);\r\n    };\r\n    CompressedObjectTreeModel.prototype.rerender = function (location) {\r\n        var compressedNode = this.getCompressedNode(location);\r\n        this.model.rerender(compressedNode);\r\n    };\r\n    CompressedObjectTreeModel.prototype.refilter = function () {\r\n        this.model.refilter();\r\n    };\r\n    CompressedObjectTreeModel.prototype.getCompressedNode = function (element) {\r\n        if (element === null) {\r\n            return null;\r\n        }\r\n        var node = this.nodes.get(element);\r\n        if (!node) {\r\n            throw new TreeError(this.user, \"Tree element not found: \" + element);\r\n        }\r\n        return node;\r\n    };\r\n    return CompressedObjectTreeModel;\r\n}());\r\nexport { CompressedObjectTreeModel };\r\nexport var DefaultElementMapper = function (elements) { return elements[elements.length - 1]; };\r\nvar CompressedTreeNodeWrapper = /** @class */ (function () {\r\n    function CompressedTreeNodeWrapper(unwrapper, node) {\r\n        this.unwrapper = unwrapper;\r\n        this.node = node;\r\n    }\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"element\", {\r\n        get: function () { return this.node.element === null ? null : this.unwrapper(this.node.element); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"children\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this.node.children.map(function (node) { return new CompressedTreeNodeWrapper(_this.unwrapper, node); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"depth\", {\r\n        get: function () { return this.node.depth; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\r\n        get: function () { return this.node.visibleChildrenCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"visibleChildIndex\", {\r\n        get: function () { return this.node.visibleChildIndex; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"collapsible\", {\r\n        get: function () { return this.node.collapsible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"collapsed\", {\r\n        get: function () { return this.node.collapsed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"visible\", {\r\n        get: function () { return this.node.visible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressedTreeNodeWrapper.prototype, \"filterData\", {\r\n        get: function () { return this.node.filterData; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return CompressedTreeNodeWrapper;\r\n}());\r\nfunction mapList(nodeMapper, list) {\r\n    return {\r\n        splice: function (start, deleteCount, toInsert) {\r\n            list.splice(start, deleteCount, toInsert.map(function (node) { return nodeMapper.map(node); }));\r\n        }\r\n    };\r\n}\r\nfunction mapOptions(compressedNodeUnwrapper, options) {\r\n    return __assign(__assign({}, options), { sorter: options.sorter && {\r\n            compare: function (node, otherNode) {\r\n                return options.sorter.compare(node.elements[0], otherNode.elements[0]);\r\n            }\r\n        }, identityProvider: options.identityProvider && {\r\n            getId: function (node) {\r\n                return options.identityProvider.getId(compressedNodeUnwrapper(node));\r\n            }\r\n        }, filter: options.filter && {\r\n            filter: function (node, parentVisibility) {\r\n                return options.filter.filter(compressedNodeUnwrapper(node), parentVisibility);\r\n            }\r\n        } });\r\n}\r\nvar CompressibleObjectTreeModel = /** @class */ (function () {\r\n    function CompressibleObjectTreeModel(user, list, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this.elementMapper = options.elementMapper || DefaultElementMapper;\r\n        var compressedNodeUnwrapper = function (node) { return _this.elementMapper(node.elements); };\r\n        this.nodeMapper = new WeakMapper(function (node) { return new CompressedTreeNodeWrapper(compressedNodeUnwrapper, node); });\r\n        this.model = new CompressedObjectTreeModel(user, mapList(this.nodeMapper, list), mapOptions(compressedNodeUnwrapper, options));\r\n    }\r\n    Object.defineProperty(CompressibleObjectTreeModel.prototype, \"onDidSplice\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(this.model.onDidSplice, function (_a) {\r\n                var insertedNodes = _a.insertedNodes, deletedNodes = _a.deletedNodes;\r\n                return ({\r\n                    insertedNodes: insertedNodes.map(function (node) { return _this.nodeMapper.map(node); }),\r\n                    deletedNodes: deletedNodes.map(function (node) { return _this.nodeMapper.map(node); }),\r\n                });\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleObjectTreeModel.prototype, \"onDidChangeCollapseState\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(this.model.onDidChangeCollapseState, function (_a) {\r\n                var node = _a.node, deep = _a.deep;\r\n                return ({\r\n                    node: _this.nodeMapper.map(node),\r\n                    deep: deep\r\n                });\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompressibleObjectTreeModel.prototype.setChildren = function (element, children) {\r\n        this.model.setChildren(element, children);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.setCompressionEnabled = function (enabled) {\r\n        this.model.setCompressionEnabled(enabled);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.has = function (location) {\r\n        return this.model.has(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.getListIndex = function (location) {\r\n        return this.model.getListIndex(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.getListRenderCount = function (location) {\r\n        return this.model.getListRenderCount(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.getNode = function (location) {\r\n        return this.nodeMapper.map(this.model.getNode(location));\r\n    };\r\n    CompressibleObjectTreeModel.prototype.getNodeLocation = function (node) {\r\n        return node.element;\r\n    };\r\n    CompressibleObjectTreeModel.prototype.getParentNodeLocation = function (location) {\r\n        return this.model.getParentNodeLocation(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.isCollapsible = function (location) {\r\n        return this.model.isCollapsible(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.setCollapsible = function (location, collapsed) {\r\n        return this.model.setCollapsible(location, collapsed);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.isCollapsed = function (location) {\r\n        return this.model.isCollapsed(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.setCollapsed = function (location, collapsed, recursive) {\r\n        return this.model.setCollapsed(location, collapsed, recursive);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.expandTo = function (location) {\r\n        return this.model.expandTo(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.rerender = function (location) {\r\n        return this.model.rerender(location);\r\n    };\r\n    CompressibleObjectTreeModel.prototype.refilter = function () {\r\n        return this.model.refilter();\r\n    };\r\n    CompressibleObjectTreeModel.prototype.getCompressedTreeNode = function (location) {\r\n        if (location === void 0) { location = null; }\r\n        return this.model.getNode(location);\r\n    };\r\n    return CompressibleObjectTreeModel;\r\n}());\r\nexport { CompressibleObjectTreeModel };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { AbstractTree } from './abstractTree.js';\r\nimport { ObjectTreeModel } from './objectTreeModel.js';\r\nimport { CompressibleObjectTreeModel } from './compressedObjectTreeModel.js';\r\nimport { memoize } from '../../../common/decorators.js';\r\nvar ObjectTree = /** @class */ (function (_super) {\r\n    __extends(ObjectTree, _super);\r\n    function ObjectTree(user, container, delegate, renderers, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return _super.call(this, user, container, delegate, renderers, options) || this;\r\n    }\r\n    Object.defineProperty(ObjectTree.prototype, \"onDidChangeCollapseState\", {\r\n        get: function () { return this.model.onDidChangeCollapseState; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ObjectTree.prototype.setChildren = function (element, children) {\r\n        this.model.setChildren(element, children);\r\n    };\r\n    ObjectTree.prototype.rerender = function (element) {\r\n        if (element === undefined) {\r\n            this.view.rerender();\r\n            return;\r\n        }\r\n        this.model.rerender(element);\r\n    };\r\n    ObjectTree.prototype.hasElement = function (element) {\r\n        return this.model.has(element);\r\n    };\r\n    ObjectTree.prototype.createModel = function (user, view, options) {\r\n        return new ObjectTreeModel(user, view, options);\r\n    };\r\n    return ObjectTree;\r\n}(AbstractTree));\r\nexport { ObjectTree };\r\nvar CompressibleRenderer = /** @class */ (function () {\r\n    function CompressibleRenderer(_compressedTreeNodeProvider, renderer) {\r\n        this._compressedTreeNodeProvider = _compressedTreeNodeProvider;\r\n        this.renderer = renderer;\r\n        this.templateId = renderer.templateId;\r\n        if (renderer.onDidChangeTwistieState) {\r\n            this.onDidChangeTwistieState = renderer.onDidChangeTwistieState;\r\n        }\r\n    }\r\n    Object.defineProperty(CompressibleRenderer.prototype, \"compressedTreeNodeProvider\", {\r\n        get: function () {\r\n            return this._compressedTreeNodeProvider();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompressibleRenderer.prototype.renderTemplate = function (container) {\r\n        var data = this.renderer.renderTemplate(container);\r\n        return { compressedTreeNode: undefined, data: data };\r\n    };\r\n    CompressibleRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        var compressedTreeNode = this.compressedTreeNodeProvider.getCompressedTreeNode(node.element);\r\n        if (compressedTreeNode.element.elements.length === 1) {\r\n            templateData.compressedTreeNode = undefined;\r\n            this.renderer.renderElement(node, index, templateData.data, height);\r\n        }\r\n        else {\r\n            templateData.compressedTreeNode = compressedTreeNode;\r\n            this.renderer.renderCompressedElements(compressedTreeNode, index, templateData.data, height);\r\n        }\r\n    };\r\n    CompressibleRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        if (templateData.compressedTreeNode) {\r\n            if (this.renderer.disposeCompressedElements) {\r\n                this.renderer.disposeCompressedElements(templateData.compressedTreeNode, index, templateData.data, height);\r\n            }\r\n        }\r\n        else {\r\n            if (this.renderer.disposeElement) {\r\n                this.renderer.disposeElement(node, index, templateData.data, height);\r\n            }\r\n        }\r\n    };\r\n    CompressibleRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.data);\r\n    };\r\n    CompressibleRenderer.prototype.renderTwistie = function (element, twistieElement) {\r\n        if (this.renderer.renderTwistie) {\r\n            this.renderer.renderTwistie(element, twistieElement);\r\n        }\r\n    };\r\n    __decorate([\r\n        memoize\r\n    ], CompressibleRenderer.prototype, \"compressedTreeNodeProvider\", null);\r\n    return CompressibleRenderer;\r\n}());\r\nfunction asObjectTreeOptions(compressedTreeNodeProvider, options) {\r\n    return options && __assign(__assign({}, options), { keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && {\r\n            getKeyboardNavigationLabel: function (e) {\r\n                var compressedTreeNode;\r\n                try {\r\n                    compressedTreeNode = compressedTreeNodeProvider().getCompressedTreeNode(e);\r\n                }\r\n                catch (_a) {\r\n                    return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e);\r\n                }\r\n                if (compressedTreeNode.element.elements.length === 1) {\r\n                    return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e);\r\n                }\r\n                else {\r\n                    return options.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(compressedTreeNode.element.elements);\r\n                }\r\n            }\r\n        } });\r\n}\r\nvar CompressibleObjectTree = /** @class */ (function (_super) {\r\n    __extends(CompressibleObjectTree, _super);\r\n    function CompressibleObjectTree(user, container, delegate, renderers, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = this;\r\n        var compressedTreeNodeProvider = function () { return _this; };\r\n        var compressibleRenderers = renderers.map(function (r) { return new CompressibleRenderer(compressedTreeNodeProvider, r); });\r\n        _this = _super.call(this, user, container, delegate, compressibleRenderers, asObjectTreeOptions(compressedTreeNodeProvider, options)) || this;\r\n        return _this;\r\n    }\r\n    CompressibleObjectTree.prototype.setChildren = function (element, children) {\r\n        this.model.setChildren(element, children);\r\n    };\r\n    CompressibleObjectTree.prototype.createModel = function (user, view, options) {\r\n        return new CompressibleObjectTreeModel(user, view, options);\r\n    };\r\n    CompressibleObjectTree.prototype.updateOptions = function (optionsUpdate) {\r\n        if (optionsUpdate === void 0) { optionsUpdate = {}; }\r\n        _super.prototype.updateOptions.call(this, optionsUpdate);\r\n        if (typeof optionsUpdate.compressionEnabled !== 'undefined') {\r\n            this.model.setCompressionEnabled(optionsUpdate.compressionEnabled);\r\n        }\r\n    };\r\n    CompressibleObjectTree.prototype.getCompressedTreeNode = function (element) {\r\n        if (element === void 0) { element = null; }\r\n        return this.model.getCompressedTreeNode(element);\r\n    };\r\n    return CompressibleObjectTree;\r\n}(ObjectTree));\r\nexport { CompressibleObjectTree };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { Iterator, getSequenceIterator } from '../../../common/iterator.js';\r\nimport { IndexTreeModel } from './indexTreeModel.js';\r\nimport { TreeError } from './tree.js';\r\nimport { mergeSort } from '../../../common/arrays.js';\r\nvar ObjectTreeModel = /** @class */ (function () {\r\n    function ObjectTreeModel(user, list, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.user = user;\r\n        this.nodes = new Map();\r\n        this.nodesByIdentity = new Map();\r\n        this.model = new IndexTreeModel(user, list, null, options);\r\n        this.onDidSplice = this.model.onDidSplice;\r\n        this.onDidChangeCollapseState = this.model.onDidChangeCollapseState;\r\n        this.onDidChangeRenderNodeCount = this.model.onDidChangeRenderNodeCount;\r\n        if (options.sorter) {\r\n            this.sorter = {\r\n                compare: function (a, b) {\r\n                    return options.sorter.compare(a.element, b.element);\r\n                }\r\n            };\r\n        }\r\n        this.identityProvider = options.identityProvider;\r\n    }\r\n    ObjectTreeModel.prototype.setChildren = function (element, children, onDidCreateNode, onDidDeleteNode) {\r\n        var location = this.getElementLocation(element);\r\n        this._setChildren(location, this.preserveCollapseState(children), onDidCreateNode, onDidDeleteNode);\r\n    };\r\n    ObjectTreeModel.prototype._setChildren = function (location, children, onDidCreateNode, onDidDeleteNode) {\r\n        var _this = this;\r\n        var insertedElements = new Set();\r\n        var insertedElementIds = new Set();\r\n        var _onDidCreateNode = function (node) {\r\n            insertedElements.add(node.element);\r\n            _this.nodes.set(node.element, node);\r\n            if (_this.identityProvider) {\r\n                var id = _this.identityProvider.getId(node.element).toString();\r\n                insertedElementIds.add(id);\r\n                _this.nodesByIdentity.set(id, node);\r\n            }\r\n            if (onDidCreateNode) {\r\n                onDidCreateNode(node);\r\n            }\r\n        };\r\n        var _onDidDeleteNode = function (node) {\r\n            if (!insertedElements.has(node.element)) {\r\n                _this.nodes.delete(node.element);\r\n            }\r\n            if (_this.identityProvider) {\r\n                var id = _this.identityProvider.getId(node.element).toString();\r\n                if (!insertedElementIds.has(id)) {\r\n                    _this.nodesByIdentity.delete(id);\r\n                }\r\n            }\r\n            if (onDidDeleteNode) {\r\n                onDidDeleteNode(node);\r\n            }\r\n        };\r\n        this.model.splice(__spreadArrays(location, [0]), Number.MAX_VALUE, children, _onDidCreateNode, _onDidDeleteNode);\r\n    };\r\n    ObjectTreeModel.prototype.preserveCollapseState = function (elements) {\r\n        var _this = this;\r\n        var iterator = elements ? getSequenceIterator(elements) : Iterator.empty();\r\n        if (this.sorter) {\r\n            iterator = Iterator.fromArray(mergeSort(Iterator.collect(iterator), this.sorter.compare.bind(this.sorter)));\r\n        }\r\n        return Iterator.map(iterator, function (treeElement) {\r\n            var node = _this.nodes.get(treeElement.element);\r\n            if (!node && _this.identityProvider) {\r\n                var id = _this.identityProvider.getId(treeElement.element).toString();\r\n                node = _this.nodesByIdentity.get(id);\r\n            }\r\n            if (!node) {\r\n                return __assign(__assign({}, treeElement), { children: _this.preserveCollapseState(treeElement.children) });\r\n            }\r\n            var collapsible = typeof treeElement.collapsible === 'boolean' ? treeElement.collapsible : node.collapsible;\r\n            var collapsed = typeof treeElement.collapsed !== 'undefined' ? treeElement.collapsed : node.collapsed;\r\n            return __assign(__assign({}, treeElement), { collapsible: collapsible,\r\n                collapsed: collapsed, children: _this.preserveCollapseState(treeElement.children) });\r\n        });\r\n    };\r\n    ObjectTreeModel.prototype.rerender = function (element) {\r\n        var location = this.getElementLocation(element);\r\n        this.model.rerender(location);\r\n    };\r\n    ObjectTreeModel.prototype.has = function (element) {\r\n        return this.nodes.has(element);\r\n    };\r\n    ObjectTreeModel.prototype.getListIndex = function (element) {\r\n        var location = this.getElementLocation(element);\r\n        return this.model.getListIndex(location);\r\n    };\r\n    ObjectTreeModel.prototype.getListRenderCount = function (element) {\r\n        var location = this.getElementLocation(element);\r\n        return this.model.getListRenderCount(location);\r\n    };\r\n    ObjectTreeModel.prototype.isCollapsible = function (element) {\r\n        var location = this.getElementLocation(element);\r\n        return this.model.isCollapsible(location);\r\n    };\r\n    ObjectTreeModel.prototype.setCollapsible = function (element, collapsible) {\r\n        var location = this.getElementLocation(element);\r\n        return this.model.setCollapsible(location, collapsible);\r\n    };\r\n    ObjectTreeModel.prototype.isCollapsed = function (element) {\r\n        var location = this.getElementLocation(element);\r\n        return this.model.isCollapsed(location);\r\n    };\r\n    ObjectTreeModel.prototype.setCollapsed = function (element, collapsed, recursive) {\r\n        var location = this.getElementLocation(element);\r\n        return this.model.setCollapsed(location, collapsed, recursive);\r\n    };\r\n    ObjectTreeModel.prototype.expandTo = function (element) {\r\n        var location = this.getElementLocation(element);\r\n        this.model.expandTo(location);\r\n    };\r\n    ObjectTreeModel.prototype.refilter = function () {\r\n        this.model.refilter();\r\n    };\r\n    ObjectTreeModel.prototype.getNode = function (element) {\r\n        if (element === void 0) { element = null; }\r\n        if (element === null) {\r\n            return this.model.getNode(this.model.rootRef);\r\n        }\r\n        var node = this.nodes.get(element);\r\n        if (!node) {\r\n            throw new TreeError(this.user, \"Tree element not found: \" + element);\r\n        }\r\n        return node;\r\n    };\r\n    ObjectTreeModel.prototype.getNodeLocation = function (node) {\r\n        return node.element;\r\n    };\r\n    ObjectTreeModel.prototype.getParentNodeLocation = function (element) {\r\n        if (element === null) {\r\n            throw new TreeError(this.user, \"Invalid getParentNodeLocation call\");\r\n        }\r\n        var node = this.nodes.get(element);\r\n        if (!node) {\r\n            throw new TreeError(this.user, \"Tree element not found: \" + element);\r\n        }\r\n        var location = this.model.getNodeLocation(node);\r\n        var parentLocation = this.model.getParentNodeLocation(location);\r\n        var parent = this.model.getNode(parentLocation);\r\n        return parent.element;\r\n    };\r\n    ObjectTreeModel.prototype.getElementLocation = function (element) {\r\n        if (element === null) {\r\n            return [];\r\n        }\r\n        var node = this.nodes.get(element);\r\n        if (!node) {\r\n            throw new TreeError(this.user, \"Tree element not found: \" + element);\r\n        }\r\n        return this.model.getNodeLocation(node);\r\n    };\r\n    return ObjectTreeModel;\r\n}());\r\nexport { ObjectTreeModel };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { TreeError } from './tree.js';\r\nimport { tail2 } from '../../../common/arrays.js';\r\nimport { Emitter, EventBufferer } from '../../../common/event.js';\r\nimport { Iterator } from '../../../common/iterator.js';\r\nexport function isFilterResult(obj) {\r\n    return typeof obj === 'object' && 'visibility' in obj && 'data' in obj;\r\n}\r\nexport function getVisibleState(visibility) {\r\n    switch (visibility) {\r\n        case true: return 1 /* Visible */;\r\n        case false: return 0 /* Hidden */;\r\n        default: return visibility;\r\n    }\r\n}\r\nfunction isCollapsibleStateUpdate(update) {\r\n    return typeof update.collapsible === 'boolean';\r\n}\r\nvar IndexTreeModel = /** @class */ (function () {\r\n    function IndexTreeModel(user, list, rootElement, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.user = user;\r\n        this.list = list;\r\n        this.rootRef = [];\r\n        this.eventBufferer = new EventBufferer();\r\n        this._onDidChangeCollapseState = new Emitter();\r\n        this.onDidChangeCollapseState = this.eventBufferer.wrapEvent(this._onDidChangeCollapseState.event);\r\n        this._onDidChangeRenderNodeCount = new Emitter();\r\n        this.onDidChangeRenderNodeCount = this.eventBufferer.wrapEvent(this._onDidChangeRenderNodeCount.event);\r\n        this._onDidSplice = new Emitter();\r\n        this.onDidSplice = this._onDidSplice.event;\r\n        this.collapseByDefault = typeof options.collapseByDefault === 'undefined' ? false : options.collapseByDefault;\r\n        this.filter = options.filter;\r\n        this.autoExpandSingleChildren = typeof options.autoExpandSingleChildren === 'undefined' ? false : options.autoExpandSingleChildren;\r\n        this.root = {\r\n            parent: undefined,\r\n            element: rootElement,\r\n            children: [],\r\n            depth: 0,\r\n            visibleChildrenCount: 0,\r\n            visibleChildIndex: -1,\r\n            collapsible: false,\r\n            collapsed: false,\r\n            renderNodeCount: 0,\r\n            visible: true,\r\n            filterData: undefined\r\n        };\r\n    }\r\n    IndexTreeModel.prototype.splice = function (location, deleteCount, toInsert, onDidCreateNode, onDidDeleteNode) {\r\n        var _a;\r\n        var _this = this;\r\n        if (location.length === 0) {\r\n            throw new TreeError(this.user, 'Invalid tree location');\r\n        }\r\n        var _b = this.getParentNodeWithListIndex(location), parentNode = _b.parentNode, listIndex = _b.listIndex, revealed = _b.revealed, visible = _b.visible;\r\n        var treeListElementsToInsert = [];\r\n        var nodesToInsertIterator = Iterator.map(Iterator.from(toInsert), function (el) { return _this.createTreeNode(el, parentNode, parentNode.visible ? 1 /* Visible */ : 0 /* Hidden */, revealed, treeListElementsToInsert, onDidCreateNode); });\r\n        var lastIndex = location[location.length - 1];\r\n        // figure out what's the visible child start index right before the\r\n        // splice point\r\n        var visibleChildStartIndex = 0;\r\n        for (var i = lastIndex; i >= 0 && i < parentNode.children.length; i--) {\r\n            var child = parentNode.children[i];\r\n            if (child.visible) {\r\n                visibleChildStartIndex = child.visibleChildIndex;\r\n                break;\r\n            }\r\n        }\r\n        var nodesToInsert = [];\r\n        var insertedVisibleChildrenCount = 0;\r\n        var renderNodeCount = 0;\r\n        Iterator.forEach(nodesToInsertIterator, function (child) {\r\n            nodesToInsert.push(child);\r\n            renderNodeCount += child.renderNodeCount;\r\n            if (child.visible) {\r\n                child.visibleChildIndex = visibleChildStartIndex + insertedVisibleChildrenCount++;\r\n            }\r\n        });\r\n        var deletedNodes = (_a = parentNode.children).splice.apply(_a, __spreadArrays([lastIndex, deleteCount], nodesToInsert));\r\n        // figure out what is the count of deleted visible children\r\n        var deletedVisibleChildrenCount = 0;\r\n        for (var _i = 0, deletedNodes_1 = deletedNodes; _i < deletedNodes_1.length; _i++) {\r\n            var child = deletedNodes_1[_i];\r\n            if (child.visible) {\r\n                deletedVisibleChildrenCount++;\r\n            }\r\n        }\r\n        // and adjust for all visible children after the splice point\r\n        if (deletedVisibleChildrenCount !== 0) {\r\n            for (var i = lastIndex + nodesToInsert.length; i < parentNode.children.length; i++) {\r\n                var child = parentNode.children[i];\r\n                if (child.visible) {\r\n                    child.visibleChildIndex -= deletedVisibleChildrenCount;\r\n                }\r\n            }\r\n        }\r\n        // update parent's visible children count\r\n        parentNode.visibleChildrenCount += insertedVisibleChildrenCount - deletedVisibleChildrenCount;\r\n        if (revealed && visible) {\r\n            var visibleDeleteCount = deletedNodes.reduce(function (r, node) { return r + (node.visible ? node.renderNodeCount : 0); }, 0);\r\n            this._updateAncestorsRenderNodeCount(parentNode, renderNodeCount - visibleDeleteCount);\r\n            this.list.splice(listIndex, visibleDeleteCount, treeListElementsToInsert);\r\n        }\r\n        if (deletedNodes.length > 0 && onDidDeleteNode) {\r\n            var visit_1 = function (node) {\r\n                onDidDeleteNode(node);\r\n                node.children.forEach(visit_1);\r\n            };\r\n            deletedNodes.forEach(visit_1);\r\n        }\r\n        this._onDidSplice.fire({ insertedNodes: nodesToInsert, deletedNodes: deletedNodes });\r\n    };\r\n    IndexTreeModel.prototype.rerender = function (location) {\r\n        if (location.length === 0) {\r\n            throw new TreeError(this.user, 'Invalid tree location');\r\n        }\r\n        var _a = this.getTreeNodeWithListIndex(location), node = _a.node, listIndex = _a.listIndex, revealed = _a.revealed;\r\n        if (revealed) {\r\n            this.list.splice(listIndex, 1, [node]);\r\n        }\r\n    };\r\n    IndexTreeModel.prototype.has = function (location) {\r\n        return this.hasTreeNode(location);\r\n    };\r\n    IndexTreeModel.prototype.getListIndex = function (location) {\r\n        var _a = this.getTreeNodeWithListIndex(location), listIndex = _a.listIndex, visible = _a.visible, revealed = _a.revealed;\r\n        return visible && revealed ? listIndex : -1;\r\n    };\r\n    IndexTreeModel.prototype.getListRenderCount = function (location) {\r\n        return this.getTreeNode(location).renderNodeCount;\r\n    };\r\n    IndexTreeModel.prototype.isCollapsible = function (location) {\r\n        return this.getTreeNode(location).collapsible;\r\n    };\r\n    IndexTreeModel.prototype.setCollapsible = function (location, collapsible) {\r\n        var _this = this;\r\n        var node = this.getTreeNode(location);\r\n        if (typeof collapsible === 'undefined') {\r\n            collapsible = !node.collapsible;\r\n        }\r\n        var update = { collapsible: collapsible };\r\n        return this.eventBufferer.bufferEvents(function () { return _this._setCollapseState(location, update); });\r\n    };\r\n    IndexTreeModel.prototype.isCollapsed = function (location) {\r\n        return this.getTreeNode(location).collapsed;\r\n    };\r\n    IndexTreeModel.prototype.setCollapsed = function (location, collapsed, recursive) {\r\n        var _this = this;\r\n        var node = this.getTreeNode(location);\r\n        if (typeof collapsed === 'undefined') {\r\n            collapsed = !node.collapsed;\r\n        }\r\n        var update = { collapsed: collapsed, recursive: recursive || false };\r\n        return this.eventBufferer.bufferEvents(function () { return _this._setCollapseState(location, update); });\r\n    };\r\n    IndexTreeModel.prototype._setCollapseState = function (location, update) {\r\n        var _a = this.getTreeNodeWithListIndex(location), node = _a.node, listIndex = _a.listIndex, revealed = _a.revealed;\r\n        var result = this._setListNodeCollapseState(node, listIndex, revealed, update);\r\n        if (node !== this.root && this.autoExpandSingleChildren && result && !isCollapsibleStateUpdate(update) && node.collapsible && !node.collapsed && !update.recursive) {\r\n            var onlyVisibleChildIndex = -1;\r\n            for (var i = 0; i < node.children.length; i++) {\r\n                var child = node.children[i];\r\n                if (child.visible) {\r\n                    if (onlyVisibleChildIndex > -1) {\r\n                        onlyVisibleChildIndex = -1;\r\n                        break;\r\n                    }\r\n                    else {\r\n                        onlyVisibleChildIndex = i;\r\n                    }\r\n                }\r\n            }\r\n            if (onlyVisibleChildIndex > -1) {\r\n                this._setCollapseState(__spreadArrays(location, [onlyVisibleChildIndex]), update);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    IndexTreeModel.prototype._setListNodeCollapseState = function (node, listIndex, revealed, update) {\r\n        var result = this._setNodeCollapseState(node, update, false);\r\n        if (!revealed || !node.visible || !result) {\r\n            return result;\r\n        }\r\n        var previousRenderNodeCount = node.renderNodeCount;\r\n        var toInsert = this.updateNodeAfterCollapseChange(node);\r\n        var deleteCount = previousRenderNodeCount - (listIndex === -1 ? 0 : 1);\r\n        this.list.splice(listIndex + 1, deleteCount, toInsert.slice(1));\r\n        return result;\r\n    };\r\n    IndexTreeModel.prototype._setNodeCollapseState = function (node, update, deep) {\r\n        var result;\r\n        if (node === this.root) {\r\n            result = false;\r\n        }\r\n        else {\r\n            if (isCollapsibleStateUpdate(update)) {\r\n                result = node.collapsible !== update.collapsible;\r\n                node.collapsible = update.collapsible;\r\n            }\r\n            else if (!node.collapsible) {\r\n                result = false;\r\n            }\r\n            else {\r\n                result = node.collapsed !== update.collapsed;\r\n                node.collapsed = update.collapsed;\r\n            }\r\n            if (result) {\r\n                this._onDidChangeCollapseState.fire({ node: node, deep: deep });\r\n            }\r\n        }\r\n        if (!isCollapsibleStateUpdate(update) && update.recursive) {\r\n            for (var _i = 0, _a = node.children; _i < _a.length; _i++) {\r\n                var child = _a[_i];\r\n                result = this._setNodeCollapseState(child, update, true) || result;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    IndexTreeModel.prototype.expandTo = function (location) {\r\n        var _this = this;\r\n        this.eventBufferer.bufferEvents(function () {\r\n            var node = _this.getTreeNode(location);\r\n            while (node.parent) {\r\n                node = node.parent;\r\n                location = location.slice(0, location.length - 1);\r\n                if (node.collapsed) {\r\n                    _this._setCollapseState(location, { collapsed: false, recursive: false });\r\n                }\r\n            }\r\n        });\r\n    };\r\n    IndexTreeModel.prototype.refilter = function () {\r\n        var previousRenderNodeCount = this.root.renderNodeCount;\r\n        var toInsert = this.updateNodeAfterFilterChange(this.root);\r\n        this.list.splice(0, previousRenderNodeCount, toInsert);\r\n    };\r\n    IndexTreeModel.prototype.createTreeNode = function (treeElement, parent, parentVisibility, revealed, treeListElements, onDidCreateNode) {\r\n        var _this = this;\r\n        var node = {\r\n            parent: parent,\r\n            element: treeElement.element,\r\n            children: [],\r\n            depth: parent.depth + 1,\r\n            visibleChildrenCount: 0,\r\n            visibleChildIndex: -1,\r\n            collapsible: typeof treeElement.collapsible === 'boolean' ? treeElement.collapsible : (typeof treeElement.collapsed !== 'undefined'),\r\n            collapsed: typeof treeElement.collapsed === 'undefined' ? this.collapseByDefault : treeElement.collapsed,\r\n            renderNodeCount: 1,\r\n            visible: true,\r\n            filterData: undefined\r\n        };\r\n        var visibility = this._filterNode(node, parentVisibility);\r\n        if (revealed) {\r\n            treeListElements.push(node);\r\n        }\r\n        var childElements = Iterator.from(treeElement.children);\r\n        var childRevealed = revealed && visibility !== 0 /* Hidden */ && !node.collapsed;\r\n        var childNodes = Iterator.map(childElements, function (el) { return _this.createTreeNode(el, node, visibility, childRevealed, treeListElements, onDidCreateNode); });\r\n        var visibleChildrenCount = 0;\r\n        var renderNodeCount = 1;\r\n        Iterator.forEach(childNodes, function (child) {\r\n            node.children.push(child);\r\n            renderNodeCount += child.renderNodeCount;\r\n            if (child.visible) {\r\n                child.visibleChildIndex = visibleChildrenCount++;\r\n            }\r\n        });\r\n        node.collapsible = node.collapsible || node.children.length > 0;\r\n        node.visibleChildrenCount = visibleChildrenCount;\r\n        node.visible = visibility === 2 /* Recurse */ ? visibleChildrenCount > 0 : (visibility === 1 /* Visible */);\r\n        if (!node.visible) {\r\n            node.renderNodeCount = 0;\r\n            if (revealed) {\r\n                treeListElements.pop();\r\n            }\r\n        }\r\n        else if (!node.collapsed) {\r\n            node.renderNodeCount = renderNodeCount;\r\n        }\r\n        if (onDidCreateNode) {\r\n            onDidCreateNode(node);\r\n        }\r\n        return node;\r\n    };\r\n    IndexTreeModel.prototype.updateNodeAfterCollapseChange = function (node) {\r\n        var previousRenderNodeCount = node.renderNodeCount;\r\n        var result = [];\r\n        this._updateNodeAfterCollapseChange(node, result);\r\n        this._updateAncestorsRenderNodeCount(node.parent, result.length - previousRenderNodeCount);\r\n        return result;\r\n    };\r\n    IndexTreeModel.prototype._updateNodeAfterCollapseChange = function (node, result) {\r\n        if (node.visible === false) {\r\n            return 0;\r\n        }\r\n        result.push(node);\r\n        node.renderNodeCount = 1;\r\n        if (!node.collapsed) {\r\n            for (var _i = 0, _a = node.children; _i < _a.length; _i++) {\r\n                var child = _a[_i];\r\n                node.renderNodeCount += this._updateNodeAfterCollapseChange(child, result);\r\n            }\r\n        }\r\n        this._onDidChangeRenderNodeCount.fire(node);\r\n        return node.renderNodeCount;\r\n    };\r\n    IndexTreeModel.prototype.updateNodeAfterFilterChange = function (node) {\r\n        var previousRenderNodeCount = node.renderNodeCount;\r\n        var result = [];\r\n        this._updateNodeAfterFilterChange(node, node.visible ? 1 /* Visible */ : 0 /* Hidden */, result);\r\n        this._updateAncestorsRenderNodeCount(node.parent, result.length - previousRenderNodeCount);\r\n        return result;\r\n    };\r\n    IndexTreeModel.prototype._updateNodeAfterFilterChange = function (node, parentVisibility, result, revealed) {\r\n        if (revealed === void 0) { revealed = true; }\r\n        var visibility;\r\n        if (node !== this.root) {\r\n            visibility = this._filterNode(node, parentVisibility);\r\n            if (visibility === 0 /* Hidden */) {\r\n                node.visible = false;\r\n                node.renderNodeCount = 0;\r\n                return false;\r\n            }\r\n            if (revealed) {\r\n                result.push(node);\r\n            }\r\n        }\r\n        var resultStartLength = result.length;\r\n        node.renderNodeCount = node === this.root ? 0 : 1;\r\n        var hasVisibleDescendants = false;\r\n        if (!node.collapsed || visibility !== 0 /* Hidden */) {\r\n            var visibleChildIndex = 0;\r\n            for (var _i = 0, _a = node.children; _i < _a.length; _i++) {\r\n                var child = _a[_i];\r\n                hasVisibleDescendants = this._updateNodeAfterFilterChange(child, visibility, result, revealed && !node.collapsed) || hasVisibleDescendants;\r\n                if (child.visible) {\r\n                    child.visibleChildIndex = visibleChildIndex++;\r\n                }\r\n            }\r\n            node.visibleChildrenCount = visibleChildIndex;\r\n        }\r\n        else {\r\n            node.visibleChildrenCount = 0;\r\n        }\r\n        if (node !== this.root) {\r\n            node.visible = visibility === 2 /* Recurse */ ? hasVisibleDescendants : (visibility === 1 /* Visible */);\r\n        }\r\n        if (!node.visible) {\r\n            node.renderNodeCount = 0;\r\n            if (revealed) {\r\n                result.pop();\r\n            }\r\n        }\r\n        else if (!node.collapsed) {\r\n            node.renderNodeCount += result.length - resultStartLength;\r\n        }\r\n        this._onDidChangeRenderNodeCount.fire(node);\r\n        return node.visible;\r\n    };\r\n    IndexTreeModel.prototype._updateAncestorsRenderNodeCount = function (node, diff) {\r\n        if (diff === 0) {\r\n            return;\r\n        }\r\n        while (node) {\r\n            node.renderNodeCount += diff;\r\n            this._onDidChangeRenderNodeCount.fire(node);\r\n            node = node.parent;\r\n        }\r\n    };\r\n    IndexTreeModel.prototype._filterNode = function (node, parentVisibility) {\r\n        var result = this.filter ? this.filter.filter(node.element, parentVisibility) : 1 /* Visible */;\r\n        if (typeof result === 'boolean') {\r\n            node.filterData = undefined;\r\n            return result ? 1 /* Visible */ : 0 /* Hidden */;\r\n        }\r\n        else if (isFilterResult(result)) {\r\n            node.filterData = result.data;\r\n            return getVisibleState(result.visibility);\r\n        }\r\n        else {\r\n            node.filterData = undefined;\r\n            return getVisibleState(result);\r\n        }\r\n    };\r\n    // cheap\r\n    IndexTreeModel.prototype.hasTreeNode = function (location, node) {\r\n        if (node === void 0) { node = this.root; }\r\n        if (!location || location.length === 0) {\r\n            return true;\r\n        }\r\n        var index = location[0], rest = location.slice(1);\r\n        if (index < 0 || index > node.children.length) {\r\n            return false;\r\n        }\r\n        return this.hasTreeNode(rest, node.children[index]);\r\n    };\r\n    // cheap\r\n    IndexTreeModel.prototype.getTreeNode = function (location, node) {\r\n        if (node === void 0) { node = this.root; }\r\n        if (!location || location.length === 0) {\r\n            return node;\r\n        }\r\n        var index = location[0], rest = location.slice(1);\r\n        if (index < 0 || index > node.children.length) {\r\n            throw new TreeError(this.user, 'Invalid tree location');\r\n        }\r\n        return this.getTreeNode(rest, node.children[index]);\r\n    };\r\n    // expensive\r\n    IndexTreeModel.prototype.getTreeNodeWithListIndex = function (location) {\r\n        if (location.length === 0) {\r\n            return { node: this.root, listIndex: -1, revealed: true, visible: false };\r\n        }\r\n        var _a = this.getParentNodeWithListIndex(location), parentNode = _a.parentNode, listIndex = _a.listIndex, revealed = _a.revealed, visible = _a.visible;\r\n        var index = location[location.length - 1];\r\n        if (index < 0 || index > parentNode.children.length) {\r\n            throw new TreeError(this.user, 'Invalid tree location');\r\n        }\r\n        var node = parentNode.children[index];\r\n        return { node: node, listIndex: listIndex, revealed: revealed, visible: visible && node.visible };\r\n    };\r\n    IndexTreeModel.prototype.getParentNodeWithListIndex = function (location, node, listIndex, revealed, visible) {\r\n        if (node === void 0) { node = this.root; }\r\n        if (listIndex === void 0) { listIndex = 0; }\r\n        if (revealed === void 0) { revealed = true; }\r\n        if (visible === void 0) { visible = true; }\r\n        var index = location[0], rest = location.slice(1);\r\n        if (index < 0 || index > node.children.length) {\r\n            throw new TreeError(this.user, 'Invalid tree location');\r\n        }\r\n        // TODO@joao perf!\r\n        for (var i = 0; i < index; i++) {\r\n            listIndex += node.children[i].renderNodeCount;\r\n        }\r\n        revealed = revealed && !node.collapsed;\r\n        visible = visible && node.visible;\r\n        if (rest.length === 0) {\r\n            return { parentNode: node, listIndex: listIndex, revealed: revealed, visible: visible };\r\n        }\r\n        return this.getParentNodeWithListIndex(rest, node.children[index], listIndex + 1, revealed, visible);\r\n    };\r\n    IndexTreeModel.prototype.getNode = function (location) {\r\n        if (location === void 0) { location = []; }\r\n        return this.getTreeNode(location);\r\n    };\r\n    // TODO@joao perf!\r\n    IndexTreeModel.prototype.getNodeLocation = function (node) {\r\n        var location = [];\r\n        var indexTreeNode = node; // typing woes\r\n        while (indexTreeNode.parent) {\r\n            location.push(indexTreeNode.parent.children.indexOf(indexTreeNode));\r\n            indexTreeNode = indexTreeNode.parent;\r\n        }\r\n        return location.reverse();\r\n    };\r\n    IndexTreeModel.prototype.getParentNodeLocation = function (location) {\r\n        if (location.length === 0) {\r\n            return undefined;\r\n        }\r\n        else if (location.length === 1) {\r\n            return [];\r\n        }\r\n        else {\r\n            return tail2(location)[0];\r\n        }\r\n    };\r\n    return IndexTreeModel;\r\n}());\r\nexport { IndexTreeModel };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport './media/tree.css';\r\nimport { dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { List, MouseController, DefaultKeyboardNavigationDelegate } from '../list/listWidget.js';\r\nimport { append, $, toggleClass, getDomNodePagePosition, removeClass, addClass, hasClass, createStyleSheet, clearNode, addClasses, removeClasses } from '../../dom.js';\r\nimport { Event, Relay, Emitter, EventBufferer } from '../../../common/event.js';\r\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\r\nimport { StaticDND, DragAndDropData } from '../../dnd.js';\r\nimport { range, equals, distinctES6, fromSet } from '../../../common/arrays.js';\r\nimport { ElementsDragAndDropData } from '../list/listView.js';\r\nimport { domEvent } from '../../event.js';\r\nimport { fuzzyScore, FuzzyScore } from '../../../common/filters.js';\r\nimport { getVisibleState, isFilterResult } from './indexTreeModel.js';\r\nimport { localize } from '../../../../nls.js';\r\nimport { disposableTimeout } from '../../../common/async.js';\r\nimport { isMacintosh } from '../../../common/platform.js';\r\nimport { values } from '../../../common/map.js';\r\nimport { clamp } from '../../../common/numbers.js';\r\nimport { SetMap } from '../../../common/collections.js';\r\nvar TreeElementsDragAndDropData = /** @class */ (function (_super) {\r\n    __extends(TreeElementsDragAndDropData, _super);\r\n    function TreeElementsDragAndDropData(data) {\r\n        var _this = _super.call(this, data.elements.map(function (node) { return node.element; })) || this;\r\n        _this.data = data;\r\n        return _this;\r\n    }\r\n    return TreeElementsDragAndDropData;\r\n}(ElementsDragAndDropData));\r\nfunction asTreeDragAndDropData(data) {\r\n    if (data instanceof ElementsDragAndDropData) {\r\n        return new TreeElementsDragAndDropData(data);\r\n    }\r\n    return data;\r\n}\r\nvar TreeNodeListDragAndDrop = /** @class */ (function () {\r\n    function TreeNodeListDragAndDrop(modelProvider, dnd) {\r\n        this.modelProvider = modelProvider;\r\n        this.dnd = dnd;\r\n        this.autoExpandDisposable = Disposable.None;\r\n    }\r\n    TreeNodeListDragAndDrop.prototype.getDragURI = function (node) {\r\n        return this.dnd.getDragURI(node.element);\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.getDragLabel = function (nodes, originalEvent) {\r\n        if (this.dnd.getDragLabel) {\r\n            return this.dnd.getDragLabel(nodes.map(function (node) { return node.element; }), originalEvent);\r\n        }\r\n        return undefined;\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.onDragStart = function (data, originalEvent) {\r\n        if (this.dnd.onDragStart) {\r\n            this.dnd.onDragStart(asTreeDragAndDropData(data), originalEvent);\r\n        }\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.onDragOver = function (data, targetNode, targetIndex, originalEvent, raw) {\r\n        var _this = this;\r\n        if (raw === void 0) { raw = true; }\r\n        var result = this.dnd.onDragOver(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n        var didChangeAutoExpandNode = this.autoExpandNode !== targetNode;\r\n        if (didChangeAutoExpandNode) {\r\n            this.autoExpandDisposable.dispose();\r\n            this.autoExpandNode = targetNode;\r\n        }\r\n        if (typeof targetNode === 'undefined') {\r\n            return result;\r\n        }\r\n        if (didChangeAutoExpandNode && typeof result !== 'boolean' && result.autoExpand) {\r\n            this.autoExpandDisposable = disposableTimeout(function () {\r\n                var model = _this.modelProvider();\r\n                var ref = model.getNodeLocation(targetNode);\r\n                if (model.isCollapsed(ref)) {\r\n                    model.setCollapsed(ref, false);\r\n                }\r\n                _this.autoExpandNode = undefined;\r\n            }, 500);\r\n        }\r\n        if (typeof result === 'boolean' || !result.accept || typeof result.bubble === 'undefined' || result.feedback) {\r\n            if (!raw) {\r\n                var accept = typeof result === 'boolean' ? result : result.accept;\r\n                var effect = typeof result === 'boolean' ? undefined : result.effect;\r\n                return { accept: accept, effect: effect, feedback: [targetIndex] };\r\n            }\r\n            return result;\r\n        }\r\n        if (result.bubble === 1 /* Up */) {\r\n            var model_1 = this.modelProvider();\r\n            var ref_1 = model_1.getNodeLocation(targetNode);\r\n            var parentRef = model_1.getParentNodeLocation(ref_1);\r\n            var parentNode = model_1.getNode(parentRef);\r\n            var parentIndex = parentRef && model_1.getListIndex(parentRef);\r\n            return this.onDragOver(data, parentNode, parentIndex, originalEvent, false);\r\n        }\r\n        var model = this.modelProvider();\r\n        var ref = model.getNodeLocation(targetNode);\r\n        var start = model.getListIndex(ref);\r\n        var length = model.getListRenderCount(ref);\r\n        return __assign(__assign({}, result), { feedback: range(start, start + length) });\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.drop = function (data, targetNode, targetIndex, originalEvent) {\r\n        this.autoExpandDisposable.dispose();\r\n        this.autoExpandNode = undefined;\r\n        this.dnd.drop(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n    };\r\n    TreeNodeListDragAndDrop.prototype.onDragEnd = function (originalEvent) {\r\n        if (this.dnd.onDragEnd) {\r\n            this.dnd.onDragEnd(originalEvent);\r\n        }\r\n    };\r\n    return TreeNodeListDragAndDrop;\r\n}());\r\nfunction asListOptions(modelProvider, options) {\r\n    return options && __assign(__assign({}, options), { identityProvider: options.identityProvider && {\r\n            getId: function (el) {\r\n                return options.identityProvider.getId(el.element);\r\n            }\r\n        }, dnd: options.dnd && new TreeNodeListDragAndDrop(modelProvider, options.dnd), multipleSelectionController: options.multipleSelectionController && {\r\n            isSelectionSingleChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionSingleChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            },\r\n            isSelectionRangeChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionRangeChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            }\r\n        }, accessibilityProvider: options.accessibilityProvider && __assign(__assign({}, options.accessibilityProvider), { getAriaLabel: function (e) {\r\n                return options.accessibilityProvider.getAriaLabel(e.element);\r\n            },\r\n            getAriaLevel: function (node) {\r\n                return node.depth;\r\n            }, getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && (function (node) {\r\n                return options.accessibilityProvider.getActiveDescendantId(node.element);\r\n            }) }), keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && __assign(__assign({}, options.keyboardNavigationLabelProvider), { getKeyboardNavigationLabel: function (node) {\r\n                return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(node.element);\r\n            } }), enableKeyboardNavigation: options.simpleKeyboardNavigation, ariaProvider: {\r\n            getSetSize: function (node) {\r\n                var model = modelProvider();\r\n                var ref = model.getNodeLocation(node);\r\n                var parentRef = model.getParentNodeLocation(ref);\r\n                var parentNode = model.getNode(parentRef);\r\n                return parentNode.visibleChildrenCount;\r\n            },\r\n            getPosInSet: function (node) {\r\n                return node.visibleChildIndex + 1;\r\n            },\r\n            isChecked: options.ariaProvider && options.ariaProvider.isChecked ? function (node) {\r\n                return options.ariaProvider.isChecked(node.element);\r\n            } : undefined,\r\n            getRole: options.ariaProvider && options.ariaProvider.getRole ? function (node) {\r\n                return options.ariaProvider.getRole(node.element);\r\n            } : undefined\r\n        } });\r\n}\r\nvar ComposedTreeDelegate = /** @class */ (function () {\r\n    function ComposedTreeDelegate(delegate) {\r\n        this.delegate = delegate;\r\n    }\r\n    ComposedTreeDelegate.prototype.getHeight = function (element) {\r\n        return this.delegate.getHeight(element.element);\r\n    };\r\n    ComposedTreeDelegate.prototype.getTemplateId = function (element) {\r\n        return this.delegate.getTemplateId(element.element);\r\n    };\r\n    ComposedTreeDelegate.prototype.hasDynamicHeight = function (element) {\r\n        return !!this.delegate.hasDynamicHeight && this.delegate.hasDynamicHeight(element.element);\r\n    };\r\n    ComposedTreeDelegate.prototype.setDynamicHeight = function (element, height) {\r\n        if (this.delegate.setDynamicHeight) {\r\n            this.delegate.setDynamicHeight(element.element, height);\r\n        }\r\n    };\r\n    return ComposedTreeDelegate;\r\n}());\r\nexport { ComposedTreeDelegate };\r\nexport var RenderIndentGuides;\r\n(function (RenderIndentGuides) {\r\n    RenderIndentGuides[\"None\"] = \"none\";\r\n    RenderIndentGuides[\"OnHover\"] = \"onHover\";\r\n    RenderIndentGuides[\"Always\"] = \"always\";\r\n})(RenderIndentGuides || (RenderIndentGuides = {}));\r\nvar EventCollection = /** @class */ (function () {\r\n    function EventCollection(onDidChange, _elements) {\r\n        var _this = this;\r\n        if (_elements === void 0) { _elements = []; }\r\n        this._elements = _elements;\r\n        this.onDidChange = Event.forEach(onDidChange, function (elements) { return _this._elements = elements; });\r\n    }\r\n    Object.defineProperty(EventCollection.prototype, \"elements\", {\r\n        get: function () {\r\n            return this._elements;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return EventCollection;\r\n}());\r\nvar TreeRenderer = /** @class */ (function () {\r\n    function TreeRenderer(renderer, modelProvider, onDidChangeCollapseState, activeNodes, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.renderer = renderer;\r\n        this.modelProvider = modelProvider;\r\n        this.activeNodes = activeNodes;\r\n        this.renderedElements = new Map();\r\n        this.renderedNodes = new Map();\r\n        this.indent = TreeRenderer.DefaultIndent;\r\n        this.hideTwistiesOfChildlessElements = false;\r\n        this.shouldRenderIndentGuides = false;\r\n        this.renderedIndentGuides = new SetMap();\r\n        this.activeIndentNodes = new Set();\r\n        this.indentGuidesDisposable = Disposable.None;\r\n        this.disposables = new DisposableStore();\r\n        this.templateId = renderer.templateId;\r\n        this.updateOptions(options);\r\n        Event.map(onDidChangeCollapseState, function (e) { return e.node; })(this.onDidChangeNodeTwistieState, this, this.disposables);\r\n        if (renderer.onDidChangeTwistieState) {\r\n            renderer.onDidChangeTwistieState(this.onDidChangeTwistieState, this, this.disposables);\r\n        }\r\n    }\r\n    TreeRenderer.prototype.updateOptions = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (typeof options.indent !== 'undefined') {\r\n            this.indent = clamp(options.indent, 0, 40);\r\n        }\r\n        if (typeof options.renderIndentGuides !== 'undefined') {\r\n            var shouldRenderIndentGuides = options.renderIndentGuides !== RenderIndentGuides.None;\r\n            if (shouldRenderIndentGuides !== this.shouldRenderIndentGuides) {\r\n                this.shouldRenderIndentGuides = shouldRenderIndentGuides;\r\n                this.indentGuidesDisposable.dispose();\r\n                if (shouldRenderIndentGuides) {\r\n                    var disposables = new DisposableStore();\r\n                    this.activeNodes.onDidChange(this._onDidChangeActiveNodes, this, disposables);\r\n                    this.indentGuidesDisposable = disposables;\r\n                    this._onDidChangeActiveNodes(this.activeNodes.elements);\r\n                }\r\n            }\r\n        }\r\n        if (typeof options.hideTwistiesOfChildlessElements !== 'undefined') {\r\n            this.hideTwistiesOfChildlessElements = options.hideTwistiesOfChildlessElements;\r\n        }\r\n    };\r\n    TreeRenderer.prototype.renderTemplate = function (container) {\r\n        var el = append(container, $('.monaco-tl-row'));\r\n        var indent = append(el, $('.monaco-tl-indent'));\r\n        var twistie = append(el, $('.monaco-tl-twistie'));\r\n        var contents = append(el, $('.monaco-tl-contents'));\r\n        var templateData = this.renderer.renderTemplate(contents);\r\n        return { container: container, indent: indent, twistie: twistie, indentGuidesDisposable: Disposable.None, templateData: templateData };\r\n    };\r\n    TreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        if (typeof height === 'number') {\r\n            this.renderedNodes.set(node, { templateData: templateData, height: height });\r\n            this.renderedElements.set(node.element, node);\r\n        }\r\n        var indent = TreeRenderer.DefaultIndent + (node.depth - 1) * this.indent;\r\n        templateData.twistie.style.paddingLeft = indent + \"px\";\r\n        templateData.indent.style.width = indent + this.indent - 16 + \"px\";\r\n        this.renderTwistie(node, templateData);\r\n        if (typeof height === 'number') {\r\n            this.renderIndentGuides(node, templateData);\r\n        }\r\n        this.renderer.renderElement(node, index, templateData.templateData, height);\r\n    };\r\n    TreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        templateData.indentGuidesDisposable.dispose();\r\n        if (this.renderer.disposeElement) {\r\n            this.renderer.disposeElement(node, index, templateData.templateData, height);\r\n        }\r\n        if (typeof height === 'number') {\r\n            this.renderedNodes.delete(node);\r\n            this.renderedElements.delete(node.element);\r\n        }\r\n    };\r\n    TreeRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.templateData);\r\n    };\r\n    TreeRenderer.prototype.onDidChangeTwistieState = function (element) {\r\n        var node = this.renderedElements.get(element);\r\n        if (!node) {\r\n            return;\r\n        }\r\n        this.onDidChangeNodeTwistieState(node);\r\n    };\r\n    TreeRenderer.prototype.onDidChangeNodeTwistieState = function (node) {\r\n        var data = this.renderedNodes.get(node);\r\n        if (!data) {\r\n            return;\r\n        }\r\n        this.renderTwistie(node, data.templateData);\r\n        this._onDidChangeActiveNodes(this.activeNodes.elements);\r\n        this.renderIndentGuides(node, data.templateData);\r\n    };\r\n    TreeRenderer.prototype.renderTwistie = function (node, templateData) {\r\n        if (this.renderer.renderTwistie) {\r\n            this.renderer.renderTwistie(node.element, templateData.twistie);\r\n        }\r\n        if (node.collapsible && (!this.hideTwistiesOfChildlessElements || node.visibleChildrenCount > 0)) {\r\n            addClasses(templateData.twistie, 'codicon', 'codicon-chevron-down', 'collapsible');\r\n            toggleClass(templateData.twistie, 'collapsed', node.collapsed);\r\n        }\r\n        else {\r\n            removeClasses(templateData.twistie, 'codicon', 'codicon-chevron-down', 'collapsible', 'collapsed');\r\n        }\r\n        if (node.collapsible) {\r\n            templateData.container.setAttribute('aria-expanded', String(!node.collapsed));\r\n        }\r\n        else {\r\n            templateData.container.removeAttribute('aria-expanded');\r\n        }\r\n    };\r\n    TreeRenderer.prototype.renderIndentGuides = function (target, templateData) {\r\n        var _this = this;\r\n        clearNode(templateData.indent);\r\n        templateData.indentGuidesDisposable.dispose();\r\n        if (!this.shouldRenderIndentGuides) {\r\n            return;\r\n        }\r\n        var disposableStore = new DisposableStore();\r\n        var model = this.modelProvider();\r\n        var node = target;\r\n        var _loop_1 = function () {\r\n            var ref = model.getNodeLocation(node);\r\n            var parentRef = model.getParentNodeLocation(ref);\r\n            if (!parentRef) {\r\n                return \"break\";\r\n            }\r\n            var parent_1 = model.getNode(parentRef);\r\n            var guide = $('.indent-guide', { style: \"width: \" + this_1.indent + \"px\" });\r\n            if (this_1.activeIndentNodes.has(parent_1)) {\r\n                addClass(guide, 'active');\r\n            }\r\n            if (templateData.indent.childElementCount === 0) {\r\n                templateData.indent.appendChild(guide);\r\n            }\r\n            else {\r\n                templateData.indent.insertBefore(guide, templateData.indent.firstElementChild);\r\n            }\r\n            this_1.renderedIndentGuides.add(parent_1, guide);\r\n            disposableStore.add(toDisposable(function () { return _this.renderedIndentGuides.delete(parent_1, guide); }));\r\n            node = parent_1;\r\n        };\r\n        var this_1 = this;\r\n        while (true) {\r\n            var state_1 = _loop_1();\r\n            if (state_1 === \"break\")\r\n                break;\r\n        }\r\n        templateData.indentGuidesDisposable = disposableStore;\r\n    };\r\n    TreeRenderer.prototype._onDidChangeActiveNodes = function (nodes) {\r\n        var _this = this;\r\n        if (!this.shouldRenderIndentGuides) {\r\n            return;\r\n        }\r\n        var set = new Set();\r\n        var model = this.modelProvider();\r\n        nodes.forEach(function (node) {\r\n            var ref = model.getNodeLocation(node);\r\n            try {\r\n                var parentRef = model.getParentNodeLocation(ref);\r\n                if (node.collapsible && node.children.length > 0 && !node.collapsed) {\r\n                    set.add(node);\r\n                }\r\n                else if (parentRef) {\r\n                    set.add(model.getNode(parentRef));\r\n                }\r\n            }\r\n            catch (_a) {\r\n                // noop\r\n            }\r\n        });\r\n        this.activeIndentNodes.forEach(function (node) {\r\n            if (!set.has(node)) {\r\n                _this.renderedIndentGuides.forEach(node, function (line) { return removeClass(line, 'active'); });\r\n            }\r\n        });\r\n        set.forEach(function (node) {\r\n            if (!_this.activeIndentNodes.has(node)) {\r\n                _this.renderedIndentGuides.forEach(node, function (line) { return addClass(line, 'active'); });\r\n            }\r\n        });\r\n        this.activeIndentNodes = set;\r\n    };\r\n    TreeRenderer.prototype.dispose = function () {\r\n        this.renderedNodes.clear();\r\n        this.renderedElements.clear();\r\n        this.indentGuidesDisposable.dispose();\r\n        dispose(this.disposables);\r\n    };\r\n    TreeRenderer.DefaultIndent = 8;\r\n    return TreeRenderer;\r\n}());\r\nvar TypeFilter = /** @class */ (function () {\r\n    function TypeFilter(tree, keyboardNavigationLabelProvider, _filter) {\r\n        this.tree = tree;\r\n        this.keyboardNavigationLabelProvider = keyboardNavigationLabelProvider;\r\n        this._filter = _filter;\r\n        this._totalCount = 0;\r\n        this._matchCount = 0;\r\n        this._pattern = '';\r\n        this._lowercasePattern = '';\r\n        this.disposables = new DisposableStore();\r\n        tree.onWillRefilter(this.reset, this, this.disposables);\r\n    }\r\n    Object.defineProperty(TypeFilter.prototype, \"totalCount\", {\r\n        get: function () { return this._totalCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilter.prototype, \"matchCount\", {\r\n        get: function () { return this._matchCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilter.prototype, \"pattern\", {\r\n        set: function (pattern) {\r\n            this._pattern = pattern;\r\n            this._lowercasePattern = pattern.toLowerCase();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    TypeFilter.prototype.filter = function (element, parentVisibility) {\r\n        if (this._filter) {\r\n            var result = this._filter.filter(element, parentVisibility);\r\n            if (this.tree.options.simpleKeyboardNavigation) {\r\n                return result;\r\n            }\r\n            var visibility = void 0;\r\n            if (typeof result === 'boolean') {\r\n                visibility = result ? 1 /* Visible */ : 0 /* Hidden */;\r\n            }\r\n            else if (isFilterResult(result)) {\r\n                visibility = getVisibleState(result.visibility);\r\n            }\r\n            else {\r\n                visibility = result;\r\n            }\r\n            if (visibility === 0 /* Hidden */) {\r\n                return false;\r\n            }\r\n        }\r\n        this._totalCount++;\r\n        if (this.tree.options.simpleKeyboardNavigation || !this._pattern) {\r\n            this._matchCount++;\r\n            return { data: FuzzyScore.Default, visibility: true };\r\n        }\r\n        var label = this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(element);\r\n        var labelStr = label && label.toString();\r\n        if (typeof labelStr === 'undefined') {\r\n            return { data: FuzzyScore.Default, visibility: true };\r\n        }\r\n        var score = fuzzyScore(this._pattern, this._lowercasePattern, 0, labelStr, labelStr.toLowerCase(), 0, true);\r\n        if (!score) {\r\n            if (this.tree.options.filterOnType) {\r\n                return 2 /* Recurse */;\r\n            }\r\n            else {\r\n                return { data: FuzzyScore.Default, visibility: true };\r\n            }\r\n            // DEMO: smarter filter ?\r\n            // return parentVisibility === TreeVisibility.Visible ? true : TreeVisibility.Recurse;\r\n        }\r\n        this._matchCount++;\r\n        return { data: score, visibility: true };\r\n    };\r\n    TypeFilter.prototype.reset = function () {\r\n        this._totalCount = 0;\r\n        this._matchCount = 0;\r\n    };\r\n    TypeFilter.prototype.dispose = function () {\r\n        dispose(this.disposables);\r\n    };\r\n    return TypeFilter;\r\n}());\r\nvar TypeFilterController = /** @class */ (function () {\r\n    function TypeFilterController(tree, model, view, filter, keyboardNavigationDelegate) {\r\n        this.tree = tree;\r\n        this.view = view;\r\n        this.filter = filter;\r\n        this.keyboardNavigationDelegate = keyboardNavigationDelegate;\r\n        this._enabled = false;\r\n        this._pattern = '';\r\n        this._empty = false;\r\n        this._onDidChangeEmptyState = new Emitter();\r\n        this.positionClassName = 'ne';\r\n        this.automaticKeyboardNavigation = true;\r\n        this.triggered = false;\r\n        this._onDidChangePattern = new Emitter();\r\n        this.enabledDisposables = new DisposableStore();\r\n        this.disposables = new DisposableStore();\r\n        this.domNode = $(\".monaco-list-type-filter.\" + this.positionClassName);\r\n        this.domNode.draggable = true;\r\n        domEvent(this.domNode, 'dragstart')(this.onDragStart, this, this.disposables);\r\n        this.messageDomNode = append(view.getHTMLElement(), $(\".monaco-list-type-filter-message\"));\r\n        this.labelDomNode = append(this.domNode, $('span.label'));\r\n        var controls = append(this.domNode, $('.controls'));\r\n        this._filterOnType = !!tree.options.filterOnType;\r\n        this.filterOnTypeDomNode = append(controls, $('input.filter.codicon.codicon-list-selection'));\r\n        this.filterOnTypeDomNode.type = 'checkbox';\r\n        this.filterOnTypeDomNode.checked = this._filterOnType;\r\n        this.filterOnTypeDomNode.tabIndex = -1;\r\n        this.updateFilterOnTypeTitle();\r\n        domEvent(this.filterOnTypeDomNode, 'input')(this.onDidChangeFilterOnType, this, this.disposables);\r\n        this.clearDomNode = append(controls, $('button.clear.codicon.codicon-close'));\r\n        this.clearDomNode.tabIndex = -1;\r\n        this.clearDomNode.title = localize('clear', \"Clear\");\r\n        this.keyboardNavigationEventFilter = tree.options.keyboardNavigationEventFilter;\r\n        model.onDidSplice(this.onDidSpliceModel, this, this.disposables);\r\n        this.updateOptions(tree.options);\r\n    }\r\n    Object.defineProperty(TypeFilterController.prototype, \"enabled\", {\r\n        get: function () { return this._enabled; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilterController.prototype, \"pattern\", {\r\n        get: function () { return this._pattern; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TypeFilterController.prototype, \"filterOnType\", {\r\n        get: function () { return this._filterOnType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    TypeFilterController.prototype.updateOptions = function (options) {\r\n        if (options.simpleKeyboardNavigation) {\r\n            this.disable();\r\n        }\r\n        else {\r\n            this.enable();\r\n        }\r\n        if (typeof options.filterOnType !== 'undefined') {\r\n            this._filterOnType = !!options.filterOnType;\r\n            this.filterOnTypeDomNode.checked = this._filterOnType;\r\n        }\r\n        if (typeof options.automaticKeyboardNavigation !== 'undefined') {\r\n            this.automaticKeyboardNavigation = options.automaticKeyboardNavigation;\r\n        }\r\n        this.tree.refilter();\r\n        this.render();\r\n        if (!this.automaticKeyboardNavigation) {\r\n            this.onEventOrInput('');\r\n        }\r\n    };\r\n    TypeFilterController.prototype.enable = function () {\r\n        var _this = this;\r\n        if (this._enabled) {\r\n            return;\r\n        }\r\n        var onKeyDown = Event.chain(domEvent(this.view.getHTMLElement(), 'keydown'))\r\n            .filter(function (e) { return !isInputElement(e.target) || e.target === _this.filterOnTypeDomNode; })\r\n            .filter(function (e) { return e.key !== 'Dead' && !/^Media/.test(e.key); })\r\n            .map(function (e) { return new StandardKeyboardEvent(e); })\r\n            .filter(this.keyboardNavigationEventFilter || (function () { return true; }))\r\n            .filter(function () { return _this.automaticKeyboardNavigation || _this.triggered; })\r\n            .filter(function (e) { return _this.keyboardNavigationDelegate.mightProducePrintableCharacter(e) || ((_this.pattern.length > 0 || _this.triggered) && ((e.keyCode === 9 /* Escape */ || e.keyCode === 1 /* Backspace */) && !e.altKey && !e.ctrlKey && !e.metaKey) || (e.keyCode === 1 /* Backspace */ && (isMacintosh ? (e.altKey && !e.metaKey) : e.ctrlKey) && !e.shiftKey)); })\r\n            .forEach(function (e) { e.stopPropagation(); e.preventDefault(); })\r\n            .event;\r\n        var onClear = domEvent(this.clearDomNode, 'click');\r\n        Event.chain(Event.any(onKeyDown, onClear))\r\n            .event(this.onEventOrInput, this, this.enabledDisposables);\r\n        this.filter.pattern = '';\r\n        this.tree.refilter();\r\n        this.render();\r\n        this._enabled = true;\r\n        this.triggered = false;\r\n    };\r\n    TypeFilterController.prototype.disable = function () {\r\n        if (!this._enabled) {\r\n            return;\r\n        }\r\n        this.domNode.remove();\r\n        this.enabledDisposables.clear();\r\n        this.tree.refilter();\r\n        this.render();\r\n        this._enabled = false;\r\n        this.triggered = false;\r\n    };\r\n    TypeFilterController.prototype.onEventOrInput = function (e) {\r\n        if (typeof e === 'string') {\r\n            this.onInput(e);\r\n        }\r\n        else if (e instanceof MouseEvent || e.keyCode === 9 /* Escape */ || (e.keyCode === 1 /* Backspace */ && (isMacintosh ? e.altKey : e.ctrlKey))) {\r\n            this.onInput('');\r\n        }\r\n        else if (e.keyCode === 1 /* Backspace */) {\r\n            this.onInput(this.pattern.length === 0 ? '' : this.pattern.substr(0, this.pattern.length - 1));\r\n        }\r\n        else {\r\n            this.onInput(this.pattern + e.browserEvent.key);\r\n        }\r\n    };\r\n    TypeFilterController.prototype.onInput = function (pattern) {\r\n        var container = this.view.getHTMLElement();\r\n        if (pattern && !this.domNode.parentElement) {\r\n            container.append(this.domNode);\r\n        }\r\n        else if (!pattern && this.domNode.parentElement) {\r\n            this.domNode.remove();\r\n            this.tree.domFocus();\r\n        }\r\n        this._pattern = pattern;\r\n        this._onDidChangePattern.fire(pattern);\r\n        this.filter.pattern = pattern;\r\n        this.tree.refilter();\r\n        if (pattern) {\r\n            this.tree.focusNext(0, true, undefined, function (node) { return !FuzzyScore.isDefault(node.filterData); });\r\n        }\r\n        var focus = this.tree.getFocus();\r\n        if (focus.length > 0) {\r\n            var element = focus[0];\r\n            if (this.tree.getRelativeTop(element) === null) {\r\n                this.tree.reveal(element, 0.5);\r\n            }\r\n        }\r\n        this.render();\r\n        if (!pattern) {\r\n            this.triggered = false;\r\n        }\r\n    };\r\n    TypeFilterController.prototype.onDragStart = function () {\r\n        var _this = this;\r\n        var container = this.view.getHTMLElement();\r\n        var left = getDomNodePagePosition(container).left;\r\n        var containerWidth = container.clientWidth;\r\n        var midContainerWidth = containerWidth / 2;\r\n        var width = this.domNode.clientWidth;\r\n        var disposables = new DisposableStore();\r\n        var positionClassName = this.positionClassName;\r\n        var updatePosition = function () {\r\n            switch (positionClassName) {\r\n                case 'nw':\r\n                    _this.domNode.style.top = \"4px\";\r\n                    _this.domNode.style.left = \"4px\";\r\n                    break;\r\n                case 'ne':\r\n                    _this.domNode.style.top = \"4px\";\r\n                    _this.domNode.style.left = containerWidth - width - 6 + \"px\";\r\n                    break;\r\n            }\r\n        };\r\n        var onDragOver = function (event) {\r\n            event.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\r\n            var x = event.screenX - left;\r\n            if (event.dataTransfer) {\r\n                event.dataTransfer.dropEffect = 'none';\r\n            }\r\n            if (x < midContainerWidth) {\r\n                positionClassName = 'nw';\r\n            }\r\n            else {\r\n                positionClassName = 'ne';\r\n            }\r\n            updatePosition();\r\n        };\r\n        var onDragEnd = function () {\r\n            _this.positionClassName = positionClassName;\r\n            _this.domNode.className = \"monaco-list-type-filter \" + _this.positionClassName;\r\n            _this.domNode.style.top = '';\r\n            _this.domNode.style.left = '';\r\n            dispose(disposables);\r\n        };\r\n        updatePosition();\r\n        removeClass(this.domNode, positionClassName);\r\n        addClass(this.domNode, 'dragging');\r\n        disposables.add(toDisposable(function () { return removeClass(_this.domNode, 'dragging'); }));\r\n        domEvent(document, 'dragover')(onDragOver, null, disposables);\r\n        domEvent(this.domNode, 'dragend')(onDragEnd, null, disposables);\r\n        StaticDND.CurrentDragAndDropData = new DragAndDropData('vscode-ui');\r\n        disposables.add(toDisposable(function () { return StaticDND.CurrentDragAndDropData = undefined; }));\r\n    };\r\n    TypeFilterController.prototype.onDidSpliceModel = function () {\r\n        if (!this._enabled || this.pattern.length === 0) {\r\n            return;\r\n        }\r\n        this.tree.refilter();\r\n        this.render();\r\n    };\r\n    TypeFilterController.prototype.onDidChangeFilterOnType = function () {\r\n        this.tree.updateOptions({ filterOnType: this.filterOnTypeDomNode.checked });\r\n        this.tree.refilter();\r\n        this.tree.domFocus();\r\n        this.render();\r\n        this.updateFilterOnTypeTitle();\r\n    };\r\n    TypeFilterController.prototype.updateFilterOnTypeTitle = function () {\r\n        if (this.filterOnType) {\r\n            this.filterOnTypeDomNode.title = localize('disable filter on type', \"Disable Filter on Type\");\r\n        }\r\n        else {\r\n            this.filterOnTypeDomNode.title = localize('enable filter on type', \"Enable Filter on Type\");\r\n        }\r\n    };\r\n    TypeFilterController.prototype.render = function () {\r\n        var noMatches = this.filter.totalCount > 0 && this.filter.matchCount === 0;\r\n        if (this.pattern && this.tree.options.filterOnType && noMatches) {\r\n            this.messageDomNode.textContent = localize('empty', \"No elements found\");\r\n            this._empty = true;\r\n        }\r\n        else {\r\n            this.messageDomNode.innerHTML = '';\r\n            this._empty = false;\r\n        }\r\n        toggleClass(this.domNode, 'no-matches', noMatches);\r\n        this.domNode.title = localize('found', \"Matched {0} out of {1} elements\", this.filter.matchCount, this.filter.totalCount);\r\n        this.labelDomNode.textContent = this.pattern.length > 16 ? '…' + this.pattern.substr(this.pattern.length - 16) : this.pattern;\r\n        this._onDidChangeEmptyState.fire(this._empty);\r\n    };\r\n    TypeFilterController.prototype.shouldAllowFocus = function (node) {\r\n        if (!this.enabled || !this.pattern || this.filterOnType) {\r\n            return true;\r\n        }\r\n        if (this.filter.totalCount > 0 && this.filter.matchCount <= 1) {\r\n            return true;\r\n        }\r\n        return !FuzzyScore.isDefault(node.filterData);\r\n    };\r\n    TypeFilterController.prototype.dispose = function () {\r\n        if (this._enabled) {\r\n            this.domNode.remove();\r\n            this.enabledDisposables.dispose();\r\n            this._enabled = false;\r\n            this.triggered = false;\r\n        }\r\n        this._onDidChangePattern.dispose();\r\n        dispose(this.disposables);\r\n    };\r\n    return TypeFilterController;\r\n}());\r\nfunction isInputElement(e) {\r\n    return e.tagName === 'INPUT' || e.tagName === 'TEXTAREA';\r\n}\r\nfunction asTreeEvent(event) {\r\n    return {\r\n        elements: event.elements.map(function (node) { return node.element; }),\r\n        browserEvent: event.browserEvent\r\n    };\r\n}\r\nfunction dfs(node, fn) {\r\n    fn(node);\r\n    node.children.forEach(function (child) { return dfs(child, fn); });\r\n}\r\n/**\r\n * The trait concept needs to exist at the tree level, because collapsed\r\n * tree nodes will not be known by the list.\r\n */\r\nvar Trait = /** @class */ (function () {\r\n    function Trait(identityProvider) {\r\n        this.identityProvider = identityProvider;\r\n        this.nodes = [];\r\n        this._onDidChange = new Emitter();\r\n        this.onDidChange = this._onDidChange.event;\r\n    }\r\n    Object.defineProperty(Trait.prototype, \"nodeSet\", {\r\n        get: function () {\r\n            if (!this._nodeSet) {\r\n                this._nodeSet = this.createNodeSet();\r\n            }\r\n            return this._nodeSet;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Trait.prototype.set = function (nodes, browserEvent) {\r\n        if (equals(this.nodes, nodes)) {\r\n            return;\r\n        }\r\n        this._set(nodes, false, browserEvent);\r\n    };\r\n    Trait.prototype._set = function (nodes, silent, browserEvent) {\r\n        this.nodes = __spreadArrays(nodes);\r\n        this.elements = undefined;\r\n        this._nodeSet = undefined;\r\n        if (!silent) {\r\n            var that_1 = this;\r\n            this._onDidChange.fire({ get elements() { return that_1.get(); }, browserEvent: browserEvent });\r\n        }\r\n    };\r\n    Trait.prototype.get = function () {\r\n        if (!this.elements) {\r\n            this.elements = this.nodes.map(function (node) { return node.element; });\r\n        }\r\n        return __spreadArrays(this.elements);\r\n    };\r\n    Trait.prototype.getNodes = function () {\r\n        return this.nodes;\r\n    };\r\n    Trait.prototype.has = function (node) {\r\n        return this.nodeSet.has(node);\r\n    };\r\n    Trait.prototype.onDidModelSplice = function (_a) {\r\n        var _this = this;\r\n        var insertedNodes = _a.insertedNodes, deletedNodes = _a.deletedNodes;\r\n        if (!this.identityProvider) {\r\n            var set_1 = this.createNodeSet();\r\n            var visit_1 = function (node) { return set_1.delete(node); };\r\n            deletedNodes.forEach(function (node) { return dfs(node, visit_1); });\r\n            this.set(values(set_1));\r\n            return;\r\n        }\r\n        var deletedNodesIdSet = new Set();\r\n        var deletedNodesVisitor = function (node) { return deletedNodesIdSet.add(_this.identityProvider.getId(node.element).toString()); };\r\n        deletedNodes.forEach(function (node) { return dfs(node, deletedNodesVisitor); });\r\n        var insertedNodesMap = new Map();\r\n        var insertedNodesVisitor = function (node) { return insertedNodesMap.set(_this.identityProvider.getId(node.element).toString(), node); };\r\n        insertedNodes.forEach(function (node) { return dfs(node, insertedNodesVisitor); });\r\n        var nodes = [];\r\n        for (var _i = 0, _b = this.nodes; _i < _b.length; _i++) {\r\n            var node = _b[_i];\r\n            var id = this.identityProvider.getId(node.element).toString();\r\n            var wasDeleted = deletedNodesIdSet.has(id);\r\n            if (!wasDeleted) {\r\n                nodes.push(node);\r\n            }\r\n            else {\r\n                var insertedNode = insertedNodesMap.get(id);\r\n                if (insertedNode) {\r\n                    nodes.push(insertedNode);\r\n                }\r\n            }\r\n        }\r\n        this._set(nodes, true);\r\n    };\r\n    Trait.prototype.createNodeSet = function () {\r\n        var set = new Set();\r\n        for (var _i = 0, _a = this.nodes; _i < _a.length; _i++) {\r\n            var node = _a[_i];\r\n            set.add(node);\r\n        }\r\n        return set;\r\n    };\r\n    return Trait;\r\n}());\r\nvar TreeNodeListMouseController = /** @class */ (function (_super) {\r\n    __extends(TreeNodeListMouseController, _super);\r\n    function TreeNodeListMouseController(list, tree) {\r\n        var _this = _super.call(this, list) || this;\r\n        _this.tree = tree;\r\n        return _this;\r\n    }\r\n    TreeNodeListMouseController.prototype.onPointer = function (e) {\r\n        if (isInputElement(e.browserEvent.target)) {\r\n            return;\r\n        }\r\n        var node = e.element;\r\n        if (!node) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        if (this.isSelectionRangeChangeEvent(e) || this.isSelectionSingleChangeEvent(e)) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        var onTwistie = hasClass(e.browserEvent.target, 'monaco-tl-twistie');\r\n        if (!this.tree.openOnSingleClick && e.browserEvent.detail !== 2 && !onTwistie) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        var expandOnlyOnTwistieClick = false;\r\n        if (typeof this.tree.expandOnlyOnTwistieClick === 'function') {\r\n            expandOnlyOnTwistieClick = this.tree.expandOnlyOnTwistieClick(node.element);\r\n        }\r\n        else {\r\n            expandOnlyOnTwistieClick = !!this.tree.expandOnlyOnTwistieClick;\r\n        }\r\n        if (expandOnlyOnTwistieClick && !onTwistie) {\r\n            return _super.prototype.onPointer.call(this, e);\r\n        }\r\n        if (node.collapsible) {\r\n            var model = this.tree.model; // internal\r\n            var location_1 = model.getNodeLocation(node);\r\n            var recursive = e.browserEvent.altKey;\r\n            model.setCollapsed(location_1, undefined, recursive);\r\n            if (expandOnlyOnTwistieClick && onTwistie) {\r\n                return;\r\n            }\r\n        }\r\n        _super.prototype.onPointer.call(this, e);\r\n    };\r\n    TreeNodeListMouseController.prototype.onDoubleClick = function (e) {\r\n        var onTwistie = hasClass(e.browserEvent.target, 'monaco-tl-twistie');\r\n        if (onTwistie) {\r\n            return;\r\n        }\r\n        _super.prototype.onDoubleClick.call(this, e);\r\n    };\r\n    return TreeNodeListMouseController;\r\n}(MouseController));\r\n/**\r\n * We use this List subclass to restore selection and focus as nodes\r\n * get rendered in the list, possibly due to a node expand() call.\r\n */\r\nvar TreeNodeList = /** @class */ (function (_super) {\r\n    __extends(TreeNodeList, _super);\r\n    function TreeNodeList(user, container, virtualDelegate, renderers, focusTrait, selectionTrait, options) {\r\n        var _this = _super.call(this, user, container, virtualDelegate, renderers, options) || this;\r\n        _this.focusTrait = focusTrait;\r\n        _this.selectionTrait = selectionTrait;\r\n        return _this;\r\n    }\r\n    TreeNodeList.prototype.createMouseController = function (options) {\r\n        return new TreeNodeListMouseController(this, options.tree);\r\n    };\r\n    TreeNodeList.prototype.splice = function (start, deleteCount, elements) {\r\n        var _this = this;\r\n        if (elements === void 0) { elements = []; }\r\n        _super.prototype.splice.call(this, start, deleteCount, elements);\r\n        if (elements.length === 0) {\r\n            return;\r\n        }\r\n        var additionalFocus = [];\r\n        var additionalSelection = [];\r\n        elements.forEach(function (node, index) {\r\n            if (_this.focusTrait.has(node)) {\r\n                additionalFocus.push(start + index);\r\n            }\r\n            if (_this.selectionTrait.has(node)) {\r\n                additionalSelection.push(start + index);\r\n            }\r\n        });\r\n        if (additionalFocus.length > 0) {\r\n            _super.prototype.setFocus.call(this, distinctES6(__spreadArrays(_super.prototype.getFocus.call(this), additionalFocus)));\r\n        }\r\n        if (additionalSelection.length > 0) {\r\n            _super.prototype.setSelection.call(this, distinctES6(__spreadArrays(_super.prototype.getSelection.call(this), additionalSelection)));\r\n        }\r\n    };\r\n    TreeNodeList.prototype.setFocus = function (indexes, browserEvent, fromAPI) {\r\n        var _this = this;\r\n        if (fromAPI === void 0) { fromAPI = false; }\r\n        _super.prototype.setFocus.call(this, indexes, browserEvent);\r\n        if (!fromAPI) {\r\n            this.focusTrait.set(indexes.map(function (i) { return _this.element(i); }), browserEvent);\r\n        }\r\n    };\r\n    TreeNodeList.prototype.setSelection = function (indexes, browserEvent, fromAPI) {\r\n        var _this = this;\r\n        if (fromAPI === void 0) { fromAPI = false; }\r\n        _super.prototype.setSelection.call(this, indexes, browserEvent);\r\n        if (!fromAPI) {\r\n            this.selectionTrait.set(indexes.map(function (i) { return _this.element(i); }), browserEvent);\r\n        }\r\n    };\r\n    return TreeNodeList;\r\n}(List));\r\nvar AbstractTree = /** @class */ (function () {\r\n    function AbstractTree(user, container, delegate, renderers, _options) {\r\n        var _this = this;\r\n        if (_options === void 0) { _options = {}; }\r\n        this._options = _options;\r\n        this.eventBufferer = new EventBufferer();\r\n        this.disposables = new DisposableStore();\r\n        this._onWillRefilter = new Emitter();\r\n        this.onWillRefilter = this._onWillRefilter.event;\r\n        this._onDidUpdateOptions = new Emitter();\r\n        var treeDelegate = new ComposedTreeDelegate(delegate);\r\n        var onDidChangeCollapseStateRelay = new Relay();\r\n        var onDidChangeActiveNodes = new Relay();\r\n        var activeNodes = new EventCollection(onDidChangeActiveNodes.event);\r\n        this.renderers = renderers.map(function (r) { return new TreeRenderer(r, function () { return _this.model; }, onDidChangeCollapseStateRelay.event, activeNodes, _options); });\r\n        for (var _i = 0, _a = this.renderers; _i < _a.length; _i++) {\r\n            var r = _a[_i];\r\n            this.disposables.add(r);\r\n        }\r\n        var filter;\r\n        if (_options.keyboardNavigationLabelProvider) {\r\n            filter = new TypeFilter(this, _options.keyboardNavigationLabelProvider, _options.filter);\r\n            _options = __assign(__assign({}, _options), { filter: filter }); // TODO need typescript help here\r\n            this.disposables.add(filter);\r\n        }\r\n        this.focus = new Trait(_options.identityProvider);\r\n        this.selection = new Trait(_options.identityProvider);\r\n        this.view = new TreeNodeList(user, container, treeDelegate, this.renderers, this.focus, this.selection, __assign(__assign({}, asListOptions(function () { return _this.model; }, _options)), { tree: this }));\r\n        this.model = this.createModel(user, this.view, _options);\r\n        onDidChangeCollapseStateRelay.input = this.model.onDidChangeCollapseState;\r\n        var onDidModelSplice = Event.forEach(this.model.onDidSplice, function (e) {\r\n            _this.eventBufferer.bufferEvents(function () {\r\n                _this.focus.onDidModelSplice(e);\r\n                _this.selection.onDidModelSplice(e);\r\n            });\r\n        });\r\n        // Make sure the `forEach` always runs\r\n        onDidModelSplice(function () { return null; }, null, this.disposables);\r\n        // Active nodes can change when the model changes or when focus or selection change.\r\n        // We debounce it with 0 delay since these events may fire in the same stack and we only\r\n        // want to run this once. It also doesn't matter if it runs on the next tick since it's only\r\n        // a nice to have UI feature.\r\n        onDidChangeActiveNodes.input = Event.chain(Event.any(onDidModelSplice, this.focus.onDidChange, this.selection.onDidChange))\r\n            .debounce(function () { return null; }, 0)\r\n            .map(function () {\r\n            var set = new Set();\r\n            for (var _i = 0, _a = _this.focus.getNodes(); _i < _a.length; _i++) {\r\n                var node = _a[_i];\r\n                set.add(node);\r\n            }\r\n            for (var _b = 0, _c = _this.selection.getNodes(); _b < _c.length; _b++) {\r\n                var node = _c[_b];\r\n                set.add(node);\r\n            }\r\n            return fromSet(set);\r\n        }).event;\r\n        if (_options.keyboardSupport !== false) {\r\n            var onKeyDown = Event.chain(this.view.onKeyDown)\r\n                .filter(function (e) { return !isInputElement(e.target); })\r\n                .map(function (e) { return new StandardKeyboardEvent(e); });\r\n            onKeyDown.filter(function (e) { return e.keyCode === 15 /* LeftArrow */; }).on(this.onLeftArrow, this, this.disposables);\r\n            onKeyDown.filter(function (e) { return e.keyCode === 17 /* RightArrow */; }).on(this.onRightArrow, this, this.disposables);\r\n            onKeyDown.filter(function (e) { return e.keyCode === 10 /* Space */; }).on(this.onSpace, this, this.disposables);\r\n        }\r\n        if (_options.keyboardNavigationLabelProvider) {\r\n            var delegate_1 = _options.keyboardNavigationDelegate || DefaultKeyboardNavigationDelegate;\r\n            this.typeFilterController = new TypeFilterController(this, this.model, this.view, filter, delegate_1);\r\n            this.focusNavigationFilter = function (node) { return _this.typeFilterController.shouldAllowFocus(node); };\r\n            this.disposables.add(this.typeFilterController);\r\n        }\r\n        this.styleElement = createStyleSheet(this.view.getHTMLElement());\r\n        toggleClass(this.getHTMLElement(), 'always', this._options.renderIndentGuides === RenderIndentGuides.Always);\r\n    }\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidChangeFocus\", {\r\n        get: function () { return this.eventBufferer.wrapEvent(this.focus.onDidChange); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidChangeSelection\", {\r\n        get: function () { return this.eventBufferer.wrapEvent(this.selection.onDidChange); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidOpen\", {\r\n        get: function () { return Event.map(this.view.onDidOpen, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidFocus\", {\r\n        get: function () { return this.view.onDidFocus; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidChangeCollapseState\", {\r\n        get: function () { return this.model.onDidChangeCollapseState; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"openOnSingleClick\", {\r\n        get: function () { return typeof this._options.openOnSingleClick === 'undefined' ? true : this._options.openOnSingleClick; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"expandOnlyOnTwistieClick\", {\r\n        get: function () { return typeof this._options.expandOnlyOnTwistieClick === 'undefined' ? false : this._options.expandOnlyOnTwistieClick; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbstractTree.prototype, \"onDidDispose\", {\r\n        get: function () { return this.view.onDidDispose; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AbstractTree.prototype.updateOptions = function (optionsUpdate) {\r\n        if (optionsUpdate === void 0) { optionsUpdate = {}; }\r\n        this._options = __assign(__assign({}, this._options), optionsUpdate);\r\n        for (var _i = 0, _a = this.renderers; _i < _a.length; _i++) {\r\n            var renderer = _a[_i];\r\n            renderer.updateOptions(optionsUpdate);\r\n        }\r\n        this.view.updateOptions({\r\n            enableKeyboardNavigation: this._options.simpleKeyboardNavigation,\r\n            automaticKeyboardNavigation: this._options.automaticKeyboardNavigation\r\n        });\r\n        if (this.typeFilterController) {\r\n            this.typeFilterController.updateOptions(this._options);\r\n        }\r\n        this._onDidUpdateOptions.fire(this._options);\r\n        toggleClass(this.getHTMLElement(), 'always', this._options.renderIndentGuides === RenderIndentGuides.Always);\r\n    };\r\n    Object.defineProperty(AbstractTree.prototype, \"options\", {\r\n        get: function () {\r\n            return this._options;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    // Widget\r\n    AbstractTree.prototype.getHTMLElement = function () {\r\n        return this.view.getHTMLElement();\r\n    };\r\n    Object.defineProperty(AbstractTree.prototype, \"scrollTop\", {\r\n        get: function () {\r\n            return this.view.scrollTop;\r\n        },\r\n        set: function (scrollTop) {\r\n            this.view.scrollTop = scrollTop;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AbstractTree.prototype.domFocus = function () {\r\n        this.view.domFocus();\r\n    };\r\n    AbstractTree.prototype.layout = function (height, width) {\r\n        this.view.layout(height, width);\r\n    };\r\n    AbstractTree.prototype.style = function (styles) {\r\n        var suffix = \".\" + this.view.domId;\r\n        var content = [];\r\n        if (styles.treeIndentGuidesStroke) {\r\n            content.push(\".monaco-list\" + suffix + \":hover .monaco-tl-indent > .indent-guide, .monaco-list\" + suffix + \".always .monaco-tl-indent > .indent-guide  { border-color: \" + styles.treeIndentGuidesStroke.transparent(0.4) + \"; }\");\r\n            content.push(\".monaco-list\" + suffix + \" .monaco-tl-indent > .indent-guide.active { border-color: \" + styles.treeIndentGuidesStroke + \"; }\");\r\n        }\r\n        var newStyles = content.join('\\n');\r\n        if (newStyles !== this.styleElement.innerHTML) {\r\n            this.styleElement.innerHTML = newStyles;\r\n        }\r\n        this.view.style(styles);\r\n    };\r\n    AbstractTree.prototype.collapse = function (location, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return this.model.setCollapsed(location, true, recursive);\r\n    };\r\n    AbstractTree.prototype.expand = function (location, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return this.model.setCollapsed(location, false, recursive);\r\n    };\r\n    AbstractTree.prototype.isCollapsible = function (location) {\r\n        return this.model.isCollapsible(location);\r\n    };\r\n    AbstractTree.prototype.setCollapsible = function (location, collapsible) {\r\n        return this.model.setCollapsible(location, collapsible);\r\n    };\r\n    AbstractTree.prototype.isCollapsed = function (location) {\r\n        return this.model.isCollapsed(location);\r\n    };\r\n    AbstractTree.prototype.refilter = function () {\r\n        this._onWillRefilter.fire(undefined);\r\n        this.model.refilter();\r\n    };\r\n    AbstractTree.prototype.setSelection = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.model.getNode(e); });\r\n        this.selection.set(nodes, browserEvent);\r\n        var indexes = elements.map(function (e) { return _this.model.getListIndex(e); }).filter(function (i) { return i > -1; });\r\n        this.view.setSelection(indexes, browserEvent, true);\r\n    };\r\n    AbstractTree.prototype.getSelection = function () {\r\n        return this.selection.get();\r\n    };\r\n    AbstractTree.prototype.setFocus = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.model.getNode(e); });\r\n        this.focus.set(nodes, browserEvent);\r\n        var indexes = elements.map(function (e) { return _this.model.getListIndex(e); }).filter(function (i) { return i > -1; });\r\n        this.view.setFocus(indexes, browserEvent, true);\r\n    };\r\n    AbstractTree.prototype.focusNext = function (n, loop, browserEvent, filter) {\r\n        if (n === void 0) { n = 1; }\r\n        if (loop === void 0) { loop = false; }\r\n        if (filter === void 0) { filter = this.focusNavigationFilter; }\r\n        this.view.focusNext(n, loop, browserEvent, filter);\r\n    };\r\n    AbstractTree.prototype.getFocus = function () {\r\n        return this.focus.get();\r\n    };\r\n    AbstractTree.prototype.reveal = function (location, relativeTop) {\r\n        this.model.expandTo(location);\r\n        var index = this.model.getListIndex(location);\r\n        if (index === -1) {\r\n            return;\r\n        }\r\n        this.view.reveal(index, relativeTop);\r\n    };\r\n    /**\r\n     * Returns the relative position of an element rendered in the list.\r\n     * Returns `null` if the element isn't *entirely* in the visible viewport.\r\n     */\r\n    AbstractTree.prototype.getRelativeTop = function (location) {\r\n        var index = this.model.getListIndex(location);\r\n        if (index === -1) {\r\n            return null;\r\n        }\r\n        return this.view.getRelativeTop(index);\r\n    };\r\n    // List\r\n    AbstractTree.prototype.onLeftArrow = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        var nodes = this.view.getFocusedElements();\r\n        if (nodes.length === 0) {\r\n            return;\r\n        }\r\n        var node = nodes[0];\r\n        var location = this.model.getNodeLocation(node);\r\n        var didChange = this.model.setCollapsed(location, true);\r\n        if (!didChange) {\r\n            var parentLocation = this.model.getParentNodeLocation(location);\r\n            if (!parentLocation) {\r\n                return;\r\n            }\r\n            var parentListIndex = this.model.getListIndex(parentLocation);\r\n            this.view.reveal(parentListIndex);\r\n            this.view.setFocus([parentListIndex]);\r\n        }\r\n    };\r\n    AbstractTree.prototype.onRightArrow = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        var nodes = this.view.getFocusedElements();\r\n        if (nodes.length === 0) {\r\n            return;\r\n        }\r\n        var node = nodes[0];\r\n        var location = this.model.getNodeLocation(node);\r\n        var didChange = this.model.setCollapsed(location, false);\r\n        if (!didChange) {\r\n            if (!node.children.some(function (child) { return child.visible; })) {\r\n                return;\r\n            }\r\n            var focusedIndex = this.view.getFocus()[0];\r\n            var firstChildIndex = focusedIndex + 1;\r\n            this.view.reveal(firstChildIndex);\r\n            this.view.setFocus([firstChildIndex]);\r\n        }\r\n    };\r\n    AbstractTree.prototype.onSpace = function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        var nodes = this.view.getFocusedElements();\r\n        if (nodes.length === 0) {\r\n            return;\r\n        }\r\n        var node = nodes[0];\r\n        var location = this.model.getNodeLocation(node);\r\n        var recursive = e.browserEvent.altKey;\r\n        this.model.setCollapsed(location, undefined, recursive);\r\n    };\r\n    AbstractTree.prototype.dispose = function () {\r\n        dispose(this.disposables);\r\n        this.view.dispose();\r\n    };\r\n    return AbstractTree;\r\n}());\r\nexport { AbstractTree };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar TreeError = /** @class */ (function (_super) {\r\n    __extends(TreeError, _super);\r\n    function TreeError(user, message) {\r\n        return _super.call(this, \"TreeError [\" + user + \"] \" + message) || this;\r\n    }\r\n    return TreeError;\r\n}(Error));\r\nexport { TreeError };\r\nvar WeakMapper = /** @class */ (function () {\r\n    function WeakMapper(fn) {\r\n        this.fn = fn;\r\n        this._map = new WeakMap();\r\n    }\r\n    WeakMapper.prototype.map = function (key) {\r\n        var result = this._map.get(key);\r\n        if (!result) {\r\n            result = this.fn(key);\r\n            this._map.set(key, result);\r\n        }\r\n        return result;\r\n    };\r\n    return WeakMapper;\r\n}());\r\nexport { WeakMapper };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbstractTree } from './abstractTree.js';\r\nimport { ObjectTreeModel } from './objectTreeModel.js';\r\nvar DataTree = /** @class */ (function (_super) {\r\n    __extends(DataTree, _super);\r\n    function DataTree(user, container, delegate, renderers, dataSource, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = _super.call(this, user, container, delegate, renderers, options) || this;\r\n        _this.user = user;\r\n        _this.dataSource = dataSource;\r\n        _this.identityProvider = options.identityProvider;\r\n        return _this;\r\n    }\r\n    DataTree.prototype.createModel = function (user, view, options) {\r\n        return new ObjectTreeModel(user, view, options);\r\n    };\r\n    return DataTree;\r\n}(AbstractTree));\r\nexport { DataTree };\r\n"],"sourceRoot":""}