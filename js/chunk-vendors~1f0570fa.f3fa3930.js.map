{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/textAreaState.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/config/charWidthReader.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/config/configuration.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/mouseHandler.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/pointerHandler.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/config/elementSizeObserver.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/mouseTarget.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/coreCommands.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/textAreaHandler.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/browser/controller/textAreaInput.js"],"names":["TextAreaState","value","selectionStart","selectionEnd","selectionStartPosition","selectionEndPosition","this","prototype","toString","readFromTextArea","textArea","getValue","getSelectionStart","getSelectionEnd","collapseSelection","length","writeToTextArea","reason","select","setValue","setSelectionRange","deduceEditorPosition","offset","str","substring","_finishDeduceEditorPosition","str1","indexOf","String","fromCharCode","str2","anchor","deltaText","signum","lineFeedCnt","lastLineFeedIndex","selectedText","text","deduceInput","previousState","currentState","couldBeEmojiInput","replaceCharCnt","previousValue","previousSelectionStart","previousSelectionEnd","currentValue","currentSelectionStart","currentSelectionEnd","previousSuffix","currentSuffix","suffixLength","previousPrefix","currentPrefix","prefixLength","potentialEmojiInput","test","replacePreviousCharacters_1","replacePreviousCharacters","EMPTY","PagedScreenReaderStrategy","_getPageOfLine","lineNumber","linesPerPage","Math","floor","_getRangeForPage","page","startLineNumber","endLineNumber","fromEditorSelection","model","selection","trimLongText","selectionStartPage","selectionStartPageRange","selectionEndPage","selectionEndPageRange","pretextRange","intersectRanges","startColumn","pretext","getValueInRange","lastLine","getLineCount","lastLineMaxColumn","getLineMaxColumn","posttextRange","endColumn","posttext","selectionRange1","selectionRange2","LIMIT_CHARS","CharWidthRequest","chr","type","width","fulfill","DomCharWidthReader","bareFontInfo","requests","_bareFontInfo","_requests","_container","_testElements","read","_createDomElements","document","body","appendChild","_readFromDomElements","removeChild","container","createElement","style","position","top","regularDomNode","fontFamily","getMassagedFontFamily","fontWeight","fontSize","fontFeatureSettings","lineHeight","letterSpacing","boldDomNode","italicDomNode","fontStyle","testElements","_i","_a","request","parent_1","testElement","_render","push","htmlString","i","innerHTML","testString","textContent","len","offsetWidth","readCharWidths","reader","__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","create","CSSBasedConfigurationCache","_keys","_values","has","item","itemId","getId","get","put","remove","getValues","_this","keys","map","id","clearAllFontInfos","INSTANCE","clearCache","_super","CSSBasedConfiguration","call","_onDidChange","_register","onDidChange","event","_cache","_evictUntrustedReadingsTimeout","dispose","clearTimeout","fire","_writeToCache","isTrusted","setTimeout","_evictUntrustedReadings","values","somethingRemoved","readConfiguration","readConfig","_actualReadConfiguration","typicalHalfwidthCharacterWidth","typicalFullwidthCharacterWidth","spaceWidth","maxDigitWidth","zoomLevel","browser","isMonospace","max","canUseHalfwidthRightwardsArrow","middotWidth","createRequest","all","monospace","result","typicalHalfwidthCharacter","typicalFullwidthCharacter","space","digit0","digit1","digit2","digit3","digit4","digit5","digit6","digit7","digit8","digit9","rightwardsArrow","halfwidthRightwardsArrow","middot","OFF","referenceWidth","diff","canTrustBrowserZoomLevel","Configuration","isSimpleWidget","options","referenceDomElement","accessibilityService","_elementSizeObserver","dimension","_onReferenceDomElementSizeChanged","_onCSSBasedConfigurationChanged","_validatedOptions","startObserving","_","_recomputeOptions","onDidChangeScreenReaderOptimized","applyFontInfoSlow","domNode","fontInfo","applyFontInfo","setFontFamily","setFontWeight","setFontSize","setFontFeatureSettings","setLineHeight","setLetterSpacing","observeReferenceElement","observe","_getExtraEditorClassName","extra","platform","_getEnvConfiguration","extraEditorClassName","outerWidth","getWidth","outerHeight","getHeight","emptySelectionClipboard","pixelRatio","accessibilitySupport","isScreenReaderOptimized","getAccessibilitySupport","createMouseMoveEventMerger","mouseTargetFactory","lastEvent","currentEvent","targetIsWidget","mouseTargetIsWidget","preventDefault","MouseHandler","context","viewController","viewHelper","_isFocused","_context","_mouseDownOperation","e","testEventTarget","_createMouseTarget","_getMouseColumn","_asyncFocus","focusTextArea","lastMouseLeaveTime","mouseEvents","viewDomNode","onContextMenu","_onContextMenu","onMouseMoveThrottled","_onMouseMove","MOUSE_MOVE_MINIMUM_TIME","onMouseUp","_onMouseUp","onMouseLeave","_onMouseLeave","onMouseDown","_onMouseDown","onMouseWheel","browserEvent","emitMouseWheel","configuration","ctrlKey","metaKey","getZoomLevel","delta","deltaY","setZoomLevel","stopPropagation","dom","capture","passive","addEventHandler","removeEventHandler","onCursorStateChanged","onFocusChanged","isFocused","onScrollChanged","getTargetAtClientPoint","clientX","clientY","clientPos","pos","toPageCoordinates","editorPos","y","height","x","createMouseTarget","getLastRenderData","target","getMouseColumn","emitContextMenu","isActive","actualMouseMoveTime","timestamp","emitMouseMove","Date","getTime","emitMouseLeave","emitMouseUp","t","targetIsContent","targetIsGutter","targetIsLineNumbers","selectOnLineNumbers","targetIsViewZone","shouldHandle","leftButton","middleButton","focus","schedule","start","viewZoneData","detail","shouldSuppressMouseDownOnViewZone","viewZoneId","shouldSuppressMouseDownOnWidget","emitMouseDown","MouseDownOperation","_viewController","_viewHelper","_mouseMoveMonitor","_onScrollTimeout","_mouseState","MouseDownState","_currentSelection","_isActive","_lastMouseEvent","_onMouseDownThenMove","setModifiers","_findMousePosition","isDragAndDrop","emitMouseDrag","_dispatchMouse","targetType","setStartedOnLineNumbers","setStartButtons","trySetCount","count","altKey","isEmpty","containsPosition","startMonitoring","buttons","emitMouseDrop","_stop","shiftKey","cancel","setIfNotSet","selections","_getPositionOutsideEditor","editorContent","viewLayout","mouseColumn","posy","verticalOffset","getCurrentScrollTop","getZoneAtCoord","newPosition","_helpPositionJumpOverViewZone","aboveLineNumber","getLineNumberAtVerticalOffset","belowLineNumber","possibleLineNumber","posx","positionOutsideEditor","hintedPosition","element","selectionStartLineNumber","selectionStartColumn","positionBefore","positionAfter","isBefore","inSelectionMode","dispatchMouse","startedOnLineNumbers","mouseDownCount","_altKey","_ctrlKey","_metaKey","_shiftKey","_leftButton","_middleButton","_startedOnLineNumbers","_lastMouseDownPosition","_lastMouseDownPositionEqualCount","_lastMouseDownCount","_lastSetMouseDownCountTime","defineProperty","enumerable","configurable","source","setMouseDownCount","newMouseDownPosition","currentTime","CLEAR_MOUSE_DOWN_COUNT_TIME","equals","min","gestureChangeEventMerger","r","translationY","translationX","MsPointerHandler","linesContentDomNode","msTouchAction","msContentZooming","_installGestureHandlerTimeout","window","MSGesture","touchGesture_1","penGesture_1","addEventListener","pointerType","MSPOINTER_TYPE_MOUSE","MSPOINTER_TYPE_TOUCH","_lastPointerType","addPointer","pointerId","_onGestureChange","_onCaptureGestureTap","rawEvent","moveTo","fromElement","deltaScrollNow","StandardPointerHandler","touchAction","touchGesture_2","penGesture_2","PointerEventHandler","addTarget","Tap","onTap","Change","onChange","Contextmenu","pointerEvents","onPointerMoveThrottled","onPointerUp","onPointerLeave","onPointerDown","initialTarget","contains","column","tapCount","TouchHandler","PointerHandler","navigator","msPointerEnabled","handler","TouchEvent","pointerEnabled","PointerEvent","ElementSizeObserver","changeCallback","mutationObserver","windowSizeListener","measureReferenceDomElement","stopObserving","MutationObserver","_onDidMutate","attributes","_onDidResizeWindow","disconnect","callChangeCallback","observedWidth","observedHeight","clientWidth","clientHeight","PointerHandlerLastRenderData","lastViewCursorsRenderData","lastTextareaPosition","MouseTarget","range","_typeToString","ElementPath","isTextArea","path","isChildOfViewLines","isStrictChildOfViewLines","isChildOfScrollableElement","isChildOfMinimap","isChildOfContentWidgets","isChildOfOverflowingContentWidgets","isChildOfOverlayWidgets","HitTestContext","lastRenderData","layoutInfo","mouseVerticalOffset","viewZoneWhitespace","getWhitespaceAtVerticalOffset","viewZoneMiddle","lineCount","afterLineNumber","getFullLineRangeAtCoord","isAfterLines","lineNumber_1","maxLineColumn_1","maxLineColumn","getVerticalOffsetForLineNumber","findAttribute","attr","_findAttribute","stopAt","hasAttribute","getAttribute","parentNode","getLineWidth","visibleRangeForPosition","getPositionFromDOMInfo","spanNode","getCurrentScrollLeft","BareHitTestRequest","ctx","mouseContentHorizontalOffset","contentLeft","isInMarginArea","glyphMarginLeft","isInContentArea","MouseTargetFactory","HitTestRequest","_ctx","targetPath","collect","Uint8Array","outerHTML","visibleColumnFromColumn","getLineContent","getOptions","tabSize","withTarget","EMPTY_CONTENT_AFTER_LINES","createEmptyContentDataInLines","horizontalDistanceToText","err","domHitTestExecuted","hitTestResult","_doHitTest","createMouseTargetFromHitTestPosition","hitTarget","resolvedRequest","_hitTestContentWidget","_hitTestOverlayWidget","_hitTestMinimap","_hitTestScrollbarSlider","_hitTestViewZone","_hitTestMargin","_hitTestViewCursor","_hitTestTextArea","_hitTestViewLines","_hitTestScrollbar","widgetId","lastViewCursorsRenderData_1","lastViewCursorsRenderData_2","cursorVerticalOffset","mouseTargetType","res","getStartPosition","abs","glyphMarginWidth","lineNumbersWidth","offsetX","undefined","getLineLength","lineWidth_1","lineWidth","maxColumn","nodeType","className","chars","round","detail_1","visibleRange","columnHorizontalOffset","left","points","visibleRange_1","lineMaxColumn","visibleRange_2","sort","a","prev","curr","rng","_doHitTestWithCaretRangeFromPoint","lineVerticalOffset","lineCenteredVerticalOffset","adjustedPageY","adjustedPage","_actualDoHitTestWithCaretRangeFromPoint","toClientCoordinates","coords","shadowRoot","caretRangeFromPoint","shadowCaretRangeFromPoint","startContainer","TEXT_NODE","parent1","parent2","parent3","parent3ClassName","ELEMENT_NODE","CLASS_NAME","startOffset","parent2ClassName","_doHitTestWithCaretPositionFromPoint","hitResult","caretPositionFromPoint","offsetNode","_doHitTestWithMoveToPoint","resultPosition","resultHitTarget","textRange","createTextRange","moveToPoint","collapse","parentElement","rangeToContainEntireSpan","duplicate","moveToElementText","setEndPoint","createRange","el","elementFromPoint","firstChild","lastChild","rect","getBoundingClientRect","font","getComputedStyle","getPropertyValue","innerText","pixelCursor","step","charWidthReader","CharWidthReader","getInstance","getCharWidth","charAt","setStart","setEnd","_canvas","_INSTANCE","char","cacheKey","getContext","metrics","measureText","EditorScroll_","RevealLine_","CoreNavigationCommands","CoreEditingCommands","CORE_WEIGHT","CoreEditorCommand","apply","arguments","runEditorCommand","accessor","editor","args","cursors","_getCursors","runCoreEditorCommand","registerCommand","command","register","isEditorScrollArgs","arg","scrollArg","to","by","revealCursor","parse","direction","unit","RawDirection","Up","Down","RawUnit","Line","WrappedLine","Page","HalfPage","description","name","constraint","schema","isRevealLineArgs","reveaLineArg","at","RawAtArgument","Top","Center","Bottom","BaseMoveToCommand","opts","_inSelectionMode","pushStackElement","setStates","getPrimaryCursor","viewPosition","reveal","MoveTo","precondition","MoveToSelect","ColumnSelectCommand","_getColumnSelectResult","getColumnSelectData","viewStates","viewState","fromViewState","setColumnSelectData","isReal","fromViewLineNumber","fromLineNumber","fromViewVisualColumn","fromVisualColumn","toViewLineNumber","toLineNumber","toViewVisualColumn","toVisualColumn","reversed","ColumnSelect","class_1","primary","prevColumnSelectData","validatedPosition","validatePosition","validatedViewPosition","validateViewPosition","doColumnSelect","columnSelect","config","viewModel","CursorColumnSelectLeft","class_2","kbOpts","weight","kbExpr","textInputFocus","linux","columnSelectLeft","CursorColumnSelectRight","class_3","columnSelectRight","ColumnSelectUpCommand","_isPaged","isPaged","columnSelectUp","CursorColumnSelectUp","CursorColumnSelectPageUp","ColumnSelectDownCommand","columnSelectDown","CursorColumnSelectDown","CursorColumnSelectPageDown","CursorMoveImpl","parsed","_runCursorMove","move","getAll","CursorMove","CursorMoveBasedCommand","_staticArgs","dynamicArgs","pageSize","CursorLeft","mac","secondary","CursorLeftSelect","CursorRight","CursorRightSelect","CursorUp","CursorUpSelect","CursorPageUp","CursorPageUpSelect","CursorDown","CursorDownSelect","CursorPageDown","CursorPageDownSelect","CreateCursor","class_4","newState","wholeLine","line","states","newModelPosition","modelState","newViewPosition","state","splice","LastCursorMoveToSelect","class_5","lastAddedCursorIndex","getLastAddedCursorIndex","newStates","slice","HomeCommand","moveToBeginningOfLine","CursorHome","CursorHomeSelect","CursorLineStart","class_6","_exec","cursor","fromModelState","EndCommand","moveToEndOfLine","CursorEnd","CursorEndSelect","CursorLineEnd","class_7","TopCommand","moveToBeginningOfBuffer","CursorTop","CursorTopSelect","BottomCommand","moveToEndOfBuffer","CursorBottom","CursorBottomSelect","EditorScrollImpl","_runEditorScroll","desiredScrollTop","_computeDesiredScrollTop","desiredVisibleViewRange","getCompletelyVisibleViewRangeAtScrollTop","findPositionInViewportIfOutside","scrollTo","visibleModelRange","getCompletelyVisibleModelRange","desiredTopModelLineNumber","desiredTopViewPosition","convertModelPositionToViewPosition","getVerticalOffsetForViewLine","noOfLines","deltaLines","EditorScroll","ScrollLineUp","class_8","ScrollPageUp","class_9","win","ScrollLineDown","class_10","ScrollPageDown","class_11","WordCommand","word","WordSelect","WordSelectDrag","LastCursorWordSelect","class_12","lastAddedState","hasSelection","LineCommand","LineSelect","LineSelectDrag","LastCursorLineCommand","LastCursorLineSelect","LastCursorLineSelectDrag","ExpandLineSelection","class_13","expandLineSelection","CancelSelection","class_14","hasNonEmptySelection","cancelSelection","RemoveSecondaryCursors","class_15","hasMultipleSelections","RevealLine","class_16","revealLineArg","revealAt","viewRange","convertModelRangeToViewRange","revealRange","SelectAll","class_17","selectAll","SetSelection","class_18","fromModelSelection","CoreEditingCommand","runCoreEditingCommand","LineBreakInsert","class_19","writable","pushUndoStop","executeCommands","lineBreakInsert","s","Outdent","class_20","and","editorTextFocus","tabDoesNotMoveFocus","outdent","Tab","class_21","tab","DeleteLeft","class_22","deleteLeft","getPrevEditOperationType","shouldPushStackElementBefore","commands","setPrevEditOperationType","DeleteRight","class_23","deleteRight","EditorOrNativeTextInputCommand","_editorHandler","editorHandler","_inputHandler","inputHandler","runCommand","focusedEditor","getFocusedCodeEditor","hasTextFocus","_runEditorHandler","activeElement","tagName","toLowerCase","activeEditor","getActiveCodeEditor","execCommand","HANDLER","trigger","EditorHandlerCommand","handlerId","_handlerId","registerOverwritableCommand","menuOpts","menuId","group","title","key","comment","order","Undo","Redo","Type","ReplacePreviousChar","CompositionStart","CompositionEnd","Paste","Cut","VisibleTextAreaData","setWidth","canUseZeroSizeTextarea","TextAreaHandler","_primaryCursorPosition","_primaryCursorVisibleRange","_scrollLeft","_scrollTop","_setAccessibilityOptions","_contentLeft","_contentWidth","contentWidth","_contentHeight","_fontInfo","_lineHeight","_emptySelectionClipboard","_copyWithSyntaxHighlighting","_visibleTextArea","_selections","_modelSelections","_lastRenderPosition","write","setClassName","setAttribute","_getAriaLabel","textAreaCover","setPosition","simpleModel","eol","textAreaInputHost","getDataToCopy","generateHTML","rawTextToCopy","getPlainTextToCopy","newLineCharacter","getEOL","isFromEmptySelection","multicursorText","isArray","join","html","mode","forceCopyWithSyntaxHighlighting","richText","getRichTextToCopy","getScreenReaderContent","_accessibilitySupport","textBefore","_getWordBeforePosition","_getCharacterBeforePosition","_accessibilityPageSize","deduceModelPosition","viewAnchorPosition","deltaOffset","deduceModelPositionRelativeToViewPosition","_textAreaInput","onKeyDown","emitKeyDown","onKeyUp","emitKeyUp","onPaste","pasteOnNewLine","metadata","paste","onCut","cut","onType","replacePreviousChar","onSelectionChangeRequest","modelSelection","setSelection","onCompositionStart","privateViewEventBus","emit","visibleRangeForPositionRelativeToEditor","compositionStart","onCompositionUpdate","data","onCompositionEnd","compositionEnd","onFocus","onBlur","lineContent","wordSeparators","distance","charCode","charCodeAt","charClass","charBefore","accessibilityPageSize","defaultValue","onConfigurationChanged","hasChanged","removeAttribute","writeScreenReaderContent","modelSelections","onDecorationsChanged","onFlushed","onLinesChanged","onLinesDeleted","onLinesInserted","scrollLeft","scrollTop","onZonesChanged","setAriaOptions","activeDescendant","prepareRender","positionLineNumber","positionColumn","render","_renderInsideEditor","_renderAtTopLeft","renderedPosition","ta","tac","setTop","setLeft","setHeight","OUTER_CLASS_NAME","renderType","canvasElem","createFontString","doCreateFontString","CopyOptions","InMemoryClipboardMetadataManager","_lastState","set","lastCopiedValue","pastedText","TextAreaInput","host","_onFocus","_onBlur","_onKeyDown","_onKeyUp","_onCut","_onPaste","_onType","_onCompositionStart","_onCompositionUpdate","_onCompositionEnd","_onSelectionChangeRequest","_host","_textArea","TextAreaWrapper","_asyncTriggerCut","_textAreaState","_selectionChangeListener","_hasFocus","_isDoingComposition","_nextCommand","keyCode","_setAndWriteTextAreaState","deduceInputFromTextAreaValue","oldState","deduceComposition","typeInput","compositionDataInValid","locale","newState_1","typeInput_1","_b","setIgnoreSelectionChangeTime","_firePaste","_ensureClipboardGetsEditorSelection","ClipboardEventUtils","canUseTextData","getTextData","pastePlainText","_setHasFocus","_installSelectionChangeListener","previousSelectionChangeEventTime","now","delta1","delta2","getIgnoreSelectionChangeTime","resetSelectionChangeTime","newValue","newSelectionStart","newSelectionEnd","_newSelectionStartPosition","newSelectionStartPosition","_newSelectionEndPosition","newSelectionEndPosition","newSelection","refreshFocusState","newHasFocus","textAreaState","dataToCopy","clipboard","storedMetadata","version","replace","setTextData","clipboardData","getData","rawmetadata","JSON","Error","setData","stringify","_actual","_ignoreSelectionChangeTime","currentIsFocused","parent","scrollState"],"mappings":"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","file":"js/chunk-vendors~1f0570fa.f3fa3930.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nvar TextAreaState = /** @class */ (function () {\r\n    function TextAreaState(value, selectionStart, selectionEnd, selectionStartPosition, selectionEndPosition) {\r\n        this.value = value;\r\n        this.selectionStart = selectionStart;\r\n        this.selectionEnd = selectionEnd;\r\n        this.selectionStartPosition = selectionStartPosition;\r\n        this.selectionEndPosition = selectionEndPosition;\r\n    }\r\n    TextAreaState.prototype.toString = function () {\r\n        return '[ <' + this.value + '>, selectionStart: ' + this.selectionStart + ', selectionEnd: ' + this.selectionEnd + ']';\r\n    };\r\n    TextAreaState.readFromTextArea = function (textArea) {\r\n        return new TextAreaState(textArea.getValue(), textArea.getSelectionStart(), textArea.getSelectionEnd(), null, null);\r\n    };\r\n    TextAreaState.prototype.collapseSelection = function () {\r\n        return new TextAreaState(this.value, this.value.length, this.value.length, null, null);\r\n    };\r\n    TextAreaState.prototype.writeToTextArea = function (reason, textArea, select) {\r\n        // console.log(Date.now() + ': writeToTextArea ' + reason + ': ' + this.toString());\r\n        textArea.setValue(reason, this.value);\r\n        if (select) {\r\n            textArea.setSelectionRange(reason, this.selectionStart, this.selectionEnd);\r\n        }\r\n    };\r\n    TextAreaState.prototype.deduceEditorPosition = function (offset) {\r\n        if (offset <= this.selectionStart) {\r\n            var str = this.value.substring(offset, this.selectionStart);\r\n            return this._finishDeduceEditorPosition(this.selectionStartPosition, str, -1);\r\n        }\r\n        if (offset >= this.selectionEnd) {\r\n            var str = this.value.substring(this.selectionEnd, offset);\r\n            return this._finishDeduceEditorPosition(this.selectionEndPosition, str, 1);\r\n        }\r\n        var str1 = this.value.substring(this.selectionStart, offset);\r\n        if (str1.indexOf(String.fromCharCode(8230)) === -1) {\r\n            return this._finishDeduceEditorPosition(this.selectionStartPosition, str1, 1);\r\n        }\r\n        var str2 = this.value.substring(offset, this.selectionEnd);\r\n        return this._finishDeduceEditorPosition(this.selectionEndPosition, str2, -1);\r\n    };\r\n    TextAreaState.prototype._finishDeduceEditorPosition = function (anchor, deltaText, signum) {\r\n        var lineFeedCnt = 0;\r\n        var lastLineFeedIndex = -1;\r\n        while ((lastLineFeedIndex = deltaText.indexOf('\\n', lastLineFeedIndex + 1)) !== -1) {\r\n            lineFeedCnt++;\r\n        }\r\n        return [anchor, signum * deltaText.length, lineFeedCnt];\r\n    };\r\n    TextAreaState.selectedText = function (text) {\r\n        return new TextAreaState(text, 0, text.length, null, null);\r\n    };\r\n    TextAreaState.deduceInput = function (previousState, currentState, couldBeEmojiInput) {\r\n        if (!previousState) {\r\n            // This is the EMPTY state\r\n            return {\r\n                text: '',\r\n                replaceCharCnt: 0\r\n            };\r\n        }\r\n        // console.log('------------------------deduceInput');\r\n        // console.log('PREVIOUS STATE: ' + previousState.toString());\r\n        // console.log('CURRENT STATE: ' + currentState.toString());\r\n        var previousValue = previousState.value;\r\n        var previousSelectionStart = previousState.selectionStart;\r\n        var previousSelectionEnd = previousState.selectionEnd;\r\n        var currentValue = currentState.value;\r\n        var currentSelectionStart = currentState.selectionStart;\r\n        var currentSelectionEnd = currentState.selectionEnd;\r\n        // Strip the previous suffix from the value (without interfering with the current selection)\r\n        var previousSuffix = previousValue.substring(previousSelectionEnd);\r\n        var currentSuffix = currentValue.substring(currentSelectionEnd);\r\n        var suffixLength = strings.commonSuffixLength(previousSuffix, currentSuffix);\r\n        currentValue = currentValue.substring(0, currentValue.length - suffixLength);\r\n        previousValue = previousValue.substring(0, previousValue.length - suffixLength);\r\n        var previousPrefix = previousValue.substring(0, previousSelectionStart);\r\n        var currentPrefix = currentValue.substring(0, currentSelectionStart);\r\n        var prefixLength = strings.commonPrefixLength(previousPrefix, currentPrefix);\r\n        currentValue = currentValue.substring(prefixLength);\r\n        previousValue = previousValue.substring(prefixLength);\r\n        currentSelectionStart -= prefixLength;\r\n        previousSelectionStart -= prefixLength;\r\n        currentSelectionEnd -= prefixLength;\r\n        previousSelectionEnd -= prefixLength;\r\n        // console.log('AFTER DIFFING PREVIOUS STATE: <' + previousValue + '>, selectionStart: ' + previousSelectionStart + ', selectionEnd: ' + previousSelectionEnd);\r\n        // console.log('AFTER DIFFING CURRENT STATE: <' + currentValue + '>, selectionStart: ' + currentSelectionStart + ', selectionEnd: ' + currentSelectionEnd);\r\n        if (couldBeEmojiInput && currentSelectionStart === currentSelectionEnd && previousValue.length > 0) {\r\n            // on OSX, emojis from the emoji picker are inserted at random locations\r\n            // the only hints we can use is that the selection is immediately after the inserted emoji\r\n            // and that none of the old text has been deleted\r\n            var potentialEmojiInput = null;\r\n            if (currentSelectionStart === currentValue.length) {\r\n                // emoji potentially inserted \"somewhere\" after the previous selection => it should appear at the end of `currentValue`\r\n                if (strings.startsWith(currentValue, previousValue)) {\r\n                    // only if all of the old text is accounted for\r\n                    potentialEmojiInput = currentValue.substring(previousValue.length);\r\n                }\r\n            }\r\n            else {\r\n                // emoji potentially inserted \"somewhere\" before the previous selection => it should appear at the start of `currentValue`\r\n                if (strings.endsWith(currentValue, previousValue)) {\r\n                    // only if all of the old text is accounted for\r\n                    potentialEmojiInput = currentValue.substring(0, currentValue.length - previousValue.length);\r\n                }\r\n            }\r\n            if (potentialEmojiInput !== null && potentialEmojiInput.length > 0) {\r\n                // now we check that this is indeed an emoji\r\n                // emojis can grow quite long, so a length check is of no help\r\n                // e.g. 1F3F4 E0067 E0062 E0065 E006E E0067 E007F  ; fully-qualified     # 🏴󠁧󠁢󠁥󠁮󠁧󠁿 England\r\n                // Oftentimes, emojis use Variation Selector-16 (U+FE0F), so that is a good hint\r\n                // http://emojipedia.org/variation-selector-16/\r\n                // > An invisible codepoint which specifies that the preceding character\r\n                // > should be displayed with emoji presentation. Only required if the\r\n                // > preceding character defaults to text presentation.\r\n                if (/\\uFE0F/.test(potentialEmojiInput) || strings.containsEmoji(potentialEmojiInput)) {\r\n                    return {\r\n                        text: potentialEmojiInput,\r\n                        replaceCharCnt: 0\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        if (currentSelectionStart === currentSelectionEnd) {\r\n            // composition accept case (noticed in FF + Japanese)\r\n            // [blahblah] => blahblah|\r\n            if (previousValue === currentValue\r\n                && previousSelectionStart === 0\r\n                && previousSelectionEnd === previousValue.length\r\n                && currentSelectionStart === currentValue.length\r\n                && currentValue.indexOf('\\n') === -1) {\r\n                if (strings.containsFullWidthCharacter(currentValue)) {\r\n                    return {\r\n                        text: '',\r\n                        replaceCharCnt: 0\r\n                    };\r\n                }\r\n            }\r\n            // no current selection\r\n            var replacePreviousCharacters_1 = (previousPrefix.length - prefixLength);\r\n            // console.log('REMOVE PREVIOUS: ' + (previousPrefix.length - prefixLength) + ' chars');\r\n            return {\r\n                text: currentValue,\r\n                replaceCharCnt: replacePreviousCharacters_1\r\n            };\r\n        }\r\n        // there is a current selection => composition case\r\n        var replacePreviousCharacters = previousSelectionEnd - previousSelectionStart;\r\n        return {\r\n            text: currentValue,\r\n            replaceCharCnt: replacePreviousCharacters\r\n        };\r\n    };\r\n    TextAreaState.EMPTY = new TextAreaState('', 0, 0, null, null);\r\n    return TextAreaState;\r\n}());\r\nexport { TextAreaState };\r\nvar PagedScreenReaderStrategy = /** @class */ (function () {\r\n    function PagedScreenReaderStrategy() {\r\n    }\r\n    PagedScreenReaderStrategy._getPageOfLine = function (lineNumber, linesPerPage) {\r\n        return Math.floor((lineNumber - 1) / linesPerPage);\r\n    };\r\n    PagedScreenReaderStrategy._getRangeForPage = function (page, linesPerPage) {\r\n        var offset = page * linesPerPage;\r\n        var startLineNumber = offset + 1;\r\n        var endLineNumber = offset + linesPerPage;\r\n        return new Range(startLineNumber, 1, endLineNumber + 1, 1);\r\n    };\r\n    PagedScreenReaderStrategy.fromEditorSelection = function (previousState, model, selection, linesPerPage, trimLongText) {\r\n        var selectionStartPage = PagedScreenReaderStrategy._getPageOfLine(selection.startLineNumber, linesPerPage);\r\n        var selectionStartPageRange = PagedScreenReaderStrategy._getRangeForPage(selectionStartPage, linesPerPage);\r\n        var selectionEndPage = PagedScreenReaderStrategy._getPageOfLine(selection.endLineNumber, linesPerPage);\r\n        var selectionEndPageRange = PagedScreenReaderStrategy._getRangeForPage(selectionEndPage, linesPerPage);\r\n        var pretextRange = selectionStartPageRange.intersectRanges(new Range(1, 1, selection.startLineNumber, selection.startColumn));\r\n        var pretext = model.getValueInRange(pretextRange, 1 /* LF */);\r\n        var lastLine = model.getLineCount();\r\n        var lastLineMaxColumn = model.getLineMaxColumn(lastLine);\r\n        var posttextRange = selectionEndPageRange.intersectRanges(new Range(selection.endLineNumber, selection.endColumn, lastLine, lastLineMaxColumn));\r\n        var posttext = model.getValueInRange(posttextRange, 1 /* LF */);\r\n        var text;\r\n        if (selectionStartPage === selectionEndPage || selectionStartPage + 1 === selectionEndPage) {\r\n            // take full selection\r\n            text = model.getValueInRange(selection, 1 /* LF */);\r\n        }\r\n        else {\r\n            var selectionRange1 = selectionStartPageRange.intersectRanges(selection);\r\n            var selectionRange2 = selectionEndPageRange.intersectRanges(selection);\r\n            text = (model.getValueInRange(selectionRange1, 1 /* LF */)\r\n                + String.fromCharCode(8230)\r\n                + model.getValueInRange(selectionRange2, 1 /* LF */));\r\n        }\r\n        // Chromium handles very poorly text even of a few thousand chars\r\n        // Cut text to avoid stalling the entire UI\r\n        if (trimLongText) {\r\n            var LIMIT_CHARS = 500;\r\n            if (pretext.length > LIMIT_CHARS) {\r\n                pretext = pretext.substring(pretext.length - LIMIT_CHARS, pretext.length);\r\n            }\r\n            if (posttext.length > LIMIT_CHARS) {\r\n                posttext = posttext.substring(0, LIMIT_CHARS);\r\n            }\r\n            if (text.length > 2 * LIMIT_CHARS) {\r\n                text = text.substring(0, LIMIT_CHARS) + String.fromCharCode(8230) + text.substring(text.length - LIMIT_CHARS, text.length);\r\n            }\r\n        }\r\n        return new TextAreaState(pretext + text + posttext, pretext.length, pretext.length + text.length, new Position(selection.startLineNumber, selection.startColumn), new Position(selection.endLineNumber, selection.endColumn));\r\n    };\r\n    return PagedScreenReaderStrategy;\r\n}());\r\nexport { PagedScreenReaderStrategy };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar CharWidthRequest = /** @class */ (function () {\r\n    function CharWidthRequest(chr, type) {\r\n        this.chr = chr;\r\n        this.type = type;\r\n        this.width = 0;\r\n    }\r\n    CharWidthRequest.prototype.fulfill = function (width) {\r\n        this.width = width;\r\n    };\r\n    return CharWidthRequest;\r\n}());\r\nexport { CharWidthRequest };\r\nvar DomCharWidthReader = /** @class */ (function () {\r\n    function DomCharWidthReader(bareFontInfo, requests) {\r\n        this._bareFontInfo = bareFontInfo;\r\n        this._requests = requests;\r\n        this._container = null;\r\n        this._testElements = null;\r\n    }\r\n    DomCharWidthReader.prototype.read = function () {\r\n        // Create a test container with all these test elements\r\n        this._createDomElements();\r\n        // Add the container to the DOM\r\n        document.body.appendChild(this._container);\r\n        // Read character widths\r\n        this._readFromDomElements();\r\n        // Remove the container from the DOM\r\n        document.body.removeChild(this._container);\r\n        this._container = null;\r\n        this._testElements = null;\r\n    };\r\n    DomCharWidthReader.prototype._createDomElements = function () {\r\n        var container = document.createElement('div');\r\n        container.style.position = 'absolute';\r\n        container.style.top = '-50000px';\r\n        container.style.width = '50000px';\r\n        var regularDomNode = document.createElement('div');\r\n        regularDomNode.style.fontFamily = this._bareFontInfo.getMassagedFontFamily();\r\n        regularDomNode.style.fontWeight = this._bareFontInfo.fontWeight;\r\n        regularDomNode.style.fontSize = this._bareFontInfo.fontSize + 'px';\r\n        regularDomNode.style.fontFeatureSettings = this._bareFontInfo.fontFeatureSettings;\r\n        regularDomNode.style.lineHeight = this._bareFontInfo.lineHeight + 'px';\r\n        regularDomNode.style.letterSpacing = this._bareFontInfo.letterSpacing + 'px';\r\n        container.appendChild(regularDomNode);\r\n        var boldDomNode = document.createElement('div');\r\n        boldDomNode.style.fontFamily = this._bareFontInfo.getMassagedFontFamily();\r\n        boldDomNode.style.fontWeight = 'bold';\r\n        boldDomNode.style.fontSize = this._bareFontInfo.fontSize + 'px';\r\n        boldDomNode.style.fontFeatureSettings = this._bareFontInfo.fontFeatureSettings;\r\n        boldDomNode.style.lineHeight = this._bareFontInfo.lineHeight + 'px';\r\n        boldDomNode.style.letterSpacing = this._bareFontInfo.letterSpacing + 'px';\r\n        container.appendChild(boldDomNode);\r\n        var italicDomNode = document.createElement('div');\r\n        italicDomNode.style.fontFamily = this._bareFontInfo.getMassagedFontFamily();\r\n        italicDomNode.style.fontWeight = this._bareFontInfo.fontWeight;\r\n        italicDomNode.style.fontSize = this._bareFontInfo.fontSize + 'px';\r\n        italicDomNode.style.fontFeatureSettings = this._bareFontInfo.fontFeatureSettings;\r\n        italicDomNode.style.lineHeight = this._bareFontInfo.lineHeight + 'px';\r\n        italicDomNode.style.letterSpacing = this._bareFontInfo.letterSpacing + 'px';\r\n        italicDomNode.style.fontStyle = 'italic';\r\n        container.appendChild(italicDomNode);\r\n        var testElements = [];\r\n        for (var _i = 0, _a = this._requests; _i < _a.length; _i++) {\r\n            var request = _a[_i];\r\n            var parent_1 = void 0;\r\n            if (request.type === 0 /* Regular */) {\r\n                parent_1 = regularDomNode;\r\n            }\r\n            if (request.type === 2 /* Bold */) {\r\n                parent_1 = boldDomNode;\r\n            }\r\n            if (request.type === 1 /* Italic */) {\r\n                parent_1 = italicDomNode;\r\n            }\r\n            parent_1.appendChild(document.createElement('br'));\r\n            var testElement = document.createElement('span');\r\n            DomCharWidthReader._render(testElement, request);\r\n            parent_1.appendChild(testElement);\r\n            testElements.push(testElement);\r\n        }\r\n        this._container = container;\r\n        this._testElements = testElements;\r\n    };\r\n    DomCharWidthReader._render = function (testElement, request) {\r\n        if (request.chr === ' ') {\r\n            var htmlString = '&#160;';\r\n            // Repeat character 256 (2^8) times\r\n            for (var i = 0; i < 8; i++) {\r\n                htmlString += htmlString;\r\n            }\r\n            testElement.innerHTML = htmlString;\r\n        }\r\n        else {\r\n            var testString = request.chr;\r\n            // Repeat character 256 (2^8) times\r\n            for (var i = 0; i < 8; i++) {\r\n                testString += testString;\r\n            }\r\n            testElement.textContent = testString;\r\n        }\r\n    };\r\n    DomCharWidthReader.prototype._readFromDomElements = function () {\r\n        for (var i = 0, len = this._requests.length; i < len; i++) {\r\n            var request = this._requests[i];\r\n            var testElement = this._testElements[i];\r\n            request.fulfill(testElement.offsetWidth / 256);\r\n        }\r\n    };\r\n    return DomCharWidthReader;\r\n}());\r\nexport function readCharWidths(bareFontInfo, requests) {\r\n    var reader = new DomCharWidthReader(bareFontInfo, requests);\r\n    reader.read();\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { CharWidthRequest, readCharWidths } from './charWidthReader.js';\r\nimport { ElementSizeObserver } from './elementSizeObserver.js';\r\nimport { CommonEditorConfiguration } from '../../common/config/commonEditorConfig.js';\r\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\r\nimport { FontInfo } from '../../common/config/fontInfo.js';\r\nvar CSSBasedConfigurationCache = /** @class */ (function () {\r\n    function CSSBasedConfigurationCache() {\r\n        this._keys = Object.create(null);\r\n        this._values = Object.create(null);\r\n    }\r\n    CSSBasedConfigurationCache.prototype.has = function (item) {\r\n        var itemId = item.getId();\r\n        return !!this._values[itemId];\r\n    };\r\n    CSSBasedConfigurationCache.prototype.get = function (item) {\r\n        var itemId = item.getId();\r\n        return this._values[itemId];\r\n    };\r\n    CSSBasedConfigurationCache.prototype.put = function (item, value) {\r\n        var itemId = item.getId();\r\n        this._keys[itemId] = item;\r\n        this._values[itemId] = value;\r\n    };\r\n    CSSBasedConfigurationCache.prototype.remove = function (item) {\r\n        var itemId = item.getId();\r\n        delete this._keys[itemId];\r\n        delete this._values[itemId];\r\n    };\r\n    CSSBasedConfigurationCache.prototype.getValues = function () {\r\n        var _this = this;\r\n        return Object.keys(this._keys).map(function (id) { return _this._values[id]; });\r\n    };\r\n    return CSSBasedConfigurationCache;\r\n}());\r\nexport function clearAllFontInfos() {\r\n    CSSBasedConfiguration.INSTANCE.clearCache();\r\n}\r\nvar CSSBasedConfiguration = /** @class */ (function (_super) {\r\n    __extends(CSSBasedConfiguration, _super);\r\n    function CSSBasedConfiguration() {\r\n        var _this = _super.call(this) || this;\r\n        _this._onDidChange = _this._register(new Emitter());\r\n        _this.onDidChange = _this._onDidChange.event;\r\n        _this._cache = new CSSBasedConfigurationCache();\r\n        _this._evictUntrustedReadingsTimeout = -1;\r\n        return _this;\r\n    }\r\n    CSSBasedConfiguration.prototype.dispose = function () {\r\n        if (this._evictUntrustedReadingsTimeout !== -1) {\r\n            clearTimeout(this._evictUntrustedReadingsTimeout);\r\n            this._evictUntrustedReadingsTimeout = -1;\r\n        }\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    CSSBasedConfiguration.prototype.clearCache = function () {\r\n        this._cache = new CSSBasedConfigurationCache();\r\n        this._onDidChange.fire();\r\n    };\r\n    CSSBasedConfiguration.prototype._writeToCache = function (item, value) {\r\n        var _this = this;\r\n        this._cache.put(item, value);\r\n        if (!value.isTrusted && this._evictUntrustedReadingsTimeout === -1) {\r\n            // Try reading again after some time\r\n            this._evictUntrustedReadingsTimeout = setTimeout(function () {\r\n                _this._evictUntrustedReadingsTimeout = -1;\r\n                _this._evictUntrustedReadings();\r\n            }, 5000);\r\n        }\r\n    };\r\n    CSSBasedConfiguration.prototype._evictUntrustedReadings = function () {\r\n        var values = this._cache.getValues();\r\n        var somethingRemoved = false;\r\n        for (var i = 0, len = values.length; i < len; i++) {\r\n            var item = values[i];\r\n            if (!item.isTrusted) {\r\n                somethingRemoved = true;\r\n                this._cache.remove(item);\r\n            }\r\n        }\r\n        if (somethingRemoved) {\r\n            this._onDidChange.fire();\r\n        }\r\n    };\r\n    CSSBasedConfiguration.prototype.readConfiguration = function (bareFontInfo) {\r\n        if (!this._cache.has(bareFontInfo)) {\r\n            var readConfig = CSSBasedConfiguration._actualReadConfiguration(bareFontInfo);\r\n            if (readConfig.typicalHalfwidthCharacterWidth <= 2 || readConfig.typicalFullwidthCharacterWidth <= 2 || readConfig.spaceWidth <= 2 || readConfig.maxDigitWidth <= 2) {\r\n                // Hey, it's Bug 14341 ... we couldn't read\r\n                readConfig = new FontInfo({\r\n                    zoomLevel: browser.getZoomLevel(),\r\n                    fontFamily: readConfig.fontFamily,\r\n                    fontWeight: readConfig.fontWeight,\r\n                    fontSize: readConfig.fontSize,\r\n                    fontFeatureSettings: readConfig.fontFeatureSettings,\r\n                    lineHeight: readConfig.lineHeight,\r\n                    letterSpacing: readConfig.letterSpacing,\r\n                    isMonospace: readConfig.isMonospace,\r\n                    typicalHalfwidthCharacterWidth: Math.max(readConfig.typicalHalfwidthCharacterWidth, 5),\r\n                    typicalFullwidthCharacterWidth: Math.max(readConfig.typicalFullwidthCharacterWidth, 5),\r\n                    canUseHalfwidthRightwardsArrow: readConfig.canUseHalfwidthRightwardsArrow,\r\n                    spaceWidth: Math.max(readConfig.spaceWidth, 5),\r\n                    middotWidth: Math.max(readConfig.middotWidth, 5),\r\n                    maxDigitWidth: Math.max(readConfig.maxDigitWidth, 5),\r\n                }, false);\r\n            }\r\n            this._writeToCache(bareFontInfo, readConfig);\r\n        }\r\n        return this._cache.get(bareFontInfo);\r\n    };\r\n    CSSBasedConfiguration.createRequest = function (chr, type, all, monospace) {\r\n        var result = new CharWidthRequest(chr, type);\r\n        all.push(result);\r\n        if (monospace) {\r\n            monospace.push(result);\r\n        }\r\n        return result;\r\n    };\r\n    CSSBasedConfiguration._actualReadConfiguration = function (bareFontInfo) {\r\n        var all = [];\r\n        var monospace = [];\r\n        var typicalHalfwidthCharacter = this.createRequest('n', 0 /* Regular */, all, monospace);\r\n        var typicalFullwidthCharacter = this.createRequest('\\uff4d', 0 /* Regular */, all, null);\r\n        var space = this.createRequest(' ', 0 /* Regular */, all, monospace);\r\n        var digit0 = this.createRequest('0', 0 /* Regular */, all, monospace);\r\n        var digit1 = this.createRequest('1', 0 /* Regular */, all, monospace);\r\n        var digit2 = this.createRequest('2', 0 /* Regular */, all, monospace);\r\n        var digit3 = this.createRequest('3', 0 /* Regular */, all, monospace);\r\n        var digit4 = this.createRequest('4', 0 /* Regular */, all, monospace);\r\n        var digit5 = this.createRequest('5', 0 /* Regular */, all, monospace);\r\n        var digit6 = this.createRequest('6', 0 /* Regular */, all, monospace);\r\n        var digit7 = this.createRequest('7', 0 /* Regular */, all, monospace);\r\n        var digit8 = this.createRequest('8', 0 /* Regular */, all, monospace);\r\n        var digit9 = this.createRequest('9', 0 /* Regular */, all, monospace);\r\n        // monospace test: used for whitespace rendering\r\n        var rightwardsArrow = this.createRequest('→', 0 /* Regular */, all, monospace);\r\n        var halfwidthRightwardsArrow = this.createRequest('￫', 0 /* Regular */, all, null);\r\n        // middle dot character\r\n        var middot = this.createRequest('·', 0 /* Regular */, all, monospace);\r\n        // monospace test: some characters\r\n        this.createRequest('|', 0 /* Regular */, all, monospace);\r\n        this.createRequest('/', 0 /* Regular */, all, monospace);\r\n        this.createRequest('-', 0 /* Regular */, all, monospace);\r\n        this.createRequest('_', 0 /* Regular */, all, monospace);\r\n        this.createRequest('i', 0 /* Regular */, all, monospace);\r\n        this.createRequest('l', 0 /* Regular */, all, monospace);\r\n        this.createRequest('m', 0 /* Regular */, all, monospace);\r\n        // monospace italic test\r\n        this.createRequest('|', 1 /* Italic */, all, monospace);\r\n        this.createRequest('_', 1 /* Italic */, all, monospace);\r\n        this.createRequest('i', 1 /* Italic */, all, monospace);\r\n        this.createRequest('l', 1 /* Italic */, all, monospace);\r\n        this.createRequest('m', 1 /* Italic */, all, monospace);\r\n        this.createRequest('n', 1 /* Italic */, all, monospace);\r\n        // monospace bold test\r\n        this.createRequest('|', 2 /* Bold */, all, monospace);\r\n        this.createRequest('_', 2 /* Bold */, all, monospace);\r\n        this.createRequest('i', 2 /* Bold */, all, monospace);\r\n        this.createRequest('l', 2 /* Bold */, all, monospace);\r\n        this.createRequest('m', 2 /* Bold */, all, monospace);\r\n        this.createRequest('n', 2 /* Bold */, all, monospace);\r\n        readCharWidths(bareFontInfo, all);\r\n        var maxDigitWidth = Math.max(digit0.width, digit1.width, digit2.width, digit3.width, digit4.width, digit5.width, digit6.width, digit7.width, digit8.width, digit9.width);\r\n        var isMonospace = (bareFontInfo.fontFeatureSettings === EditorFontLigatures.OFF);\r\n        var referenceWidth = monospace[0].width;\r\n        for (var i = 1, len = monospace.length; isMonospace && i < len; i++) {\r\n            var diff = referenceWidth - monospace[i].width;\r\n            if (diff < -0.001 || diff > 0.001) {\r\n                isMonospace = false;\r\n                break;\r\n            }\r\n        }\r\n        var canUseHalfwidthRightwardsArrow = true;\r\n        if (isMonospace && halfwidthRightwardsArrow.width !== referenceWidth) {\r\n            // using a halfwidth rightwards arrow would break monospace...\r\n            canUseHalfwidthRightwardsArrow = false;\r\n        }\r\n        if (halfwidthRightwardsArrow.width > rightwardsArrow.width) {\r\n            // using a halfwidth rightwards arrow would paint a larger arrow than a regular rightwards arrow\r\n            canUseHalfwidthRightwardsArrow = false;\r\n        }\r\n        // let's trust the zoom level only 2s after it was changed.\r\n        var canTrustBrowserZoomLevel = (browser.getTimeSinceLastZoomLevelChanged() > 2000);\r\n        return new FontInfo({\r\n            zoomLevel: browser.getZoomLevel(),\r\n            fontFamily: bareFontInfo.fontFamily,\r\n            fontWeight: bareFontInfo.fontWeight,\r\n            fontSize: bareFontInfo.fontSize,\r\n            fontFeatureSettings: bareFontInfo.fontFeatureSettings,\r\n            lineHeight: bareFontInfo.lineHeight,\r\n            letterSpacing: bareFontInfo.letterSpacing,\r\n            isMonospace: isMonospace,\r\n            typicalHalfwidthCharacterWidth: typicalHalfwidthCharacter.width,\r\n            typicalFullwidthCharacterWidth: typicalFullwidthCharacter.width,\r\n            canUseHalfwidthRightwardsArrow: canUseHalfwidthRightwardsArrow,\r\n            spaceWidth: space.width,\r\n            middotWidth: middot.width,\r\n            maxDigitWidth: maxDigitWidth\r\n        }, canTrustBrowserZoomLevel);\r\n    };\r\n    CSSBasedConfiguration.INSTANCE = new CSSBasedConfiguration();\r\n    return CSSBasedConfiguration;\r\n}(Disposable));\r\nvar Configuration = /** @class */ (function (_super) {\r\n    __extends(Configuration, _super);\r\n    function Configuration(isSimpleWidget, options, referenceDomElement, accessibilityService) {\r\n        if (referenceDomElement === void 0) { referenceDomElement = null; }\r\n        var _this = _super.call(this, isSimpleWidget, options) || this;\r\n        _this.accessibilityService = accessibilityService;\r\n        _this._elementSizeObserver = _this._register(new ElementSizeObserver(referenceDomElement, options.dimension, function () { return _this._onReferenceDomElementSizeChanged(); }));\r\n        _this._register(CSSBasedConfiguration.INSTANCE.onDidChange(function () { return _this._onCSSBasedConfigurationChanged(); }));\r\n        if (_this._validatedOptions.get(9 /* automaticLayout */)) {\r\n            _this._elementSizeObserver.startObserving();\r\n        }\r\n        _this._register(browser.onDidChangeZoomLevel(function (_) { return _this._recomputeOptions(); }));\r\n        _this._register(_this.accessibilityService.onDidChangeScreenReaderOptimized(function () { return _this._recomputeOptions(); }));\r\n        _this._recomputeOptions();\r\n        return _this;\r\n    }\r\n    Configuration.applyFontInfoSlow = function (domNode, fontInfo) {\r\n        domNode.style.fontFamily = fontInfo.getMassagedFontFamily();\r\n        domNode.style.fontWeight = fontInfo.fontWeight;\r\n        domNode.style.fontSize = fontInfo.fontSize + 'px';\r\n        domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\r\n        domNode.style.lineHeight = fontInfo.lineHeight + 'px';\r\n        domNode.style.letterSpacing = fontInfo.letterSpacing + 'px';\r\n    };\r\n    Configuration.applyFontInfo = function (domNode, fontInfo) {\r\n        domNode.setFontFamily(fontInfo.getMassagedFontFamily());\r\n        domNode.setFontWeight(fontInfo.fontWeight);\r\n        domNode.setFontSize(fontInfo.fontSize);\r\n        domNode.setFontFeatureSettings(fontInfo.fontFeatureSettings);\r\n        domNode.setLineHeight(fontInfo.lineHeight);\r\n        domNode.setLetterSpacing(fontInfo.letterSpacing);\r\n    };\r\n    Configuration.prototype._onReferenceDomElementSizeChanged = function () {\r\n        this._recomputeOptions();\r\n    };\r\n    Configuration.prototype._onCSSBasedConfigurationChanged = function () {\r\n        this._recomputeOptions();\r\n    };\r\n    Configuration.prototype.observeReferenceElement = function (dimension) {\r\n        this._elementSizeObserver.observe(dimension);\r\n    };\r\n    Configuration.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    Configuration.prototype._getExtraEditorClassName = function () {\r\n        var extra = '';\r\n        if (!browser.isSafari && !browser.isWebkitWebView) {\r\n            // Use user-select: none in all browsers except Safari and native macOS WebView\r\n            extra += 'no-user-select ';\r\n        }\r\n        if (platform.isMacintosh) {\r\n            extra += 'mac ';\r\n        }\r\n        return extra;\r\n    };\r\n    Configuration.prototype._getEnvConfiguration = function () {\r\n        return {\r\n            extraEditorClassName: this._getExtraEditorClassName(),\r\n            outerWidth: this._elementSizeObserver.getWidth(),\r\n            outerHeight: this._elementSizeObserver.getHeight(),\r\n            emptySelectionClipboard: browser.isWebKit || browser.isFirefox,\r\n            pixelRatio: browser.getPixelRatio(),\r\n            zoomLevel: browser.getZoomLevel(),\r\n            accessibilitySupport: (this.accessibilityService.isScreenReaderOptimized()\r\n                ? 2 /* Enabled */\r\n                : this.accessibilityService.getAccessibilitySupport())\r\n        };\r\n    };\r\n    Configuration.prototype.readConfiguration = function (bareFontInfo) {\r\n        return CSSBasedConfiguration.INSTANCE.readConfiguration(bareFontInfo);\r\n    };\r\n    return Configuration;\r\n}(CommonEditorConfiguration));\r\nexport { Configuration };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { StandardWheelEvent } from '../../../base/browser/mouseEvent.js';\r\nimport { RunOnceScheduler, TimeoutTimer } from '../../../base/common/async.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { HitTestContext, MouseTarget, MouseTargetFactory } from './mouseTarget.js';\r\nimport { ClientCoordinates, EditorMouseEventFactory, GlobalEditorMouseMoveMonitor, createEditorPagePosition } from '../editorDom.js';\r\nimport { EditorZoom } from '../../common/config/editorZoom.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { ViewEventHandler } from '../../common/viewModel/viewEventHandler.js';\r\n/**\r\n * Merges mouse events when mouse move events are throttled\r\n */\r\nexport function createMouseMoveEventMerger(mouseTargetFactory) {\r\n    return function (lastEvent, currentEvent) {\r\n        var targetIsWidget = false;\r\n        if (mouseTargetFactory) {\r\n            targetIsWidget = mouseTargetFactory.mouseTargetIsWidget(currentEvent);\r\n        }\r\n        if (!targetIsWidget) {\r\n            currentEvent.preventDefault();\r\n        }\r\n        return currentEvent;\r\n    };\r\n}\r\nvar MouseHandler = /** @class */ (function (_super) {\r\n    __extends(MouseHandler, _super);\r\n    function MouseHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this) || this;\r\n        _this._isFocused = false;\r\n        _this._context = context;\r\n        _this.viewController = viewController;\r\n        _this.viewHelper = viewHelper;\r\n        _this.mouseTargetFactory = new MouseTargetFactory(_this._context, viewHelper);\r\n        _this._mouseDownOperation = _this._register(new MouseDownOperation(_this._context, _this.viewController, _this.viewHelper, function (e, testEventTarget) { return _this._createMouseTarget(e, testEventTarget); }, function (e) { return _this._getMouseColumn(e); }));\r\n        _this._asyncFocus = _this._register(new RunOnceScheduler(function () { return _this.viewHelper.focusTextArea(); }, 0));\r\n        _this.lastMouseLeaveTime = -1;\r\n        var mouseEvents = new EditorMouseEventFactory(_this.viewHelper.viewDomNode);\r\n        _this._register(mouseEvents.onContextMenu(_this.viewHelper.viewDomNode, function (e) { return _this._onContextMenu(e, true); }));\r\n        _this._register(mouseEvents.onMouseMoveThrottled(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseMove(e); }, createMouseMoveEventMerger(_this.mouseTargetFactory), MouseHandler.MOUSE_MOVE_MINIMUM_TIME));\r\n        _this._register(mouseEvents.onMouseUp(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseUp(e); }));\r\n        _this._register(mouseEvents.onMouseLeave(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseLeave(e); }));\r\n        _this._register(mouseEvents.onMouseDown(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseDown(e); }));\r\n        var onMouseWheel = function (browserEvent) {\r\n            _this.viewController.emitMouseWheel(browserEvent);\r\n            if (!_this._context.configuration.options.get(57 /* mouseWheelZoom */)) {\r\n                return;\r\n            }\r\n            var e = new StandardWheelEvent(browserEvent);\r\n            if (e.browserEvent.ctrlKey || e.browserEvent.metaKey) {\r\n                var zoomLevel = EditorZoom.getZoomLevel();\r\n                var delta = e.deltaY > 0 ? 1 : -1;\r\n                EditorZoom.setZoomLevel(zoomLevel + delta);\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n        };\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.viewDomNode, browser.isEdgeOrIE ? 'mousewheel' : 'wheel', onMouseWheel, { capture: true, passive: false }));\r\n        _this._context.addEventHandler(_this);\r\n        return _this;\r\n    }\r\n    MouseHandler.prototype.dispose = function () {\r\n        this._context.removeEventHandler(this);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    // --- begin event handlers\r\n    MouseHandler.prototype.onCursorStateChanged = function (e) {\r\n        this._mouseDownOperation.onCursorStateChanged(e);\r\n        return false;\r\n    };\r\n    MouseHandler.prototype.onFocusChanged = function (e) {\r\n        this._isFocused = e.isFocused;\r\n        return false;\r\n    };\r\n    MouseHandler.prototype.onScrollChanged = function (e) {\r\n        this._mouseDownOperation.onScrollChanged();\r\n        return false;\r\n    };\r\n    // --- end event handlers\r\n    MouseHandler.prototype.getTargetAtClientPoint = function (clientX, clientY) {\r\n        var clientPos = new ClientCoordinates(clientX, clientY);\r\n        var pos = clientPos.toPageCoordinates();\r\n        var editorPos = createEditorPagePosition(this.viewHelper.viewDomNode);\r\n        if (pos.y < editorPos.y || pos.y > editorPos.y + editorPos.height || pos.x < editorPos.x || pos.x > editorPos.x + editorPos.width) {\r\n            return null;\r\n        }\r\n        return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), editorPos, pos, null);\r\n    };\r\n    MouseHandler.prototype._createMouseTarget = function (e, testEventTarget) {\r\n        return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), e.editorPos, e.pos, testEventTarget ? e.target : null);\r\n    };\r\n    MouseHandler.prototype._getMouseColumn = function (e) {\r\n        return this.mouseTargetFactory.getMouseColumn(e.editorPos, e.pos);\r\n    };\r\n    MouseHandler.prototype._onContextMenu = function (e, testEventTarget) {\r\n        this.viewController.emitContextMenu({\r\n            event: e,\r\n            target: this._createMouseTarget(e, testEventTarget)\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseMove = function (e) {\r\n        if (this._mouseDownOperation.isActive()) {\r\n            // In selection/drag operation\r\n            return;\r\n        }\r\n        var actualMouseMoveTime = e.timestamp;\r\n        if (actualMouseMoveTime < this.lastMouseLeaveTime) {\r\n            // Due to throttling, this event occurred before the mouse left the editor, therefore ignore it.\r\n            return;\r\n        }\r\n        this.viewController.emitMouseMove({\r\n            event: e,\r\n            target: this._createMouseTarget(e, true)\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseLeave = function (e) {\r\n        this.lastMouseLeaveTime = (new Date()).getTime();\r\n        this.viewController.emitMouseLeave({\r\n            event: e,\r\n            target: null\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseUp = function (e) {\r\n        this.viewController.emitMouseUp({\r\n            event: e,\r\n            target: this._createMouseTarget(e, true)\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseDown = function (e) {\r\n        var _this = this;\r\n        var t = this._createMouseTarget(e, true);\r\n        var targetIsContent = (t.type === 6 /* CONTENT_TEXT */ || t.type === 7 /* CONTENT_EMPTY */);\r\n        var targetIsGutter = (t.type === 2 /* GUTTER_GLYPH_MARGIN */ || t.type === 3 /* GUTTER_LINE_NUMBERS */ || t.type === 4 /* GUTTER_LINE_DECORATIONS */);\r\n        var targetIsLineNumbers = (t.type === 3 /* GUTTER_LINE_NUMBERS */);\r\n        var selectOnLineNumbers = this._context.configuration.options.get(83 /* selectOnLineNumbers */);\r\n        var targetIsViewZone = (t.type === 8 /* CONTENT_VIEW_ZONE */ || t.type === 5 /* GUTTER_VIEW_ZONE */);\r\n        var targetIsWidget = (t.type === 9 /* CONTENT_WIDGET */);\r\n        var shouldHandle = e.leftButton || e.middleButton;\r\n        if (platform.isMacintosh && e.leftButton && e.ctrlKey) {\r\n            shouldHandle = false;\r\n        }\r\n        var focus = function () {\r\n            // In IE11, if the focus is in the browser's address bar and\r\n            // then you click in the editor, calling preventDefault()\r\n            // will not move focus properly (focus remains the address bar)\r\n            if (browser.isIE && !_this._isFocused) {\r\n                _this._asyncFocus.schedule();\r\n            }\r\n            else {\r\n                e.preventDefault();\r\n                _this.viewHelper.focusTextArea();\r\n            }\r\n        };\r\n        if (shouldHandle && (targetIsContent || (targetIsLineNumbers && selectOnLineNumbers))) {\r\n            focus();\r\n            this._mouseDownOperation.start(t.type, e);\r\n        }\r\n        else if (targetIsGutter) {\r\n            // Do not steal focus\r\n            e.preventDefault();\r\n        }\r\n        else if (targetIsViewZone) {\r\n            var viewZoneData = t.detail;\r\n            if (this.viewHelper.shouldSuppressMouseDownOnViewZone(viewZoneData.viewZoneId)) {\r\n                focus();\r\n                this._mouseDownOperation.start(t.type, e);\r\n                e.preventDefault();\r\n            }\r\n        }\r\n        else if (targetIsWidget && this.viewHelper.shouldSuppressMouseDownOnWidget(t.detail)) {\r\n            focus();\r\n            e.preventDefault();\r\n        }\r\n        this.viewController.emitMouseDown({\r\n            event: e,\r\n            target: t\r\n        });\r\n    };\r\n    MouseHandler.MOUSE_MOVE_MINIMUM_TIME = 100; // ms\r\n    return MouseHandler;\r\n}(ViewEventHandler));\r\nexport { MouseHandler };\r\nvar MouseDownOperation = /** @class */ (function (_super) {\r\n    __extends(MouseDownOperation, _super);\r\n    function MouseDownOperation(context, viewController, viewHelper, createMouseTarget, getMouseColumn) {\r\n        var _this = _super.call(this) || this;\r\n        _this._context = context;\r\n        _this._viewController = viewController;\r\n        _this._viewHelper = viewHelper;\r\n        _this._createMouseTarget = createMouseTarget;\r\n        _this._getMouseColumn = getMouseColumn;\r\n        _this._mouseMoveMonitor = _this._register(new GlobalEditorMouseMoveMonitor(_this._viewHelper.viewDomNode));\r\n        _this._onScrollTimeout = _this._register(new TimeoutTimer());\r\n        _this._mouseState = new MouseDownState();\r\n        _this._currentSelection = new Selection(1, 1, 1, 1);\r\n        _this._isActive = false;\r\n        _this._lastMouseEvent = null;\r\n        return _this;\r\n    }\r\n    MouseDownOperation.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    MouseDownOperation.prototype.isActive = function () {\r\n        return this._isActive;\r\n    };\r\n    MouseDownOperation.prototype._onMouseDownThenMove = function (e) {\r\n        this._lastMouseEvent = e;\r\n        this._mouseState.setModifiers(e);\r\n        var position = this._findMousePosition(e, true);\r\n        if (!position) {\r\n            // Ignoring because position is unknown\r\n            return;\r\n        }\r\n        if (this._mouseState.isDragAndDrop) {\r\n            this._viewController.emitMouseDrag({\r\n                event: e,\r\n                target: position\r\n            });\r\n        }\r\n        else {\r\n            this._dispatchMouse(position, true);\r\n        }\r\n    };\r\n    MouseDownOperation.prototype.start = function (targetType, e) {\r\n        var _this = this;\r\n        this._lastMouseEvent = e;\r\n        this._mouseState.setStartedOnLineNumbers(targetType === 3 /* GUTTER_LINE_NUMBERS */);\r\n        this._mouseState.setStartButtons(e);\r\n        this._mouseState.setModifiers(e);\r\n        var position = this._findMousePosition(e, true);\r\n        if (!position || !position.position) {\r\n            // Ignoring because position is unknown\r\n            return;\r\n        }\r\n        this._mouseState.trySetCount(e.detail, position.position);\r\n        // Overwrite the detail of the MouseEvent, as it will be sent out in an event and contributions might rely on it.\r\n        e.detail = this._mouseState.count;\r\n        var options = this._context.configuration.options;\r\n        if (!options.get(68 /* readOnly */)\r\n            && options.get(24 /* dragAndDrop */)\r\n            && !this._mouseState.altKey // we don't support multiple mouse\r\n            && e.detail < 2 // only single click on a selection can work\r\n            && !this._isActive // the mouse is not down yet\r\n            && !this._currentSelection.isEmpty() // we don't drag single cursor\r\n            && (position.type === 6 /* CONTENT_TEXT */) // single click on text\r\n            && position.position && this._currentSelection.containsPosition(position.position) // single click on a selection\r\n        ) {\r\n            this._mouseState.isDragAndDrop = true;\r\n            this._isActive = true;\r\n            this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, createMouseMoveEventMerger(null), function (e) { return _this._onMouseDownThenMove(e); }, function () {\r\n                var position = _this._findMousePosition(_this._lastMouseEvent, true);\r\n                _this._viewController.emitMouseDrop({\r\n                    event: _this._lastMouseEvent,\r\n                    target: (position ? _this._createMouseTarget(_this._lastMouseEvent, true) : null) // Ignoring because position is unknown, e.g., Content View Zone\r\n                });\r\n                _this._stop();\r\n            });\r\n            return;\r\n        }\r\n        this._mouseState.isDragAndDrop = false;\r\n        this._dispatchMouse(position, e.shiftKey);\r\n        if (!this._isActive) {\r\n            this._isActive = true;\r\n            this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, createMouseMoveEventMerger(null), function (e) { return _this._onMouseDownThenMove(e); }, function () { return _this._stop(); });\r\n        }\r\n    };\r\n    MouseDownOperation.prototype._stop = function () {\r\n        this._isActive = false;\r\n        this._onScrollTimeout.cancel();\r\n    };\r\n    MouseDownOperation.prototype.onScrollChanged = function () {\r\n        var _this = this;\r\n        if (!this._isActive) {\r\n            return;\r\n        }\r\n        this._onScrollTimeout.setIfNotSet(function () {\r\n            if (!_this._lastMouseEvent) {\r\n                return;\r\n            }\r\n            var position = _this._findMousePosition(_this._lastMouseEvent, false);\r\n            if (!position) {\r\n                // Ignoring because position is unknown\r\n                return;\r\n            }\r\n            if (_this._mouseState.isDragAndDrop) {\r\n                // Ignoring because users are dragging the text\r\n                return;\r\n            }\r\n            _this._dispatchMouse(position, true);\r\n        }, 10);\r\n    };\r\n    MouseDownOperation.prototype.onCursorStateChanged = function (e) {\r\n        this._currentSelection = e.selections[0];\r\n    };\r\n    MouseDownOperation.prototype._getPositionOutsideEditor = function (e) {\r\n        var editorContent = e.editorPos;\r\n        var model = this._context.model;\r\n        var viewLayout = this._context.viewLayout;\r\n        var mouseColumn = this._getMouseColumn(e);\r\n        if (e.posy < editorContent.y) {\r\n            var verticalOffset = Math.max(viewLayout.getCurrentScrollTop() - (editorContent.y - e.posy), 0);\r\n            var viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\r\n            if (viewZoneData) {\r\n                var newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\r\n                if (newPosition) {\r\n                    return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, newPosition);\r\n                }\r\n            }\r\n            var aboveLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(aboveLineNumber, 1));\r\n        }\r\n        if (e.posy > editorContent.y + editorContent.height) {\r\n            var verticalOffset = viewLayout.getCurrentScrollTop() + (e.posy - editorContent.y);\r\n            var viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\r\n            if (viewZoneData) {\r\n                var newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\r\n                if (newPosition) {\r\n                    return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, newPosition);\r\n                }\r\n            }\r\n            var belowLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(belowLineNumber, model.getLineMaxColumn(belowLineNumber)));\r\n        }\r\n        var possibleLineNumber = viewLayout.getLineNumberAtVerticalOffset(viewLayout.getCurrentScrollTop() + (e.posy - editorContent.y));\r\n        if (e.posx < editorContent.x) {\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(possibleLineNumber, 1));\r\n        }\r\n        if (e.posx > editorContent.x + editorContent.width) {\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(possibleLineNumber, model.getLineMaxColumn(possibleLineNumber)));\r\n        }\r\n        return null;\r\n    };\r\n    MouseDownOperation.prototype._findMousePosition = function (e, testEventTarget) {\r\n        var positionOutsideEditor = this._getPositionOutsideEditor(e);\r\n        if (positionOutsideEditor) {\r\n            return positionOutsideEditor;\r\n        }\r\n        var t = this._createMouseTarget(e, testEventTarget);\r\n        var hintedPosition = t.position;\r\n        if (!hintedPosition) {\r\n            return null;\r\n        }\r\n        if (t.type === 8 /* CONTENT_VIEW_ZONE */ || t.type === 5 /* GUTTER_VIEW_ZONE */) {\r\n            var newPosition = this._helpPositionJumpOverViewZone(t.detail);\r\n            if (newPosition) {\r\n                return new MouseTarget(t.element, t.type, t.mouseColumn, newPosition, null, t.detail);\r\n            }\r\n        }\r\n        return t;\r\n    };\r\n    MouseDownOperation.prototype._helpPositionJumpOverViewZone = function (viewZoneData) {\r\n        // Force position on view zones to go above or below depending on where selection started from\r\n        var selectionStart = new Position(this._currentSelection.selectionStartLineNumber, this._currentSelection.selectionStartColumn);\r\n        var positionBefore = viewZoneData.positionBefore;\r\n        var positionAfter = viewZoneData.positionAfter;\r\n        if (positionBefore && positionAfter) {\r\n            if (positionBefore.isBefore(selectionStart)) {\r\n                return positionBefore;\r\n            }\r\n            else {\r\n                return positionAfter;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    MouseDownOperation.prototype._dispatchMouse = function (position, inSelectionMode) {\r\n        if (!position.position) {\r\n            return;\r\n        }\r\n        this._viewController.dispatchMouse({\r\n            position: position.position,\r\n            mouseColumn: position.mouseColumn,\r\n            startedOnLineNumbers: this._mouseState.startedOnLineNumbers,\r\n            inSelectionMode: inSelectionMode,\r\n            mouseDownCount: this._mouseState.count,\r\n            altKey: this._mouseState.altKey,\r\n            ctrlKey: this._mouseState.ctrlKey,\r\n            metaKey: this._mouseState.metaKey,\r\n            shiftKey: this._mouseState.shiftKey,\r\n            leftButton: this._mouseState.leftButton,\r\n            middleButton: this._mouseState.middleButton,\r\n        });\r\n    };\r\n    return MouseDownOperation;\r\n}(Disposable));\r\nvar MouseDownState = /** @class */ (function () {\r\n    function MouseDownState() {\r\n        this._altKey = false;\r\n        this._ctrlKey = false;\r\n        this._metaKey = false;\r\n        this._shiftKey = false;\r\n        this._leftButton = false;\r\n        this._middleButton = false;\r\n        this._startedOnLineNumbers = false;\r\n        this._lastMouseDownPosition = null;\r\n        this._lastMouseDownPositionEqualCount = 0;\r\n        this._lastMouseDownCount = 0;\r\n        this._lastSetMouseDownCountTime = 0;\r\n        this.isDragAndDrop = false;\r\n    }\r\n    Object.defineProperty(MouseDownState.prototype, \"altKey\", {\r\n        get: function () { return this._altKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"ctrlKey\", {\r\n        get: function () { return this._ctrlKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"metaKey\", {\r\n        get: function () { return this._metaKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"shiftKey\", {\r\n        get: function () { return this._shiftKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"leftButton\", {\r\n        get: function () { return this._leftButton; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"middleButton\", {\r\n        get: function () { return this._middleButton; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"startedOnLineNumbers\", {\r\n        get: function () { return this._startedOnLineNumbers; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"count\", {\r\n        get: function () {\r\n            return this._lastMouseDownCount;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    MouseDownState.prototype.setModifiers = function (source) {\r\n        this._altKey = source.altKey;\r\n        this._ctrlKey = source.ctrlKey;\r\n        this._metaKey = source.metaKey;\r\n        this._shiftKey = source.shiftKey;\r\n    };\r\n    MouseDownState.prototype.setStartButtons = function (source) {\r\n        this._leftButton = source.leftButton;\r\n        this._middleButton = source.middleButton;\r\n    };\r\n    MouseDownState.prototype.setStartedOnLineNumbers = function (startedOnLineNumbers) {\r\n        this._startedOnLineNumbers = startedOnLineNumbers;\r\n    };\r\n    MouseDownState.prototype.trySetCount = function (setMouseDownCount, newMouseDownPosition) {\r\n        // a. Invalidate multiple clicking if too much time has passed (will be hit by IE because the detail field of mouse events contains garbage in IE10)\r\n        var currentTime = (new Date()).getTime();\r\n        if (currentTime - this._lastSetMouseDownCountTime > MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME) {\r\n            setMouseDownCount = 1;\r\n        }\r\n        this._lastSetMouseDownCountTime = currentTime;\r\n        // b. Ensure that we don't jump from single click to triple click in one go (will be hit by IE because the detail field of mouse events contains garbage in IE10)\r\n        if (setMouseDownCount > this._lastMouseDownCount + 1) {\r\n            setMouseDownCount = this._lastMouseDownCount + 1;\r\n        }\r\n        // c. Invalidate multiple clicking if the logical position is different\r\n        if (this._lastMouseDownPosition && this._lastMouseDownPosition.equals(newMouseDownPosition)) {\r\n            this._lastMouseDownPositionEqualCount++;\r\n        }\r\n        else {\r\n            this._lastMouseDownPositionEqualCount = 1;\r\n        }\r\n        this._lastMouseDownPosition = newMouseDownPosition;\r\n        // Finally set the lastMouseDownCount\r\n        this._lastMouseDownCount = Math.min(setMouseDownCount, this._lastMouseDownPositionEqualCount);\r\n    };\r\n    MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME = 400; // ms\r\n    return MouseDownState;\r\n}());\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { EventType, Gesture } from '../../../base/browser/touch.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { MouseHandler, createMouseMoveEventMerger } from './mouseHandler.js';\r\nimport { EditorMouseEvent, EditorPointerEventFactory } from '../editorDom.js';\r\nimport { BrowserFeatures } from '../../../base/browser/canIUse.js';\r\nfunction gestureChangeEventMerger(lastEvent, currentEvent) {\r\n    var r = {\r\n        translationY: currentEvent.translationY,\r\n        translationX: currentEvent.translationX\r\n    };\r\n    if (lastEvent) {\r\n        r.translationY += lastEvent.translationY;\r\n        r.translationX += lastEvent.translationX;\r\n    }\r\n    return r;\r\n}\r\n/**\r\n * Basically IE10 and IE11\r\n */\r\nvar MsPointerHandler = /** @class */ (function (_super) {\r\n    __extends(MsPointerHandler, _super);\r\n    function MsPointerHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this, context, viewController, viewHelper) || this;\r\n        _this.viewHelper.linesContentDomNode.style.msTouchAction = 'none';\r\n        _this.viewHelper.linesContentDomNode.style.msContentZooming = 'none';\r\n        // TODO@Alex -> this expects that the view is added in 100 ms, might not be the case\r\n        // This handler should be added when the dom node is in the dom tree\r\n        _this._installGestureHandlerTimeout = window.setTimeout(function () {\r\n            _this._installGestureHandlerTimeout = -1;\r\n            if (window.MSGesture) {\r\n                var touchGesture_1 = new MSGesture();\r\n                var penGesture_1 = new MSGesture();\r\n                touchGesture_1.target = _this.viewHelper.linesContentDomNode;\r\n                penGesture_1.target = _this.viewHelper.linesContentDomNode;\r\n                _this.viewHelper.linesContentDomNode.addEventListener('MSPointerDown', function (e) {\r\n                    // Circumvent IE11 breaking change in e.pointerType & TypeScript's stale definitions\r\n                    var pointerType = e.pointerType;\r\n                    if (pointerType === (e.MSPOINTER_TYPE_MOUSE || 'mouse')) {\r\n                        _this._lastPointerType = 'mouse';\r\n                        return;\r\n                    }\r\n                    else if (pointerType === (e.MSPOINTER_TYPE_TOUCH || 'touch')) {\r\n                        _this._lastPointerType = 'touch';\r\n                        touchGesture_1.addPointer(e.pointerId);\r\n                    }\r\n                    else {\r\n                        _this._lastPointerType = 'pen';\r\n                        penGesture_1.addPointer(e.pointerId);\r\n                    }\r\n                });\r\n                _this._register(dom.addDisposableThrottledListener(_this.viewHelper.linesContentDomNode, 'MSGestureChange', function (e) { return _this._onGestureChange(e); }, gestureChangeEventMerger));\r\n                _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, 'MSGestureTap', function (e) { return _this._onCaptureGestureTap(e); }, true));\r\n            }\r\n        }, 100);\r\n        _this._lastPointerType = 'mouse';\r\n        return _this;\r\n    }\r\n    MsPointerHandler.prototype._onMouseDown = function (e) {\r\n        if (this._lastPointerType === 'mouse') {\r\n            _super.prototype._onMouseDown.call(this, e);\r\n        }\r\n    };\r\n    MsPointerHandler.prototype._onCaptureGestureTap = function (rawEvent) {\r\n        var _this = this;\r\n        var e = new EditorMouseEvent(rawEvent, this.viewHelper.viewDomNode);\r\n        var t = this._createMouseTarget(e, false);\r\n        if (t.position) {\r\n            this.viewController.moveTo(t.position);\r\n        }\r\n        // IE does not want to focus when coming in from the browser's address bar\r\n        if (e.browserEvent.fromElement) {\r\n            e.preventDefault();\r\n            this.viewHelper.focusTextArea();\r\n        }\r\n        else {\r\n            // TODO@Alex -> cancel this is focus is lost\r\n            setTimeout(function () {\r\n                _this.viewHelper.focusTextArea();\r\n            });\r\n        }\r\n    };\r\n    MsPointerHandler.prototype._onGestureChange = function (e) {\r\n        this._context.viewLayout.deltaScrollNow(-e.translationX, -e.translationY);\r\n    };\r\n    MsPointerHandler.prototype.dispose = function () {\r\n        window.clearTimeout(this._installGestureHandlerTimeout);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    return MsPointerHandler;\r\n}(MouseHandler));\r\n/**\r\n * Basically Edge but should be modified to handle any pointerEnabled, even without support of MSGesture\r\n */\r\nvar StandardPointerHandler = /** @class */ (function (_super) {\r\n    __extends(StandardPointerHandler, _super);\r\n    function StandardPointerHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this, context, viewController, viewHelper) || this;\r\n        _this.viewHelper.linesContentDomNode.style.touchAction = 'none';\r\n        // TODO@Alex -> this expects that the view is added in 100 ms, might not be the case\r\n        // This handler should be added when the dom node is in the dom tree\r\n        _this._installGestureHandlerTimeout = window.setTimeout(function () {\r\n            _this._installGestureHandlerTimeout = -1;\r\n            // TODO@Alex: replace the usage of MSGesture here with something that works across all browsers\r\n            if (window.MSGesture) {\r\n                var touchGesture_2 = new MSGesture();\r\n                var penGesture_2 = new MSGesture();\r\n                touchGesture_2.target = _this.viewHelper.linesContentDomNode;\r\n                penGesture_2.target = _this.viewHelper.linesContentDomNode;\r\n                _this.viewHelper.linesContentDomNode.addEventListener('pointerdown', function (e) {\r\n                    var pointerType = e.pointerType;\r\n                    if (pointerType === 'mouse') {\r\n                        _this._lastPointerType = 'mouse';\r\n                        return;\r\n                    }\r\n                    else if (pointerType === 'touch') {\r\n                        _this._lastPointerType = 'touch';\r\n                        touchGesture_2.addPointer(e.pointerId);\r\n                    }\r\n                    else {\r\n                        _this._lastPointerType = 'pen';\r\n                        penGesture_2.addPointer(e.pointerId);\r\n                    }\r\n                });\r\n                _this._register(dom.addDisposableThrottledListener(_this.viewHelper.linesContentDomNode, 'MSGestureChange', function (e) { return _this._onGestureChange(e); }, gestureChangeEventMerger));\r\n                _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, 'MSGestureTap', function (e) { return _this._onCaptureGestureTap(e); }, true));\r\n            }\r\n        }, 100);\r\n        _this._lastPointerType = 'mouse';\r\n        return _this;\r\n    }\r\n    StandardPointerHandler.prototype._onMouseDown = function (e) {\r\n        if (this._lastPointerType === 'mouse') {\r\n            _super.prototype._onMouseDown.call(this, e);\r\n        }\r\n    };\r\n    StandardPointerHandler.prototype._onCaptureGestureTap = function (rawEvent) {\r\n        var _this = this;\r\n        var e = new EditorMouseEvent(rawEvent, this.viewHelper.viewDomNode);\r\n        var t = this._createMouseTarget(e, false);\r\n        if (t.position) {\r\n            this.viewController.moveTo(t.position);\r\n        }\r\n        // IE does not want to focus when coming in from the browser's address bar\r\n        if (e.browserEvent.fromElement) {\r\n            e.preventDefault();\r\n            this.viewHelper.focusTextArea();\r\n        }\r\n        else {\r\n            // TODO@Alex -> cancel this is focus is lost\r\n            setTimeout(function () {\r\n                _this.viewHelper.focusTextArea();\r\n            });\r\n        }\r\n    };\r\n    StandardPointerHandler.prototype._onGestureChange = function (e) {\r\n        this._context.viewLayout.deltaScrollNow(-e.translationX, -e.translationY);\r\n    };\r\n    StandardPointerHandler.prototype.dispose = function () {\r\n        window.clearTimeout(this._installGestureHandlerTimeout);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    return StandardPointerHandler;\r\n}(MouseHandler));\r\n/**\r\n * Currently only tested on iOS 13/ iPadOS.\r\n */\r\nvar PointerEventHandler = /** @class */ (function (_super) {\r\n    __extends(PointerEventHandler, _super);\r\n    function PointerEventHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this, context, viewController, viewHelper) || this;\r\n        _this._register(Gesture.addTarget(_this.viewHelper.linesContentDomNode));\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, EventType.Tap, function (e) { return _this.onTap(e); }));\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, EventType.Change, function (e) { return _this.onChange(e); }));\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, EventType.Contextmenu, function (e) { return _this._onContextMenu(new EditorMouseEvent(e, _this.viewHelper.viewDomNode), false); }));\r\n        _this._lastPointerType = 'mouse';\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, 'pointerdown', function (e) {\r\n            var pointerType = e.pointerType;\r\n            if (pointerType === 'mouse') {\r\n                _this._lastPointerType = 'mouse';\r\n                return;\r\n            }\r\n            else if (pointerType === 'touch') {\r\n                _this._lastPointerType = 'touch';\r\n            }\r\n            else {\r\n                _this._lastPointerType = 'pen';\r\n            }\r\n        }));\r\n        // PonterEvents\r\n        var pointerEvents = new EditorPointerEventFactory(_this.viewHelper.viewDomNode);\r\n        _this._register(pointerEvents.onPointerMoveThrottled(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseMove(e); }, createMouseMoveEventMerger(_this.mouseTargetFactory), MouseHandler.MOUSE_MOVE_MINIMUM_TIME));\r\n        _this._register(pointerEvents.onPointerUp(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseUp(e); }));\r\n        _this._register(pointerEvents.onPointerLeave(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseLeave(e); }));\r\n        _this._register(pointerEvents.onPointerDown(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseDown(e); }));\r\n        return _this;\r\n    }\r\n    PointerEventHandler.prototype.onTap = function (event) {\r\n        if (!event.initialTarget || !this.viewHelper.linesContentDomNode.contains(event.initialTarget)) {\r\n            return;\r\n        }\r\n        event.preventDefault();\r\n        this.viewHelper.focusTextArea();\r\n        var target = this._createMouseTarget(new EditorMouseEvent(event, this.viewHelper.viewDomNode), false);\r\n        if (target.position) {\r\n            // this.viewController.moveTo(target.position);\r\n            this.viewController.dispatchMouse({\r\n                position: target.position,\r\n                mouseColumn: target.position.column,\r\n                startedOnLineNumbers: false,\r\n                mouseDownCount: event.tapCount,\r\n                inSelectionMode: false,\r\n                altKey: false,\r\n                ctrlKey: false,\r\n                metaKey: false,\r\n                shiftKey: false,\r\n                leftButton: false,\r\n                middleButton: false,\r\n            });\r\n        }\r\n    };\r\n    PointerEventHandler.prototype.onChange = function (e) {\r\n        if (this._lastPointerType === 'touch') {\r\n            this._context.viewLayout.deltaScrollNow(-e.translationX, -e.translationY);\r\n        }\r\n    };\r\n    PointerEventHandler.prototype._onMouseDown = function (e) {\r\n        if (e.target && this.viewHelper.linesContentDomNode.contains(e.target) && this._lastPointerType === 'touch') {\r\n            return;\r\n        }\r\n        _super.prototype._onMouseDown.call(this, e);\r\n    };\r\n    return PointerEventHandler;\r\n}(MouseHandler));\r\nexport { PointerEventHandler };\r\nvar TouchHandler = /** @class */ (function (_super) {\r\n    __extends(TouchHandler, _super);\r\n    function TouchHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this, context, viewController, viewHelper) || this;\r\n        _this._register(Gesture.addTarget(_this.viewHelper.linesContentDomNode));\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, EventType.Tap, function (e) { return _this.onTap(e); }));\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, EventType.Change, function (e) { return _this.onChange(e); }));\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.linesContentDomNode, EventType.Contextmenu, function (e) { return _this._onContextMenu(new EditorMouseEvent(e, _this.viewHelper.viewDomNode), false); }));\r\n        return _this;\r\n    }\r\n    TouchHandler.prototype.onTap = function (event) {\r\n        event.preventDefault();\r\n        this.viewHelper.focusTextArea();\r\n        var target = this._createMouseTarget(new EditorMouseEvent(event, this.viewHelper.viewDomNode), false);\r\n        if (target.position) {\r\n            this.viewController.moveTo(target.position);\r\n        }\r\n    };\r\n    TouchHandler.prototype.onChange = function (e) {\r\n        this._context.viewLayout.deltaScrollNow(-e.translationX, -e.translationY);\r\n    };\r\n    return TouchHandler;\r\n}(MouseHandler));\r\nvar PointerHandler = /** @class */ (function (_super) {\r\n    __extends(PointerHandler, _super);\r\n    function PointerHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this) || this;\r\n        if (window.navigator.msPointerEnabled) {\r\n            _this.handler = _this._register(new MsPointerHandler(context, viewController, viewHelper));\r\n        }\r\n        else if ((platform.isIOS && BrowserFeatures.pointerEvents)) {\r\n            _this.handler = _this._register(new PointerEventHandler(context, viewController, viewHelper));\r\n        }\r\n        else if (window.TouchEvent) {\r\n            _this.handler = _this._register(new TouchHandler(context, viewController, viewHelper));\r\n        }\r\n        else if (window.navigator.pointerEnabled || window.PointerEvent) {\r\n            _this.handler = _this._register(new StandardPointerHandler(context, viewController, viewHelper));\r\n        }\r\n        else {\r\n            _this.handler = _this._register(new MouseHandler(context, viewController, viewHelper));\r\n        }\r\n        return _this;\r\n    }\r\n    PointerHandler.prototype.getTargetAtClientPoint = function (clientX, clientY) {\r\n        return this.handler.getTargetAtClientPoint(clientX, clientY);\r\n    };\r\n    return PointerHandler;\r\n}(Disposable));\r\nexport { PointerHandler };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nvar ElementSizeObserver = /** @class */ (function (_super) {\r\n    __extends(ElementSizeObserver, _super);\r\n    function ElementSizeObserver(referenceDomElement, dimension, changeCallback) {\r\n        var _this = _super.call(this) || this;\r\n        _this.referenceDomElement = referenceDomElement;\r\n        _this.changeCallback = changeCallback;\r\n        _this.width = -1;\r\n        _this.height = -1;\r\n        _this.mutationObserver = null;\r\n        _this.windowSizeListener = null;\r\n        _this.measureReferenceDomElement(false, dimension);\r\n        return _this;\r\n    }\r\n    ElementSizeObserver.prototype.dispose = function () {\r\n        this.stopObserving();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ElementSizeObserver.prototype.getWidth = function () {\r\n        return this.width;\r\n    };\r\n    ElementSizeObserver.prototype.getHeight = function () {\r\n        return this.height;\r\n    };\r\n    ElementSizeObserver.prototype.startObserving = function () {\r\n        var _this = this;\r\n        if (!this.mutationObserver && this.referenceDomElement) {\r\n            this.mutationObserver = new MutationObserver(function () { return _this._onDidMutate(); });\r\n            this.mutationObserver.observe(this.referenceDomElement, {\r\n                attributes: true,\r\n            });\r\n        }\r\n        if (!this.windowSizeListener) {\r\n            this.windowSizeListener = dom.addDisposableListener(window, 'resize', function () { return _this._onDidResizeWindow(); });\r\n        }\r\n    };\r\n    ElementSizeObserver.prototype.stopObserving = function () {\r\n        if (this.mutationObserver) {\r\n            this.mutationObserver.disconnect();\r\n            this.mutationObserver = null;\r\n        }\r\n        if (this.windowSizeListener) {\r\n            this.windowSizeListener.dispose();\r\n            this.windowSizeListener = null;\r\n        }\r\n    };\r\n    ElementSizeObserver.prototype.observe = function (dimension) {\r\n        this.measureReferenceDomElement(true, dimension);\r\n    };\r\n    ElementSizeObserver.prototype._onDidMutate = function () {\r\n        this.measureReferenceDomElement(true);\r\n    };\r\n    ElementSizeObserver.prototype._onDidResizeWindow = function () {\r\n        this.measureReferenceDomElement(true);\r\n    };\r\n    ElementSizeObserver.prototype.measureReferenceDomElement = function (callChangeCallback, dimension) {\r\n        var observedWidth = 0;\r\n        var observedHeight = 0;\r\n        if (dimension) {\r\n            observedWidth = dimension.width;\r\n            observedHeight = dimension.height;\r\n        }\r\n        else if (this.referenceDomElement) {\r\n            observedWidth = this.referenceDomElement.clientWidth;\r\n            observedHeight = this.referenceDomElement.clientHeight;\r\n        }\r\n        observedWidth = Math.max(5, observedWidth);\r\n        observedHeight = Math.max(5, observedHeight);\r\n        if (this.width !== observedWidth || this.height !== observedHeight) {\r\n            this.width = observedWidth;\r\n            this.height = observedHeight;\r\n            if (callChangeCallback) {\r\n                this.changeCallback();\r\n            }\r\n        }\r\n    };\r\n    return ElementSizeObserver;\r\n}(Disposable));\r\nexport { ElementSizeObserver };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport { PageCoordinates } from '../editorDom.js';\r\nimport { PartFingerprints } from '../view/viewPart.js';\r\nimport { ViewLine } from '../viewParts/lines/viewLine.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range as EditorRange } from '../../common/core/range.js';\r\nimport { CursorColumns } from '../../common/controller/cursorCommon.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nvar PointerHandlerLastRenderData = /** @class */ (function () {\r\n    function PointerHandlerLastRenderData(lastViewCursorsRenderData, lastTextareaPosition) {\r\n        this.lastViewCursorsRenderData = lastViewCursorsRenderData;\r\n        this.lastTextareaPosition = lastTextareaPosition;\r\n    }\r\n    return PointerHandlerLastRenderData;\r\n}());\r\nexport { PointerHandlerLastRenderData };\r\nvar MouseTarget = /** @class */ (function () {\r\n    function MouseTarget(element, type, mouseColumn, position, range, detail) {\r\n        if (mouseColumn === void 0) { mouseColumn = 0; }\r\n        if (position === void 0) { position = null; }\r\n        if (range === void 0) { range = null; }\r\n        if (detail === void 0) { detail = null; }\r\n        this.element = element;\r\n        this.type = type;\r\n        this.mouseColumn = mouseColumn;\r\n        this.position = position;\r\n        if (!range && position) {\r\n            range = new EditorRange(position.lineNumber, position.column, position.lineNumber, position.column);\r\n        }\r\n        this.range = range;\r\n        this.detail = detail;\r\n    }\r\n    MouseTarget._typeToString = function (type) {\r\n        if (type === 1 /* TEXTAREA */) {\r\n            return 'TEXTAREA';\r\n        }\r\n        if (type === 2 /* GUTTER_GLYPH_MARGIN */) {\r\n            return 'GUTTER_GLYPH_MARGIN';\r\n        }\r\n        if (type === 3 /* GUTTER_LINE_NUMBERS */) {\r\n            return 'GUTTER_LINE_NUMBERS';\r\n        }\r\n        if (type === 4 /* GUTTER_LINE_DECORATIONS */) {\r\n            return 'GUTTER_LINE_DECORATIONS';\r\n        }\r\n        if (type === 5 /* GUTTER_VIEW_ZONE */) {\r\n            return 'GUTTER_VIEW_ZONE';\r\n        }\r\n        if (type === 6 /* CONTENT_TEXT */) {\r\n            return 'CONTENT_TEXT';\r\n        }\r\n        if (type === 7 /* CONTENT_EMPTY */) {\r\n            return 'CONTENT_EMPTY';\r\n        }\r\n        if (type === 8 /* CONTENT_VIEW_ZONE */) {\r\n            return 'CONTENT_VIEW_ZONE';\r\n        }\r\n        if (type === 9 /* CONTENT_WIDGET */) {\r\n            return 'CONTENT_WIDGET';\r\n        }\r\n        if (type === 10 /* OVERVIEW_RULER */) {\r\n            return 'OVERVIEW_RULER';\r\n        }\r\n        if (type === 11 /* SCROLLBAR */) {\r\n            return 'SCROLLBAR';\r\n        }\r\n        if (type === 12 /* OVERLAY_WIDGET */) {\r\n            return 'OVERLAY_WIDGET';\r\n        }\r\n        return 'UNKNOWN';\r\n    };\r\n    MouseTarget.toString = function (target) {\r\n        return this._typeToString(target.type) + ': ' + target.position + ' - ' + target.range + ' - ' + target.detail;\r\n    };\r\n    MouseTarget.prototype.toString = function () {\r\n        return MouseTarget.toString(this);\r\n    };\r\n    return MouseTarget;\r\n}());\r\nexport { MouseTarget };\r\nvar ElementPath = /** @class */ (function () {\r\n    function ElementPath() {\r\n    }\r\n    ElementPath.isTextArea = function (path) {\r\n        return (path.length === 2\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[1] === 6 /* TextArea */);\r\n    };\r\n    ElementPath.isChildOfViewLines = function (path) {\r\n        return (path.length >= 4\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[3] === 7 /* ViewLines */);\r\n    };\r\n    ElementPath.isStrictChildOfViewLines = function (path) {\r\n        return (path.length > 4\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[3] === 7 /* ViewLines */);\r\n    };\r\n    ElementPath.isChildOfScrollableElement = function (path) {\r\n        return (path.length >= 2\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[1] === 5 /* ScrollableElement */);\r\n    };\r\n    ElementPath.isChildOfMinimap = function (path) {\r\n        return (path.length >= 2\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[1] === 8 /* Minimap */);\r\n    };\r\n    ElementPath.isChildOfContentWidgets = function (path) {\r\n        return (path.length >= 4\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[3] === 1 /* ContentWidgets */);\r\n    };\r\n    ElementPath.isChildOfOverflowingContentWidgets = function (path) {\r\n        return (path.length >= 1\r\n            && path[0] === 2 /* OverflowingContentWidgets */);\r\n    };\r\n    ElementPath.isChildOfOverlayWidgets = function (path) {\r\n        return (path.length >= 2\r\n            && path[0] === 3 /* OverflowGuard */\r\n            && path[1] === 4 /* OverlayWidgets */);\r\n    };\r\n    return ElementPath;\r\n}());\r\nvar HitTestContext = /** @class */ (function () {\r\n    function HitTestContext(context, viewHelper, lastRenderData) {\r\n        this.model = context.model;\r\n        var options = context.configuration.options;\r\n        this.layoutInfo = options.get(107 /* layoutInfo */);\r\n        this.viewDomNode = viewHelper.viewDomNode;\r\n        this.lineHeight = options.get(49 /* lineHeight */);\r\n        this.typicalHalfwidthCharacterWidth = options.get(34 /* fontInfo */).typicalHalfwidthCharacterWidth;\r\n        this.lastRenderData = lastRenderData;\r\n        this._context = context;\r\n        this._viewHelper = viewHelper;\r\n    }\r\n    HitTestContext.prototype.getZoneAtCoord = function (mouseVerticalOffset) {\r\n        return HitTestContext.getZoneAtCoord(this._context, mouseVerticalOffset);\r\n    };\r\n    HitTestContext.getZoneAtCoord = function (context, mouseVerticalOffset) {\r\n        // The target is either a view zone or the empty space after the last view-line\r\n        var viewZoneWhitespace = context.viewLayout.getWhitespaceAtVerticalOffset(mouseVerticalOffset);\r\n        if (viewZoneWhitespace) {\r\n            var viewZoneMiddle = viewZoneWhitespace.verticalOffset + viewZoneWhitespace.height / 2, lineCount = context.model.getLineCount(), positionBefore = null, position = void 0, positionAfter = null;\r\n            if (viewZoneWhitespace.afterLineNumber !== lineCount) {\r\n                // There are more lines after this view zone\r\n                positionAfter = new Position(viewZoneWhitespace.afterLineNumber + 1, 1);\r\n            }\r\n            if (viewZoneWhitespace.afterLineNumber > 0) {\r\n                // There are more lines above this view zone\r\n                positionBefore = new Position(viewZoneWhitespace.afterLineNumber, context.model.getLineMaxColumn(viewZoneWhitespace.afterLineNumber));\r\n            }\r\n            if (positionAfter === null) {\r\n                position = positionBefore;\r\n            }\r\n            else if (positionBefore === null) {\r\n                position = positionAfter;\r\n            }\r\n            else if (mouseVerticalOffset < viewZoneMiddle) {\r\n                position = positionBefore;\r\n            }\r\n            else {\r\n                position = positionAfter;\r\n            }\r\n            return {\r\n                viewZoneId: viewZoneWhitespace.id,\r\n                afterLineNumber: viewZoneWhitespace.afterLineNumber,\r\n                positionBefore: positionBefore,\r\n                positionAfter: positionAfter,\r\n                position: position\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    HitTestContext.prototype.getFullLineRangeAtCoord = function (mouseVerticalOffset) {\r\n        if (this._context.viewLayout.isAfterLines(mouseVerticalOffset)) {\r\n            // Below the last line\r\n            var lineNumber_1 = this._context.model.getLineCount();\r\n            var maxLineColumn_1 = this._context.model.getLineMaxColumn(lineNumber_1);\r\n            return {\r\n                range: new EditorRange(lineNumber_1, maxLineColumn_1, lineNumber_1, maxLineColumn_1),\r\n                isAfterLines: true\r\n            };\r\n        }\r\n        var lineNumber = this._context.viewLayout.getLineNumberAtVerticalOffset(mouseVerticalOffset);\r\n        var maxLineColumn = this._context.model.getLineMaxColumn(lineNumber);\r\n        return {\r\n            range: new EditorRange(lineNumber, 1, lineNumber, maxLineColumn),\r\n            isAfterLines: false\r\n        };\r\n    };\r\n    HitTestContext.prototype.getLineNumberAtVerticalOffset = function (mouseVerticalOffset) {\r\n        return this._context.viewLayout.getLineNumberAtVerticalOffset(mouseVerticalOffset);\r\n    };\r\n    HitTestContext.prototype.isAfterLines = function (mouseVerticalOffset) {\r\n        return this._context.viewLayout.isAfterLines(mouseVerticalOffset);\r\n    };\r\n    HitTestContext.prototype.getVerticalOffsetForLineNumber = function (lineNumber) {\r\n        return this._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber);\r\n    };\r\n    HitTestContext.prototype.findAttribute = function (element, attr) {\r\n        return HitTestContext._findAttribute(element, attr, this._viewHelper.viewDomNode);\r\n    };\r\n    HitTestContext._findAttribute = function (element, attr, stopAt) {\r\n        while (element && element !== document.body) {\r\n            if (element.hasAttribute && element.hasAttribute(attr)) {\r\n                return element.getAttribute(attr);\r\n            }\r\n            if (element === stopAt) {\r\n                return null;\r\n            }\r\n            element = element.parentNode;\r\n        }\r\n        return null;\r\n    };\r\n    HitTestContext.prototype.getLineWidth = function (lineNumber) {\r\n        return this._viewHelper.getLineWidth(lineNumber);\r\n    };\r\n    HitTestContext.prototype.visibleRangeForPosition = function (lineNumber, column) {\r\n        return this._viewHelper.visibleRangeForPosition(lineNumber, column);\r\n    };\r\n    HitTestContext.prototype.getPositionFromDOMInfo = function (spanNode, offset) {\r\n        return this._viewHelper.getPositionFromDOMInfo(spanNode, offset);\r\n    };\r\n    HitTestContext.prototype.getCurrentScrollTop = function () {\r\n        return this._context.viewLayout.getCurrentScrollTop();\r\n    };\r\n    HitTestContext.prototype.getCurrentScrollLeft = function () {\r\n        return this._context.viewLayout.getCurrentScrollLeft();\r\n    };\r\n    return HitTestContext;\r\n}());\r\nexport { HitTestContext };\r\nvar BareHitTestRequest = /** @class */ (function () {\r\n    function BareHitTestRequest(ctx, editorPos, pos) {\r\n        this.editorPos = editorPos;\r\n        this.pos = pos;\r\n        this.mouseVerticalOffset = Math.max(0, ctx.getCurrentScrollTop() + pos.y - editorPos.y);\r\n        this.mouseContentHorizontalOffset = ctx.getCurrentScrollLeft() + pos.x - editorPos.x - ctx.layoutInfo.contentLeft;\r\n        this.isInMarginArea = (pos.x - editorPos.x < ctx.layoutInfo.contentLeft && pos.x - editorPos.x >= ctx.layoutInfo.glyphMarginLeft);\r\n        this.isInContentArea = !this.isInMarginArea;\r\n        this.mouseColumn = Math.max(0, MouseTargetFactory._getMouseColumn(this.mouseContentHorizontalOffset, ctx.typicalHalfwidthCharacterWidth));\r\n    }\r\n    return BareHitTestRequest;\r\n}());\r\nvar HitTestRequest = /** @class */ (function (_super) {\r\n    __extends(HitTestRequest, _super);\r\n    function HitTestRequest(ctx, editorPos, pos, target) {\r\n        var _this = _super.call(this, ctx, editorPos, pos) || this;\r\n        _this._ctx = ctx;\r\n        if (target) {\r\n            _this.target = target;\r\n            _this.targetPath = PartFingerprints.collect(target, ctx.viewDomNode);\r\n        }\r\n        else {\r\n            _this.target = null;\r\n            _this.targetPath = new Uint8Array(0);\r\n        }\r\n        return _this;\r\n    }\r\n    HitTestRequest.prototype.toString = function () {\r\n        return \"pos(\" + this.pos.x + \",\" + this.pos.y + \"), editorPos(\" + this.editorPos.x + \",\" + this.editorPos.y + \"), mouseVerticalOffset: \" + this.mouseVerticalOffset + \", mouseContentHorizontalOffset: \" + this.mouseContentHorizontalOffset + \"\\n\\ttarget: \" + (this.target ? this.target.outerHTML : null);\r\n    };\r\n    HitTestRequest.prototype.fulfill = function (type, position, range, detail) {\r\n        if (position === void 0) { position = null; }\r\n        if (range === void 0) { range = null; }\r\n        if (detail === void 0) { detail = null; }\r\n        var mouseColumn = this.mouseColumn;\r\n        if (position && position.column < this._ctx.model.getLineMaxColumn(position.lineNumber)) {\r\n            // Most likely, the line contains foreign decorations...\r\n            mouseColumn = CursorColumns.visibleColumnFromColumn(this._ctx.model.getLineContent(position.lineNumber), position.column, this._ctx.model.getOptions().tabSize) + 1;\r\n        }\r\n        return new MouseTarget(this.target, type, mouseColumn, position, range, detail);\r\n    };\r\n    HitTestRequest.prototype.withTarget = function (target) {\r\n        return new HitTestRequest(this._ctx, this.editorPos, this.pos, target);\r\n    };\r\n    return HitTestRequest;\r\n}(BareHitTestRequest));\r\nvar EMPTY_CONTENT_AFTER_LINES = { isAfterLines: true };\r\nfunction createEmptyContentDataInLines(horizontalDistanceToText) {\r\n    return {\r\n        isAfterLines: false,\r\n        horizontalDistanceToText: horizontalDistanceToText\r\n    };\r\n}\r\nvar MouseTargetFactory = /** @class */ (function () {\r\n    function MouseTargetFactory(context, viewHelper) {\r\n        this._context = context;\r\n        this._viewHelper = viewHelper;\r\n    }\r\n    MouseTargetFactory.prototype.mouseTargetIsWidget = function (e) {\r\n        var t = e.target;\r\n        var path = PartFingerprints.collect(t, this._viewHelper.viewDomNode);\r\n        // Is it a content widget?\r\n        if (ElementPath.isChildOfContentWidgets(path) || ElementPath.isChildOfOverflowingContentWidgets(path)) {\r\n            return true;\r\n        }\r\n        // Is it an overlay widget?\r\n        if (ElementPath.isChildOfOverlayWidgets(path)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    MouseTargetFactory.prototype.createMouseTarget = function (lastRenderData, editorPos, pos, target) {\r\n        var ctx = new HitTestContext(this._context, this._viewHelper, lastRenderData);\r\n        var request = new HitTestRequest(ctx, editorPos, pos, target);\r\n        try {\r\n            var r = MouseTargetFactory._createMouseTarget(ctx, request, false);\r\n            // console.log(r.toString());\r\n            return r;\r\n        }\r\n        catch (err) {\r\n            // console.log(err);\r\n            return request.fulfill(0 /* UNKNOWN */);\r\n        }\r\n    };\r\n    MouseTargetFactory._createMouseTarget = function (ctx, request, domHitTestExecuted) {\r\n        // console.log(`${domHitTestExecuted ? '=>' : ''}CAME IN REQUEST: ${request}`);\r\n        // First ensure the request has a target\r\n        if (request.target === null) {\r\n            if (domHitTestExecuted) {\r\n                // Still no target... and we have already executed hit test...\r\n                return request.fulfill(0 /* UNKNOWN */);\r\n            }\r\n            var hitTestResult = MouseTargetFactory._doHitTest(ctx, request);\r\n            if (hitTestResult.position) {\r\n                return MouseTargetFactory.createMouseTargetFromHitTestPosition(ctx, request, hitTestResult.position.lineNumber, hitTestResult.position.column);\r\n            }\r\n            return this._createMouseTarget(ctx, request.withTarget(hitTestResult.hitTarget), true);\r\n        }\r\n        // we know for a fact that request.target is not null\r\n        var resolvedRequest = request;\r\n        var result = null;\r\n        result = result || MouseTargetFactory._hitTestContentWidget(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestOverlayWidget(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestMinimap(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestScrollbarSlider(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestViewZone(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestMargin(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestViewCursor(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestTextArea(ctx, resolvedRequest);\r\n        result = result || MouseTargetFactory._hitTestViewLines(ctx, resolvedRequest, domHitTestExecuted);\r\n        result = result || MouseTargetFactory._hitTestScrollbar(ctx, resolvedRequest);\r\n        return (result || request.fulfill(0 /* UNKNOWN */));\r\n    };\r\n    MouseTargetFactory._hitTestContentWidget = function (ctx, request) {\r\n        // Is it a content widget?\r\n        if (ElementPath.isChildOfContentWidgets(request.targetPath) || ElementPath.isChildOfOverflowingContentWidgets(request.targetPath)) {\r\n            var widgetId = ctx.findAttribute(request.target, 'widgetId');\r\n            if (widgetId) {\r\n                return request.fulfill(9 /* CONTENT_WIDGET */, null, null, widgetId);\r\n            }\r\n            else {\r\n                return request.fulfill(0 /* UNKNOWN */);\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestOverlayWidget = function (ctx, request) {\r\n        // Is it an overlay widget?\r\n        if (ElementPath.isChildOfOverlayWidgets(request.targetPath)) {\r\n            var widgetId = ctx.findAttribute(request.target, 'widgetId');\r\n            if (widgetId) {\r\n                return request.fulfill(12 /* OVERLAY_WIDGET */, null, null, widgetId);\r\n            }\r\n            else {\r\n                return request.fulfill(0 /* UNKNOWN */);\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestViewCursor = function (ctx, request) {\r\n        if (request.target) {\r\n            // Check if we've hit a painted cursor\r\n            var lastViewCursorsRenderData = ctx.lastRenderData.lastViewCursorsRenderData;\r\n            for (var _i = 0, lastViewCursorsRenderData_1 = lastViewCursorsRenderData; _i < lastViewCursorsRenderData_1.length; _i++) {\r\n                var d = lastViewCursorsRenderData_1[_i];\r\n                if (request.target === d.domNode) {\r\n                    return request.fulfill(6 /* CONTENT_TEXT */, d.position);\r\n                }\r\n            }\r\n        }\r\n        if (request.isInContentArea) {\r\n            // Edge has a bug when hit-testing the exact position of a cursor,\r\n            // instead of returning the correct dom node, it returns the\r\n            // first or last rendered view line dom node, therefore help it out\r\n            // and first check if we are on top of a cursor\r\n            var lastViewCursorsRenderData = ctx.lastRenderData.lastViewCursorsRenderData;\r\n            var mouseContentHorizontalOffset = request.mouseContentHorizontalOffset;\r\n            var mouseVerticalOffset = request.mouseVerticalOffset;\r\n            for (var _a = 0, lastViewCursorsRenderData_2 = lastViewCursorsRenderData; _a < lastViewCursorsRenderData_2.length; _a++) {\r\n                var d = lastViewCursorsRenderData_2[_a];\r\n                if (mouseContentHorizontalOffset < d.contentLeft) {\r\n                    // mouse position is to the left of the cursor\r\n                    continue;\r\n                }\r\n                if (mouseContentHorizontalOffset > d.contentLeft + d.width) {\r\n                    // mouse position is to the right of the cursor\r\n                    continue;\r\n                }\r\n                var cursorVerticalOffset = ctx.getVerticalOffsetForLineNumber(d.position.lineNumber);\r\n                if (cursorVerticalOffset <= mouseVerticalOffset\r\n                    && mouseVerticalOffset <= cursorVerticalOffset + d.height) {\r\n                    return request.fulfill(6 /* CONTENT_TEXT */, d.position);\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestViewZone = function (ctx, request) {\r\n        var viewZoneData = ctx.getZoneAtCoord(request.mouseVerticalOffset);\r\n        if (viewZoneData) {\r\n            var mouseTargetType = (request.isInContentArea ? 8 /* CONTENT_VIEW_ZONE */ : 5 /* GUTTER_VIEW_ZONE */);\r\n            return request.fulfill(mouseTargetType, viewZoneData.position, null, viewZoneData);\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestTextArea = function (ctx, request) {\r\n        // Is it the textarea?\r\n        if (ElementPath.isTextArea(request.targetPath)) {\r\n            if (ctx.lastRenderData.lastTextareaPosition) {\r\n                return request.fulfill(6 /* CONTENT_TEXT */, ctx.lastRenderData.lastTextareaPosition);\r\n            }\r\n            return request.fulfill(1 /* TEXTAREA */, ctx.lastRenderData.lastTextareaPosition);\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestMargin = function (ctx, request) {\r\n        if (request.isInMarginArea) {\r\n            var res = ctx.getFullLineRangeAtCoord(request.mouseVerticalOffset);\r\n            var pos = res.range.getStartPosition();\r\n            var offset = Math.abs(request.pos.x - request.editorPos.x);\r\n            var detail = {\r\n                isAfterLines: res.isAfterLines,\r\n                glyphMarginLeft: ctx.layoutInfo.glyphMarginLeft,\r\n                glyphMarginWidth: ctx.layoutInfo.glyphMarginWidth,\r\n                lineNumbersWidth: ctx.layoutInfo.lineNumbersWidth,\r\n                offsetX: offset\r\n            };\r\n            offset -= ctx.layoutInfo.glyphMarginLeft;\r\n            if (offset <= ctx.layoutInfo.glyphMarginWidth) {\r\n                // On the glyph margin\r\n                return request.fulfill(2 /* GUTTER_GLYPH_MARGIN */, pos, res.range, detail);\r\n            }\r\n            offset -= ctx.layoutInfo.glyphMarginWidth;\r\n            if (offset <= ctx.layoutInfo.lineNumbersWidth) {\r\n                // On the line numbers\r\n                return request.fulfill(3 /* GUTTER_LINE_NUMBERS */, pos, res.range, detail);\r\n            }\r\n            offset -= ctx.layoutInfo.lineNumbersWidth;\r\n            // On the line decorations\r\n            return request.fulfill(4 /* GUTTER_LINE_DECORATIONS */, pos, res.range, detail);\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestViewLines = function (ctx, request, domHitTestExecuted) {\r\n        if (!ElementPath.isChildOfViewLines(request.targetPath)) {\r\n            return null;\r\n        }\r\n        // Check if it is below any lines and any view zones\r\n        if (ctx.isAfterLines(request.mouseVerticalOffset)) {\r\n            // This most likely indicates it happened after the last view-line\r\n            var lineCount = ctx.model.getLineCount();\r\n            var maxLineColumn = ctx.model.getLineMaxColumn(lineCount);\r\n            return request.fulfill(7 /* CONTENT_EMPTY */, new Position(lineCount, maxLineColumn), undefined, EMPTY_CONTENT_AFTER_LINES);\r\n        }\r\n        if (domHitTestExecuted) {\r\n            // Check if we are hitting a view-line (can happen in the case of inline decorations on empty lines)\r\n            // See https://github.com/Microsoft/vscode/issues/46942\r\n            if (ElementPath.isStrictChildOfViewLines(request.targetPath)) {\r\n                var lineNumber = ctx.getLineNumberAtVerticalOffset(request.mouseVerticalOffset);\r\n                if (ctx.model.getLineLength(lineNumber) === 0) {\r\n                    var lineWidth_1 = ctx.getLineWidth(lineNumber);\r\n                    var detail = createEmptyContentDataInLines(request.mouseContentHorizontalOffset - lineWidth_1);\r\n                    return request.fulfill(7 /* CONTENT_EMPTY */, new Position(lineNumber, 1), undefined, detail);\r\n                }\r\n                var lineWidth = ctx.getLineWidth(lineNumber);\r\n                if (request.mouseContentHorizontalOffset >= lineWidth) {\r\n                    var detail = createEmptyContentDataInLines(request.mouseContentHorizontalOffset - lineWidth);\r\n                    var pos = new Position(lineNumber, ctx.model.getLineMaxColumn(lineNumber));\r\n                    return request.fulfill(7 /* CONTENT_EMPTY */, pos, undefined, detail);\r\n                }\r\n            }\r\n            // We have already executed hit test...\r\n            return request.fulfill(0 /* UNKNOWN */);\r\n        }\r\n        var hitTestResult = MouseTargetFactory._doHitTest(ctx, request);\r\n        if (hitTestResult.position) {\r\n            return MouseTargetFactory.createMouseTargetFromHitTestPosition(ctx, request, hitTestResult.position.lineNumber, hitTestResult.position.column);\r\n        }\r\n        return this._createMouseTarget(ctx, request.withTarget(hitTestResult.hitTarget), true);\r\n    };\r\n    MouseTargetFactory._hitTestMinimap = function (ctx, request) {\r\n        if (ElementPath.isChildOfMinimap(request.targetPath)) {\r\n            var possibleLineNumber = ctx.getLineNumberAtVerticalOffset(request.mouseVerticalOffset);\r\n            var maxColumn = ctx.model.getLineMaxColumn(possibleLineNumber);\r\n            return request.fulfill(11 /* SCROLLBAR */, new Position(possibleLineNumber, maxColumn));\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestScrollbarSlider = function (ctx, request) {\r\n        if (ElementPath.isChildOfScrollableElement(request.targetPath)) {\r\n            if (request.target && request.target.nodeType === 1) {\r\n                var className = request.target.className;\r\n                if (className && /\\b(slider|scrollbar)\\b/.test(className)) {\r\n                    var possibleLineNumber = ctx.getLineNumberAtVerticalOffset(request.mouseVerticalOffset);\r\n                    var maxColumn = ctx.model.getLineMaxColumn(possibleLineNumber);\r\n                    return request.fulfill(11 /* SCROLLBAR */, new Position(possibleLineNumber, maxColumn));\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory._hitTestScrollbar = function (ctx, request) {\r\n        // Is it the overview ruler?\r\n        // Is it a child of the scrollable element?\r\n        if (ElementPath.isChildOfScrollableElement(request.targetPath)) {\r\n            var possibleLineNumber = ctx.getLineNumberAtVerticalOffset(request.mouseVerticalOffset);\r\n            var maxColumn = ctx.model.getLineMaxColumn(possibleLineNumber);\r\n            return request.fulfill(11 /* SCROLLBAR */, new Position(possibleLineNumber, maxColumn));\r\n        }\r\n        return null;\r\n    };\r\n    MouseTargetFactory.prototype.getMouseColumn = function (editorPos, pos) {\r\n        var options = this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        var mouseContentHorizontalOffset = this._context.viewLayout.getCurrentScrollLeft() + pos.x - editorPos.x - layoutInfo.contentLeft;\r\n        return MouseTargetFactory._getMouseColumn(mouseContentHorizontalOffset, options.get(34 /* fontInfo */).typicalHalfwidthCharacterWidth);\r\n    };\r\n    MouseTargetFactory._getMouseColumn = function (mouseContentHorizontalOffset, typicalHalfwidthCharacterWidth) {\r\n        if (mouseContentHorizontalOffset < 0) {\r\n            return 1;\r\n        }\r\n        var chars = Math.round(mouseContentHorizontalOffset / typicalHalfwidthCharacterWidth);\r\n        return (chars + 1);\r\n    };\r\n    MouseTargetFactory.createMouseTargetFromHitTestPosition = function (ctx, request, lineNumber, column) {\r\n        var pos = new Position(lineNumber, column);\r\n        var lineWidth = ctx.getLineWidth(lineNumber);\r\n        if (request.mouseContentHorizontalOffset > lineWidth) {\r\n            if (browser.isEdge && pos.column === 1) {\r\n                // See https://github.com/Microsoft/vscode/issues/10875\r\n                var detail_1 = createEmptyContentDataInLines(request.mouseContentHorizontalOffset - lineWidth);\r\n                return request.fulfill(7 /* CONTENT_EMPTY */, new Position(lineNumber, ctx.model.getLineMaxColumn(lineNumber)), undefined, detail_1);\r\n            }\r\n            var detail = createEmptyContentDataInLines(request.mouseContentHorizontalOffset - lineWidth);\r\n            return request.fulfill(7 /* CONTENT_EMPTY */, pos, undefined, detail);\r\n        }\r\n        var visibleRange = ctx.visibleRangeForPosition(lineNumber, column);\r\n        if (!visibleRange) {\r\n            return request.fulfill(0 /* UNKNOWN */, pos);\r\n        }\r\n        var columnHorizontalOffset = visibleRange.left;\r\n        if (request.mouseContentHorizontalOffset === columnHorizontalOffset) {\r\n            return request.fulfill(6 /* CONTENT_TEXT */, pos);\r\n        }\r\n        var points = [];\r\n        points.push({ offset: visibleRange.left, column: column });\r\n        if (column > 1) {\r\n            var visibleRange_1 = ctx.visibleRangeForPosition(lineNumber, column - 1);\r\n            if (visibleRange_1) {\r\n                points.push({ offset: visibleRange_1.left, column: column - 1 });\r\n            }\r\n        }\r\n        var lineMaxColumn = ctx.model.getLineMaxColumn(lineNumber);\r\n        if (column < lineMaxColumn) {\r\n            var visibleRange_2 = ctx.visibleRangeForPosition(lineNumber, column + 1);\r\n            if (visibleRange_2) {\r\n                points.push({ offset: visibleRange_2.left, column: column + 1 });\r\n            }\r\n        }\r\n        points.sort(function (a, b) { return a.offset - b.offset; });\r\n        for (var i = 1; i < points.length; i++) {\r\n            var prev = points[i - 1];\r\n            var curr = points[i];\r\n            if (prev.offset <= request.mouseContentHorizontalOffset && request.mouseContentHorizontalOffset <= curr.offset) {\r\n                var rng = new EditorRange(lineNumber, prev.column, lineNumber, curr.column);\r\n                return request.fulfill(6 /* CONTENT_TEXT */, pos, rng);\r\n            }\r\n        }\r\n        return request.fulfill(6 /* CONTENT_TEXT */, pos);\r\n    };\r\n    /**\r\n     * Most probably WebKit browsers and Edge\r\n     */\r\n    MouseTargetFactory._doHitTestWithCaretRangeFromPoint = function (ctx, request) {\r\n        // In Chrome, especially on Linux it is possible to click between lines,\r\n        // so try to adjust the `hity` below so that it lands in the center of a line\r\n        var lineNumber = ctx.getLineNumberAtVerticalOffset(request.mouseVerticalOffset);\r\n        var lineVerticalOffset = ctx.getVerticalOffsetForLineNumber(lineNumber);\r\n        var lineCenteredVerticalOffset = lineVerticalOffset + Math.floor(ctx.lineHeight / 2);\r\n        var adjustedPageY = request.pos.y + (lineCenteredVerticalOffset - request.mouseVerticalOffset);\r\n        if (adjustedPageY <= request.editorPos.y) {\r\n            adjustedPageY = request.editorPos.y + 1;\r\n        }\r\n        if (adjustedPageY >= request.editorPos.y + ctx.layoutInfo.height) {\r\n            adjustedPageY = request.editorPos.y + ctx.layoutInfo.height - 1;\r\n        }\r\n        var adjustedPage = new PageCoordinates(request.pos.x, adjustedPageY);\r\n        var r = this._actualDoHitTestWithCaretRangeFromPoint(ctx, adjustedPage.toClientCoordinates());\r\n        if (r.position) {\r\n            return r;\r\n        }\r\n        // Also try to hit test without the adjustment (for the edge cases that we are near the top or bottom)\r\n        return this._actualDoHitTestWithCaretRangeFromPoint(ctx, request.pos.toClientCoordinates());\r\n    };\r\n    MouseTargetFactory._actualDoHitTestWithCaretRangeFromPoint = function (ctx, coords) {\r\n        var shadowRoot = dom.getShadowRoot(ctx.viewDomNode);\r\n        var range;\r\n        if (shadowRoot) {\r\n            if (typeof shadowRoot.caretRangeFromPoint === 'undefined') {\r\n                range = shadowCaretRangeFromPoint(shadowRoot, coords.clientX, coords.clientY);\r\n            }\r\n            else {\r\n                range = shadowRoot.caretRangeFromPoint(coords.clientX, coords.clientY);\r\n            }\r\n        }\r\n        else {\r\n            range = document.caretRangeFromPoint(coords.clientX, coords.clientY);\r\n        }\r\n        if (!range || !range.startContainer) {\r\n            return {\r\n                position: null,\r\n                hitTarget: null\r\n            };\r\n        }\r\n        // Chrome always hits a TEXT_NODE, while Edge sometimes hits a token span\r\n        var startContainer = range.startContainer;\r\n        var hitTarget = null;\r\n        if (startContainer.nodeType === startContainer.TEXT_NODE) {\r\n            // startContainer is expected to be the token text\r\n            var parent1 = startContainer.parentNode; // expected to be the token span\r\n            var parent2 = parent1 ? parent1.parentNode : null; // expected to be the view line container span\r\n            var parent3 = parent2 ? parent2.parentNode : null; // expected to be the view line div\r\n            var parent3ClassName = parent3 && parent3.nodeType === parent3.ELEMENT_NODE ? parent3.className : null;\r\n            if (parent3ClassName === ViewLine.CLASS_NAME) {\r\n                var p = ctx.getPositionFromDOMInfo(parent1, range.startOffset);\r\n                return {\r\n                    position: p,\r\n                    hitTarget: null\r\n                };\r\n            }\r\n            else {\r\n                hitTarget = startContainer.parentNode;\r\n            }\r\n        }\r\n        else if (startContainer.nodeType === startContainer.ELEMENT_NODE) {\r\n            // startContainer is expected to be the token span\r\n            var parent1 = startContainer.parentNode; // expected to be the view line container span\r\n            var parent2 = parent1 ? parent1.parentNode : null; // expected to be the view line div\r\n            var parent2ClassName = parent2 && parent2.nodeType === parent2.ELEMENT_NODE ? parent2.className : null;\r\n            if (parent2ClassName === ViewLine.CLASS_NAME) {\r\n                var p = ctx.getPositionFromDOMInfo(startContainer, startContainer.textContent.length);\r\n                return {\r\n                    position: p,\r\n                    hitTarget: null\r\n                };\r\n            }\r\n            else {\r\n                hitTarget = startContainer;\r\n            }\r\n        }\r\n        return {\r\n            position: null,\r\n            hitTarget: hitTarget\r\n        };\r\n    };\r\n    /**\r\n     * Most probably Gecko\r\n     */\r\n    MouseTargetFactory._doHitTestWithCaretPositionFromPoint = function (ctx, coords) {\r\n        var hitResult = document.caretPositionFromPoint(coords.clientX, coords.clientY);\r\n        if (hitResult.offsetNode.nodeType === hitResult.offsetNode.TEXT_NODE) {\r\n            // offsetNode is expected to be the token text\r\n            var parent1 = hitResult.offsetNode.parentNode; // expected to be the token span\r\n            var parent2 = parent1 ? parent1.parentNode : null; // expected to be the view line container span\r\n            var parent3 = parent2 ? parent2.parentNode : null; // expected to be the view line div\r\n            var parent3ClassName = parent3 && parent3.nodeType === parent3.ELEMENT_NODE ? parent3.className : null;\r\n            if (parent3ClassName === ViewLine.CLASS_NAME) {\r\n                var p = ctx.getPositionFromDOMInfo(hitResult.offsetNode.parentNode, hitResult.offset);\r\n                return {\r\n                    position: p,\r\n                    hitTarget: null\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    position: null,\r\n                    hitTarget: hitResult.offsetNode.parentNode\r\n                };\r\n            }\r\n        }\r\n        return {\r\n            position: null,\r\n            hitTarget: hitResult.offsetNode\r\n        };\r\n    };\r\n    /**\r\n     * Most probably IE\r\n     */\r\n    MouseTargetFactory._doHitTestWithMoveToPoint = function (ctx, coords) {\r\n        var resultPosition = null;\r\n        var resultHitTarget = null;\r\n        var textRange = document.body.createTextRange();\r\n        try {\r\n            textRange.moveToPoint(coords.clientX, coords.clientY);\r\n        }\r\n        catch (err) {\r\n            return {\r\n                position: null,\r\n                hitTarget: null\r\n            };\r\n        }\r\n        textRange.collapse(true);\r\n        // Now, let's do our best to figure out what we hit :)\r\n        var parentElement = textRange ? textRange.parentElement() : null;\r\n        var parent1 = parentElement ? parentElement.parentNode : null;\r\n        var parent2 = parent1 ? parent1.parentNode : null;\r\n        var parent2ClassName = parent2 && parent2.nodeType === parent2.ELEMENT_NODE ? parent2.className : '';\r\n        if (parent2ClassName === ViewLine.CLASS_NAME) {\r\n            var rangeToContainEntireSpan = textRange.duplicate();\r\n            rangeToContainEntireSpan.moveToElementText(parentElement);\r\n            rangeToContainEntireSpan.setEndPoint('EndToStart', textRange);\r\n            resultPosition = ctx.getPositionFromDOMInfo(parentElement, rangeToContainEntireSpan.text.length);\r\n            // Move range out of the span node, IE doesn't like having many ranges in\r\n            // the same spot and will act badly for lines containing dashes ('-')\r\n            rangeToContainEntireSpan.moveToElementText(ctx.viewDomNode);\r\n        }\r\n        else {\r\n            // Looks like we've hit the hover or something foreign\r\n            resultHitTarget = parentElement;\r\n        }\r\n        // Move range out of the span node, IE doesn't like having many ranges in\r\n        // the same spot and will act badly for lines containing dashes ('-')\r\n        textRange.moveToElementText(ctx.viewDomNode);\r\n        return {\r\n            position: resultPosition,\r\n            hitTarget: resultHitTarget\r\n        };\r\n    };\r\n    MouseTargetFactory._doHitTest = function (ctx, request) {\r\n        // State of the art (18.10.2012):\r\n        // The spec says browsers should support document.caretPositionFromPoint, but nobody implemented it (http://dev.w3.org/csswg/cssom-view/)\r\n        // Gecko:\r\n        //    - they tried to implement it once, but failed: https://bugzilla.mozilla.org/show_bug.cgi?id=654352\r\n        //    - however, they do give out rangeParent/rangeOffset properties on mouse events\r\n        // Webkit:\r\n        //    - they have implemented a previous version of the spec which was using document.caretRangeFromPoint\r\n        // IE:\r\n        //    - they have a proprietary method on ranges, moveToPoint: https://msdn.microsoft.com/en-us/library/ie/ms536632(v=vs.85).aspx\r\n        // 24.08.2016: Edge has added WebKit's document.caretRangeFromPoint, but it is quite buggy\r\n        //    - when hit testing the cursor it returns the first or the last line in the viewport\r\n        //    - it inconsistently hits text nodes or span nodes, while WebKit only hits text nodes\r\n        //    - when toggling render whitespace on, and hit testing in the empty content after a line, it always hits offset 0 of the first span of the line\r\n        // Thank you browsers for making this so 'easy' :)\r\n        if (typeof document.caretRangeFromPoint === 'function') {\r\n            return this._doHitTestWithCaretRangeFromPoint(ctx, request);\r\n        }\r\n        else if (document.caretPositionFromPoint) {\r\n            return this._doHitTestWithCaretPositionFromPoint(ctx, request.pos.toClientCoordinates());\r\n        }\r\n        else if (document.body.createTextRange) {\r\n            return this._doHitTestWithMoveToPoint(ctx, request.pos.toClientCoordinates());\r\n        }\r\n        return {\r\n            position: null,\r\n            hitTarget: null\r\n        };\r\n    };\r\n    return MouseTargetFactory;\r\n}());\r\nexport { MouseTargetFactory };\r\nexport function shadowCaretRangeFromPoint(shadowRoot, x, y) {\r\n    var range = document.createRange();\r\n    // Get the element under the point\r\n    var el = shadowRoot.elementFromPoint(x, y);\r\n    if (el !== null) {\r\n        // Get the last child of the element until its firstChild is a text node\r\n        // This assumes that the pointer is on the right of the line, out of the tokens\r\n        // and that we want to get the offset of the last token of the line\r\n        while (el && el.firstChild && el.firstChild.nodeType !== el.firstChild.TEXT_NODE) {\r\n            el = el.lastChild;\r\n        }\r\n        // Grab its rect\r\n        var rect = el.getBoundingClientRect();\r\n        // And its font\r\n        var font = window.getComputedStyle(el, null).getPropertyValue('font');\r\n        // And also its txt content\r\n        var text = el.innerText;\r\n        // Position the pixel cursor at the left of the element\r\n        var pixelCursor = rect.left;\r\n        var offset = 0;\r\n        var step = void 0;\r\n        // If the point is on the right of the box put the cursor after the last character\r\n        if (x > rect.left + rect.width) {\r\n            offset = text.length;\r\n        }\r\n        else {\r\n            var charWidthReader = CharWidthReader.getInstance();\r\n            // Goes through all the characters of the innerText, and checks if the x of the point\r\n            // belongs to the character.\r\n            for (var i = 0; i < text.length + 1; i++) {\r\n                // The step is half the width of the character\r\n                step = charWidthReader.getCharWidth(text.charAt(i), font) / 2;\r\n                // Move to the center of the character\r\n                pixelCursor += step;\r\n                // If the x of the point is smaller that the position of the cursor, the point is over that character\r\n                if (x < pixelCursor) {\r\n                    offset = i;\r\n                    break;\r\n                }\r\n                // Move between the current character and the next\r\n                pixelCursor += step;\r\n            }\r\n        }\r\n        // Creates a range with the text node of the element and set the offset found\r\n        range.setStart(el.firstChild, offset);\r\n        range.setEnd(el.firstChild, offset);\r\n    }\r\n    return range;\r\n}\r\nvar CharWidthReader = /** @class */ (function () {\r\n    function CharWidthReader() {\r\n        this._cache = {};\r\n        this._canvas = document.createElement('canvas');\r\n    }\r\n    CharWidthReader.getInstance = function () {\r\n        if (!CharWidthReader._INSTANCE) {\r\n            CharWidthReader._INSTANCE = new CharWidthReader();\r\n        }\r\n        return CharWidthReader._INSTANCE;\r\n    };\r\n    CharWidthReader.prototype.getCharWidth = function (char, font) {\r\n        var cacheKey = char + font;\r\n        if (this._cache[cacheKey]) {\r\n            return this._cache[cacheKey];\r\n        }\r\n        var context = this._canvas.getContext('2d');\r\n        context.font = font;\r\n        var metrics = context.measureText(char);\r\n        var width = metrics.width;\r\n        this._cache[cacheKey] = width;\r\n        return width;\r\n    };\r\n    CharWidthReader._INSTANCE = null;\r\n    return CharWidthReader;\r\n}());\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as nls from '../../../nls.js';\r\nimport * as types from '../../../base/common/types.js';\r\nimport { Command, EditorCommand, registerEditorCommand } from '../editorExtensions.js';\r\nimport { ICodeEditorService } from '../services/codeEditorService.js';\r\nimport { ColumnSelection } from '../../common/controller/cursorColumnSelection.js';\r\nimport { CursorState } from '../../common/controller/cursorCommon.js';\r\nimport { DeleteOperations } from '../../common/controller/cursorDeleteOperations.js';\r\nimport { CursorMove as CursorMove_, CursorMoveCommands } from '../../common/controller/cursorMoveCommands.js';\r\nimport { TypeOperations } from '../../common/controller/cursorTypeOperations.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Handler } from '../../common/editorCommon.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\r\nvar CORE_WEIGHT = 0 /* EditorCore */;\r\nvar CoreEditorCommand = /** @class */ (function (_super) {\r\n    __extends(CoreEditorCommand, _super);\r\n    function CoreEditorCommand() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    CoreEditorCommand.prototype.runEditorCommand = function (accessor, editor, args) {\r\n        var cursors = editor._getCursors();\r\n        if (!cursors) {\r\n            // the editor has no view => has no cursors\r\n            return;\r\n        }\r\n        this.runCoreEditorCommand(cursors, args || {});\r\n    };\r\n    return CoreEditorCommand;\r\n}(EditorCommand));\r\nexport { CoreEditorCommand };\r\nexport var EditorScroll_;\r\n(function (EditorScroll_) {\r\n    var isEditorScrollArgs = function (arg) {\r\n        if (!types.isObject(arg)) {\r\n            return false;\r\n        }\r\n        var scrollArg = arg;\r\n        if (!types.isString(scrollArg.to)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(scrollArg.by) && !types.isString(scrollArg.by)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(scrollArg.value) && !types.isNumber(scrollArg.value)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(scrollArg.revealCursor) && !types.isBoolean(scrollArg.revealCursor)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    EditorScroll_.description = {\r\n        description: 'Scroll editor in the given direction',\r\n        args: [\r\n            {\r\n                name: 'Editor scroll argument object',\r\n                description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t* 'to': A mandatory direction value.\\n\\t\\t\\t\\t\\t\\t```\\n\\t\\t\\t\\t\\t\\t'up', 'down'\\n\\t\\t\\t\\t\\t\\t```\\n\\t\\t\\t\\t\\t* 'by': Unit to move. Default is computed based on 'to' value.\\n\\t\\t\\t\\t\\t\\t```\\n\\t\\t\\t\\t\\t\\t'line', 'wrappedLine', 'page', 'halfPage'\\n\\t\\t\\t\\t\\t\\t```\\n\\t\\t\\t\\t\\t* 'value': Number of units to move. Default is '1'.\\n\\t\\t\\t\\t\\t* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\\n\\t\\t\\t\\t\",\r\n                constraint: isEditorScrollArgs,\r\n                schema: {\r\n                    'type': 'object',\r\n                    'required': ['to'],\r\n                    'properties': {\r\n                        'to': {\r\n                            'type': 'string',\r\n                            'enum': ['up', 'down']\r\n                        },\r\n                        'by': {\r\n                            'type': 'string',\r\n                            'enum': ['line', 'wrappedLine', 'page', 'halfPage']\r\n                        },\r\n                        'value': {\r\n                            'type': 'number',\r\n                            'default': 1\r\n                        },\r\n                        'revealCursor': {\r\n                            'type': 'boolean',\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        ]\r\n    };\r\n    /**\r\n     * Directions in the view for editor scroll command.\r\n     */\r\n    EditorScroll_.RawDirection = {\r\n        Up: 'up',\r\n        Down: 'down',\r\n    };\r\n    /**\r\n     * Units for editor scroll 'by' argument\r\n     */\r\n    EditorScroll_.RawUnit = {\r\n        Line: 'line',\r\n        WrappedLine: 'wrappedLine',\r\n        Page: 'page',\r\n        HalfPage: 'halfPage'\r\n    };\r\n    function parse(args) {\r\n        var direction;\r\n        switch (args.to) {\r\n            case EditorScroll_.RawDirection.Up:\r\n                direction = 1 /* Up */;\r\n                break;\r\n            case EditorScroll_.RawDirection.Down:\r\n                direction = 2 /* Down */;\r\n                break;\r\n            default:\r\n                // Illegal arguments\r\n                return null;\r\n        }\r\n        var unit;\r\n        switch (args.by) {\r\n            case EditorScroll_.RawUnit.Line:\r\n                unit = 1 /* Line */;\r\n                break;\r\n            case EditorScroll_.RawUnit.WrappedLine:\r\n                unit = 2 /* WrappedLine */;\r\n                break;\r\n            case EditorScroll_.RawUnit.Page:\r\n                unit = 3 /* Page */;\r\n                break;\r\n            case EditorScroll_.RawUnit.HalfPage:\r\n                unit = 4 /* HalfPage */;\r\n                break;\r\n            default:\r\n                unit = 2 /* WrappedLine */;\r\n        }\r\n        var value = Math.floor(args.value || 1);\r\n        var revealCursor = !!args.revealCursor;\r\n        return {\r\n            direction: direction,\r\n            unit: unit,\r\n            value: value,\r\n            revealCursor: revealCursor,\r\n            select: (!!args.select)\r\n        };\r\n    }\r\n    EditorScroll_.parse = parse;\r\n})(EditorScroll_ || (EditorScroll_ = {}));\r\nexport var RevealLine_;\r\n(function (RevealLine_) {\r\n    var isRevealLineArgs = function (arg) {\r\n        if (!types.isObject(arg)) {\r\n            return false;\r\n        }\r\n        var reveaLineArg = arg;\r\n        if (!types.isNumber(reveaLineArg.lineNumber)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(reveaLineArg.at) && !types.isString(reveaLineArg.at)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    RevealLine_.description = {\r\n        description: 'Reveal the given line at the given logical position',\r\n        args: [\r\n            {\r\n                name: 'Reveal line argument object',\r\n                description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t* 'lineNumber': A mandatory line number value.\\n\\t\\t\\t\\t\\t* 'at': Logical position at which line has to be revealed .\\n\\t\\t\\t\\t\\t\\t```\\n\\t\\t\\t\\t\\t\\t'top', 'center', 'bottom'\\n\\t\\t\\t\\t\\t\\t```\\n\\t\\t\\t\\t\",\r\n                constraint: isRevealLineArgs,\r\n                schema: {\r\n                    'type': 'object',\r\n                    'required': ['lineNumber'],\r\n                    'properties': {\r\n                        'lineNumber': {\r\n                            'type': 'number',\r\n                        },\r\n                        'at': {\r\n                            'type': 'string',\r\n                            'enum': ['top', 'center', 'bottom']\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        ]\r\n    };\r\n    /**\r\n     * Values for reveal line 'at' argument\r\n     */\r\n    RevealLine_.RawAtArgument = {\r\n        Top: 'top',\r\n        Center: 'center',\r\n        Bottom: 'bottom'\r\n    };\r\n})(RevealLine_ || (RevealLine_ = {}));\r\nexport var CoreNavigationCommands;\r\n(function (CoreNavigationCommands) {\r\n    var BaseMoveToCommand = /** @class */ (function (_super) {\r\n        __extends(BaseMoveToCommand, _super);\r\n        function BaseMoveToCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        BaseMoveToCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                CursorMoveCommands.moveTo(cursors.context, cursors.getPrimaryCursor(), this._inSelectionMode, args.position, args.viewPosition)\r\n            ]);\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return BaseMoveToCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.MoveTo = registerEditorCommand(new BaseMoveToCommand({\r\n        id: '_moveTo',\r\n        inSelectionMode: false,\r\n        precondition: undefined\r\n    }));\r\n    CoreNavigationCommands.MoveToSelect = registerEditorCommand(new BaseMoveToCommand({\r\n        id: '_moveToSelect',\r\n        inSelectionMode: true,\r\n        precondition: undefined\r\n    }));\r\n    var ColumnSelectCommand = /** @class */ (function (_super) {\r\n        __extends(ColumnSelectCommand, _super);\r\n        function ColumnSelectCommand() {\r\n            return _super !== null && _super.apply(this, arguments) || this;\r\n        }\r\n        ColumnSelectCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            var result = this._getColumnSelectResult(cursors.context, cursors.getPrimaryCursor(), cursors.getColumnSelectData(), args);\r\n            cursors.setStates(args.source, 3 /* Explicit */, result.viewStates.map(function (viewState) { return CursorState.fromViewState(viewState); }));\r\n            cursors.setColumnSelectData({\r\n                isReal: true,\r\n                fromViewLineNumber: result.fromLineNumber,\r\n                fromViewVisualColumn: result.fromVisualColumn,\r\n                toViewLineNumber: result.toLineNumber,\r\n                toViewVisualColumn: result.toVisualColumn\r\n            });\r\n            cursors.reveal(args.source, true, (result.reversed ? 1 /* TopMost */ : 2 /* BottomMost */), 0 /* Smooth */);\r\n        };\r\n        return ColumnSelectCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.ColumnSelect = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1() {\r\n            return _super.call(this, {\r\n                id: 'columnSelect',\r\n                precondition: undefined\r\n            }) || this;\r\n        }\r\n        class_1.prototype._getColumnSelectResult = function (context, primary, prevColumnSelectData, args) {\r\n            // validate `args`\r\n            var validatedPosition = context.model.validatePosition(args.position);\r\n            var validatedViewPosition = context.validateViewPosition(new Position(args.viewPosition.lineNumber, args.viewPosition.column), validatedPosition);\r\n            var fromViewLineNumber = args.doColumnSelect ? prevColumnSelectData.fromViewLineNumber : validatedViewPosition.lineNumber;\r\n            var fromViewVisualColumn = args.doColumnSelect ? prevColumnSelectData.fromViewVisualColumn : args.mouseColumn - 1;\r\n            return ColumnSelection.columnSelect(context.config, context.viewModel, fromViewLineNumber, fromViewVisualColumn, validatedViewPosition.lineNumber, args.mouseColumn - 1);\r\n        };\r\n        return class_1;\r\n    }(ColumnSelectCommand)));\r\n    CoreNavigationCommands.CursorColumnSelectLeft = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_2, _super);\r\n        function class_2() {\r\n            return _super.call(this, {\r\n                id: 'cursorColumnSelectLeft',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 512 /* Alt */ | 15 /* LeftArrow */,\r\n                    linux: { primary: 0 }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_2.prototype._getColumnSelectResult = function (context, primary, prevColumnSelectData, args) {\r\n            return ColumnSelection.columnSelectLeft(context.config, context.viewModel, prevColumnSelectData);\r\n        };\r\n        return class_2;\r\n    }(ColumnSelectCommand)));\r\n    CoreNavigationCommands.CursorColumnSelectRight = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_3, _super);\r\n        function class_3() {\r\n            return _super.call(this, {\r\n                id: 'cursorColumnSelectRight',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 512 /* Alt */ | 17 /* RightArrow */,\r\n                    linux: { primary: 0 }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_3.prototype._getColumnSelectResult = function (context, primary, prevColumnSelectData, args) {\r\n            return ColumnSelection.columnSelectRight(context.config, context.viewModel, prevColumnSelectData);\r\n        };\r\n        return class_3;\r\n    }(ColumnSelectCommand)));\r\n    var ColumnSelectUpCommand = /** @class */ (function (_super) {\r\n        __extends(ColumnSelectUpCommand, _super);\r\n        function ColumnSelectUpCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._isPaged = opts.isPaged;\r\n            return _this;\r\n        }\r\n        ColumnSelectUpCommand.prototype._getColumnSelectResult = function (context, primary, prevColumnSelectData, args) {\r\n            return ColumnSelection.columnSelectUp(context.config, context.viewModel, prevColumnSelectData, this._isPaged);\r\n        };\r\n        return ColumnSelectUpCommand;\r\n    }(ColumnSelectCommand));\r\n    CoreNavigationCommands.CursorColumnSelectUp = registerEditorCommand(new ColumnSelectUpCommand({\r\n        isPaged: false,\r\n        id: 'cursorColumnSelectUp',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 512 /* Alt */ | 16 /* UpArrow */,\r\n            linux: { primary: 0 }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorColumnSelectPageUp = registerEditorCommand(new ColumnSelectUpCommand({\r\n        isPaged: true,\r\n        id: 'cursorColumnSelectPageUp',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 512 /* Alt */ | 11 /* PageUp */,\r\n            linux: { primary: 0 }\r\n        }\r\n    }));\r\n    var ColumnSelectDownCommand = /** @class */ (function (_super) {\r\n        __extends(ColumnSelectDownCommand, _super);\r\n        function ColumnSelectDownCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._isPaged = opts.isPaged;\r\n            return _this;\r\n        }\r\n        ColumnSelectDownCommand.prototype._getColumnSelectResult = function (context, primary, prevColumnSelectData, args) {\r\n            return ColumnSelection.columnSelectDown(context.config, context.viewModel, prevColumnSelectData, this._isPaged);\r\n        };\r\n        return ColumnSelectDownCommand;\r\n    }(ColumnSelectCommand));\r\n    CoreNavigationCommands.CursorColumnSelectDown = registerEditorCommand(new ColumnSelectDownCommand({\r\n        isPaged: false,\r\n        id: 'cursorColumnSelectDown',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 512 /* Alt */ | 18 /* DownArrow */,\r\n            linux: { primary: 0 }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorColumnSelectPageDown = registerEditorCommand(new ColumnSelectDownCommand({\r\n        isPaged: true,\r\n        id: 'cursorColumnSelectPageDown',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 512 /* Alt */ | 12 /* PageDown */,\r\n            linux: { primary: 0 }\r\n        }\r\n    }));\r\n    var CursorMoveImpl = /** @class */ (function (_super) {\r\n        __extends(CursorMoveImpl, _super);\r\n        function CursorMoveImpl() {\r\n            return _super.call(this, {\r\n                id: 'cursorMove',\r\n                precondition: undefined,\r\n                description: CursorMove_.description\r\n            }) || this;\r\n        }\r\n        CursorMoveImpl.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var parsed = CursorMove_.parse(args);\r\n            if (!parsed) {\r\n                // illegal arguments\r\n                return;\r\n            }\r\n            this._runCursorMove(cursors, args.source, parsed);\r\n        };\r\n        CursorMoveImpl.prototype._runCursorMove = function (cursors, source, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(source, 3 /* Explicit */, CursorMoveCommands.move(cursors.context, cursors.getAll(), args));\r\n            cursors.reveal(source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return CursorMoveImpl;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.CursorMoveImpl = CursorMoveImpl;\r\n    CoreNavigationCommands.CursorMove = registerEditorCommand(new CursorMoveImpl());\r\n    var CursorMoveBasedCommand = /** @class */ (function (_super) {\r\n        __extends(CursorMoveBasedCommand, _super);\r\n        function CursorMoveBasedCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._staticArgs = opts.args;\r\n            return _this;\r\n        }\r\n        CursorMoveBasedCommand.prototype.runCoreEditorCommand = function (cursors, dynamicArgs) {\r\n            var args = this._staticArgs;\r\n            if (this._staticArgs.value === -1 /* PAGE_SIZE_MARKER */) {\r\n                // -1 is a marker for page size\r\n                args = {\r\n                    direction: this._staticArgs.direction,\r\n                    unit: this._staticArgs.unit,\r\n                    select: this._staticArgs.select,\r\n                    value: cursors.context.config.pageSize\r\n                };\r\n            }\r\n            CoreNavigationCommands.CursorMove._runCursorMove(cursors, dynamicArgs.source, args);\r\n        };\r\n        return CursorMoveBasedCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.CursorLeft = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 0 /* Left */,\r\n            unit: 0 /* None */,\r\n            select: false,\r\n            value: 1\r\n        },\r\n        id: 'cursorLeft',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 15 /* LeftArrow */,\r\n            mac: { primary: 15 /* LeftArrow */, secondary: [256 /* WinCtrl */ | 32 /* KEY_B */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorLeftSelect = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 0 /* Left */,\r\n            unit: 0 /* None */,\r\n            select: true,\r\n            value: 1\r\n        },\r\n        id: 'cursorLeftSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 15 /* LeftArrow */\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorRight = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 1 /* Right */,\r\n            unit: 0 /* None */,\r\n            select: false,\r\n            value: 1\r\n        },\r\n        id: 'cursorRight',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 17 /* RightArrow */,\r\n            mac: { primary: 17 /* RightArrow */, secondary: [256 /* WinCtrl */ | 36 /* KEY_F */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorRightSelect = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 1 /* Right */,\r\n            unit: 0 /* None */,\r\n            select: true,\r\n            value: 1\r\n        },\r\n        id: 'cursorRightSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 17 /* RightArrow */\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorUp = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 2 /* Up */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: false,\r\n            value: 1\r\n        },\r\n        id: 'cursorUp',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 16 /* UpArrow */,\r\n            mac: { primary: 16 /* UpArrow */, secondary: [256 /* WinCtrl */ | 46 /* KEY_P */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorUpSelect = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 2 /* Up */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: true,\r\n            value: 1\r\n        },\r\n        id: 'cursorUpSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 16 /* UpArrow */,\r\n            secondary: [2048 /* CtrlCmd */ | 1024 /* Shift */ | 16 /* UpArrow */],\r\n            mac: { primary: 1024 /* Shift */ | 16 /* UpArrow */ },\r\n            linux: { primary: 1024 /* Shift */ | 16 /* UpArrow */ }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorPageUp = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 2 /* Up */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: false,\r\n            value: -1 /* PAGE_SIZE_MARKER */\r\n        },\r\n        id: 'cursorPageUp',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 11 /* PageUp */\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorPageUpSelect = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 2 /* Up */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: true,\r\n            value: -1 /* PAGE_SIZE_MARKER */\r\n        },\r\n        id: 'cursorPageUpSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 11 /* PageUp */\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorDown = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 3 /* Down */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: false,\r\n            value: 1\r\n        },\r\n        id: 'cursorDown',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 18 /* DownArrow */,\r\n            mac: { primary: 18 /* DownArrow */, secondary: [256 /* WinCtrl */ | 44 /* KEY_N */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorDownSelect = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 3 /* Down */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: true,\r\n            value: 1\r\n        },\r\n        id: 'cursorDownSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 18 /* DownArrow */,\r\n            secondary: [2048 /* CtrlCmd */ | 1024 /* Shift */ | 18 /* DownArrow */],\r\n            mac: { primary: 1024 /* Shift */ | 18 /* DownArrow */ },\r\n            linux: { primary: 1024 /* Shift */ | 18 /* DownArrow */ }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorPageDown = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 3 /* Down */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: false,\r\n            value: -1 /* PAGE_SIZE_MARKER */\r\n        },\r\n        id: 'cursorPageDown',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 12 /* PageDown */\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorPageDownSelect = registerEditorCommand(new CursorMoveBasedCommand({\r\n        args: {\r\n            direction: 3 /* Down */,\r\n            unit: 2 /* WrappedLine */,\r\n            select: true,\r\n            value: -1 /* PAGE_SIZE_MARKER */\r\n        },\r\n        id: 'cursorPageDownSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 12 /* PageDown */\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CreateCursor = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_4, _super);\r\n        function class_4() {\r\n            return _super.call(this, {\r\n                id: 'createCursor',\r\n                precondition: undefined\r\n            }) || this;\r\n        }\r\n        class_4.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var context = cursors.context;\r\n            var newState;\r\n            if (args.wholeLine) {\r\n                newState = CursorMoveCommands.line(context, cursors.getPrimaryCursor(), false, args.position, args.viewPosition);\r\n            }\r\n            else {\r\n                newState = CursorMoveCommands.moveTo(context, cursors.getPrimaryCursor(), false, args.position, args.viewPosition);\r\n            }\r\n            var states = cursors.getAll();\r\n            // Check if we should remove a cursor (sort of like a toggle)\r\n            if (states.length > 1) {\r\n                var newModelPosition = (newState.modelState ? newState.modelState.position : null);\r\n                var newViewPosition = (newState.viewState ? newState.viewState.position : null);\r\n                for (var i = 0, len = states.length; i < len; i++) {\r\n                    var state = states[i];\r\n                    if (newModelPosition && !state.modelState.selection.containsPosition(newModelPosition)) {\r\n                        continue;\r\n                    }\r\n                    if (newViewPosition && !state.viewState.selection.containsPosition(newViewPosition)) {\r\n                        continue;\r\n                    }\r\n                    // => Remove the cursor\r\n                    states.splice(i, 1);\r\n                    cursors.context.model.pushStackElement();\r\n                    cursors.setStates(args.source, 3 /* Explicit */, states);\r\n                    return;\r\n                }\r\n            }\r\n            // => Add the new cursor\r\n            states.push(newState);\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, states);\r\n        };\r\n        return class_4;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.LastCursorMoveToSelect = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_5, _super);\r\n        function class_5() {\r\n            return _super.call(this, {\r\n                id: '_lastCursorMoveToSelect',\r\n                precondition: undefined\r\n            }) || this;\r\n        }\r\n        class_5.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var context = cursors.context;\r\n            var lastAddedCursorIndex = cursors.getLastAddedCursorIndex();\r\n            var states = cursors.getAll();\r\n            var newStates = states.slice(0);\r\n            newStates[lastAddedCursorIndex] = CursorMoveCommands.moveTo(context, states[lastAddedCursorIndex], true, args.position, args.viewPosition);\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, newStates);\r\n        };\r\n        return class_5;\r\n    }(CoreEditorCommand)));\r\n    var HomeCommand = /** @class */ (function (_super) {\r\n        __extends(HomeCommand, _super);\r\n        function HomeCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        HomeCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, CursorMoveCommands.moveToBeginningOfLine(cursors.context, cursors.getAll(), this._inSelectionMode));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return HomeCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.CursorHome = registerEditorCommand(new HomeCommand({\r\n        inSelectionMode: false,\r\n        id: 'cursorHome',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 14 /* Home */,\r\n            mac: { primary: 14 /* Home */, secondary: [2048 /* CtrlCmd */ | 15 /* LeftArrow */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorHomeSelect = registerEditorCommand(new HomeCommand({\r\n        inSelectionMode: true,\r\n        id: 'cursorHomeSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 14 /* Home */,\r\n            mac: { primary: 1024 /* Shift */ | 14 /* Home */, secondary: [2048 /* CtrlCmd */ | 1024 /* Shift */ | 15 /* LeftArrow */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorLineStart = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_6, _super);\r\n        function class_6() {\r\n            return _super.call(this, {\r\n                id: 'cursorLineStart',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 0,\r\n                    mac: { primary: 256 /* WinCtrl */ | 31 /* KEY_A */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_6.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, this._exec(cursors.context, cursors.getAll()));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        class_6.prototype._exec = function (context, cursors) {\r\n            var result = [];\r\n            for (var i = 0, len = cursors.length; i < len; i++) {\r\n                var cursor = cursors[i];\r\n                var lineNumber = cursor.modelState.position.lineNumber;\r\n                result[i] = CursorState.fromModelState(cursor.modelState.move(false, lineNumber, 1, 0));\r\n            }\r\n            return result;\r\n        };\r\n        return class_6;\r\n    }(CoreEditorCommand)));\r\n    var EndCommand = /** @class */ (function (_super) {\r\n        __extends(EndCommand, _super);\r\n        function EndCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        EndCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, CursorMoveCommands.moveToEndOfLine(cursors.context, cursors.getAll(), this._inSelectionMode));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return EndCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.CursorEnd = registerEditorCommand(new EndCommand({\r\n        inSelectionMode: false,\r\n        id: 'cursorEnd',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 13 /* End */,\r\n            mac: { primary: 13 /* End */, secondary: [2048 /* CtrlCmd */ | 17 /* RightArrow */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorEndSelect = registerEditorCommand(new EndCommand({\r\n        inSelectionMode: true,\r\n        id: 'cursorEndSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 1024 /* Shift */ | 13 /* End */,\r\n            mac: { primary: 1024 /* Shift */ | 13 /* End */, secondary: [2048 /* CtrlCmd */ | 1024 /* Shift */ | 17 /* RightArrow */] }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorLineEnd = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_7, _super);\r\n        function class_7() {\r\n            return _super.call(this, {\r\n                id: 'cursorLineEnd',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 0,\r\n                    mac: { primary: 256 /* WinCtrl */ | 35 /* KEY_E */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_7.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, this._exec(cursors.context, cursors.getAll()));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        class_7.prototype._exec = function (context, cursors) {\r\n            var result = [];\r\n            for (var i = 0, len = cursors.length; i < len; i++) {\r\n                var cursor = cursors[i];\r\n                var lineNumber = cursor.modelState.position.lineNumber;\r\n                var maxColumn = context.model.getLineMaxColumn(lineNumber);\r\n                result[i] = CursorState.fromModelState(cursor.modelState.move(false, lineNumber, maxColumn, 0));\r\n            }\r\n            return result;\r\n        };\r\n        return class_7;\r\n    }(CoreEditorCommand)));\r\n    var TopCommand = /** @class */ (function (_super) {\r\n        __extends(TopCommand, _super);\r\n        function TopCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        TopCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, CursorMoveCommands.moveToBeginningOfBuffer(cursors.context, cursors.getAll(), this._inSelectionMode));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return TopCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.CursorTop = registerEditorCommand(new TopCommand({\r\n        inSelectionMode: false,\r\n        id: 'cursorTop',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 14 /* Home */,\r\n            mac: { primary: 2048 /* CtrlCmd */ | 16 /* UpArrow */ }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorTopSelect = registerEditorCommand(new TopCommand({\r\n        inSelectionMode: true,\r\n        id: 'cursorTopSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 14 /* Home */,\r\n            mac: { primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 16 /* UpArrow */ }\r\n        }\r\n    }));\r\n    var BottomCommand = /** @class */ (function (_super) {\r\n        __extends(BottomCommand, _super);\r\n        function BottomCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        BottomCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, CursorMoveCommands.moveToEndOfBuffer(cursors.context, cursors.getAll(), this._inSelectionMode));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return BottomCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.CursorBottom = registerEditorCommand(new BottomCommand({\r\n        inSelectionMode: false,\r\n        id: 'cursorBottom',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 13 /* End */,\r\n            mac: { primary: 2048 /* CtrlCmd */ | 18 /* DownArrow */ }\r\n        }\r\n    }));\r\n    CoreNavigationCommands.CursorBottomSelect = registerEditorCommand(new BottomCommand({\r\n        inSelectionMode: true,\r\n        id: 'cursorBottomSelect',\r\n        precondition: undefined,\r\n        kbOpts: {\r\n            weight: CORE_WEIGHT,\r\n            kbExpr: EditorContextKeys.textInputFocus,\r\n            primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 13 /* End */,\r\n            mac: { primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 18 /* DownArrow */ }\r\n        }\r\n    }));\r\n    var EditorScrollImpl = /** @class */ (function (_super) {\r\n        __extends(EditorScrollImpl, _super);\r\n        function EditorScrollImpl() {\r\n            return _super.call(this, {\r\n                id: 'editorScroll',\r\n                precondition: undefined,\r\n                description: EditorScroll_.description\r\n            }) || this;\r\n        }\r\n        EditorScrollImpl.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var parsed = EditorScroll_.parse(args);\r\n            if (!parsed) {\r\n                // illegal arguments\r\n                return;\r\n            }\r\n            this._runEditorScroll(cursors, args.source, parsed);\r\n        };\r\n        EditorScrollImpl.prototype._runEditorScroll = function (cursors, source, args) {\r\n            var desiredScrollTop = this._computeDesiredScrollTop(cursors.context, args);\r\n            if (args.revealCursor) {\r\n                // must ensure cursor is in new visible range\r\n                var desiredVisibleViewRange = cursors.context.getCompletelyVisibleViewRangeAtScrollTop(desiredScrollTop);\r\n                cursors.setStates(source, 3 /* Explicit */, [\r\n                    CursorMoveCommands.findPositionInViewportIfOutside(cursors.context, cursors.getPrimaryCursor(), desiredVisibleViewRange, args.select)\r\n                ]);\r\n            }\r\n            cursors.scrollTo(desiredScrollTop);\r\n        };\r\n        EditorScrollImpl.prototype._computeDesiredScrollTop = function (context, args) {\r\n            if (args.unit === 1 /* Line */) {\r\n                // scrolling by model lines\r\n                var visibleModelRange = context.getCompletelyVisibleModelRange();\r\n                var desiredTopModelLineNumber = void 0;\r\n                if (args.direction === 1 /* Up */) {\r\n                    // must go x model lines up\r\n                    desiredTopModelLineNumber = Math.max(1, visibleModelRange.startLineNumber - args.value);\r\n                }\r\n                else {\r\n                    // must go x model lines down\r\n                    desiredTopModelLineNumber = Math.min(context.model.getLineCount(), visibleModelRange.startLineNumber + args.value);\r\n                }\r\n                var desiredTopViewPosition = context.convertModelPositionToViewPosition(new Position(desiredTopModelLineNumber, 1));\r\n                return context.getVerticalOffsetForViewLine(desiredTopViewPosition.lineNumber);\r\n            }\r\n            var noOfLines;\r\n            if (args.unit === 3 /* Page */) {\r\n                noOfLines = context.config.pageSize * args.value;\r\n            }\r\n            else if (args.unit === 4 /* HalfPage */) {\r\n                noOfLines = Math.round(context.config.pageSize / 2) * args.value;\r\n            }\r\n            else {\r\n                noOfLines = args.value;\r\n            }\r\n            var deltaLines = (args.direction === 1 /* Up */ ? -1 : 1) * noOfLines;\r\n            return context.getCurrentScrollTop() + deltaLines * context.config.lineHeight;\r\n        };\r\n        return EditorScrollImpl;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.EditorScrollImpl = EditorScrollImpl;\r\n    CoreNavigationCommands.EditorScroll = registerEditorCommand(new EditorScrollImpl());\r\n    CoreNavigationCommands.ScrollLineUp = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_8, _super);\r\n        function class_8() {\r\n            return _super.call(this, {\r\n                id: 'scrollLineUp',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 16 /* UpArrow */,\r\n                    mac: { primary: 256 /* WinCtrl */ | 11 /* PageUp */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_8.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            CoreNavigationCommands.EditorScroll._runEditorScroll(cursors, args.source, {\r\n                direction: 1 /* Up */,\r\n                unit: 2 /* WrappedLine */,\r\n                value: 1,\r\n                revealCursor: false,\r\n                select: false\r\n            });\r\n        };\r\n        return class_8;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.ScrollPageUp = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_9, _super);\r\n        function class_9() {\r\n            return _super.call(this, {\r\n                id: 'scrollPageUp',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 11 /* PageUp */,\r\n                    win: { primary: 512 /* Alt */ | 11 /* PageUp */ },\r\n                    linux: { primary: 512 /* Alt */ | 11 /* PageUp */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_9.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            CoreNavigationCommands.EditorScroll._runEditorScroll(cursors, args.source, {\r\n                direction: 1 /* Up */,\r\n                unit: 3 /* Page */,\r\n                value: 1,\r\n                revealCursor: false,\r\n                select: false\r\n            });\r\n        };\r\n        return class_9;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.ScrollLineDown = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_10, _super);\r\n        function class_10() {\r\n            return _super.call(this, {\r\n                id: 'scrollLineDown',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 18 /* DownArrow */,\r\n                    mac: { primary: 256 /* WinCtrl */ | 12 /* PageDown */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_10.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            CoreNavigationCommands.EditorScroll._runEditorScroll(cursors, args.source, {\r\n                direction: 2 /* Down */,\r\n                unit: 2 /* WrappedLine */,\r\n                value: 1,\r\n                revealCursor: false,\r\n                select: false\r\n            });\r\n        };\r\n        return class_10;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.ScrollPageDown = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_11, _super);\r\n        function class_11() {\r\n            return _super.call(this, {\r\n                id: 'scrollPageDown',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 12 /* PageDown */,\r\n                    win: { primary: 512 /* Alt */ | 12 /* PageDown */ },\r\n                    linux: { primary: 512 /* Alt */ | 12 /* PageDown */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_11.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            CoreNavigationCommands.EditorScroll._runEditorScroll(cursors, args.source, {\r\n                direction: 2 /* Down */,\r\n                unit: 3 /* Page */,\r\n                value: 1,\r\n                revealCursor: false,\r\n                select: false\r\n            });\r\n        };\r\n        return class_11;\r\n    }(CoreEditorCommand)));\r\n    var WordCommand = /** @class */ (function (_super) {\r\n        __extends(WordCommand, _super);\r\n        function WordCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        WordCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                CursorMoveCommands.word(cursors.context, cursors.getPrimaryCursor(), this._inSelectionMode, args.position)\r\n            ]);\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return WordCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.WordSelect = registerEditorCommand(new WordCommand({\r\n        inSelectionMode: false,\r\n        id: '_wordSelect',\r\n        precondition: undefined\r\n    }));\r\n    CoreNavigationCommands.WordSelectDrag = registerEditorCommand(new WordCommand({\r\n        inSelectionMode: true,\r\n        id: '_wordSelectDrag',\r\n        precondition: undefined\r\n    }));\r\n    CoreNavigationCommands.LastCursorWordSelect = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_12, _super);\r\n        function class_12() {\r\n            return _super.call(this, {\r\n                id: 'lastCursorWordSelect',\r\n                precondition: undefined\r\n            }) || this;\r\n        }\r\n        class_12.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var context = cursors.context;\r\n            var lastAddedCursorIndex = cursors.getLastAddedCursorIndex();\r\n            var states = cursors.getAll();\r\n            var newStates = states.slice(0);\r\n            var lastAddedState = states[lastAddedCursorIndex];\r\n            newStates[lastAddedCursorIndex] = CursorMoveCommands.word(context, lastAddedState, lastAddedState.modelState.hasSelection(), args.position);\r\n            context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, newStates);\r\n        };\r\n        return class_12;\r\n    }(CoreEditorCommand)));\r\n    var LineCommand = /** @class */ (function (_super) {\r\n        __extends(LineCommand, _super);\r\n        function LineCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        LineCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                CursorMoveCommands.line(cursors.context, cursors.getPrimaryCursor(), this._inSelectionMode, args.position, args.viewPosition)\r\n            ]);\r\n            cursors.reveal(args.source, false, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return LineCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.LineSelect = registerEditorCommand(new LineCommand({\r\n        inSelectionMode: false,\r\n        id: '_lineSelect',\r\n        precondition: undefined\r\n    }));\r\n    CoreNavigationCommands.LineSelectDrag = registerEditorCommand(new LineCommand({\r\n        inSelectionMode: true,\r\n        id: '_lineSelectDrag',\r\n        precondition: undefined\r\n    }));\r\n    var LastCursorLineCommand = /** @class */ (function (_super) {\r\n        __extends(LastCursorLineCommand, _super);\r\n        function LastCursorLineCommand(opts) {\r\n            var _this = _super.call(this, opts) || this;\r\n            _this._inSelectionMode = opts.inSelectionMode;\r\n            return _this;\r\n        }\r\n        LastCursorLineCommand.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var lastAddedCursorIndex = cursors.getLastAddedCursorIndex();\r\n            var states = cursors.getAll();\r\n            var newStates = states.slice(0);\r\n            newStates[lastAddedCursorIndex] = CursorMoveCommands.line(cursors.context, states[lastAddedCursorIndex], this._inSelectionMode, args.position, args.viewPosition);\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, newStates);\r\n        };\r\n        return LastCursorLineCommand;\r\n    }(CoreEditorCommand));\r\n    CoreNavigationCommands.LastCursorLineSelect = registerEditorCommand(new LastCursorLineCommand({\r\n        inSelectionMode: false,\r\n        id: 'lastCursorLineSelect',\r\n        precondition: undefined\r\n    }));\r\n    CoreNavigationCommands.LastCursorLineSelectDrag = registerEditorCommand(new LastCursorLineCommand({\r\n        inSelectionMode: true,\r\n        id: 'lastCursorLineSelectDrag',\r\n        precondition: undefined\r\n    }));\r\n    CoreNavigationCommands.ExpandLineSelection = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_13, _super);\r\n        function class_13() {\r\n            return _super.call(this, {\r\n                id: 'expandLineSelection',\r\n                precondition: undefined,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 2048 /* CtrlCmd */ | 42 /* KEY_L */\r\n                }\r\n            }) || this;\r\n        }\r\n        class_13.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, CursorMoveCommands.expandLineSelection(cursors.context, cursors.getAll()));\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return class_13;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.CancelSelection = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_14, _super);\r\n        function class_14() {\r\n            return _super.call(this, {\r\n                id: 'cancelSelection',\r\n                precondition: EditorContextKeys.hasNonEmptySelection,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 9 /* Escape */,\r\n                    secondary: [1024 /* Shift */ | 9 /* Escape */]\r\n                }\r\n            }) || this;\r\n        }\r\n        class_14.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                CursorMoveCommands.cancelSelection(cursors.context, cursors.getPrimaryCursor())\r\n            ]);\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return class_14;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.RemoveSecondaryCursors = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_15, _super);\r\n        function class_15() {\r\n            return _super.call(this, {\r\n                id: 'removeSecondaryCursors',\r\n                precondition: EditorContextKeys.hasMultipleSelections,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT + 1,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 9 /* Escape */,\r\n                    secondary: [1024 /* Shift */ | 9 /* Escape */]\r\n                }\r\n            }) || this;\r\n        }\r\n        class_15.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                cursors.getPrimaryCursor()\r\n            ]);\r\n            cursors.reveal(args.source, true, 0 /* Primary */, 0 /* Smooth */);\r\n        };\r\n        return class_15;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.RevealLine = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_16, _super);\r\n        function class_16() {\r\n            return _super.call(this, {\r\n                id: 'revealLine',\r\n                precondition: undefined,\r\n                description: RevealLine_.description\r\n            }) || this;\r\n        }\r\n        class_16.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            var revealLineArg = args;\r\n            var lineNumber = (revealLineArg.lineNumber || 0) + 1;\r\n            if (lineNumber < 1) {\r\n                lineNumber = 1;\r\n            }\r\n            var lineCount = cursors.context.model.getLineCount();\r\n            if (lineNumber > lineCount) {\r\n                lineNumber = lineCount;\r\n            }\r\n            var range = new Range(lineNumber, 1, lineNumber, cursors.context.model.getLineMaxColumn(lineNumber));\r\n            var revealAt = 0 /* Simple */;\r\n            if (revealLineArg.at) {\r\n                switch (revealLineArg.at) {\r\n                    case RevealLine_.RawAtArgument.Top:\r\n                        revealAt = 3 /* Top */;\r\n                        break;\r\n                    case RevealLine_.RawAtArgument.Center:\r\n                        revealAt = 1 /* Center */;\r\n                        break;\r\n                    case RevealLine_.RawAtArgument.Bottom:\r\n                        revealAt = 4 /* Bottom */;\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n            var viewRange = cursors.context.convertModelRangeToViewRange(range);\r\n            cursors.revealRange(args.source, false, viewRange, revealAt, 0 /* Smooth */);\r\n        };\r\n        return class_16;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.SelectAll = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_17, _super);\r\n        function class_17() {\r\n            return _super.call(this, {\r\n                id: 'selectAll',\r\n                precondition: undefined\r\n            }) || this;\r\n        }\r\n        class_17.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                CursorMoveCommands.selectAll(cursors.context, cursors.getPrimaryCursor())\r\n            ]);\r\n        };\r\n        return class_17;\r\n    }(CoreEditorCommand)));\r\n    CoreNavigationCommands.SetSelection = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_18, _super);\r\n        function class_18() {\r\n            return _super.call(this, {\r\n                id: 'setSelection',\r\n                precondition: undefined\r\n            }) || this;\r\n        }\r\n        class_18.prototype.runCoreEditorCommand = function (cursors, args) {\r\n            cursors.context.model.pushStackElement();\r\n            cursors.setStates(args.source, 3 /* Explicit */, [\r\n                CursorState.fromModelSelection(args.selection)\r\n            ]);\r\n        };\r\n        return class_18;\r\n    }(CoreEditorCommand)));\r\n})(CoreNavigationCommands || (CoreNavigationCommands = {}));\r\nexport var CoreEditingCommands;\r\n(function (CoreEditingCommands) {\r\n    var CoreEditingCommand = /** @class */ (function (_super) {\r\n        __extends(CoreEditingCommand, _super);\r\n        function CoreEditingCommand() {\r\n            return _super !== null && _super.apply(this, arguments) || this;\r\n        }\r\n        CoreEditingCommand.prototype.runEditorCommand = function (accessor, editor, args) {\r\n            var cursors = editor._getCursors();\r\n            if (!cursors) {\r\n                // the editor has no view => has no cursors\r\n                return;\r\n            }\r\n            this.runCoreEditingCommand(editor, cursors, args || {});\r\n        };\r\n        return CoreEditingCommand;\r\n    }(EditorCommand));\r\n    CoreEditingCommands.CoreEditingCommand = CoreEditingCommand;\r\n    CoreEditingCommands.LineBreakInsert = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_19, _super);\r\n        function class_19() {\r\n            return _super.call(this, {\r\n                id: 'lineBreakInsert',\r\n                precondition: EditorContextKeys.writable,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 0,\r\n                    mac: { primary: 256 /* WinCtrl */ | 45 /* KEY_O */ }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_19.prototype.runCoreEditingCommand = function (editor, cursors, args) {\r\n            editor.pushUndoStop();\r\n            editor.executeCommands(this.id, TypeOperations.lineBreakInsert(cursors.context.config, cursors.context.model, cursors.getAll().map(function (s) { return s.modelState.selection; })));\r\n        };\r\n        return class_19;\r\n    }(CoreEditingCommand)));\r\n    CoreEditingCommands.Outdent = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_20, _super);\r\n        function class_20() {\r\n            return _super.call(this, {\r\n                id: 'outdent',\r\n                precondition: EditorContextKeys.writable,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus, EditorContextKeys.tabDoesNotMoveFocus),\r\n                    primary: 1024 /* Shift */ | 2 /* Tab */\r\n                }\r\n            }) || this;\r\n        }\r\n        class_20.prototype.runCoreEditingCommand = function (editor, cursors, args) {\r\n            editor.pushUndoStop();\r\n            editor.executeCommands(this.id, TypeOperations.outdent(cursors.context.config, cursors.context.model, cursors.getAll().map(function (s) { return s.modelState.selection; })));\r\n            editor.pushUndoStop();\r\n        };\r\n        return class_20;\r\n    }(CoreEditingCommand)));\r\n    CoreEditingCommands.Tab = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_21, _super);\r\n        function class_21() {\r\n            return _super.call(this, {\r\n                id: 'tab',\r\n                precondition: EditorContextKeys.writable,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus, EditorContextKeys.tabDoesNotMoveFocus),\r\n                    primary: 2 /* Tab */\r\n                }\r\n            }) || this;\r\n        }\r\n        class_21.prototype.runCoreEditingCommand = function (editor, cursors, args) {\r\n            editor.pushUndoStop();\r\n            editor.executeCommands(this.id, TypeOperations.tab(cursors.context.config, cursors.context.model, cursors.getAll().map(function (s) { return s.modelState.selection; })));\r\n            editor.pushUndoStop();\r\n        };\r\n        return class_21;\r\n    }(CoreEditingCommand)));\r\n    CoreEditingCommands.DeleteLeft = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_22, _super);\r\n        function class_22() {\r\n            return _super.call(this, {\r\n                id: 'deleteLeft',\r\n                precondition: EditorContextKeys.writable,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 1 /* Backspace */,\r\n                    secondary: [1024 /* Shift */ | 1 /* Backspace */],\r\n                    mac: { primary: 1 /* Backspace */, secondary: [1024 /* Shift */ | 1 /* Backspace */, 256 /* WinCtrl */ | 38 /* KEY_H */, 256 /* WinCtrl */ | 1 /* Backspace */] }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_22.prototype.runCoreEditingCommand = function (editor, cursors, args) {\r\n            var _a = DeleteOperations.deleteLeft(cursors.getPrevEditOperationType(), cursors.context.config, cursors.context.model, cursors.getAll().map(function (s) { return s.modelState.selection; })), shouldPushStackElementBefore = _a[0], commands = _a[1];\r\n            if (shouldPushStackElementBefore) {\r\n                editor.pushUndoStop();\r\n            }\r\n            editor.executeCommands(this.id, commands);\r\n            cursors.setPrevEditOperationType(2 /* DeletingLeft */);\r\n        };\r\n        return class_22;\r\n    }(CoreEditingCommand)));\r\n    CoreEditingCommands.DeleteRight = registerEditorCommand(new /** @class */ (function (_super) {\r\n        __extends(class_23, _super);\r\n        function class_23() {\r\n            return _super.call(this, {\r\n                id: 'deleteRight',\r\n                precondition: EditorContextKeys.writable,\r\n                kbOpts: {\r\n                    weight: CORE_WEIGHT,\r\n                    kbExpr: EditorContextKeys.textInputFocus,\r\n                    primary: 20 /* Delete */,\r\n                    mac: { primary: 20 /* Delete */, secondary: [256 /* WinCtrl */ | 34 /* KEY_D */, 256 /* WinCtrl */ | 20 /* Delete */] }\r\n                }\r\n            }) || this;\r\n        }\r\n        class_23.prototype.runCoreEditingCommand = function (editor, cursors, args) {\r\n            var _a = DeleteOperations.deleteRight(cursors.getPrevEditOperationType(), cursors.context.config, cursors.context.model, cursors.getAll().map(function (s) { return s.modelState.selection; })), shouldPushStackElementBefore = _a[0], commands = _a[1];\r\n            if (shouldPushStackElementBefore) {\r\n                editor.pushUndoStop();\r\n            }\r\n            editor.executeCommands(this.id, commands);\r\n            cursors.setPrevEditOperationType(3 /* DeletingRight */);\r\n        };\r\n        return class_23;\r\n    }(CoreEditingCommand)));\r\n})(CoreEditingCommands || (CoreEditingCommands = {}));\r\nfunction registerCommand(command) {\r\n    command.register();\r\n}\r\n/**\r\n * A command that will:\r\n *  1. invoke a command on the focused editor.\r\n *  2. otherwise, invoke a browser built-in command on the `activeElement`.\r\n *  3. otherwise, invoke a command on the workbench active editor.\r\n */\r\nvar EditorOrNativeTextInputCommand = /** @class */ (function (_super) {\r\n    __extends(EditorOrNativeTextInputCommand, _super);\r\n    function EditorOrNativeTextInputCommand(opts) {\r\n        var _this = _super.call(this, opts) || this;\r\n        _this._editorHandler = opts.editorHandler;\r\n        _this._inputHandler = opts.inputHandler;\r\n        return _this;\r\n    }\r\n    EditorOrNativeTextInputCommand.prototype.runCommand = function (accessor, args) {\r\n        var focusedEditor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\r\n        // Only if editor text focus (i.e. not if editor has widget focus).\r\n        if (focusedEditor && focusedEditor.hasTextFocus()) {\r\n            return this._runEditorHandler(accessor, focusedEditor, args);\r\n        }\r\n        // Ignore this action when user is focused on an element that allows for entering text\r\n        var activeElement = document.activeElement;\r\n        if (activeElement && ['input', 'textarea'].indexOf(activeElement.tagName.toLowerCase()) >= 0) {\r\n            document.execCommand(this._inputHandler);\r\n            return;\r\n        }\r\n        // Redirecting to active editor\r\n        var activeEditor = accessor.get(ICodeEditorService).getActiveCodeEditor();\r\n        if (activeEditor) {\r\n            activeEditor.focus();\r\n            return this._runEditorHandler(accessor, activeEditor, args);\r\n        }\r\n    };\r\n    EditorOrNativeTextInputCommand.prototype._runEditorHandler = function (accessor, editor, args) {\r\n        var HANDLER = this._editorHandler;\r\n        if (typeof HANDLER === 'string') {\r\n            editor.trigger('keyboard', HANDLER, args);\r\n        }\r\n        else {\r\n            args = args || {};\r\n            args.source = 'keyboard';\r\n            HANDLER.runEditorCommand(accessor, editor, args);\r\n        }\r\n    };\r\n    return EditorOrNativeTextInputCommand;\r\n}(Command));\r\n/**\r\n * A command that will invoke a command on the focused editor.\r\n */\r\nvar EditorHandlerCommand = /** @class */ (function (_super) {\r\n    __extends(EditorHandlerCommand, _super);\r\n    function EditorHandlerCommand(id, handlerId, description) {\r\n        var _this = _super.call(this, {\r\n            id: id,\r\n            precondition: undefined,\r\n            description: description\r\n        }) || this;\r\n        _this._handlerId = handlerId;\r\n        return _this;\r\n    }\r\n    EditorHandlerCommand.prototype.runCommand = function (accessor, args) {\r\n        var editor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\r\n        if (!editor) {\r\n            return;\r\n        }\r\n        editor.trigger('keyboard', this._handlerId, args);\r\n    };\r\n    return EditorHandlerCommand;\r\n}(Command));\r\nregisterCommand(new EditorOrNativeTextInputCommand({\r\n    editorHandler: CoreNavigationCommands.SelectAll,\r\n    inputHandler: 'selectAll',\r\n    id: 'editor.action.selectAll',\r\n    precondition: EditorContextKeys.textInputFocus,\r\n    kbOpts: {\r\n        weight: CORE_WEIGHT,\r\n        kbExpr: null,\r\n        primary: 2048 /* CtrlCmd */ | 31 /* KEY_A */\r\n    },\r\n    menuOpts: {\r\n        menuId: 25 /* MenubarSelectionMenu */,\r\n        group: '1_basic',\r\n        title: nls.localize({ key: 'miSelectAll', comment: ['&& denotes a mnemonic'] }, \"&&Select All\"),\r\n        order: 1\r\n    }\r\n}));\r\nregisterCommand(new EditorOrNativeTextInputCommand({\r\n    editorHandler: Handler.Undo,\r\n    inputHandler: 'undo',\r\n    id: Handler.Undo,\r\n    precondition: EditorContextKeys.writable,\r\n    kbOpts: {\r\n        weight: CORE_WEIGHT,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 2048 /* CtrlCmd */ | 56 /* KEY_Z */\r\n    },\r\n    menuOpts: {\r\n        menuId: 17 /* MenubarEditMenu */,\r\n        group: '1_do',\r\n        title: nls.localize({ key: 'miUndo', comment: ['&& denotes a mnemonic'] }, \"&&Undo\"),\r\n        order: 1\r\n    }\r\n}));\r\nregisterCommand(new EditorHandlerCommand('default:' + Handler.Undo, Handler.Undo));\r\nregisterCommand(new EditorOrNativeTextInputCommand({\r\n    editorHandler: Handler.Redo,\r\n    inputHandler: 'redo',\r\n    id: Handler.Redo,\r\n    precondition: EditorContextKeys.writable,\r\n    kbOpts: {\r\n        weight: CORE_WEIGHT,\r\n        kbExpr: EditorContextKeys.textInputFocus,\r\n        primary: 2048 /* CtrlCmd */ | 55 /* KEY_Y */,\r\n        secondary: [2048 /* CtrlCmd */ | 1024 /* Shift */ | 56 /* KEY_Z */],\r\n        mac: { primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 56 /* KEY_Z */ }\r\n    },\r\n    menuOpts: {\r\n        menuId: 17 /* MenubarEditMenu */,\r\n        group: '1_do',\r\n        title: nls.localize({ key: 'miRedo', comment: ['&& denotes a mnemonic'] }, \"&&Redo\"),\r\n        order: 2\r\n    }\r\n}));\r\nregisterCommand(new EditorHandlerCommand('default:' + Handler.Redo, Handler.Redo));\r\nfunction registerOverwritableCommand(handlerId, description) {\r\n    registerCommand(new EditorHandlerCommand('default:' + handlerId, handlerId));\r\n    registerCommand(new EditorHandlerCommand(handlerId, handlerId, description));\r\n}\r\nregisterOverwritableCommand(Handler.Type, {\r\n    description: \"Type\",\r\n    args: [{\r\n            name: 'args',\r\n            schema: {\r\n                'type': 'object',\r\n                'required': ['text'],\r\n                'properties': {\r\n                    'text': {\r\n                        'type': 'string'\r\n                    }\r\n                },\r\n            }\r\n        }]\r\n});\r\nregisterOverwritableCommand(Handler.ReplacePreviousChar);\r\nregisterOverwritableCommand(Handler.CompositionStart);\r\nregisterOverwritableCommand(Handler.CompositionEnd);\r\nregisterOverwritableCommand(Handler.Paste);\r\nregisterOverwritableCommand(Handler.Cut);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './textAreaHandler.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport { createFastDomNode } from '../../../base/browser/fastDomNode.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { Configuration } from '../config/configuration.js';\r\nimport { CopyOptions, TextAreaInput } from './textAreaInput.js';\r\nimport { PagedScreenReaderStrategy, TextAreaState } from './textAreaState.js';\r\nimport { PartFingerprints, ViewPart } from '../view/viewPart.js';\r\nimport { LineNumbersOverlay } from '../viewParts/lineNumbers/lineNumbers.js';\r\nimport { Margin } from '../viewParts/margin/margin.js';\r\nimport { EditorOptions } from '../../common/config/editorOptions.js';\r\nimport { getMapForWordSeparators } from '../../common/controller/wordCharacterClassifier.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport * as viewEvents from '../../common/view/viewEvents.js';\r\nvar VisibleTextAreaData = /** @class */ (function () {\r\n    function VisibleTextAreaData(top, left, width) {\r\n        this.top = top;\r\n        this.left = left;\r\n        this.width = width;\r\n    }\r\n    VisibleTextAreaData.prototype.setWidth = function (width) {\r\n        return new VisibleTextAreaData(this.top, this.left, width);\r\n    };\r\n    return VisibleTextAreaData;\r\n}());\r\nvar canUseZeroSizeTextarea = (browser.isEdgeOrIE || browser.isFirefox);\r\nvar TextAreaHandler = /** @class */ (function (_super) {\r\n    __extends(TextAreaHandler, _super);\r\n    function TextAreaHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this, context) || this;\r\n        // --- end view API\r\n        _this._primaryCursorPosition = new Position(1, 1);\r\n        _this._primaryCursorVisibleRange = null;\r\n        _this._viewController = viewController;\r\n        _this._viewHelper = viewHelper;\r\n        _this._scrollLeft = 0;\r\n        _this._scrollTop = 0;\r\n        var options = _this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        _this._setAccessibilityOptions(options);\r\n        _this._contentLeft = layoutInfo.contentLeft;\r\n        _this._contentWidth = layoutInfo.contentWidth;\r\n        _this._contentHeight = layoutInfo.height;\r\n        _this._fontInfo = options.get(34 /* fontInfo */);\r\n        _this._lineHeight = options.get(49 /* lineHeight */);\r\n        _this._emptySelectionClipboard = options.get(25 /* emptySelectionClipboard */);\r\n        _this._copyWithSyntaxHighlighting = options.get(15 /* copyWithSyntaxHighlighting */);\r\n        _this._visibleTextArea = null;\r\n        _this._selections = [new Selection(1, 1, 1, 1)];\r\n        _this._modelSelections = [new Selection(1, 1, 1, 1)];\r\n        _this._lastRenderPosition = null;\r\n        // Text Area (The focus will always be in the textarea when the cursor is blinking)\r\n        _this.textArea = createFastDomNode(document.createElement('textarea'));\r\n        PartFingerprints.write(_this.textArea, 6 /* TextArea */);\r\n        _this.textArea.setClassName('inputarea');\r\n        _this.textArea.setAttribute('wrap', 'off');\r\n        _this.textArea.setAttribute('autocorrect', 'off');\r\n        _this.textArea.setAttribute('autocapitalize', 'off');\r\n        _this.textArea.setAttribute('autocomplete', 'off');\r\n        _this.textArea.setAttribute('spellcheck', 'false');\r\n        _this.textArea.setAttribute('aria-label', _this._getAriaLabel(options));\r\n        _this.textArea.setAttribute('role', 'textbox');\r\n        _this.textArea.setAttribute('aria-multiline', 'true');\r\n        _this.textArea.setAttribute('aria-haspopup', 'false');\r\n        _this.textArea.setAttribute('aria-autocomplete', 'both');\r\n        if (platform.isWeb && options.get(68 /* readOnly */)) {\r\n            _this.textArea.setAttribute('readonly', 'true');\r\n        }\r\n        _this.textAreaCover = createFastDomNode(document.createElement('div'));\r\n        _this.textAreaCover.setPosition('absolute');\r\n        var simpleModel = {\r\n            getLineCount: function () {\r\n                return _this._context.model.getLineCount();\r\n            },\r\n            getLineMaxColumn: function (lineNumber) {\r\n                return _this._context.model.getLineMaxColumn(lineNumber);\r\n            },\r\n            getValueInRange: function (range, eol) {\r\n                return _this._context.model.getValueInRange(range, eol);\r\n            }\r\n        };\r\n        var textAreaInputHost = {\r\n            getDataToCopy: function (generateHTML) {\r\n                var rawTextToCopy = _this._context.model.getPlainTextToCopy(_this._modelSelections, _this._emptySelectionClipboard, platform.isWindows);\r\n                var newLineCharacter = _this._context.model.getEOL();\r\n                var isFromEmptySelection = (_this._emptySelectionClipboard && _this._modelSelections.length === 1 && _this._modelSelections[0].isEmpty());\r\n                var multicursorText = (Array.isArray(rawTextToCopy) ? rawTextToCopy : null);\r\n                var text = (Array.isArray(rawTextToCopy) ? rawTextToCopy.join(newLineCharacter) : rawTextToCopy);\r\n                var html = undefined;\r\n                var mode = null;\r\n                if (generateHTML) {\r\n                    if (CopyOptions.forceCopyWithSyntaxHighlighting || (_this._copyWithSyntaxHighlighting && text.length < 65536)) {\r\n                        var richText = _this._context.model.getRichTextToCopy(_this._modelSelections, _this._emptySelectionClipboard);\r\n                        if (richText) {\r\n                            html = richText.html;\r\n                            mode = richText.mode;\r\n                        }\r\n                    }\r\n                }\r\n                return {\r\n                    isFromEmptySelection: isFromEmptySelection,\r\n                    multicursorText: multicursorText,\r\n                    text: text,\r\n                    html: html,\r\n                    mode: mode\r\n                };\r\n            },\r\n            getScreenReaderContent: function (currentState) {\r\n                if (browser.isIPad) {\r\n                    // Do not place anything in the textarea for the iPad\r\n                    return TextAreaState.EMPTY;\r\n                }\r\n                if (_this._accessibilitySupport === 1 /* Disabled */) {\r\n                    // We know for a fact that a screen reader is not attached\r\n                    // On OSX, we write the character before the cursor to allow for \"long-press\" composition\r\n                    // Also on OSX, we write the word before the cursor to allow for the Accessibility Keyboard to give good hints\r\n                    if (platform.isMacintosh) {\r\n                        var selection = _this._selections[0];\r\n                        if (selection.isEmpty()) {\r\n                            var position = selection.getStartPosition();\r\n                            var textBefore = _this._getWordBeforePosition(position);\r\n                            if (textBefore.length === 0) {\r\n                                textBefore = _this._getCharacterBeforePosition(position);\r\n                            }\r\n                            if (textBefore.length > 0) {\r\n                                return new TextAreaState(textBefore, textBefore.length, textBefore.length, position, position);\r\n                            }\r\n                        }\r\n                    }\r\n                    return TextAreaState.EMPTY;\r\n                }\r\n                return PagedScreenReaderStrategy.fromEditorSelection(currentState, simpleModel, _this._selections[0], _this._accessibilityPageSize, _this._accessibilitySupport === 0 /* Unknown */);\r\n            },\r\n            deduceModelPosition: function (viewAnchorPosition, deltaOffset, lineFeedCnt) {\r\n                return _this._context.model.deduceModelPositionRelativeToViewPosition(viewAnchorPosition, deltaOffset, lineFeedCnt);\r\n            }\r\n        };\r\n        _this._textAreaInput = _this._register(new TextAreaInput(textAreaInputHost, _this.textArea));\r\n        _this._register(_this._textAreaInput.onKeyDown(function (e) {\r\n            _this._viewController.emitKeyDown(e);\r\n        }));\r\n        _this._register(_this._textAreaInput.onKeyUp(function (e) {\r\n            _this._viewController.emitKeyUp(e);\r\n        }));\r\n        _this._register(_this._textAreaInput.onPaste(function (e) {\r\n            var pasteOnNewLine = false;\r\n            var multicursorText = null;\r\n            var mode = null;\r\n            if (e.metadata) {\r\n                pasteOnNewLine = (_this._emptySelectionClipboard && !!e.metadata.isFromEmptySelection);\r\n                multicursorText = (typeof e.metadata.multicursorText !== 'undefined' ? e.metadata.multicursorText : null);\r\n                mode = e.metadata.mode;\r\n            }\r\n            _this._viewController.paste('keyboard', e.text, pasteOnNewLine, multicursorText, mode);\r\n        }));\r\n        _this._register(_this._textAreaInput.onCut(function () {\r\n            _this._viewController.cut('keyboard');\r\n        }));\r\n        _this._register(_this._textAreaInput.onType(function (e) {\r\n            if (e.replaceCharCnt) {\r\n                _this._viewController.replacePreviousChar('keyboard', e.text, e.replaceCharCnt);\r\n            }\r\n            else {\r\n                _this._viewController.type('keyboard', e.text);\r\n            }\r\n        }));\r\n        _this._register(_this._textAreaInput.onSelectionChangeRequest(function (modelSelection) {\r\n            _this._viewController.setSelection('keyboard', modelSelection);\r\n        }));\r\n        _this._register(_this._textAreaInput.onCompositionStart(function () {\r\n            var lineNumber = _this._selections[0].startLineNumber;\r\n            var column = _this._selections[0].startColumn;\r\n            _this._context.privateViewEventBus.emit(new viewEvents.ViewRevealRangeRequestEvent('keyboard', new Range(lineNumber, column, lineNumber, column), 0 /* Simple */, true, 1 /* Immediate */));\r\n            // Find range pixel position\r\n            var visibleRange = _this._viewHelper.visibleRangeForPositionRelativeToEditor(lineNumber, column);\r\n            if (visibleRange) {\r\n                _this._visibleTextArea = new VisibleTextAreaData(_this._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber), visibleRange.left, canUseZeroSizeTextarea ? 0 : 1);\r\n                _this._render();\r\n            }\r\n            // Show the textarea\r\n            _this.textArea.setClassName('inputarea ime-input');\r\n            _this._viewController.compositionStart('keyboard');\r\n        }));\r\n        _this._register(_this._textAreaInput.onCompositionUpdate(function (e) {\r\n            if (browser.isEdgeOrIE) {\r\n                // Due to isEdgeOrIE (where the textarea was not cleared initially)\r\n                // we cannot assume the text consists only of the composited text\r\n                _this._visibleTextArea = _this._visibleTextArea.setWidth(0);\r\n            }\r\n            else {\r\n                // adjust width by its size\r\n                _this._visibleTextArea = _this._visibleTextArea.setWidth(measureText(e.data, _this._fontInfo));\r\n            }\r\n            _this._render();\r\n        }));\r\n        _this._register(_this._textAreaInput.onCompositionEnd(function () {\r\n            _this._visibleTextArea = null;\r\n            _this._render();\r\n            _this.textArea.setClassName('inputarea');\r\n            _this._viewController.compositionEnd('keyboard');\r\n        }));\r\n        _this._register(_this._textAreaInput.onFocus(function () {\r\n            _this._context.privateViewEventBus.emit(new viewEvents.ViewFocusChangedEvent(true));\r\n        }));\r\n        _this._register(_this._textAreaInput.onBlur(function () {\r\n            _this._context.privateViewEventBus.emit(new viewEvents.ViewFocusChangedEvent(false));\r\n        }));\r\n        return _this;\r\n    }\r\n    TextAreaHandler.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    TextAreaHandler.prototype._getWordBeforePosition = function (position) {\r\n        var lineContent = this._context.model.getLineContent(position.lineNumber);\r\n        var wordSeparators = getMapForWordSeparators(this._context.configuration.options.get(96 /* wordSeparators */));\r\n        var column = position.column;\r\n        var distance = 0;\r\n        while (column > 1) {\r\n            var charCode = lineContent.charCodeAt(column - 2);\r\n            var charClass = wordSeparators.get(charCode);\r\n            if (charClass !== 0 /* Regular */ || distance > 50) {\r\n                return lineContent.substring(column - 1, position.column - 1);\r\n            }\r\n            distance++;\r\n            column--;\r\n        }\r\n        return lineContent.substring(0, position.column - 1);\r\n    };\r\n    TextAreaHandler.prototype._getCharacterBeforePosition = function (position) {\r\n        if (position.column > 1) {\r\n            var lineContent = this._context.model.getLineContent(position.lineNumber);\r\n            var charBefore = lineContent.charAt(position.column - 2);\r\n            if (!strings.isHighSurrogate(charBefore.charCodeAt(0))) {\r\n                return charBefore;\r\n            }\r\n        }\r\n        return '';\r\n    };\r\n    TextAreaHandler.prototype._getAriaLabel = function (options) {\r\n        var accessibilitySupport = options.get(2 /* accessibilitySupport */);\r\n        if (accessibilitySupport === 1 /* Disabled */) {\r\n            return nls.localize('accessibilityOffAriaLabel', \"The editor is not accessible at this time. Press Alt+F1 for options.\");\r\n        }\r\n        return options.get(4 /* ariaLabel */);\r\n    };\r\n    TextAreaHandler.prototype._setAccessibilityOptions = function (options) {\r\n        this._accessibilitySupport = options.get(2 /* accessibilitySupport */);\r\n        var accessibilityPageSize = options.get(3 /* accessibilityPageSize */);\r\n        if (this._accessibilitySupport === 2 /* Enabled */ && accessibilityPageSize === EditorOptions.accessibilityPageSize.defaultValue) {\r\n            // If a screen reader is attached and the default value is not set we shuold automatically increase the page size to 160 for a better experience\r\n            // If we put more than 160 lines the nvda can not handle this https://github.com/microsoft/vscode/issues/89717\r\n            this._accessibilityPageSize = 160;\r\n        }\r\n        else {\r\n            this._accessibilityPageSize = accessibilityPageSize;\r\n        }\r\n    };\r\n    // --- begin event handlers\r\n    TextAreaHandler.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        this._setAccessibilityOptions(options);\r\n        this._contentLeft = layoutInfo.contentLeft;\r\n        this._contentWidth = layoutInfo.contentWidth;\r\n        this._contentHeight = layoutInfo.height;\r\n        this._fontInfo = options.get(34 /* fontInfo */);\r\n        this._lineHeight = options.get(49 /* lineHeight */);\r\n        this._emptySelectionClipboard = options.get(25 /* emptySelectionClipboard */);\r\n        this._copyWithSyntaxHighlighting = options.get(15 /* copyWithSyntaxHighlighting */);\r\n        this.textArea.setAttribute('aria-label', this._getAriaLabel(options));\r\n        if (platform.isWeb && e.hasChanged(68 /* readOnly */)) {\r\n            if (options.get(68 /* readOnly */)) {\r\n                this.textArea.setAttribute('readonly', 'true');\r\n            }\r\n            else {\r\n                this.textArea.removeAttribute('readonly');\r\n            }\r\n        }\r\n        if (e.hasChanged(2 /* accessibilitySupport */)) {\r\n            this._textAreaInput.writeScreenReaderContent('strategy changed');\r\n        }\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onCursorStateChanged = function (e) {\r\n        this._selections = e.selections.slice(0);\r\n        this._modelSelections = e.modelSelections.slice(0);\r\n        this._textAreaInput.writeScreenReaderContent('selection changed');\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onDecorationsChanged = function (e) {\r\n        // true for inline decorations that can end up relayouting text\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onFlushed = function (e) {\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onLinesChanged = function (e) {\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onLinesDeleted = function (e) {\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onLinesInserted = function (e) {\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onScrollChanged = function (e) {\r\n        this._scrollLeft = e.scrollLeft;\r\n        this._scrollTop = e.scrollTop;\r\n        return true;\r\n    };\r\n    TextAreaHandler.prototype.onZonesChanged = function (e) {\r\n        return true;\r\n    };\r\n    // --- end event handlers\r\n    // --- begin view API\r\n    TextAreaHandler.prototype.isFocused = function () {\r\n        return this._textAreaInput.isFocused();\r\n    };\r\n    TextAreaHandler.prototype.focusTextArea = function () {\r\n        this._textAreaInput.focusTextArea();\r\n    };\r\n    TextAreaHandler.prototype.getLastRenderData = function () {\r\n        return this._lastRenderPosition;\r\n    };\r\n    TextAreaHandler.prototype.setAriaOptions = function (options) {\r\n        if (options.activeDescendant) {\r\n            this.textArea.setAttribute('aria-haspopup', 'true');\r\n            this.textArea.setAttribute('aria-autocomplete', 'list');\r\n            this.textArea.setAttribute('aria-activedescendant', options.activeDescendant);\r\n        }\r\n        else {\r\n            this.textArea.setAttribute('aria-haspopup', 'false');\r\n            this.textArea.setAttribute('aria-autocomplete', 'both');\r\n            this.textArea.removeAttribute('aria-activedescendant');\r\n        }\r\n    };\r\n    TextAreaHandler.prototype.prepareRender = function (ctx) {\r\n        this._primaryCursorPosition = new Position(this._selections[0].positionLineNumber, this._selections[0].positionColumn);\r\n        this._primaryCursorVisibleRange = ctx.visibleRangeForPosition(this._primaryCursorPosition);\r\n    };\r\n    TextAreaHandler.prototype.render = function (ctx) {\r\n        this._textAreaInput.writeScreenReaderContent('render');\r\n        this._render();\r\n    };\r\n    TextAreaHandler.prototype._render = function () {\r\n        if (this._visibleTextArea) {\r\n            // The text area is visible for composition reasons\r\n            this._renderInsideEditor(null, this._visibleTextArea.top - this._scrollTop, this._contentLeft + this._visibleTextArea.left - this._scrollLeft, this._visibleTextArea.width, this._lineHeight);\r\n            return;\r\n        }\r\n        if (!this._primaryCursorVisibleRange) {\r\n            // The primary cursor is outside the viewport => place textarea to the top left\r\n            this._renderAtTopLeft();\r\n            return;\r\n        }\r\n        var left = this._contentLeft + this._primaryCursorVisibleRange.left - this._scrollLeft;\r\n        if (left < this._contentLeft || left > this._contentLeft + this._contentWidth) {\r\n            // cursor is outside the viewport\r\n            this._renderAtTopLeft();\r\n            return;\r\n        }\r\n        var top = this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber) - this._scrollTop;\r\n        if (top < 0 || top > this._contentHeight) {\r\n            // cursor is outside the viewport\r\n            this._renderAtTopLeft();\r\n            return;\r\n        }\r\n        // The primary cursor is in the viewport (at least vertically) => place textarea on the cursor\r\n        if (platform.isMacintosh) {\r\n            // For the popup emoji input, we will make the text area as high as the line height\r\n            // We will also make the fontSize and lineHeight the correct dimensions to help with the placement of these pickers\r\n            this._renderInsideEditor(this._primaryCursorPosition, top, left, canUseZeroSizeTextarea ? 0 : 1, this._lineHeight);\r\n            return;\r\n        }\r\n        this._renderInsideEditor(this._primaryCursorPosition, top, left, canUseZeroSizeTextarea ? 0 : 1, canUseZeroSizeTextarea ? 0 : 1);\r\n    };\r\n    TextAreaHandler.prototype._renderInsideEditor = function (renderedPosition, top, left, width, height) {\r\n        this._lastRenderPosition = renderedPosition;\r\n        var ta = this.textArea;\r\n        var tac = this.textAreaCover;\r\n        Configuration.applyFontInfo(ta, this._fontInfo);\r\n        ta.setTop(top);\r\n        ta.setLeft(left);\r\n        ta.setWidth(width);\r\n        ta.setHeight(height);\r\n        tac.setTop(0);\r\n        tac.setLeft(0);\r\n        tac.setWidth(0);\r\n        tac.setHeight(0);\r\n    };\r\n    TextAreaHandler.prototype._renderAtTopLeft = function () {\r\n        this._lastRenderPosition = null;\r\n        var ta = this.textArea;\r\n        var tac = this.textAreaCover;\r\n        Configuration.applyFontInfo(ta, this._fontInfo);\r\n        ta.setTop(0);\r\n        ta.setLeft(0);\r\n        tac.setTop(0);\r\n        tac.setLeft(0);\r\n        if (canUseZeroSizeTextarea) {\r\n            ta.setWidth(0);\r\n            ta.setHeight(0);\r\n            tac.setWidth(0);\r\n            tac.setHeight(0);\r\n            return;\r\n        }\r\n        // (in WebKit the textarea is 1px by 1px because it cannot handle input to a 0x0 textarea)\r\n        // specifically, when doing Korean IME, setting the textarea to 0x0 breaks IME badly.\r\n        ta.setWidth(1);\r\n        ta.setHeight(1);\r\n        tac.setWidth(1);\r\n        tac.setHeight(1);\r\n        var options = this._context.configuration.options;\r\n        if (options.get(40 /* glyphMargin */)) {\r\n            tac.setClassName('monaco-editor-background textAreaCover ' + Margin.OUTER_CLASS_NAME);\r\n        }\r\n        else {\r\n            if (options.get(50 /* lineNumbers */).renderType !== 0 /* Off */) {\r\n                tac.setClassName('monaco-editor-background textAreaCover ' + LineNumbersOverlay.CLASS_NAME);\r\n            }\r\n            else {\r\n                tac.setClassName('monaco-editor-background textAreaCover');\r\n            }\r\n        }\r\n    };\r\n    return TextAreaHandler;\r\n}(ViewPart));\r\nexport { TextAreaHandler };\r\nfunction measureText(text, fontInfo) {\r\n    // adjust width by its size\r\n    var canvasElem = document.createElement('canvas');\r\n    var context = canvasElem.getContext('2d');\r\n    context.font = createFontString(fontInfo);\r\n    var metrics = context.measureText(text);\r\n    if (browser.isFirefox) {\r\n        return metrics.width + 2; // +2 for Japanese...\r\n    }\r\n    else {\r\n        return metrics.width;\r\n    }\r\n}\r\nfunction createFontString(bareFontInfo) {\r\n    return doCreateFontString('normal', bareFontInfo.fontWeight, bareFontInfo.fontSize, bareFontInfo.lineHeight, bareFontInfo.fontFamily);\r\n}\r\nfunction doCreateFontString(fontStyle, fontWeight, fontSize, lineHeight, fontFamily) {\r\n    // The full font syntax is:\r\n    // style | variant | weight | stretch | size/line-height | fontFamily\r\n    // (https://developer.mozilla.org/en-US/docs/Web/CSS/font)\r\n    // But it appears Edge and IE11 cannot properly parse `stretch`.\r\n    return fontStyle + \" normal \" + fontWeight + \" \" + fontSize + \"px / \" + lineHeight + \"px \" + fontFamily;\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { RunOnceScheduler } from '../../../base/common/async.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { TextAreaState } from './textAreaState.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { BrowserFeatures } from '../../../base/browser/canIUse.js';\r\nexport var CopyOptions = {\r\n    forceCopyWithSyntaxHighlighting: false\r\n};\r\n/**\r\n * Every time we write to the clipboard, we record a bit of extra metadata here.\r\n * Every time we read from the cipboard, if the text matches our last written text,\r\n * we can fetch the previous metadata.\r\n */\r\nvar InMemoryClipboardMetadataManager = /** @class */ (function () {\r\n    function InMemoryClipboardMetadataManager() {\r\n        this._lastState = null;\r\n    }\r\n    InMemoryClipboardMetadataManager.prototype.set = function (lastCopiedValue, data) {\r\n        this._lastState = { lastCopiedValue: lastCopiedValue, data: data };\r\n    };\r\n    InMemoryClipboardMetadataManager.prototype.get = function (pastedText) {\r\n        if (this._lastState && this._lastState.lastCopiedValue === pastedText) {\r\n            // match!\r\n            return this._lastState.data;\r\n        }\r\n        this._lastState = null;\r\n        return null;\r\n    };\r\n    InMemoryClipboardMetadataManager.INSTANCE = new InMemoryClipboardMetadataManager();\r\n    return InMemoryClipboardMetadataManager;\r\n}());\r\n/**\r\n * Writes screen reader content to the textarea and is able to analyze its input events to generate:\r\n *  - onCut\r\n *  - onPaste\r\n *  - onType\r\n *\r\n * Composition events are generated for presentation purposes (composition input is reflected in onType).\r\n */\r\nvar TextAreaInput = /** @class */ (function (_super) {\r\n    __extends(TextAreaInput, _super);\r\n    function TextAreaInput(host, textArea) {\r\n        var _this = _super.call(this) || this;\r\n        _this.textArea = textArea;\r\n        _this._onFocus = _this._register(new Emitter());\r\n        _this.onFocus = _this._onFocus.event;\r\n        _this._onBlur = _this._register(new Emitter());\r\n        _this.onBlur = _this._onBlur.event;\r\n        _this._onKeyDown = _this._register(new Emitter());\r\n        _this.onKeyDown = _this._onKeyDown.event;\r\n        _this._onKeyUp = _this._register(new Emitter());\r\n        _this.onKeyUp = _this._onKeyUp.event;\r\n        _this._onCut = _this._register(new Emitter());\r\n        _this.onCut = _this._onCut.event;\r\n        _this._onPaste = _this._register(new Emitter());\r\n        _this.onPaste = _this._onPaste.event;\r\n        _this._onType = _this._register(new Emitter());\r\n        _this.onType = _this._onType.event;\r\n        _this._onCompositionStart = _this._register(new Emitter());\r\n        _this.onCompositionStart = _this._onCompositionStart.event;\r\n        _this._onCompositionUpdate = _this._register(new Emitter());\r\n        _this.onCompositionUpdate = _this._onCompositionUpdate.event;\r\n        _this._onCompositionEnd = _this._register(new Emitter());\r\n        _this.onCompositionEnd = _this._onCompositionEnd.event;\r\n        _this._onSelectionChangeRequest = _this._register(new Emitter());\r\n        _this.onSelectionChangeRequest = _this._onSelectionChangeRequest.event;\r\n        _this._host = host;\r\n        _this._textArea = _this._register(new TextAreaWrapper(textArea));\r\n        _this._asyncTriggerCut = _this._register(new RunOnceScheduler(function () { return _this._onCut.fire(); }, 0));\r\n        _this._textAreaState = TextAreaState.EMPTY;\r\n        _this._selectionChangeListener = null;\r\n        _this.writeScreenReaderContent('ctor');\r\n        _this._hasFocus = false;\r\n        _this._isDoingComposition = false;\r\n        _this._nextCommand = 0 /* Type */;\r\n        _this._register(dom.addStandardDisposableListener(textArea.domNode, 'keydown', function (e) {\r\n            if (_this._isDoingComposition &&\r\n                (e.keyCode === 109 /* KEY_IN_COMPOSITION */ || e.keyCode === 1 /* Backspace */)) {\r\n                // Stop propagation for keyDown events if the IME is processing key input\r\n                e.stopPropagation();\r\n            }\r\n            if (e.equals(9 /* Escape */)) {\r\n                // Prevent default always for `Esc`, otherwise it will generate a keypress\r\n                // See https://msdn.microsoft.com/en-us/library/ie/ms536939(v=vs.85).aspx\r\n                e.preventDefault();\r\n            }\r\n            _this._onKeyDown.fire(e);\r\n        }));\r\n        _this._register(dom.addStandardDisposableListener(textArea.domNode, 'keyup', function (e) {\r\n            _this._onKeyUp.fire(e);\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'compositionstart', function (e) {\r\n            if (_this._isDoingComposition) {\r\n                return;\r\n            }\r\n            _this._isDoingComposition = true;\r\n            // In IE we cannot set .value when handling 'compositionstart' because the entire composition will get canceled.\r\n            if (!browser.isEdgeOrIE) {\r\n                _this._setAndWriteTextAreaState('compositionstart', TextAreaState.EMPTY);\r\n            }\r\n            _this._onCompositionStart.fire();\r\n        }));\r\n        /**\r\n         * Deduce the typed input from a text area's value and the last observed state.\r\n         */\r\n        var deduceInputFromTextAreaValue = function (couldBeEmojiInput) {\r\n            var oldState = _this._textAreaState;\r\n            var newState = TextAreaState.readFromTextArea(_this._textArea);\r\n            return [newState, TextAreaState.deduceInput(oldState, newState, couldBeEmojiInput)];\r\n        };\r\n        /**\r\n         * Deduce the composition input from a string.\r\n         */\r\n        var deduceComposition = function (text) {\r\n            var oldState = _this._textAreaState;\r\n            var newState = TextAreaState.selectedText(text);\r\n            var typeInput = {\r\n                text: newState.value,\r\n                replaceCharCnt: oldState.selectionEnd - oldState.selectionStart\r\n            };\r\n            return [newState, typeInput];\r\n        };\r\n        var compositionDataInValid = function (locale) {\r\n            // https://github.com/Microsoft/monaco-editor/issues/339\r\n            // Multi-part Japanese compositions reset cursor in Edge/IE, Chinese and Korean IME don't have this issue.\r\n            // The reason that we can't use this path for all CJK IME is IE and Edge behave differently when handling Korean IME,\r\n            // which breaks this path of code.\r\n            if (browser.isEdgeOrIE && locale === 'ja') {\r\n                return true;\r\n            }\r\n            // https://github.com/Microsoft/monaco-editor/issues/545\r\n            // On IE11, we can't trust composition data when typing Chinese as IE11 doesn't emit correct\r\n            // events when users type numbers in IME.\r\n            // Chinese: zh-Hans-CN, zh-Hans-SG, zh-Hant-TW, zh-Hant-HK\r\n            if (browser.isIE && locale.indexOf('zh-Han') === 0) {\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'compositionupdate', function (e) {\r\n            if (compositionDataInValid(e.locale)) {\r\n                var _a = deduceInputFromTextAreaValue(/*couldBeEmojiInput*/ false), newState_1 = _a[0], typeInput_1 = _a[1];\r\n                _this._textAreaState = newState_1;\r\n                _this._onType.fire(typeInput_1);\r\n                _this._onCompositionUpdate.fire(e);\r\n                return;\r\n            }\r\n            var _b = deduceComposition(e.data), newState = _b[0], typeInput = _b[1];\r\n            _this._textAreaState = newState;\r\n            _this._onType.fire(typeInput);\r\n            _this._onCompositionUpdate.fire(e);\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'compositionend', function (e) {\r\n            // https://github.com/microsoft/monaco-editor/issues/1663\r\n            // On iOS 13.2, Chinese system IME randomly trigger an additional compositionend event with empty data\r\n            if (!_this._isDoingComposition) {\r\n                return;\r\n            }\r\n            if (compositionDataInValid(e.locale)) {\r\n                // https://github.com/Microsoft/monaco-editor/issues/339\r\n                var _a = deduceInputFromTextAreaValue(/*couldBeEmojiInput*/ false), newState = _a[0], typeInput = _a[1];\r\n                _this._textAreaState = newState;\r\n                _this._onType.fire(typeInput);\r\n            }\r\n            else {\r\n                var _b = deduceComposition(e.data), newState = _b[0], typeInput = _b[1];\r\n                _this._textAreaState = newState;\r\n                _this._onType.fire(typeInput);\r\n            }\r\n            // Due to isEdgeOrIE (where the textarea was not cleared initially) and isChrome (the textarea is not updated correctly when composition ends)\r\n            // we cannot assume the text at the end consists only of the composited text\r\n            if (browser.isEdgeOrIE || browser.isChrome) {\r\n                _this._textAreaState = TextAreaState.readFromTextArea(_this._textArea);\r\n            }\r\n            if (!_this._isDoingComposition) {\r\n                return;\r\n            }\r\n            _this._isDoingComposition = false;\r\n            _this._onCompositionEnd.fire();\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'input', function () {\r\n            // Pretend here we touched the text area, as the `input` event will most likely\r\n            // result in a `selectionchange` event which we want to ignore\r\n            _this._textArea.setIgnoreSelectionChangeTime('received input event');\r\n            if (_this._isDoingComposition) {\r\n                return;\r\n            }\r\n            var _a = deduceInputFromTextAreaValue(/*couldBeEmojiInput*/ platform.isMacintosh), newState = _a[0], typeInput = _a[1];\r\n            if (typeInput.replaceCharCnt === 0 && typeInput.text.length === 1 && strings.isHighSurrogate(typeInput.text.charCodeAt(0))) {\r\n                // Ignore invalid input but keep it around for next time\r\n                return;\r\n            }\r\n            _this._textAreaState = newState;\r\n            if (_this._nextCommand === 0 /* Type */) {\r\n                if (typeInput.text !== '') {\r\n                    _this._onType.fire(typeInput);\r\n                }\r\n            }\r\n            else {\r\n                if (typeInput.text !== '' || typeInput.replaceCharCnt !== 0) {\r\n                    _this._firePaste(typeInput.text, null);\r\n                }\r\n                _this._nextCommand = 0 /* Type */;\r\n            }\r\n        }));\r\n        // --- Clipboard operations\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'cut', function (e) {\r\n            // Pretend here we touched the text area, as the `cut` event will most likely\r\n            // result in a `selectionchange` event which we want to ignore\r\n            _this._textArea.setIgnoreSelectionChangeTime('received cut event');\r\n            _this._ensureClipboardGetsEditorSelection(e);\r\n            _this._asyncTriggerCut.schedule();\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'copy', function (e) {\r\n            _this._ensureClipboardGetsEditorSelection(e);\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'paste', function (e) {\r\n            // Pretend here we touched the text area, as the `paste` event will most likely\r\n            // result in a `selectionchange` event which we want to ignore\r\n            _this._textArea.setIgnoreSelectionChangeTime('received paste event');\r\n            if (ClipboardEventUtils.canUseTextData(e)) {\r\n                var _a = ClipboardEventUtils.getTextData(e), pastePlainText = _a[0], metadata = _a[1];\r\n                if (pastePlainText !== '') {\r\n                    _this._firePaste(pastePlainText, metadata);\r\n                }\r\n            }\r\n            else {\r\n                if (_this._textArea.getSelectionStart() !== _this._textArea.getSelectionEnd()) {\r\n                    // Clean up the textarea, to get a clean paste\r\n                    _this._setAndWriteTextAreaState('paste', TextAreaState.EMPTY);\r\n                }\r\n                _this._nextCommand = 1 /* Paste */;\r\n            }\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'focus', function () {\r\n            _this._setHasFocus(true);\r\n        }));\r\n        _this._register(dom.addDisposableListener(textArea.domNode, 'blur', function () {\r\n            _this._setHasFocus(false);\r\n        }));\r\n        return _this;\r\n    }\r\n    TextAreaInput.prototype._installSelectionChangeListener = function () {\r\n        // See https://github.com/Microsoft/vscode/issues/27216\r\n        // When using a Braille display, it is possible for users to reposition the\r\n        // system caret. This is reflected in Chrome as a `selectionchange` event.\r\n        //\r\n        // The `selectionchange` event appears to be emitted under numerous other circumstances,\r\n        // so it is quite a challenge to distinguish a `selectionchange` coming in from a user\r\n        // using a Braille display from all the other cases.\r\n        //\r\n        // The problems with the `selectionchange` event are:\r\n        //  * the event is emitted when the textarea is focused programmatically -- textarea.focus()\r\n        //  * the event is emitted when the selection is changed in the textarea programmatically -- textarea.setSelectionRange(...)\r\n        //  * the event is emitted when the value of the textarea is changed programmatically -- textarea.value = '...'\r\n        //  * the event is emitted when tabbing into the textarea\r\n        //  * the event is emitted asynchronously (sometimes with a delay as high as a few tens of ms)\r\n        //  * the event sometimes comes in bursts for a single logical textarea operation\r\n        var _this = this;\r\n        // `selectionchange` events often come multiple times for a single logical change\r\n        // so throttle multiple `selectionchange` events that burst in a short period of time.\r\n        var previousSelectionChangeEventTime = 0;\r\n        return dom.addDisposableListener(document, 'selectionchange', function (e) {\r\n            if (!_this._hasFocus) {\r\n                return;\r\n            }\r\n            if (_this._isDoingComposition) {\r\n                return;\r\n            }\r\n            if (!browser.isChrome || !platform.isWindows) {\r\n                // Support only for Chrome on Windows until testing happens on other browsers + OS configurations\r\n                return;\r\n            }\r\n            var now = Date.now();\r\n            var delta1 = now - previousSelectionChangeEventTime;\r\n            previousSelectionChangeEventTime = now;\r\n            if (delta1 < 5) {\r\n                // received another `selectionchange` event within 5ms of the previous `selectionchange` event\r\n                // => ignore it\r\n                return;\r\n            }\r\n            var delta2 = now - _this._textArea.getIgnoreSelectionChangeTime();\r\n            _this._textArea.resetSelectionChangeTime();\r\n            if (delta2 < 100) {\r\n                // received a `selectionchange` event within 100ms since we touched the textarea\r\n                // => ignore it, since we caused it\r\n                return;\r\n            }\r\n            if (!_this._textAreaState.selectionStartPosition || !_this._textAreaState.selectionEndPosition) {\r\n                // Cannot correlate a position in the textarea with a position in the editor...\r\n                return;\r\n            }\r\n            var newValue = _this._textArea.getValue();\r\n            if (_this._textAreaState.value !== newValue) {\r\n                // Cannot correlate a position in the textarea with a position in the editor...\r\n                return;\r\n            }\r\n            var newSelectionStart = _this._textArea.getSelectionStart();\r\n            var newSelectionEnd = _this._textArea.getSelectionEnd();\r\n            if (_this._textAreaState.selectionStart === newSelectionStart && _this._textAreaState.selectionEnd === newSelectionEnd) {\r\n                // Nothing to do...\r\n                return;\r\n            }\r\n            var _newSelectionStartPosition = _this._textAreaState.deduceEditorPosition(newSelectionStart);\r\n            var newSelectionStartPosition = _this._host.deduceModelPosition(_newSelectionStartPosition[0], _newSelectionStartPosition[1], _newSelectionStartPosition[2]);\r\n            var _newSelectionEndPosition = _this._textAreaState.deduceEditorPosition(newSelectionEnd);\r\n            var newSelectionEndPosition = _this._host.deduceModelPosition(_newSelectionEndPosition[0], _newSelectionEndPosition[1], _newSelectionEndPosition[2]);\r\n            var newSelection = new Selection(newSelectionStartPosition.lineNumber, newSelectionStartPosition.column, newSelectionEndPosition.lineNumber, newSelectionEndPosition.column);\r\n            _this._onSelectionChangeRequest.fire(newSelection);\r\n        });\r\n    };\r\n    TextAreaInput.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        if (this._selectionChangeListener) {\r\n            this._selectionChangeListener.dispose();\r\n            this._selectionChangeListener = null;\r\n        }\r\n    };\r\n    TextAreaInput.prototype.focusTextArea = function () {\r\n        // Setting this._hasFocus and writing the screen reader content\r\n        // will result in a focus() and setSelectionRange() in the textarea\r\n        this._setHasFocus(true);\r\n        // If the editor is off DOM, focus cannot be really set, so let's double check that we have managed to set the focus\r\n        this.refreshFocusState();\r\n    };\r\n    TextAreaInput.prototype.isFocused = function () {\r\n        return this._hasFocus;\r\n    };\r\n    TextAreaInput.prototype.refreshFocusState = function () {\r\n        var shadowRoot = dom.getShadowRoot(this.textArea.domNode);\r\n        if (shadowRoot) {\r\n            this._setHasFocus(shadowRoot.activeElement === this.textArea.domNode);\r\n        }\r\n        else if (dom.isInDOM(this.textArea.domNode)) {\r\n            this._setHasFocus(document.activeElement === this.textArea.domNode);\r\n        }\r\n        else {\r\n            this._setHasFocus(false);\r\n        }\r\n    };\r\n    TextAreaInput.prototype._setHasFocus = function (newHasFocus) {\r\n        if (this._hasFocus === newHasFocus) {\r\n            // no change\r\n            return;\r\n        }\r\n        this._hasFocus = newHasFocus;\r\n        if (this._selectionChangeListener) {\r\n            this._selectionChangeListener.dispose();\r\n            this._selectionChangeListener = null;\r\n        }\r\n        if (this._hasFocus) {\r\n            this._selectionChangeListener = this._installSelectionChangeListener();\r\n        }\r\n        if (this._hasFocus) {\r\n            if (browser.isEdge) {\r\n                // Edge has a bug where setting the selection range while the focus event\r\n                // is dispatching doesn't work. To reproduce, \"tab into\" the editor.\r\n                this._setAndWriteTextAreaState('focusgain', TextAreaState.EMPTY);\r\n            }\r\n            else {\r\n                this.writeScreenReaderContent('focusgain');\r\n            }\r\n        }\r\n        if (this._hasFocus) {\r\n            this._onFocus.fire();\r\n        }\r\n        else {\r\n            this._onBlur.fire();\r\n        }\r\n    };\r\n    TextAreaInput.prototype._setAndWriteTextAreaState = function (reason, textAreaState) {\r\n        if (!this._hasFocus) {\r\n            textAreaState = textAreaState.collapseSelection();\r\n        }\r\n        textAreaState.writeToTextArea(reason, this._textArea, this._hasFocus);\r\n        this._textAreaState = textAreaState;\r\n    };\r\n    TextAreaInput.prototype.writeScreenReaderContent = function (reason) {\r\n        if (this._isDoingComposition) {\r\n            // Do not write to the text area when doing composition\r\n            return;\r\n        }\r\n        this._setAndWriteTextAreaState(reason, this._host.getScreenReaderContent(this._textAreaState));\r\n    };\r\n    TextAreaInput.prototype._ensureClipboardGetsEditorSelection = function (e) {\r\n        var dataToCopy = this._host.getDataToCopy(ClipboardEventUtils.canUseTextData(e) && BrowserFeatures.clipboard.richText);\r\n        var storedMetadata = {\r\n            version: 1,\r\n            isFromEmptySelection: dataToCopy.isFromEmptySelection,\r\n            multicursorText: dataToCopy.multicursorText,\r\n            mode: dataToCopy.mode\r\n        };\r\n        InMemoryClipboardMetadataManager.INSTANCE.set(\r\n        // When writing \"LINE\\r\\n\" to the clipboard and then pasting,\r\n        // Firefox pastes \"LINE\\n\", so let's work around this quirk\r\n        (browser.isFirefox ? dataToCopy.text.replace(/\\r\\n/g, '\\n') : dataToCopy.text), storedMetadata);\r\n        if (!ClipboardEventUtils.canUseTextData(e)) {\r\n            // Looks like an old browser. The strategy is to place the text\r\n            // we'd like to be copied to the clipboard in the textarea and select it.\r\n            this._setAndWriteTextAreaState('copy or cut', TextAreaState.selectedText(dataToCopy.text));\r\n            return;\r\n        }\r\n        ClipboardEventUtils.setTextData(e, dataToCopy.text, dataToCopy.html, storedMetadata);\r\n    };\r\n    TextAreaInput.prototype._firePaste = function (text, metadata) {\r\n        if (!metadata) {\r\n            // try the in-memory store\r\n            metadata = InMemoryClipboardMetadataManager.INSTANCE.get(text);\r\n        }\r\n        this._onPaste.fire({\r\n            text: text,\r\n            metadata: metadata\r\n        });\r\n    };\r\n    return TextAreaInput;\r\n}(Disposable));\r\nexport { TextAreaInput };\r\nvar ClipboardEventUtils = /** @class */ (function () {\r\n    function ClipboardEventUtils() {\r\n    }\r\n    ClipboardEventUtils.canUseTextData = function (e) {\r\n        if (e.clipboardData) {\r\n            return true;\r\n        }\r\n        if (window.clipboardData) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    ClipboardEventUtils.getTextData = function (e) {\r\n        if (e.clipboardData) {\r\n            e.preventDefault();\r\n            var text = e.clipboardData.getData('text/plain');\r\n            var metadata = null;\r\n            var rawmetadata = e.clipboardData.getData('vscode-editor-data');\r\n            if (typeof rawmetadata === 'string') {\r\n                try {\r\n                    metadata = JSON.parse(rawmetadata);\r\n                    if (metadata.version !== 1) {\r\n                        metadata = null;\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    // no problem!\r\n                }\r\n            }\r\n            return [text, metadata];\r\n        }\r\n        if (window.clipboardData) {\r\n            e.preventDefault();\r\n            var text = window.clipboardData.getData('Text');\r\n            return [text, null];\r\n        }\r\n        throw new Error('ClipboardEventUtils.getTextData: Cannot use text data!');\r\n    };\r\n    ClipboardEventUtils.setTextData = function (e, text, html, metadata) {\r\n        if (e.clipboardData) {\r\n            e.clipboardData.setData('text/plain', text);\r\n            if (typeof html === 'string') {\r\n                e.clipboardData.setData('text/html', html);\r\n            }\r\n            e.clipboardData.setData('vscode-editor-data', JSON.stringify(metadata));\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (window.clipboardData) {\r\n            window.clipboardData.setData('Text', text);\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        throw new Error('ClipboardEventUtils.setTextData: Cannot use text data!');\r\n    };\r\n    return ClipboardEventUtils;\r\n}());\r\nvar TextAreaWrapper = /** @class */ (function (_super) {\r\n    __extends(TextAreaWrapper, _super);\r\n    function TextAreaWrapper(_textArea) {\r\n        var _this = _super.call(this) || this;\r\n        _this._actual = _textArea;\r\n        _this._ignoreSelectionChangeTime = 0;\r\n        return _this;\r\n    }\r\n    TextAreaWrapper.prototype.setIgnoreSelectionChangeTime = function (reason) {\r\n        this._ignoreSelectionChangeTime = Date.now();\r\n    };\r\n    TextAreaWrapper.prototype.getIgnoreSelectionChangeTime = function () {\r\n        return this._ignoreSelectionChangeTime;\r\n    };\r\n    TextAreaWrapper.prototype.resetSelectionChangeTime = function () {\r\n        this._ignoreSelectionChangeTime = 0;\r\n    };\r\n    TextAreaWrapper.prototype.getValue = function () {\r\n        // console.log('current value: ' + this._textArea.value);\r\n        return this._actual.domNode.value;\r\n    };\r\n    TextAreaWrapper.prototype.setValue = function (reason, value) {\r\n        var textArea = this._actual.domNode;\r\n        if (textArea.value === value) {\r\n            // No change\r\n            return;\r\n        }\r\n        // console.log('reason: ' + reason + ', current value: ' + textArea.value + ' => new value: ' + value);\r\n        this.setIgnoreSelectionChangeTime('setValue');\r\n        textArea.value = value;\r\n    };\r\n    TextAreaWrapper.prototype.getSelectionStart = function () {\r\n        return this._actual.domNode.selectionStart;\r\n    };\r\n    TextAreaWrapper.prototype.getSelectionEnd = function () {\r\n        return this._actual.domNode.selectionEnd;\r\n    };\r\n    TextAreaWrapper.prototype.setSelectionRange = function (reason, selectionStart, selectionEnd) {\r\n        var textArea = this._actual.domNode;\r\n        var activeElement = null;\r\n        var shadowRoot = dom.getShadowRoot(textArea);\r\n        if (shadowRoot) {\r\n            activeElement = shadowRoot.activeElement;\r\n        }\r\n        else {\r\n            activeElement = document.activeElement;\r\n        }\r\n        var currentIsFocused = (activeElement === textArea);\r\n        var currentSelectionStart = textArea.selectionStart;\r\n        var currentSelectionEnd = textArea.selectionEnd;\r\n        if (currentIsFocused && currentSelectionStart === selectionStart && currentSelectionEnd === selectionEnd) {\r\n            // No change\r\n            // Firefox iframe bug https://github.com/Microsoft/monaco-editor/issues/643#issuecomment-367871377\r\n            if (browser.isFirefox && window.parent !== window) {\r\n                textArea.focus();\r\n            }\r\n            return;\r\n        }\r\n        // console.log('reason: ' + reason + ', setSelectionRange: ' + selectionStart + ' -> ' + selectionEnd);\r\n        if (currentIsFocused) {\r\n            // No need to focus, only need to change the selection range\r\n            this.setIgnoreSelectionChangeTime('setSelectionRange');\r\n            textArea.setSelectionRange(selectionStart, selectionEnd);\r\n            if (browser.isFirefox && window.parent !== window) {\r\n                textArea.focus();\r\n            }\r\n            return;\r\n        }\r\n        // If the focus is outside the textarea, browsers will try really hard to reveal the textarea.\r\n        // Here, we try to undo the browser's desperate reveal.\r\n        try {\r\n            var scrollState = dom.saveParentsScrollTop(textArea);\r\n            this.setIgnoreSelectionChangeTime('setSelectionRange');\r\n            textArea.focus();\r\n            textArea.setSelectionRange(selectionStart, selectionEnd);\r\n            dom.restoreParentsScrollTop(textArea, scrollState);\r\n        }\r\n        catch (e) {\r\n            // Sometimes IE throws when setting selection (e.g. textarea is off-DOM)\r\n        }\r\n    };\r\n    return TextAreaWrapper;\r\n}(Disposable));\r\n"],"sourceRoot":""}