{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/find/findWidget.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/foldingRanges.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/foldingModel.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/foldingDecorations.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/hiddenRangeModel.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/indentRangeProvider.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/syntaxRangeProvider.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/intializingRangeProvider.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/folding/folding.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/find/replacePattern.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/find/findState.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/contrib/find/replaceAllCommand.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","this","constructor","prototype","create","NLS_FIND_INPUT_LABEL","NLS_FIND_INPUT_PLACEHOLDER","NLS_PREVIOUS_MATCH_BTN_LABEL","NLS_NEXT_MATCH_BTN_LABEL","NLS_TOGGLE_SELECTION_FIND_TITLE","NLS_CLOSE_BTN_LABEL","NLS_REPLACE_INPUT_LABEL","NLS_REPLACE_INPUT_PLACEHOLDER","NLS_REPLACE_BTN_LABEL","NLS_REPLACE_ALL_BTN_LABEL","NLS_TOGGLE_REPLACE_MODE_BTN_LABEL","NLS_MATCHES_COUNT_LIMIT_TITLE","NLS_MATCHES_LOCATION","NLS_NO_RESULTS","FIND_WIDGET_INITIAL_WIDTH","PART_WIDTH","FIND_INPUT_AREA_WIDTH","MAX_MATCHES_COUNT_WIDTH","FIND_INPUT_AREA_HEIGHT","ctrlEnterReplaceAllWarningPromptedKey","ctrlKeyMod","FindWidgetViewZone","afterLineNumber","heightInPx","suppressMouseDown","domNode","document","createElement","className","stopPropagationForMultiLineUpwards","event","value","textarea","isMultiline","match","selectionStart","stopPropagation","stopPropagationForMultiLineDownwards","selectionEnd","length","FindWidget","_super","codeEditor","controller","state","contextViewProvider","keybindingService","contextKeyService","themeService","storageService","notificationService","_this","call","_cachedHeight","_codeEditor","_controller","_state","_contextViewProvider","_keybindingService","_contextKeyService","_storageService","_notificationService","_ctrlEnterReplaceAllWarningPrompted","getBoolean","_isVisible","_isReplaceVisible","_ignoreChangeEvent","_updateHistoryDelayer","_register","cancel","onFindReplaceStateChange","e","_onStateChanged","_buildDomNode","_updateButtons","_tryUpdateWidgetWidth","_findInput","inputBox","layout","onDidChangeConfiguration","hasChanged","getOption","change","isReplaceRevealed","updateAccessibilitySupport","addExtraSpaceOnTop","_viewZone","_showViewZone","_removeViewZone","onDidChangeCursorSelection","_updateToggleSelectionFindButton","onDidFocusEditorWidget","globalBufferTerm","getGlobalBufferTerm","searchString","select","_findInputFocused","bindTo","_findFocusTracker","inputElement","onDidFocus","set","_updateSearchScope","onDidBlur","_replaceInputFocused","_replaceFocusTracker","_replaceInput","addOverlayWidget","_applyTheme","getTheme","onThemeChange","bind","onDidChangeModel","_viewZoneId","undefined","onDidScrollChange","scrollTopChanged","_layoutViewZone","setTimeout","getId","ID","getDomNode","_domNode","getPosition","preference","setValue","replaceString","isRevealed","_reveal","_hide","width","_tryUpdateHeight","isRegex","setRegex","wholeWord","setWholeWords","matchCase","setCaseSensitive","searchScope","_toggleSelectionFind","checked","matchesCount","matchesPosition","showRedOutline","_updateMatchesCount","currentMatch","updateHistory","_delayedUpdateHistory","trigger","_updateHistory","addToHistory","label","_matchesCount","style","minWidth","title","firstChild","removeChild","String","appendChild","createTextNode","_getAriaLabel","Math","max","clientWidth","startLineNumber","startColumn","selection","getSelection","isSelection","endLineNumber","endColumn","isChecked","enable","disable","setEnabled","_closeBtn","findInputIsNonEmpty","_prevBtn","_nextBtn","_replaceBtn","_replaceAllBtn","_toggleReplaceBtn","toggleClass","setExpanded","canReplace","autoFindInSelection","isSelectionMultipleLine","setAttribute","validate","layoutOverlayWidget","adjustEditorScrollTop","seedSearchStringFromSelection","editorCoords","startCoords","getScrolledVisiblePosition","getStartPosition","startLeft","left","startTop","top","leftOfFindWidget","endCoords","getEndPosition","endLeft","focusTheEditor","clearMessage","focus","viewZone","changeViewZones","accessor","_getHeight","addZone","setScrollTop","getScrollTop","adjustScroll","newHeight","scrollAdjustment","layoutZone","removeZone","theme","inputStyles","inputActiveOptionBorder","getColor","inputActiveOptionBackground","inputBackground","inputForeground","inputBorder","inputValidationInfoBackground","inputValidationInfoForeground","inputValidationInfoBorder","inputValidationWarningBackground","inputValidationWarningForeground","inputValidationWarningBorder","inputValidationErrorBackground","inputValidationErrorForeground","inputValidationErrorBorder","layoutInfo","getLayoutInfo","editorContentWidth","contentWidth","editorWidth","minimapWidth","collapsedFindWidget","reducedFindWidget","narrowFindWidget","_resized","widgetWidth","maxWidth","findInputWidth","element","totalheight","height","totalHeight","focusFindInput","focusReplaceInput","highlightFindOptions","hasModel","setEndPosition","getModel","getLineMaxColumn","equalsRange","_onFindInputMouseDown","middleButton","_onFindInputKeyDown","equals","insertAtCursor","preventDefault","focusOnCaseSensitive","getValue","querySelector","_onReplaceInputKeyDown","info","store","getHorizontalSashTop","_sash","getHorizontalSashLeft","getHorizontalSashWidth","_keybindingLabelFor","actionId","kb","lookupKeybinding","getLabel","flexibleHeight","flexibleWidth","placeholder","appendCaseSensitiveLabel","ToggleCaseSensitiveCommand","appendWholeWordsLabel","ToggleWholeWordCommand","appendRegexLabel","ToggleRegexCommand","validation","getRegex","RegExp","content","message","flexibleMaxHeight","onKeyDown","onDidChange","onDidOptionChange","getWholeWords","getCaseSensitive","onCaseSensitiveKeyDown","onRegexKeyDown","focusOnPreserve","onDidHeightChange","onMouseDown","SimpleButton","PreviousMatchFindAction","onTrigger","getAction","run","then","NextMatchFindAction","findPart","actionsContainer","actionClassName","ToggleSearchScopeCommand","onChange","isEmpty","CloseFindWidgetCommand","isEnabled","history","setPreserveCase","preserveCase","getPreserveCase","onPreserveCaseKeyDown","enabled","ReplaceOneAction","replace","ReplaceAllAction","replaceAll","replacePart","replaceActionsContainer","_resizeSash","orientation","originalWidth","onDidStart","evt","startX","currentX","parseFloat","onDidReset","currentWidth","setFocusInputOnOptionClick","opts","_opts","tabIndex","onclick","onkeydown","defineProperty","get","enumerable","configurable","expanded","shouldHaveIt","collector","addBackgroundColorRule","selector","color","addRule","widgetBackground","widgetShadowColor","findMatchHighlightBorder","type","findMatchBorder","findRangeHighlightBorder","hcBorder","foreground","error","resizeBorderBackground","border","focusOutline","MAX_FOLDING_REGIONS","MAX_LINE_NUMBER","MASK_INDENT","FoldingRegions","startIndexes","endIndexes","types","Error","_startIndexes","_endIndexes","_collapseStates","Uint32Array","ceil","_types","_parentsComputed","ensureParentIndices","parentIndexes_1","isInsideLast","index","getStartLineNumber","getEndLineNumber","i","len","pop","parentIndex","push","getType","hasTypes","isCollapsed","arrayIndex","bit","setCollapsed","newState","toRegion","FoldingRegion","getParentIndex","parent","contains","line","findIndex","low","high","mid","floor","findRange","toString","res","join","ranges","containedBy","range","containsLine","lineNumber","FoldingModel","textModel","decorationProvider","_updateEventEmitter","_textModel","_decorationProvider","_regions","_editorDecorationIds","_isInitialized","toggleCollapseState","regions","processed","changeDecorations","_i","regions_1","region","regionIndex","editorDecorationId","newCollapseState","changeDecorationOptions","getDecorationOption","fire","model","collapseStateChanged","update","newRegions","blockedLineNumers","newEditorDecorations","isBlocked","blockedLineNumers_1","blockedLineNumber","initRange","maxColumn","decorationRange","options","nextCollapsed","k","collapsedIndex","decRange","getDecorationRange","collapsedStartLineNumber","deltaDecorations","getMemento","collapsedRanges","applyMemento","isArray","toToogle","state_1","getRegionAtLine","dispose","getAllRegionsAtLine","filter","result","level","current","getRegionsInside","Number","MAX_VALUE","levelStack","foldingModel","levels","lineNumbers","toToggle","_loop_1","doCollapse_1","regionsInside","r","apply","lineNumbers_1","setCollapseStateLevelsDown","doCollapse","lineNumbers_2","setCollapseStateLevelsUp","lineNumbers_3","setCollapseStateUp","lineNumbers_4","setCollapseStateAtLevel","foldLevel","blockedLineNumbers","some","setCollapseStateForMatchingLines","regExp","editorModel","test","getLineContent","setCollapseStateForType","FoldingDecorationProvider","editor","autoHideFoldingControls","showFoldingHighlights","COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION","COLLAPSED_VISUAL_DECORATION","EXPANDED_AUTO_HIDE_VISUAL_DECORATION","EXPANDED_VISUAL_DECORATION","oldDecorations","newDecorations","callback","register","stickiness","afterContentClassName","linesDecorationsClassName","isWholeLine","HiddenRangeModel","_foldingModel","_foldingModelListener","_","updateHiddenRanges","_hiddenRanges","updateHiddenAreas","newHiddenAreas","lastCollapsedStart","lastCollapsedEnd","applyHiddenRanges","hiddenRanges","map","hasRanges","isHidden","adjustSelections","selections","hasChanges","lastRange","adjustLine","isInside","adjustedStartLine","setStartPosition","adjustedEndLine","MAX_FOLDING_REGIONS_FOR_INDENT_LIMIT","ID_INDENT_PROVIDER","IndentRangeProvider","id","compute","cancelationToken","foldingRules","getFoldingRules","getLanguageIdentifier","offSide","markers","Promise","resolve","computeRanges","RangesCollector","foldingRangesLimit","_indentOccurrences","_length","_foldingRangesLimit","insertFirst","indent","toIndentRanges","entries","maxIndent","n","tabSize","getOptions","startIndex","lineContent","computeIndentLevel","pattern","start","source","end","previousRegions","getLineCount","endAbove","line_1","previous","m","foldingContext","ID_SYNTAX_PROVIDER","SyntaxRangeProvider","providers","limit","cancellationToken","collectSyntaxRanges","sanitizeRanges","rangeData","promises","provider","provideFoldingRanges","isCancellationRequested","nLines","ranges_1","rank","kind","all","_nestingLevels","_nestingLevelCounts","add","nestingLevel","maxLevel","sorted","sort","d1","d2","diff","sorted_1","entry","ID_INIT_PROVIDER","InitializingRangeProvider","initialRanges","onTimeout","timeoutTime","toDecorationRange","getLineLength","decorationIds","timeout","clearTimeout","foldingRangeData","_a","__decorate","decorators","target","key","desc","c","arguments","getOwnPropertyDescriptor","Reflect","decorate","__param","paramIndex","decorator","CONTEXT_FOLDING_ENABLED","FoldingController","localToDispose","_isEnabled","_useFoldingProviders","hiddenRangeModel","rangeProvider","foldingRegionPromise","foldingStateMemento","foldingModelPromise","updateScheduler","cursorChangedScheduler","mouseDownInfo","foldingDecorationProvider","foldingEnabled","onModelChanged","options_1","options_2","onModelContentChanged","options_3","onFoldingStrategyChanged","getContribution","saveViewState","isTooLargeForTokenization","collapsedRegions","isInitialized","lineCount","restoreViewState","getFoldingModel","clear","hr","onHiddenRangesChanges","revealCursor","onDidChangeModelLanguageConfiguration","onDidChangeModelContent","onDidChangeCursorPosition","onCursorPositionChanged","onEditorMouseDown","onMouseUp","onEditorMouseUp","getRangeProvider","foldingProviders","ordered","token","foldingRanges","getSelections","selectionLineNumbers","s","err","setSelections","setHiddenAreas","schedule","selectionStartLineNumber","selections_1","reveal","leftButton","iconClicked","data","detail","offsetLeftInGutter","offsetLeft","gutterOffsetX","offsetX","recursive","shiftKey","column","position","revealPositionInCenterIfOutsideViewport","FoldingAction","runEditorCommand","args","foldingController","reportTelemetry","invoke","getSelectedLines","getLineNumbers","selectionLines","l","_accessor","_editor","foldingArgumentsConstraint","foldingArgs","direction","every","UnfoldAction","nls","alias","precondition","kbOpts","kbExpr","editorTextFocus","primary","mac","weight","description","name","constraint","schema","_foldingController","UnFoldRecursivelyAction","_args","FoldAction","ToggleFoldAction","selectedLines","FoldRecursivelyAction","FoldAllBlockCommentsAction","Comment","comments","getComments","blockCommentStartToken","FoldAllRegionsAction","Region","UnfoldAllRegionsAction","FoldAllAction","UnfoldAllAction","FoldLevelAction","getFoldingLevel","parseInt","substr","ID_PREFIX","foldBackgroundBackground","light","dark","hc","foldBackground","StaticValueReplacePattern","staticValue","DynamicPiecesReplacePattern","pieces","ReplacePattern","fromStaticValue","ReplacePiece","buildReplaceString","matches","piece","_substitute","matchIndex","remainder","ReplacePieceBuilder","_source","_lastCharIndex","_result","_resultLen","_currentStaticPiece","emitUnchanged","toCharIndex","_emitStatic","substring","emitStatic","emitMatchIndex","finalize","parseReplaceString","chCode","charCodeAt","nextChCode","nextNextChCode","effectiveOptionValue","override","FindReplaceState","_onFindReplaceStateChange","_searchString","_replaceString","_isRevealed","_isReplaceRevealed","_isRegex","_isRegexOverride","_wholeWord","_wholeWordOverride","_matchCase","_matchCaseOverride","_preserveCase","_preserveCaseOverride","_searchScope","_matchesPosition","_currentMatch","changeMatchInfo","changeEvent","moveCursor","somethingChanged","oldEffectiveIsRegex","oldEffectiveWholeWords","oldEffectiveMatchCase","oldEffectivePreserveCase","isRegexOverride","wholeWordOverride","matchCaseOverride","preserveCaseOverride","ReplaceAllCommand","editorSelection","replaceStrings","_editorSelection","_ranges","_replaceStrings","_trackedEditorSelectionId","getEditOperations","builder","ops","text","o1","o2","compareRangesUsingStarts","resultOps","previousOp","plusRange","resultOps_1","op","addEditOperation","trackSelection","computeCursorState","helper","getTrackedSelection"],"mappings":"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","file":"js/chunk-vendors~689c4cb3.9ecbf0a6.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './findWidget.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { alert as alertFn } from '../../../base/browser/ui/aria/aria.js';\r\nimport { Checkbox } from '../../../base/browser/ui/checkbox/checkbox.js';\r\nimport { Sash } from '../../../base/browser/ui/sash/sash.js';\r\nimport { Widget } from '../../../base/browser/ui/widget.js';\r\nimport { Delayer } from '../../../base/common/async.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { toDisposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { CONTEXT_FIND_INPUT_FOCUSED, CONTEXT_REPLACE_INPUT_FOCUSED, FIND_IDS, MATCHES_LIMIT } from './findModel.js';\r\nimport { contrastBorder, editorFindMatch, editorFindMatchBorder, editorFindMatchHighlight, editorFindMatchHighlightBorder, editorFindRangeHighlight, editorFindRangeHighlightBorder, editorWidgetBackground, editorWidgetBorder, editorWidgetResizeBorder, errorForeground, inputActiveOptionBorder, inputActiveOptionBackground, inputBackground, inputBorder, inputForeground, inputValidationErrorBackground, inputValidationErrorBorder, inputValidationErrorForeground, inputValidationInfoBackground, inputValidationInfoBorder, inputValidationInfoForeground, inputValidationWarningBackground, inputValidationWarningBorder, inputValidationWarningForeground, widgetShadow, editorWidgetForeground, focusBorder } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { ContextScopedFindInput, ContextScopedReplaceInput } from '../../../platform/browser/contextScopedHistoryWidget.js';\r\nvar NLS_FIND_INPUT_LABEL = nls.localize('label.find', \"Find\");\r\nvar NLS_FIND_INPUT_PLACEHOLDER = nls.localize('placeholder.find', \"Find\");\r\nvar NLS_PREVIOUS_MATCH_BTN_LABEL = nls.localize('label.previousMatchButton', \"Previous match\");\r\nvar NLS_NEXT_MATCH_BTN_LABEL = nls.localize('label.nextMatchButton', \"Next match\");\r\nvar NLS_TOGGLE_SELECTION_FIND_TITLE = nls.localize('label.toggleSelectionFind', \"Find in selection\");\r\nvar NLS_CLOSE_BTN_LABEL = nls.localize('label.closeButton', \"Close\");\r\nvar NLS_REPLACE_INPUT_LABEL = nls.localize('label.replace', \"Replace\");\r\nvar NLS_REPLACE_INPUT_PLACEHOLDER = nls.localize('placeholder.replace', \"Replace\");\r\nvar NLS_REPLACE_BTN_LABEL = nls.localize('label.replaceButton', \"Replace\");\r\nvar NLS_REPLACE_ALL_BTN_LABEL = nls.localize('label.replaceAllButton', \"Replace All\");\r\nvar NLS_TOGGLE_REPLACE_MODE_BTN_LABEL = nls.localize('label.toggleReplaceButton', \"Toggle Replace mode\");\r\nvar NLS_MATCHES_COUNT_LIMIT_TITLE = nls.localize('title.matchesCountLimit', \"Only the first {0} results are highlighted, but all find operations work on the entire text.\", MATCHES_LIMIT);\r\nvar NLS_MATCHES_LOCATION = nls.localize('label.matchesLocation', \"{0} of {1}\");\r\nvar NLS_NO_RESULTS = nls.localize('label.noResults', \"No Results\");\r\nvar FIND_WIDGET_INITIAL_WIDTH = 419;\r\nvar PART_WIDTH = 275;\r\nvar FIND_INPUT_AREA_WIDTH = PART_WIDTH - 54;\r\nvar MAX_MATCHES_COUNT_WIDTH = 69;\r\n// let FIND_ALL_CONTROLS_WIDTH = 17/** Find Input margin-left */ + (MAX_MATCHES_COUNT_WIDTH + 3 + 1) /** Match Results */ + 23 /** Button */ * 4 + 2/** sash */;\r\nvar FIND_INPUT_AREA_HEIGHT = 33; // The height of Find Widget when Replace Input is not visible.\r\nvar ctrlEnterReplaceAllWarningPromptedKey = 'ctrlEnterReplaceAll.windows.donotask';\r\nvar ctrlKeyMod = (platform.isMacintosh ? 256 /* WinCtrl */ : 2048 /* CtrlCmd */);\r\nvar FindWidgetViewZone = /** @class */ (function () {\r\n    function FindWidgetViewZone(afterLineNumber) {\r\n        this.afterLineNumber = afterLineNumber;\r\n        this.heightInPx = FIND_INPUT_AREA_HEIGHT;\r\n        this.suppressMouseDown = false;\r\n        this.domNode = document.createElement('div');\r\n        this.domNode.className = 'dock-find-viewzone';\r\n    }\r\n    return FindWidgetViewZone;\r\n}());\r\nexport { FindWidgetViewZone };\r\nfunction stopPropagationForMultiLineUpwards(event, value, textarea) {\r\n    var isMultiline = !!value.match(/\\n/);\r\n    if (textarea && isMultiline && textarea.selectionStart > 0) {\r\n        event.stopPropagation();\r\n        return;\r\n    }\r\n}\r\nfunction stopPropagationForMultiLineDownwards(event, value, textarea) {\r\n    var isMultiline = !!value.match(/\\n/);\r\n    if (textarea && isMultiline && textarea.selectionEnd < textarea.value.length) {\r\n        event.stopPropagation();\r\n        return;\r\n    }\r\n}\r\nvar FindWidget = /** @class */ (function (_super) {\r\n    __extends(FindWidget, _super);\r\n    function FindWidget(codeEditor, controller, state, contextViewProvider, keybindingService, contextKeyService, themeService, storageService, notificationService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._cachedHeight = null;\r\n        _this._codeEditor = codeEditor;\r\n        _this._controller = controller;\r\n        _this._state = state;\r\n        _this._contextViewProvider = contextViewProvider;\r\n        _this._keybindingService = keybindingService;\r\n        _this._contextKeyService = contextKeyService;\r\n        _this._storageService = storageService;\r\n        _this._notificationService = notificationService;\r\n        _this._ctrlEnterReplaceAllWarningPrompted = !!storageService.getBoolean(ctrlEnterReplaceAllWarningPromptedKey, 0 /* GLOBAL */);\r\n        _this._isVisible = false;\r\n        _this._isReplaceVisible = false;\r\n        _this._ignoreChangeEvent = false;\r\n        _this._updateHistoryDelayer = new Delayer(500);\r\n        _this._register(toDisposable(function () { return _this._updateHistoryDelayer.cancel(); }));\r\n        _this._register(_this._state.onFindReplaceStateChange(function (e) { return _this._onStateChanged(e); }));\r\n        _this._buildDomNode();\r\n        _this._updateButtons();\r\n        _this._tryUpdateWidgetWidth();\r\n        _this._findInput.inputBox.layout();\r\n        _this._register(_this._codeEditor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(68 /* readOnly */)) {\r\n                if (_this._codeEditor.getOption(68 /* readOnly */)) {\r\n                    // Hide replace part if editor becomes read only\r\n                    _this._state.change({ isReplaceRevealed: false }, false);\r\n                }\r\n                _this._updateButtons();\r\n            }\r\n            if (e.hasChanged(107 /* layoutInfo */)) {\r\n                _this._tryUpdateWidgetWidth();\r\n            }\r\n            if (e.hasChanged(2 /* accessibilitySupport */)) {\r\n                _this.updateAccessibilitySupport();\r\n            }\r\n            if (e.hasChanged(28 /* find */)) {\r\n                var addExtraSpaceOnTop = _this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop;\r\n                if (addExtraSpaceOnTop && !_this._viewZone) {\r\n                    _this._viewZone = new FindWidgetViewZone(0);\r\n                    _this._showViewZone();\r\n                }\r\n                if (!addExtraSpaceOnTop && _this._viewZone) {\r\n                    _this._removeViewZone();\r\n                }\r\n            }\r\n        }));\r\n        _this.updateAccessibilitySupport();\r\n        _this._register(_this._codeEditor.onDidChangeCursorSelection(function () {\r\n            if (_this._isVisible) {\r\n                _this._updateToggleSelectionFindButton();\r\n            }\r\n        }));\r\n        _this._register(_this._codeEditor.onDidFocusEditorWidget(function () {\r\n            if (_this._isVisible) {\r\n                var globalBufferTerm = _this._controller.getGlobalBufferTerm();\r\n                if (globalBufferTerm && globalBufferTerm !== _this._state.searchString) {\r\n                    _this._state.change({ searchString: globalBufferTerm }, true);\r\n                    _this._findInput.select();\r\n                }\r\n            }\r\n        }));\r\n        _this._findInputFocused = CONTEXT_FIND_INPUT_FOCUSED.bindTo(contextKeyService);\r\n        _this._findFocusTracker = _this._register(dom.trackFocus(_this._findInput.inputBox.inputElement));\r\n        _this._register(_this._findFocusTracker.onDidFocus(function () {\r\n            _this._findInputFocused.set(true);\r\n            _this._updateSearchScope();\r\n        }));\r\n        _this._register(_this._findFocusTracker.onDidBlur(function () {\r\n            _this._findInputFocused.set(false);\r\n        }));\r\n        _this._replaceInputFocused = CONTEXT_REPLACE_INPUT_FOCUSED.bindTo(contextKeyService);\r\n        _this._replaceFocusTracker = _this._register(dom.trackFocus(_this._replaceInput.inputBox.inputElement));\r\n        _this._register(_this._replaceFocusTracker.onDidFocus(function () {\r\n            _this._replaceInputFocused.set(true);\r\n            _this._updateSearchScope();\r\n        }));\r\n        _this._register(_this._replaceFocusTracker.onDidBlur(function () {\r\n            _this._replaceInputFocused.set(false);\r\n        }));\r\n        _this._codeEditor.addOverlayWidget(_this);\r\n        if (_this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop) {\r\n            _this._viewZone = new FindWidgetViewZone(0); // Put it before the first line then users can scroll beyond the first line.\r\n        }\r\n        _this._applyTheme(themeService.getTheme());\r\n        _this._register(themeService.onThemeChange(_this._applyTheme.bind(_this)));\r\n        _this._register(_this._codeEditor.onDidChangeModel(function () {\r\n            if (!_this._isVisible) {\r\n                return;\r\n            }\r\n            _this._viewZoneId = undefined;\r\n        }));\r\n        _this._register(_this._codeEditor.onDidScrollChange(function (e) {\r\n            if (e.scrollTopChanged) {\r\n                _this._layoutViewZone();\r\n                return;\r\n            }\r\n            // for other scroll changes, layout the viewzone in next tick to avoid ruining current rendering.\r\n            setTimeout(function () {\r\n                _this._layoutViewZone();\r\n            }, 0);\r\n        }));\r\n        return _this;\r\n    }\r\n    // ----- IOverlayWidget API\r\n    FindWidget.prototype.getId = function () {\r\n        return FindWidget.ID;\r\n    };\r\n    FindWidget.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    FindWidget.prototype.getPosition = function () {\r\n        if (this._isVisible) {\r\n            return {\r\n                preference: 0 /* TOP_RIGHT_CORNER */\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    // ----- React to state changes\r\n    FindWidget.prototype._onStateChanged = function (e) {\r\n        if (e.searchString) {\r\n            try {\r\n                this._ignoreChangeEvent = true;\r\n                this._findInput.setValue(this._state.searchString);\r\n            }\r\n            finally {\r\n                this._ignoreChangeEvent = false;\r\n            }\r\n            this._updateButtons();\r\n        }\r\n        if (e.replaceString) {\r\n            this._replaceInput.inputBox.value = this._state.replaceString;\r\n        }\r\n        if (e.isRevealed) {\r\n            if (this._state.isRevealed) {\r\n                this._reveal();\r\n            }\r\n            else {\r\n                this._hide(true);\r\n            }\r\n        }\r\n        if (e.isReplaceRevealed) {\r\n            if (this._state.isReplaceRevealed) {\r\n                if (!this._codeEditor.getOption(68 /* readOnly */) && !this._isReplaceVisible) {\r\n                    this._isReplaceVisible = true;\r\n                    this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\r\n                    this._updateButtons();\r\n                    this._replaceInput.inputBox.layout();\r\n                }\r\n            }\r\n            else {\r\n                if (this._isReplaceVisible) {\r\n                    this._isReplaceVisible = false;\r\n                    this._updateButtons();\r\n                }\r\n            }\r\n        }\r\n        if ((e.isRevealed || e.isReplaceRevealed) && (this._state.isRevealed || this._state.isReplaceRevealed)) {\r\n            if (this._tryUpdateHeight()) {\r\n                this._showViewZone();\r\n            }\r\n        }\r\n        if (e.isRegex) {\r\n            this._findInput.setRegex(this._state.isRegex);\r\n        }\r\n        if (e.wholeWord) {\r\n            this._findInput.setWholeWords(this._state.wholeWord);\r\n        }\r\n        if (e.matchCase) {\r\n            this._findInput.setCaseSensitive(this._state.matchCase);\r\n        }\r\n        if (e.searchScope) {\r\n            if (this._state.searchScope) {\r\n                this._toggleSelectionFind.checked = true;\r\n            }\r\n            else {\r\n                this._toggleSelectionFind.checked = false;\r\n            }\r\n            this._updateToggleSelectionFindButton();\r\n        }\r\n        if (e.searchString || e.matchesCount || e.matchesPosition) {\r\n            var showRedOutline = (this._state.searchString.length > 0 && this._state.matchesCount === 0);\r\n            dom.toggleClass(this._domNode, 'no-results', showRedOutline);\r\n            this._updateMatchesCount();\r\n            this._updateButtons();\r\n        }\r\n        if (e.searchString || e.currentMatch) {\r\n            this._layoutViewZone();\r\n        }\r\n        if (e.updateHistory) {\r\n            this._delayedUpdateHistory();\r\n        }\r\n    };\r\n    FindWidget.prototype._delayedUpdateHistory = function () {\r\n        this._updateHistoryDelayer.trigger(this._updateHistory.bind(this));\r\n    };\r\n    FindWidget.prototype._updateHistory = function () {\r\n        if (this._state.searchString) {\r\n            this._findInput.inputBox.addToHistory();\r\n        }\r\n        if (this._state.replaceString) {\r\n            this._replaceInput.inputBox.addToHistory();\r\n        }\r\n    };\r\n    FindWidget.prototype._updateMatchesCount = function () {\r\n        this._matchesCount.style.minWidth = MAX_MATCHES_COUNT_WIDTH + 'px';\r\n        if (this._state.matchesCount >= MATCHES_LIMIT) {\r\n            this._matchesCount.title = NLS_MATCHES_COUNT_LIMIT_TITLE;\r\n        }\r\n        else {\r\n            this._matchesCount.title = '';\r\n        }\r\n        // remove previous content\r\n        if (this._matchesCount.firstChild) {\r\n            this._matchesCount.removeChild(this._matchesCount.firstChild);\r\n        }\r\n        var label;\r\n        if (this._state.matchesCount > 0) {\r\n            var matchesCount = String(this._state.matchesCount);\r\n            if (this._state.matchesCount >= MATCHES_LIMIT) {\r\n                matchesCount += '+';\r\n            }\r\n            var matchesPosition = String(this._state.matchesPosition);\r\n            if (matchesPosition === '0') {\r\n                matchesPosition = '?';\r\n            }\r\n            label = strings.format(NLS_MATCHES_LOCATION, matchesPosition, matchesCount);\r\n        }\r\n        else {\r\n            label = NLS_NO_RESULTS;\r\n        }\r\n        this._matchesCount.appendChild(document.createTextNode(label));\r\n        alertFn(this._getAriaLabel(label, this._state.currentMatch, this._state.searchString), true);\r\n        MAX_MATCHES_COUNT_WIDTH = Math.max(MAX_MATCHES_COUNT_WIDTH, this._matchesCount.clientWidth);\r\n    };\r\n    // ----- actions\r\n    FindWidget.prototype._getAriaLabel = function (label, currentMatch, searchString) {\r\n        if (label === NLS_NO_RESULTS) {\r\n            return searchString === ''\r\n                ? nls.localize('ariaSearchNoResultEmpty', \"{0} found\", label)\r\n                : nls.localize('ariaSearchNoResult', \"{0} found for {1}\", label, searchString);\r\n        }\r\n        return currentMatch\r\n            ? nls.localize('ariaSearchNoResultWithLineNum', \"{0} found for {1} at {2}\", label, searchString, currentMatch.startLineNumber + ':' + currentMatch.startColumn)\r\n            : nls.localize('ariaSearchNoResultWithLineNumNoCurrentMatch', \"{0} found for {1}\", label, searchString);\r\n    };\r\n    /**\r\n     * If 'selection find' is ON we should not disable the button (its function is to cancel 'selection find').\r\n     * If 'selection find' is OFF we enable the button only if there is a selection.\r\n     */\r\n    FindWidget.prototype._updateToggleSelectionFindButton = function () {\r\n        var selection = this._codeEditor.getSelection();\r\n        var isSelection = selection ? (selection.startLineNumber !== selection.endLineNumber || selection.startColumn !== selection.endColumn) : false;\r\n        var isChecked = this._toggleSelectionFind.checked;\r\n        if (this._isVisible && (isChecked || isSelection)) {\r\n            this._toggleSelectionFind.enable();\r\n        }\r\n        else {\r\n            this._toggleSelectionFind.disable();\r\n        }\r\n    };\r\n    FindWidget.prototype._updateButtons = function () {\r\n        this._findInput.setEnabled(this._isVisible);\r\n        this._replaceInput.setEnabled(this._isVisible && this._isReplaceVisible);\r\n        this._updateToggleSelectionFindButton();\r\n        this._closeBtn.setEnabled(this._isVisible);\r\n        var findInputIsNonEmpty = (this._state.searchString.length > 0);\r\n        var matchesCount = this._state.matchesCount ? true : false;\r\n        this._prevBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount);\r\n        this._nextBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount);\r\n        this._replaceBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);\r\n        this._replaceAllBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);\r\n        dom.toggleClass(this._domNode, 'replaceToggled', this._isReplaceVisible);\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-right', !this._isReplaceVisible);\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-down', this._isReplaceVisible);\r\n        this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);\r\n        var canReplace = !this._codeEditor.getOption(68 /* readOnly */);\r\n        this._toggleReplaceBtn.setEnabled(this._isVisible && canReplace);\r\n    };\r\n    FindWidget.prototype._reveal = function () {\r\n        var _this = this;\r\n        if (!this._isVisible) {\r\n            this._isVisible = true;\r\n            var selection = this._codeEditor.getSelection();\r\n            switch (this._codeEditor.getOption(28 /* find */).autoFindInSelection) {\r\n                case 'always':\r\n                    this._toggleSelectionFind.checked = true;\r\n                    break;\r\n                case 'never':\r\n                    this._toggleSelectionFind.checked = false;\r\n                    break;\r\n                case 'multiline':\r\n                    var isSelectionMultipleLine = !!selection && selection.startLineNumber !== selection.endLineNumber;\r\n                    this._toggleSelectionFind.checked = isSelectionMultipleLine;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            this._tryUpdateWidgetWidth();\r\n            this._updateButtons();\r\n            setTimeout(function () {\r\n                dom.addClass(_this._domNode, 'visible');\r\n                _this._domNode.setAttribute('aria-hidden', 'false');\r\n            }, 0);\r\n            // validate query again as it's being dismissed when we hide the find widget.\r\n            setTimeout(function () {\r\n                _this._findInput.validate();\r\n            }, 200);\r\n            this._codeEditor.layoutOverlayWidget(this);\r\n            var adjustEditorScrollTop = true;\r\n            if (this._codeEditor.getOption(28 /* find */).seedSearchStringFromSelection && selection) {\r\n                var domNode = this._codeEditor.getDomNode();\r\n                if (domNode) {\r\n                    var editorCoords = dom.getDomNodePagePosition(domNode);\r\n                    var startCoords = this._codeEditor.getScrolledVisiblePosition(selection.getStartPosition());\r\n                    var startLeft = editorCoords.left + (startCoords ? startCoords.left : 0);\r\n                    var startTop = startCoords ? startCoords.top : 0;\r\n                    if (this._viewZone && startTop < this._viewZone.heightInPx) {\r\n                        if (selection.endLineNumber > selection.startLineNumber) {\r\n                            adjustEditorScrollTop = false;\r\n                        }\r\n                        var leftOfFindWidget = dom.getTopLeftOffset(this._domNode).left;\r\n                        if (startLeft > leftOfFindWidget) {\r\n                            adjustEditorScrollTop = false;\r\n                        }\r\n                        var endCoords = this._codeEditor.getScrolledVisiblePosition(selection.getEndPosition());\r\n                        var endLeft = editorCoords.left + (endCoords ? endCoords.left : 0);\r\n                        if (endLeft > leftOfFindWidget) {\r\n                            adjustEditorScrollTop = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            this._showViewZone(adjustEditorScrollTop);\r\n        }\r\n    };\r\n    FindWidget.prototype._hide = function (focusTheEditor) {\r\n        if (this._isVisible) {\r\n            this._isVisible = false;\r\n            this._updateButtons();\r\n            dom.removeClass(this._domNode, 'visible');\r\n            this._domNode.setAttribute('aria-hidden', 'true');\r\n            this._findInput.clearMessage();\r\n            if (focusTheEditor) {\r\n                this._codeEditor.focus();\r\n            }\r\n            this._codeEditor.layoutOverlayWidget(this);\r\n            this._removeViewZone();\r\n        }\r\n    };\r\n    FindWidget.prototype._layoutViewZone = function () {\r\n        var _this = this;\r\n        var addExtraSpaceOnTop = this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop;\r\n        if (!addExtraSpaceOnTop) {\r\n            this._removeViewZone();\r\n            return;\r\n        }\r\n        if (!this._isVisible) {\r\n            return;\r\n        }\r\n        var viewZone = this._viewZone;\r\n        if (this._viewZoneId !== undefined || !viewZone) {\r\n            return;\r\n        }\r\n        this._codeEditor.changeViewZones(function (accessor) {\r\n            viewZone.heightInPx = _this._getHeight();\r\n            _this._viewZoneId = accessor.addZone(viewZone);\r\n            // scroll top adjust to make sure the editor doesn't scroll when adding viewzone at the beginning.\r\n            _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + viewZone.heightInPx);\r\n        });\r\n    };\r\n    FindWidget.prototype._showViewZone = function (adjustScroll) {\r\n        var _this = this;\r\n        if (adjustScroll === void 0) { adjustScroll = true; }\r\n        if (!this._isVisible) {\r\n            return;\r\n        }\r\n        var addExtraSpaceOnTop = this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop;\r\n        if (!addExtraSpaceOnTop) {\r\n            return;\r\n        }\r\n        if (this._viewZone === undefined) {\r\n            this._viewZone = new FindWidgetViewZone(0);\r\n        }\r\n        var viewZone = this._viewZone;\r\n        this._codeEditor.changeViewZones(function (accessor) {\r\n            if (_this._viewZoneId !== undefined) {\r\n                // the view zone already exists, we need to update the height\r\n                var newHeight = _this._getHeight();\r\n                if (newHeight === viewZone.heightInPx) {\r\n                    return;\r\n                }\r\n                var scrollAdjustment = newHeight - viewZone.heightInPx;\r\n                viewZone.heightInPx = newHeight;\r\n                accessor.layoutZone(_this._viewZoneId);\r\n                if (adjustScroll) {\r\n                    _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + scrollAdjustment);\r\n                }\r\n                return;\r\n            }\r\n            else {\r\n                var scrollAdjustment = _this._getHeight();\r\n                viewZone.heightInPx = scrollAdjustment;\r\n                _this._viewZoneId = accessor.addZone(viewZone);\r\n                if (adjustScroll) {\r\n                    _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + scrollAdjustment);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    FindWidget.prototype._removeViewZone = function () {\r\n        var _this = this;\r\n        this._codeEditor.changeViewZones(function (accessor) {\r\n            if (_this._viewZoneId !== undefined) {\r\n                accessor.removeZone(_this._viewZoneId);\r\n                _this._viewZoneId = undefined;\r\n                if (_this._viewZone) {\r\n                    _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() - _this._viewZone.heightInPx);\r\n                    _this._viewZone = undefined;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    FindWidget.prototype._applyTheme = function (theme) {\r\n        var inputStyles = {\r\n            inputActiveOptionBorder: theme.getColor(inputActiveOptionBorder),\r\n            inputActiveOptionBackground: theme.getColor(inputActiveOptionBackground),\r\n            inputBackground: theme.getColor(inputBackground),\r\n            inputForeground: theme.getColor(inputForeground),\r\n            inputBorder: theme.getColor(inputBorder),\r\n            inputValidationInfoBackground: theme.getColor(inputValidationInfoBackground),\r\n            inputValidationInfoForeground: theme.getColor(inputValidationInfoForeground),\r\n            inputValidationInfoBorder: theme.getColor(inputValidationInfoBorder),\r\n            inputValidationWarningBackground: theme.getColor(inputValidationWarningBackground),\r\n            inputValidationWarningForeground: theme.getColor(inputValidationWarningForeground),\r\n            inputValidationWarningBorder: theme.getColor(inputValidationWarningBorder),\r\n            inputValidationErrorBackground: theme.getColor(inputValidationErrorBackground),\r\n            inputValidationErrorForeground: theme.getColor(inputValidationErrorForeground),\r\n            inputValidationErrorBorder: theme.getColor(inputValidationErrorBorder),\r\n        };\r\n        this._findInput.style(inputStyles);\r\n        this._replaceInput.style(inputStyles);\r\n        this._toggleSelectionFind.style(inputStyles);\r\n    };\r\n    FindWidget.prototype._tryUpdateWidgetWidth = function () {\r\n        if (!this._isVisible) {\r\n            return;\r\n        }\r\n        if (!dom.isInDOM(this._domNode)) {\r\n            // the widget is not in the DOM\r\n            return;\r\n        }\r\n        var layoutInfo = this._codeEditor.getLayoutInfo();\r\n        var editorContentWidth = layoutInfo.contentWidth;\r\n        if (editorContentWidth <= 0) {\r\n            // for example, diff view original editor\r\n            dom.addClass(this._domNode, 'hiddenEditor');\r\n            return;\r\n        }\r\n        else if (dom.hasClass(this._domNode, 'hiddenEditor')) {\r\n            dom.removeClass(this._domNode, 'hiddenEditor');\r\n        }\r\n        var editorWidth = layoutInfo.width;\r\n        var minimapWidth = layoutInfo.minimapWidth;\r\n        var collapsedFindWidget = false;\r\n        var reducedFindWidget = false;\r\n        var narrowFindWidget = false;\r\n        if (this._resized) {\r\n            var widgetWidth = dom.getTotalWidth(this._domNode);\r\n            if (widgetWidth > FIND_WIDGET_INITIAL_WIDTH) {\r\n                // as the widget is resized by users, we may need to change the max width of the widget as the editor width changes.\r\n                this._domNode.style.maxWidth = editorWidth - 28 - minimapWidth - 15 + \"px\";\r\n                this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\r\n                return;\r\n            }\r\n        }\r\n        if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth >= editorWidth) {\r\n            reducedFindWidget = true;\r\n        }\r\n        if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - MAX_MATCHES_COUNT_WIDTH >= editorWidth) {\r\n            narrowFindWidget = true;\r\n        }\r\n        if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - MAX_MATCHES_COUNT_WIDTH >= editorWidth + 50) {\r\n            collapsedFindWidget = true;\r\n        }\r\n        dom.toggleClass(this._domNode, 'collapsed-find-widget', collapsedFindWidget);\r\n        dom.toggleClass(this._domNode, 'narrow-find-widget', narrowFindWidget);\r\n        dom.toggleClass(this._domNode, 'reduced-find-widget', reducedFindWidget);\r\n        if (!narrowFindWidget && !collapsedFindWidget) {\r\n            // the minimal left offset of findwidget is 15px.\r\n            this._domNode.style.maxWidth = editorWidth - 28 - minimapWidth - 15 + \"px\";\r\n        }\r\n        if (this._resized) {\r\n            this._findInput.inputBox.layout();\r\n            var findInputWidth = this._findInput.inputBox.element.clientWidth;\r\n            if (findInputWidth > 0) {\r\n                this._replaceInput.width = findInputWidth;\r\n            }\r\n        }\r\n        else if (this._isReplaceVisible) {\r\n            this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\r\n        }\r\n    };\r\n    FindWidget.prototype._getHeight = function () {\r\n        var totalheight = 0;\r\n        // find input margin top\r\n        totalheight += 4;\r\n        // find input height\r\n        totalheight += this._findInput.inputBox.height + 2 /** input box border */;\r\n        if (this._isReplaceVisible) {\r\n            // replace input margin\r\n            totalheight += 4;\r\n            totalheight += this._replaceInput.inputBox.height + 2 /** input box border */;\r\n        }\r\n        // margin bottom\r\n        totalheight += 4;\r\n        return totalheight;\r\n    };\r\n    FindWidget.prototype._tryUpdateHeight = function () {\r\n        var totalHeight = this._getHeight();\r\n        if (this._cachedHeight !== null && this._cachedHeight === totalHeight) {\r\n            return false;\r\n        }\r\n        this._cachedHeight = totalHeight;\r\n        this._domNode.style.height = totalHeight + \"px\";\r\n        return true;\r\n    };\r\n    // ----- Public\r\n    FindWidget.prototype.focusFindInput = function () {\r\n        this._findInput.select();\r\n        // Edge browser requires focus() in addition to select()\r\n        this._findInput.focus();\r\n    };\r\n    FindWidget.prototype.focusReplaceInput = function () {\r\n        this._replaceInput.select();\r\n        // Edge browser requires focus() in addition to select()\r\n        this._replaceInput.focus();\r\n    };\r\n    FindWidget.prototype.highlightFindOptions = function () {\r\n        this._findInput.highlightFindOptions();\r\n    };\r\n    FindWidget.prototype._updateSearchScope = function () {\r\n        if (!this._codeEditor.hasModel()) {\r\n            return;\r\n        }\r\n        if (this._toggleSelectionFind.checked) {\r\n            var selection = this._codeEditor.getSelection();\r\n            if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) {\r\n                selection = selection.setEndPosition(selection.endLineNumber - 1, this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));\r\n            }\r\n            var currentMatch = this._state.currentMatch;\r\n            if (selection.startLineNumber !== selection.endLineNumber) {\r\n                if (!Range.equalsRange(selection, currentMatch)) {\r\n                    // Reseed find scope\r\n                    this._state.change({ searchScope: selection }, true);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    FindWidget.prototype._onFindInputMouseDown = function (e) {\r\n        // on linux, middle key does pasting.\r\n        if (e.middleButton) {\r\n            e.stopPropagation();\r\n        }\r\n    };\r\n    FindWidget.prototype._onFindInputKeyDown = function (e) {\r\n        if (e.equals(ctrlKeyMod | 3 /* Enter */)) {\r\n            this._findInput.inputBox.insertAtCursor('\\n');\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2 /* Tab */)) {\r\n            if (this._isReplaceVisible) {\r\n                this._replaceInput.focus();\r\n            }\r\n            else {\r\n                this._findInput.focusOnCaseSensitive();\r\n            }\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2048 /* CtrlCmd */ | 18 /* DownArrow */)) {\r\n            this._codeEditor.focus();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(16 /* UpArrow */)) {\r\n            return stopPropagationForMultiLineUpwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));\r\n        }\r\n        if (e.equals(18 /* DownArrow */)) {\r\n            return stopPropagationForMultiLineDownwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));\r\n        }\r\n    };\r\n    FindWidget.prototype._onReplaceInputKeyDown = function (e) {\r\n        if (e.equals(ctrlKeyMod | 3 /* Enter */)) {\r\n            if (platform.isWindows && platform.isNative && !this._ctrlEnterReplaceAllWarningPrompted) {\r\n                // this is the first time when users press Ctrl + Enter to replace all\r\n                this._notificationService.info(nls.localize('ctrlEnter.keybindingChanged', 'Ctrl+Enter now inserts line break instead of replacing all. You can modify the keybinding for editor.action.replaceAll to override this behavior.'));\r\n                this._ctrlEnterReplaceAllWarningPrompted = true;\r\n                this._storageService.store(ctrlEnterReplaceAllWarningPromptedKey, true, 0 /* GLOBAL */);\r\n            }\r\n            this._replaceInput.inputBox.insertAtCursor('\\n');\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2 /* Tab */)) {\r\n            this._findInput.focusOnCaseSensitive();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(1024 /* Shift */ | 2 /* Tab */)) {\r\n            this._findInput.focus();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2048 /* CtrlCmd */ | 18 /* DownArrow */)) {\r\n            this._codeEditor.focus();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(16 /* UpArrow */)) {\r\n            return stopPropagationForMultiLineUpwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));\r\n        }\r\n        if (e.equals(18 /* DownArrow */)) {\r\n            return stopPropagationForMultiLineDownwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));\r\n        }\r\n    };\r\n    // ----- sash\r\n    FindWidget.prototype.getHorizontalSashTop = function (_sash) {\r\n        return 0;\r\n    };\r\n    FindWidget.prototype.getHorizontalSashLeft = function (_sash) {\r\n        return 0;\r\n    };\r\n    FindWidget.prototype.getHorizontalSashWidth = function (_sash) {\r\n        return 500;\r\n    };\r\n    // ----- initialization\r\n    FindWidget.prototype._keybindingLabelFor = function (actionId) {\r\n        var kb = this._keybindingService.lookupKeybinding(actionId);\r\n        if (!kb) {\r\n            return '';\r\n        }\r\n        return \" (\" + kb.getLabel() + \")\";\r\n    };\r\n    FindWidget.prototype._buildDomNode = function () {\r\n        var _this = this;\r\n        var flexibleHeight = true;\r\n        var flexibleWidth = true;\r\n        // Find input\r\n        this._findInput = this._register(new ContextScopedFindInput(null, this._contextViewProvider, {\r\n            width: FIND_INPUT_AREA_WIDTH,\r\n            label: NLS_FIND_INPUT_LABEL,\r\n            placeholder: NLS_FIND_INPUT_PLACEHOLDER,\r\n            appendCaseSensitiveLabel: this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),\r\n            appendWholeWordsLabel: this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),\r\n            appendRegexLabel: this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),\r\n            validation: function (value) {\r\n                if (value.length === 0 || !_this._findInput.getRegex()) {\r\n                    return null;\r\n                }\r\n                try {\r\n                    new RegExp(value);\r\n                    return null;\r\n                }\r\n                catch (e) {\r\n                    return { content: e.message };\r\n                }\r\n            },\r\n            flexibleHeight: flexibleHeight,\r\n            flexibleWidth: flexibleWidth,\r\n            flexibleMaxHeight: 118\r\n        }, this._contextKeyService, true));\r\n        this._findInput.setRegex(!!this._state.isRegex);\r\n        this._findInput.setCaseSensitive(!!this._state.matchCase);\r\n        this._findInput.setWholeWords(!!this._state.wholeWord);\r\n        this._register(this._findInput.onKeyDown(function (e) { return _this._onFindInputKeyDown(e); }));\r\n        this._register(this._findInput.inputBox.onDidChange(function () {\r\n            if (_this._ignoreChangeEvent) {\r\n                return;\r\n            }\r\n            _this._state.change({ searchString: _this._findInput.getValue() }, true);\r\n        }));\r\n        this._register(this._findInput.onDidOptionChange(function () {\r\n            _this._state.change({\r\n                isRegex: _this._findInput.getRegex(),\r\n                wholeWord: _this._findInput.getWholeWords(),\r\n                matchCase: _this._findInput.getCaseSensitive()\r\n            }, true);\r\n        }));\r\n        this._register(this._findInput.onCaseSensitiveKeyDown(function (e) {\r\n            if (e.equals(1024 /* Shift */ | 2 /* Tab */)) {\r\n                if (_this._isReplaceVisible) {\r\n                    _this._replaceInput.focus();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }));\r\n        this._register(this._findInput.onRegexKeyDown(function (e) {\r\n            if (e.equals(2 /* Tab */)) {\r\n                if (_this._isReplaceVisible) {\r\n                    _this._replaceInput.focusOnPreserve();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }));\r\n        this._register(this._findInput.inputBox.onDidHeightChange(function (e) {\r\n            if (_this._tryUpdateHeight()) {\r\n                _this._showViewZone();\r\n            }\r\n        }));\r\n        if (platform.isLinux) {\r\n            this._register(this._findInput.onMouseDown(function (e) { return _this._onFindInputMouseDown(e); }));\r\n        }\r\n        this._matchesCount = document.createElement('div');\r\n        this._matchesCount.className = 'matchesCount';\r\n        this._updateMatchesCount();\r\n        // Previous button\r\n        this._prevBtn = this._register(new SimpleButton({\r\n            label: NLS_PREVIOUS_MATCH_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.PreviousMatchFindAction),\r\n            className: 'codicon codicon-arrow-up',\r\n            onTrigger: function () {\r\n                _this._codeEditor.getAction(FIND_IDS.PreviousMatchFindAction).run().then(undefined, onUnexpectedError);\r\n            }\r\n        }));\r\n        // Next button\r\n        this._nextBtn = this._register(new SimpleButton({\r\n            label: NLS_NEXT_MATCH_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.NextMatchFindAction),\r\n            className: 'codicon codicon-arrow-down',\r\n            onTrigger: function () {\r\n                _this._codeEditor.getAction(FIND_IDS.NextMatchFindAction).run().then(undefined, onUnexpectedError);\r\n            }\r\n        }));\r\n        var findPart = document.createElement('div');\r\n        findPart.className = 'find-part';\r\n        findPart.appendChild(this._findInput.domNode);\r\n        var actionsContainer = document.createElement('div');\r\n        actionsContainer.className = 'find-actions';\r\n        findPart.appendChild(actionsContainer);\r\n        actionsContainer.appendChild(this._matchesCount);\r\n        actionsContainer.appendChild(this._prevBtn.domNode);\r\n        actionsContainer.appendChild(this._nextBtn.domNode);\r\n        // Toggle selection button\r\n        this._toggleSelectionFind = this._register(new Checkbox({\r\n            actionClassName: 'codicon codicon-selection',\r\n            title: NLS_TOGGLE_SELECTION_FIND_TITLE + this._keybindingLabelFor(FIND_IDS.ToggleSearchScopeCommand),\r\n            isChecked: false\r\n        }));\r\n        this._register(this._toggleSelectionFind.onChange(function () {\r\n            if (_this._toggleSelectionFind.checked) {\r\n                if (_this._codeEditor.hasModel()) {\r\n                    var selection = _this._codeEditor.getSelection();\r\n                    if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) {\r\n                        selection = selection.setEndPosition(selection.endLineNumber - 1, _this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));\r\n                    }\r\n                    if (!selection.isEmpty()) {\r\n                        _this._state.change({ searchScope: selection }, true);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                _this._state.change({ searchScope: null }, true);\r\n            }\r\n        }));\r\n        actionsContainer.appendChild(this._toggleSelectionFind.domNode);\r\n        // Close button\r\n        this._closeBtn = this._register(new SimpleButton({\r\n            label: NLS_CLOSE_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.CloseFindWidgetCommand),\r\n            className: 'codicon codicon-close',\r\n            onTrigger: function () {\r\n                _this._state.change({ isRevealed: false, searchScope: null }, false);\r\n            },\r\n            onKeyDown: function (e) {\r\n                if (e.equals(2 /* Tab */)) {\r\n                    if (_this._isReplaceVisible) {\r\n                        if (_this._replaceBtn.isEnabled()) {\r\n                            _this._replaceBtn.focus();\r\n                        }\r\n                        else {\r\n                            _this._codeEditor.focus();\r\n                        }\r\n                        e.preventDefault();\r\n                    }\r\n                }\r\n            }\r\n        }));\r\n        actionsContainer.appendChild(this._closeBtn.domNode);\r\n        // Replace input\r\n        this._replaceInput = this._register(new ContextScopedReplaceInput(null, undefined, {\r\n            label: NLS_REPLACE_INPUT_LABEL,\r\n            placeholder: NLS_REPLACE_INPUT_PLACEHOLDER,\r\n            history: [],\r\n            flexibleHeight: flexibleHeight,\r\n            flexibleWidth: flexibleWidth,\r\n            flexibleMaxHeight: 118\r\n        }, this._contextKeyService, true));\r\n        this._replaceInput.setPreserveCase(!!this._state.preserveCase);\r\n        this._register(this._replaceInput.onKeyDown(function (e) { return _this._onReplaceInputKeyDown(e); }));\r\n        this._register(this._replaceInput.inputBox.onDidChange(function () {\r\n            _this._state.change({ replaceString: _this._replaceInput.inputBox.value }, false);\r\n        }));\r\n        this._register(this._replaceInput.inputBox.onDidHeightChange(function (e) {\r\n            if (_this._isReplaceVisible && _this._tryUpdateHeight()) {\r\n                _this._showViewZone();\r\n            }\r\n        }));\r\n        this._register(this._replaceInput.onDidOptionChange(function () {\r\n            _this._state.change({\r\n                preserveCase: _this._replaceInput.getPreserveCase()\r\n            }, true);\r\n        }));\r\n        this._register(this._replaceInput.onPreserveCaseKeyDown(function (e) {\r\n            if (e.equals(2 /* Tab */)) {\r\n                if (_this._prevBtn.isEnabled()) {\r\n                    _this._prevBtn.focus();\r\n                }\r\n                else if (_this._nextBtn.isEnabled()) {\r\n                    _this._nextBtn.focus();\r\n                }\r\n                else if (_this._toggleSelectionFind.enabled) {\r\n                    _this._toggleSelectionFind.focus();\r\n                }\r\n                else if (_this._closeBtn.isEnabled()) {\r\n                    _this._closeBtn.focus();\r\n                }\r\n                e.preventDefault();\r\n            }\r\n        }));\r\n        // Replace one button\r\n        this._replaceBtn = this._register(new SimpleButton({\r\n            label: NLS_REPLACE_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.ReplaceOneAction),\r\n            className: 'codicon codicon-replace',\r\n            onTrigger: function () {\r\n                _this._controller.replace();\r\n            },\r\n            onKeyDown: function (e) {\r\n                if (e.equals(1024 /* Shift */ | 2 /* Tab */)) {\r\n                    _this._closeBtn.focus();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }));\r\n        // Replace all button\r\n        this._replaceAllBtn = this._register(new SimpleButton({\r\n            label: NLS_REPLACE_ALL_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.ReplaceAllAction),\r\n            className: 'codicon codicon-replace-all',\r\n            onTrigger: function () {\r\n                _this._controller.replaceAll();\r\n            }\r\n        }));\r\n        var replacePart = document.createElement('div');\r\n        replacePart.className = 'replace-part';\r\n        replacePart.appendChild(this._replaceInput.domNode);\r\n        var replaceActionsContainer = document.createElement('div');\r\n        replaceActionsContainer.className = 'replace-actions';\r\n        replacePart.appendChild(replaceActionsContainer);\r\n        replaceActionsContainer.appendChild(this._replaceBtn.domNode);\r\n        replaceActionsContainer.appendChild(this._replaceAllBtn.domNode);\r\n        // Toggle replace button\r\n        this._toggleReplaceBtn = this._register(new SimpleButton({\r\n            label: NLS_TOGGLE_REPLACE_MODE_BTN_LABEL,\r\n            className: 'codicon toggle left',\r\n            onTrigger: function () {\r\n                _this._state.change({ isReplaceRevealed: !_this._isReplaceVisible }, false);\r\n                if (_this._isReplaceVisible) {\r\n                    _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\r\n                    _this._replaceInput.inputBox.layout();\r\n                }\r\n                _this._showViewZone();\r\n            }\r\n        }));\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-down', this._isReplaceVisible);\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-right', !this._isReplaceVisible);\r\n        this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);\r\n        // Widget\r\n        this._domNode = document.createElement('div');\r\n        this._domNode.className = 'editor-widget find-widget';\r\n        this._domNode.setAttribute('aria-hidden', 'true');\r\n        // We need to set this explicitly, otherwise on IE11, the width inheritence of flex doesn't work.\r\n        this._domNode.style.width = FIND_WIDGET_INITIAL_WIDTH + \"px\";\r\n        this._domNode.appendChild(this._toggleReplaceBtn.domNode);\r\n        this._domNode.appendChild(findPart);\r\n        this._domNode.appendChild(replacePart);\r\n        this._resizeSash = new Sash(this._domNode, this, { orientation: 0 /* VERTICAL */ });\r\n        this._resized = false;\r\n        var originalWidth = FIND_WIDGET_INITIAL_WIDTH;\r\n        this._register(this._resizeSash.onDidStart(function () {\r\n            originalWidth = dom.getTotalWidth(_this._domNode);\r\n        }));\r\n        this._register(this._resizeSash.onDidChange(function (evt) {\r\n            _this._resized = true;\r\n            var width = originalWidth + evt.startX - evt.currentX;\r\n            if (width < FIND_WIDGET_INITIAL_WIDTH) {\r\n                // narrow down the find widget should be handled by CSS.\r\n                return;\r\n            }\r\n            var maxWidth = parseFloat(dom.getComputedStyle(_this._domNode).maxWidth) || 0;\r\n            if (width > maxWidth) {\r\n                return;\r\n            }\r\n            _this._domNode.style.width = width + \"px\";\r\n            if (_this._isReplaceVisible) {\r\n                _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\r\n            }\r\n            _this._findInput.inputBox.layout();\r\n            _this._tryUpdateHeight();\r\n        }));\r\n        this._register(this._resizeSash.onDidReset(function () {\r\n            // users double click on the sash\r\n            var currentWidth = dom.getTotalWidth(_this._domNode);\r\n            if (currentWidth < FIND_WIDGET_INITIAL_WIDTH) {\r\n                // The editor is narrow and the width of the find widget is controlled fully by CSS.\r\n                return;\r\n            }\r\n            var width = FIND_WIDGET_INITIAL_WIDTH;\r\n            if (!_this._resized || currentWidth === FIND_WIDGET_INITIAL_WIDTH) {\r\n                // 1. never resized before, double click should maximizes it\r\n                // 2. users resized it already but its width is the same as default\r\n                var layoutInfo = _this._codeEditor.getLayoutInfo();\r\n                width = layoutInfo.width - 28 - layoutInfo.minimapWidth - 15;\r\n                _this._resized = true;\r\n            }\r\n            else {\r\n                /**\r\n                 * no op, the find widget should be shrinked to its default size.\r\n                 */\r\n            }\r\n            _this._domNode.style.width = width + \"px\";\r\n            if (_this._isReplaceVisible) {\r\n                _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\r\n            }\r\n            _this._findInput.inputBox.layout();\r\n        }));\r\n    };\r\n    FindWidget.prototype.updateAccessibilitySupport = function () {\r\n        var value = this._codeEditor.getOption(2 /* accessibilitySupport */);\r\n        this._findInput.setFocusInputOnOptionClick(value !== 2 /* Enabled */);\r\n    };\r\n    FindWidget.ID = 'editor.contrib.findWidget';\r\n    return FindWidget;\r\n}(Widget));\r\nexport { FindWidget };\r\nvar SimpleButton = /** @class */ (function (_super) {\r\n    __extends(SimpleButton, _super);\r\n    function SimpleButton(opts) {\r\n        var _this = _super.call(this) || this;\r\n        _this._opts = opts;\r\n        _this._domNode = document.createElement('div');\r\n        _this._domNode.title = _this._opts.label;\r\n        _this._domNode.tabIndex = 0;\r\n        _this._domNode.className = 'button ' + _this._opts.className;\r\n        _this._domNode.setAttribute('role', 'button');\r\n        _this._domNode.setAttribute('aria-label', _this._opts.label);\r\n        _this.onclick(_this._domNode, function (e) {\r\n            _this._opts.onTrigger();\r\n            e.preventDefault();\r\n        });\r\n        _this.onkeydown(_this._domNode, function (e) {\r\n            if (e.equals(10 /* Space */) || e.equals(3 /* Enter */)) {\r\n                _this._opts.onTrigger();\r\n                e.preventDefault();\r\n                return;\r\n            }\r\n            if (_this._opts.onKeyDown) {\r\n                _this._opts.onKeyDown(e);\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    Object.defineProperty(SimpleButton.prototype, \"domNode\", {\r\n        get: function () {\r\n            return this._domNode;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SimpleButton.prototype.isEnabled = function () {\r\n        return (this._domNode.tabIndex >= 0);\r\n    };\r\n    SimpleButton.prototype.focus = function () {\r\n        this._domNode.focus();\r\n    };\r\n    SimpleButton.prototype.setEnabled = function (enabled) {\r\n        dom.toggleClass(this._domNode, 'disabled', !enabled);\r\n        this._domNode.setAttribute('aria-disabled', String(!enabled));\r\n        this._domNode.tabIndex = enabled ? 0 : -1;\r\n    };\r\n    SimpleButton.prototype.setExpanded = function (expanded) {\r\n        this._domNode.setAttribute('aria-expanded', String(!!expanded));\r\n    };\r\n    SimpleButton.prototype.toggleClass = function (className, shouldHaveIt) {\r\n        dom.toggleClass(this._domNode, className, shouldHaveIt);\r\n    };\r\n    return SimpleButton;\r\n}(Widget));\r\nexport { SimpleButton };\r\n// theming\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var addBackgroundColorRule = function (selector, color) {\r\n        if (color) {\r\n            collector.addRule(\".monaco-editor \" + selector + \" { background-color: \" + color + \"; }\");\r\n        }\r\n    };\r\n    addBackgroundColorRule('.findMatch', theme.getColor(editorFindMatchHighlight));\r\n    addBackgroundColorRule('.currentFindMatch', theme.getColor(editorFindMatch));\r\n    addBackgroundColorRule('.findScope', theme.getColor(editorFindRangeHighlight));\r\n    var widgetBackground = theme.getColor(editorWidgetBackground);\r\n    addBackgroundColorRule('.find-widget', widgetBackground);\r\n    var widgetShadowColor = theme.getColor(widgetShadow);\r\n    if (widgetShadowColor) {\r\n        collector.addRule(\".monaco-editor .find-widget { box-shadow: 0 2px 8px \" + widgetShadowColor + \"; }\");\r\n    }\r\n    var findMatchHighlightBorder = theme.getColor(editorFindMatchHighlightBorder);\r\n    if (findMatchHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .findMatch { border: 1px \" + (theme.type === 'hc' ? 'dotted' : 'solid') + \" \" + findMatchHighlightBorder + \"; box-sizing: border-box; }\");\r\n    }\r\n    var findMatchBorder = theme.getColor(editorFindMatchBorder);\r\n    if (findMatchBorder) {\r\n        collector.addRule(\".monaco-editor .currentFindMatch { border: 2px solid \" + findMatchBorder + \"; padding: 1px; box-sizing: border-box; }\");\r\n    }\r\n    var findRangeHighlightBorder = theme.getColor(editorFindRangeHighlightBorder);\r\n    if (findRangeHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .findScope { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + findRangeHighlightBorder + \"; }\");\r\n    }\r\n    var hcBorder = theme.getColor(contrastBorder);\r\n    if (hcBorder) {\r\n        collector.addRule(\".monaco-editor .find-widget { border: 1px solid \" + hcBorder + \"; }\");\r\n    }\r\n    var foreground = theme.getColor(editorWidgetForeground);\r\n    if (foreground) {\r\n        collector.addRule(\".monaco-editor .find-widget { color: \" + foreground + \"; }\");\r\n    }\r\n    var error = theme.getColor(errorForeground);\r\n    if (error) {\r\n        collector.addRule(\".monaco-editor .find-widget.no-results .matchesCount { color: \" + error + \"; }\");\r\n    }\r\n    var resizeBorderBackground = theme.getColor(editorWidgetResizeBorder);\r\n    if (resizeBorderBackground) {\r\n        collector.addRule(\".monaco-editor .find-widget .monaco-sash { background-color: \" + resizeBorderBackground + \"; width: 3px !important; margin-left: -4px;}\");\r\n    }\r\n    else {\r\n        var border = theme.getColor(editorWidgetBorder);\r\n        if (border) {\r\n            collector.addRule(\".monaco-editor .find-widget .monaco-sash { background-color: \" + border + \"; width: 3px !important; margin-left: -4px;}\");\r\n        }\r\n    }\r\n    // This rule is used to override the outline color for synthetic-focus find input.\r\n    var focusOutline = theme.getColor(focusBorder);\r\n    if (focusOutline) {\r\n        collector.addRule(\".monaco-editor .find-widget .monaco-inputbox.synthetic-focus { outline-color: \" + focusOutline + \"; }\");\r\n    }\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nexport var MAX_FOLDING_REGIONS = 0xFFFF;\r\nexport var MAX_LINE_NUMBER = 0xFFFFFF;\r\nvar MASK_INDENT = 0xFF000000;\r\nvar FoldingRegions = /** @class */ (function () {\r\n    function FoldingRegions(startIndexes, endIndexes, types) {\r\n        if (startIndexes.length !== endIndexes.length || startIndexes.length > MAX_FOLDING_REGIONS) {\r\n            throw new Error('invalid startIndexes or endIndexes size');\r\n        }\r\n        this._startIndexes = startIndexes;\r\n        this._endIndexes = endIndexes;\r\n        this._collapseStates = new Uint32Array(Math.ceil(startIndexes.length / 32));\r\n        this._types = types;\r\n        this._parentsComputed = false;\r\n    }\r\n    FoldingRegions.prototype.ensureParentIndices = function () {\r\n        var _this = this;\r\n        if (!this._parentsComputed) {\r\n            this._parentsComputed = true;\r\n            var parentIndexes_1 = [];\r\n            var isInsideLast = function (startLineNumber, endLineNumber) {\r\n                var index = parentIndexes_1[parentIndexes_1.length - 1];\r\n                return _this.getStartLineNumber(index) <= startLineNumber && _this.getEndLineNumber(index) >= endLineNumber;\r\n            };\r\n            for (var i = 0, len = this._startIndexes.length; i < len; i++) {\r\n                var startLineNumber = this._startIndexes[i];\r\n                var endLineNumber = this._endIndexes[i];\r\n                if (startLineNumber > MAX_LINE_NUMBER || endLineNumber > MAX_LINE_NUMBER) {\r\n                    throw new Error('startLineNumber or endLineNumber must not exceed ' + MAX_LINE_NUMBER);\r\n                }\r\n                while (parentIndexes_1.length > 0 && !isInsideLast(startLineNumber, endLineNumber)) {\r\n                    parentIndexes_1.pop();\r\n                }\r\n                var parentIndex = parentIndexes_1.length > 0 ? parentIndexes_1[parentIndexes_1.length - 1] : -1;\r\n                parentIndexes_1.push(i);\r\n                this._startIndexes[i] = startLineNumber + ((parentIndex & 0xFF) << 24);\r\n                this._endIndexes[i] = endLineNumber + ((parentIndex & 0xFF00) << 16);\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(FoldingRegions.prototype, \"length\", {\r\n        get: function () {\r\n            return this._startIndexes.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    FoldingRegions.prototype.getStartLineNumber = function (index) {\r\n        return this._startIndexes[index] & MAX_LINE_NUMBER;\r\n    };\r\n    FoldingRegions.prototype.getEndLineNumber = function (index) {\r\n        return this._endIndexes[index] & MAX_LINE_NUMBER;\r\n    };\r\n    FoldingRegions.prototype.getType = function (index) {\r\n        return this._types ? this._types[index] : undefined;\r\n    };\r\n    FoldingRegions.prototype.hasTypes = function () {\r\n        return !!this._types;\r\n    };\r\n    FoldingRegions.prototype.isCollapsed = function (index) {\r\n        var arrayIndex = (index / 32) | 0;\r\n        var bit = index % 32;\r\n        return (this._collapseStates[arrayIndex] & (1 << bit)) !== 0;\r\n    };\r\n    FoldingRegions.prototype.setCollapsed = function (index, newState) {\r\n        var arrayIndex = (index / 32) | 0;\r\n        var bit = index % 32;\r\n        var value = this._collapseStates[arrayIndex];\r\n        if (newState) {\r\n            this._collapseStates[arrayIndex] = value | (1 << bit);\r\n        }\r\n        else {\r\n            this._collapseStates[arrayIndex] = value & ~(1 << bit);\r\n        }\r\n    };\r\n    FoldingRegions.prototype.toRegion = function (index) {\r\n        return new FoldingRegion(this, index);\r\n    };\r\n    FoldingRegions.prototype.getParentIndex = function (index) {\r\n        this.ensureParentIndices();\r\n        var parent = ((this._startIndexes[index] & MASK_INDENT) >>> 24) + ((this._endIndexes[index] & MASK_INDENT) >>> 16);\r\n        if (parent === MAX_FOLDING_REGIONS) {\r\n            return -1;\r\n        }\r\n        return parent;\r\n    };\r\n    FoldingRegions.prototype.contains = function (index, line) {\r\n        return this.getStartLineNumber(index) <= line && this.getEndLineNumber(index) >= line;\r\n    };\r\n    FoldingRegions.prototype.findIndex = function (line) {\r\n        var low = 0, high = this._startIndexes.length;\r\n        if (high === 0) {\r\n            return -1; // no children\r\n        }\r\n        while (low < high) {\r\n            var mid = Math.floor((low + high) / 2);\r\n            if (line < this.getStartLineNumber(mid)) {\r\n                high = mid;\r\n            }\r\n            else {\r\n                low = mid + 1;\r\n            }\r\n        }\r\n        return low - 1;\r\n    };\r\n    FoldingRegions.prototype.findRange = function (line) {\r\n        var index = this.findIndex(line);\r\n        if (index >= 0) {\r\n            var endLineNumber = this.getEndLineNumber(index);\r\n            if (endLineNumber >= line) {\r\n                return index;\r\n            }\r\n            index = this.getParentIndex(index);\r\n            while (index !== -1) {\r\n                if (this.contains(index, line)) {\r\n                    return index;\r\n                }\r\n                index = this.getParentIndex(index);\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    FoldingRegions.prototype.toString = function () {\r\n        var res = [];\r\n        for (var i = 0; i < this.length; i++) {\r\n            res[i] = \"[\" + (this.isCollapsed(i) ? '+' : '-') + \"] \" + this.getStartLineNumber(i) + \"/\" + this.getEndLineNumber(i);\r\n        }\r\n        return res.join(', ');\r\n    };\r\n    return FoldingRegions;\r\n}());\r\nexport { FoldingRegions };\r\nvar FoldingRegion = /** @class */ (function () {\r\n    function FoldingRegion(ranges, index) {\r\n        this.ranges = ranges;\r\n        this.index = index;\r\n    }\r\n    Object.defineProperty(FoldingRegion.prototype, \"startLineNumber\", {\r\n        get: function () {\r\n            return this.ranges.getStartLineNumber(this.index);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FoldingRegion.prototype, \"endLineNumber\", {\r\n        get: function () {\r\n            return this.ranges.getEndLineNumber(this.index);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FoldingRegion.prototype, \"regionIndex\", {\r\n        get: function () {\r\n            return this.index;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FoldingRegion.prototype, \"parentIndex\", {\r\n        get: function () {\r\n            return this.ranges.getParentIndex(this.index);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FoldingRegion.prototype, \"isCollapsed\", {\r\n        get: function () {\r\n            return this.ranges.isCollapsed(this.index);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    FoldingRegion.prototype.containedBy = function (range) {\r\n        return range.startLineNumber <= this.startLineNumber && range.endLineNumber >= this.endLineNumber;\r\n    };\r\n    FoldingRegion.prototype.containsLine = function (lineNumber) {\r\n        return this.startLineNumber <= lineNumber && lineNumber <= this.endLineNumber;\r\n    };\r\n    return FoldingRegion;\r\n}());\r\nexport { FoldingRegion };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { FoldingRegions } from './foldingRanges.js';\r\nvar FoldingModel = /** @class */ (function () {\r\n    function FoldingModel(textModel, decorationProvider) {\r\n        this._updateEventEmitter = new Emitter();\r\n        this.onDidChange = this._updateEventEmitter.event;\r\n        this._textModel = textModel;\r\n        this._decorationProvider = decorationProvider;\r\n        this._regions = new FoldingRegions(new Uint32Array(0), new Uint32Array(0));\r\n        this._editorDecorationIds = [];\r\n        this._isInitialized = false;\r\n    }\r\n    Object.defineProperty(FoldingModel.prototype, \"regions\", {\r\n        get: function () { return this._regions; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FoldingModel.prototype, \"textModel\", {\r\n        get: function () { return this._textModel; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FoldingModel.prototype, \"isInitialized\", {\r\n        get: function () { return this._isInitialized; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    FoldingModel.prototype.toggleCollapseState = function (regions) {\r\n        var _this = this;\r\n        if (!regions.length) {\r\n            return;\r\n        }\r\n        var processed = {};\r\n        this._decorationProvider.changeDecorations(function (accessor) {\r\n            for (var _i = 0, regions_1 = regions; _i < regions_1.length; _i++) {\r\n                var region = regions_1[_i];\r\n                var index = region.regionIndex;\r\n                var editorDecorationId = _this._editorDecorationIds[index];\r\n                if (editorDecorationId && !processed[editorDecorationId]) {\r\n                    processed[editorDecorationId] = true;\r\n                    var newCollapseState = !_this._regions.isCollapsed(index);\r\n                    _this._regions.setCollapsed(index, newCollapseState);\r\n                    accessor.changeDecorationOptions(editorDecorationId, _this._decorationProvider.getDecorationOption(newCollapseState));\r\n                }\r\n            }\r\n        });\r\n        this._updateEventEmitter.fire({ model: this, collapseStateChanged: regions });\r\n    };\r\n    FoldingModel.prototype.update = function (newRegions, blockedLineNumers) {\r\n        var _this = this;\r\n        if (blockedLineNumers === void 0) { blockedLineNumers = []; }\r\n        var newEditorDecorations = [];\r\n        var isBlocked = function (startLineNumber, endLineNumber) {\r\n            for (var _i = 0, blockedLineNumers_1 = blockedLineNumers; _i < blockedLineNumers_1.length; _i++) {\r\n                var blockedLineNumber = blockedLineNumers_1[_i];\r\n                if (startLineNumber < blockedLineNumber && blockedLineNumber <= endLineNumber) { // first line is visible\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var initRange = function (index, isCollapsed) {\r\n            var startLineNumber = newRegions.getStartLineNumber(index);\r\n            if (isCollapsed && isBlocked(startLineNumber, newRegions.getEndLineNumber(index))) {\r\n                isCollapsed = false;\r\n            }\r\n            newRegions.setCollapsed(index, isCollapsed);\r\n            var maxColumn = _this._textModel.getLineMaxColumn(startLineNumber);\r\n            var decorationRange = {\r\n                startLineNumber: startLineNumber,\r\n                startColumn: maxColumn,\r\n                endLineNumber: startLineNumber,\r\n                endColumn: maxColumn\r\n            };\r\n            newEditorDecorations.push({ range: decorationRange, options: _this._decorationProvider.getDecorationOption(isCollapsed) });\r\n        };\r\n        var i = 0;\r\n        var nextCollapsed = function () {\r\n            while (i < _this._regions.length) {\r\n                var isCollapsed = _this._regions.isCollapsed(i);\r\n                i++;\r\n                if (isCollapsed) {\r\n                    return i - 1;\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var k = 0;\r\n        var collapsedIndex = nextCollapsed();\r\n        while (collapsedIndex !== -1 && k < newRegions.length) {\r\n            // get the latest range\r\n            var decRange = this._textModel.getDecorationRange(this._editorDecorationIds[collapsedIndex]);\r\n            if (decRange) {\r\n                var collapsedStartLineNumber = decRange.startLineNumber;\r\n                if (this._textModel.getLineMaxColumn(collapsedStartLineNumber) === decRange.startColumn) { // test that the decoration is still at the end otherwise it got deleted\r\n                    while (k < newRegions.length) {\r\n                        var startLineNumber = newRegions.getStartLineNumber(k);\r\n                        if (collapsedStartLineNumber >= startLineNumber) {\r\n                            initRange(k, collapsedStartLineNumber === startLineNumber);\r\n                            k++;\r\n                        }\r\n                        else {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            collapsedIndex = nextCollapsed();\r\n        }\r\n        while (k < newRegions.length) {\r\n            initRange(k, false);\r\n            k++;\r\n        }\r\n        this._editorDecorationIds = this._decorationProvider.deltaDecorations(this._editorDecorationIds, newEditorDecorations);\r\n        this._regions = newRegions;\r\n        this._isInitialized = true;\r\n        this._updateEventEmitter.fire({ model: this });\r\n    };\r\n    /**\r\n     * Collapse state memento, for persistence only\r\n     */\r\n    FoldingModel.prototype.getMemento = function () {\r\n        var collapsedRanges = [];\r\n        for (var i = 0; i < this._regions.length; i++) {\r\n            if (this._regions.isCollapsed(i)) {\r\n                var range = this._textModel.getDecorationRange(this._editorDecorationIds[i]);\r\n                if (range) {\r\n                    var startLineNumber = range.startLineNumber;\r\n                    var endLineNumber = range.endLineNumber + this._regions.getEndLineNumber(i) - this._regions.getStartLineNumber(i);\r\n                    collapsedRanges.push({ startLineNumber: startLineNumber, endLineNumber: endLineNumber });\r\n                }\r\n            }\r\n        }\r\n        if (collapsedRanges.length > 0) {\r\n            return collapsedRanges;\r\n        }\r\n        return undefined;\r\n    };\r\n    /**\r\n     * Apply persisted state, for persistence only\r\n     */\r\n    FoldingModel.prototype.applyMemento = function (state) {\r\n        if (!Array.isArray(state)) {\r\n            return;\r\n        }\r\n        var toToogle = [];\r\n        for (var _i = 0, state_1 = state; _i < state_1.length; _i++) {\r\n            var range = state_1[_i];\r\n            var region = this.getRegionAtLine(range.startLineNumber);\r\n            if (region && !region.isCollapsed) {\r\n                toToogle.push(region);\r\n            }\r\n        }\r\n        this.toggleCollapseState(toToogle);\r\n    };\r\n    FoldingModel.prototype.dispose = function () {\r\n        this._decorationProvider.deltaDecorations(this._editorDecorationIds, []);\r\n    };\r\n    FoldingModel.prototype.getAllRegionsAtLine = function (lineNumber, filter) {\r\n        var result = [];\r\n        if (this._regions) {\r\n            var index = this._regions.findRange(lineNumber);\r\n            var level = 1;\r\n            while (index >= 0) {\r\n                var current = this._regions.toRegion(index);\r\n                if (!filter || filter(current, level)) {\r\n                    result.push(current);\r\n                }\r\n                level++;\r\n                index = current.parentIndex;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    FoldingModel.prototype.getRegionAtLine = function (lineNumber) {\r\n        if (this._regions) {\r\n            var index = this._regions.findRange(lineNumber);\r\n            if (index >= 0) {\r\n                return this._regions.toRegion(index);\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    FoldingModel.prototype.getRegionsInside = function (region, filter) {\r\n        var result = [];\r\n        var index = region ? region.regionIndex + 1 : 0;\r\n        var endLineNumber = region ? region.endLineNumber : Number.MAX_VALUE;\r\n        if (filter && filter.length === 2) {\r\n            var levelStack = [];\r\n            for (var i = index, len = this._regions.length; i < len; i++) {\r\n                var current = this._regions.toRegion(i);\r\n                if (this._regions.getStartLineNumber(i) < endLineNumber) {\r\n                    while (levelStack.length > 0 && !current.containedBy(levelStack[levelStack.length - 1])) {\r\n                        levelStack.pop();\r\n                    }\r\n                    levelStack.push(current);\r\n                    if (filter(current, levelStack.length)) {\r\n                        result.push(current);\r\n                    }\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            for (var i = index, len = this._regions.length; i < len; i++) {\r\n                var current = this._regions.toRegion(i);\r\n                if (this._regions.getStartLineNumber(i) < endLineNumber) {\r\n                    if (!filter || filter(current)) {\r\n                        result.push(current);\r\n                    }\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    return FoldingModel;\r\n}());\r\nexport { FoldingModel };\r\n/**\r\n * Collapse or expand the regions at the given locations\r\n * @param levels The number of levels. Use 1 to only impact the regions at the location, use Number.MAX_VALUE for all levels.\r\n * @param lineNumbers the location of the regions to collapse or expand, or if not set, all regions in the model.\r\n */\r\nexport function toggleCollapseState(foldingModel, levels, lineNumbers) {\r\n    var toToggle = [];\r\n    var _loop_1 = function (lineNumber) {\r\n        var region = foldingModel.getRegionAtLine(lineNumber);\r\n        if (region) {\r\n            var doCollapse_1 = !region.isCollapsed;\r\n            toToggle.push(region);\r\n            if (levels > 1) {\r\n                var regionsInside = foldingModel.getRegionsInside(region, function (r, level) { return r.isCollapsed !== doCollapse_1 && level < levels; });\r\n                toToggle.push.apply(toToggle, regionsInside);\r\n            }\r\n        }\r\n    };\r\n    for (var _i = 0, lineNumbers_1 = lineNumbers; _i < lineNumbers_1.length; _i++) {\r\n        var lineNumber = lineNumbers_1[_i];\r\n        _loop_1(lineNumber);\r\n    }\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n/**\r\n * Collapse or expand the regions at the given locations including all children.\r\n * @param doCollapse Wheter to collase or expand\r\n * @param levels The number of levels. Use 1 to only impact the regions at the location, use Number.MAX_VALUE for all levels.\r\n * @param lineNumbers the location of the regions to collapse or expand, or if not set, all regions in the model.\r\n */\r\nexport function setCollapseStateLevelsDown(foldingModel, doCollapse, levels, lineNumbers) {\r\n    if (levels === void 0) { levels = Number.MAX_VALUE; }\r\n    var toToggle = [];\r\n    if (lineNumbers && lineNumbers.length > 0) {\r\n        for (var _i = 0, lineNumbers_2 = lineNumbers; _i < lineNumbers_2.length; _i++) {\r\n            var lineNumber = lineNumbers_2[_i];\r\n            var region = foldingModel.getRegionAtLine(lineNumber);\r\n            if (region) {\r\n                if (region.isCollapsed !== doCollapse) {\r\n                    toToggle.push(region);\r\n                }\r\n                if (levels > 1) {\r\n                    var regionsInside = foldingModel.getRegionsInside(region, function (r, level) { return r.isCollapsed !== doCollapse && level < levels; });\r\n                    toToggle.push.apply(toToggle, regionsInside);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        var regionsInside = foldingModel.getRegionsInside(null, function (r, level) { return r.isCollapsed !== doCollapse && level < levels; });\r\n        toToggle.push.apply(toToggle, regionsInside);\r\n    }\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n/**\r\n * Collapse or expand the regions at the given locations including all parents.\r\n * @param doCollapse Wheter to collase or expand\r\n * @param levels The number of levels. Use 1 to only impact the regions at the location, use Number.MAX_VALUE for all levels.\r\n * @param lineNumbers the location of the regions to collapse or expand.\r\n */\r\nexport function setCollapseStateLevelsUp(foldingModel, doCollapse, levels, lineNumbers) {\r\n    var toToggle = [];\r\n    for (var _i = 0, lineNumbers_3 = lineNumbers; _i < lineNumbers_3.length; _i++) {\r\n        var lineNumber = lineNumbers_3[_i];\r\n        var regions = foldingModel.getAllRegionsAtLine(lineNumber, function (region, level) { return region.isCollapsed !== doCollapse && level <= levels; });\r\n        toToggle.push.apply(toToggle, regions);\r\n    }\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n/**\r\n * Collapse or expand a region at the given locations. If the inner most region is already collapsed/expanded, uses the first parent instead.\r\n * @param doCollapse Wheter to collase or expand\r\n * @param lineNumbers the location of the regions to collapse or expand.\r\n */\r\nexport function setCollapseStateUp(foldingModel, doCollapse, lineNumbers) {\r\n    var toToggle = [];\r\n    for (var _i = 0, lineNumbers_4 = lineNumbers; _i < lineNumbers_4.length; _i++) {\r\n        var lineNumber = lineNumbers_4[_i];\r\n        var regions = foldingModel.getAllRegionsAtLine(lineNumber, function (region) { return region.isCollapsed !== doCollapse; });\r\n        if (regions.length > 0) {\r\n            toToggle.push(regions[0]);\r\n        }\r\n    }\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n/**\r\n * Folds or unfolds all regions that have a given level, except if they contain one of the blocked lines.\r\n * @param foldLevel level. Level == 1 is the top level\r\n * @param doCollapse Wheter to collase or expand\r\n*/\r\nexport function setCollapseStateAtLevel(foldingModel, foldLevel, doCollapse, blockedLineNumbers) {\r\n    var filter = function (region, level) { return level === foldLevel && region.isCollapsed !== doCollapse && !blockedLineNumbers.some(function (line) { return region.containsLine(line); }); };\r\n    var toToggle = foldingModel.getRegionsInside(null, filter);\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n/**\r\n * Folds all regions for which the lines start with a given regex\r\n * @param foldingModel the folding model\r\n */\r\nexport function setCollapseStateForMatchingLines(foldingModel, regExp, doCollapse) {\r\n    var editorModel = foldingModel.textModel;\r\n    var regions = foldingModel.regions;\r\n    var toToggle = [];\r\n    for (var i = regions.length - 1; i >= 0; i--) {\r\n        if (doCollapse !== regions.isCollapsed(i)) {\r\n            var startLineNumber = regions.getStartLineNumber(i);\r\n            if (regExp.test(editorModel.getLineContent(startLineNumber))) {\r\n                toToggle.push(regions.toRegion(i));\r\n            }\r\n        }\r\n    }\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n/**\r\n * Folds all regions of the given type\r\n * @param foldingModel the folding model\r\n */\r\nexport function setCollapseStateForType(foldingModel, type, doCollapse) {\r\n    var regions = foldingModel.regions;\r\n    var toToggle = [];\r\n    for (var i = regions.length - 1; i >= 0; i--) {\r\n        if (doCollapse !== regions.isCollapsed(i) && type === regions.getType(i)) {\r\n            toToggle.push(regions.toRegion(i));\r\n        }\r\n    }\r\n    foldingModel.toggleCollapseState(toToggle);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nvar FoldingDecorationProvider = /** @class */ (function () {\r\n    function FoldingDecorationProvider(editor) {\r\n        this.editor = editor;\r\n        this.autoHideFoldingControls = true;\r\n        this.showFoldingHighlights = true;\r\n    }\r\n    FoldingDecorationProvider.prototype.getDecorationOption = function (isCollapsed) {\r\n        if (isCollapsed) {\r\n            return this.showFoldingHighlights ? FoldingDecorationProvider.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION : FoldingDecorationProvider.COLLAPSED_VISUAL_DECORATION;\r\n        }\r\n        else if (this.autoHideFoldingControls) {\r\n            return FoldingDecorationProvider.EXPANDED_AUTO_HIDE_VISUAL_DECORATION;\r\n        }\r\n        else {\r\n            return FoldingDecorationProvider.EXPANDED_VISUAL_DECORATION;\r\n        }\r\n    };\r\n    FoldingDecorationProvider.prototype.deltaDecorations = function (oldDecorations, newDecorations) {\r\n        return this.editor.deltaDecorations(oldDecorations, newDecorations);\r\n    };\r\n    FoldingDecorationProvider.prototype.changeDecorations = function (callback) {\r\n        return this.editor.changeDecorations(callback);\r\n    };\r\n    FoldingDecorationProvider.COLLAPSED_VISUAL_DECORATION = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        afterContentClassName: 'inline-folded',\r\n        linesDecorationsClassName: 'codicon codicon-chevron-right'\r\n    });\r\n    FoldingDecorationProvider.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        afterContentClassName: 'inline-folded',\r\n        className: 'folded-background',\r\n        isWholeLine: true,\r\n        linesDecorationsClassName: 'codicon codicon-chevron-right'\r\n    });\r\n    FoldingDecorationProvider.EXPANDED_AUTO_HIDE_VISUAL_DECORATION = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        linesDecorationsClassName: 'codicon codicon-chevron-down'\r\n    });\r\n    FoldingDecorationProvider.EXPANDED_VISUAL_DECORATION = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        linesDecorationsClassName: 'codicon codicon-chevron-down alwaysShowFoldIcons'\r\n    });\r\n    return FoldingDecorationProvider;\r\n}());\r\nexport { FoldingDecorationProvider };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { findFirstInSorted } from '../../../base/common/arrays.js';\r\nvar HiddenRangeModel = /** @class */ (function () {\r\n    function HiddenRangeModel(model) {\r\n        var _this = this;\r\n        this._updateEventEmitter = new Emitter();\r\n        this._foldingModel = model;\r\n        this._foldingModelListener = model.onDidChange(function (_) { return _this.updateHiddenRanges(); });\r\n        this._hiddenRanges = [];\r\n        if (model.regions.length) {\r\n            this.updateHiddenRanges();\r\n        }\r\n    }\r\n    Object.defineProperty(HiddenRangeModel.prototype, \"onDidChange\", {\r\n        get: function () { return this._updateEventEmitter.event; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HiddenRangeModel.prototype, \"hiddenRanges\", {\r\n        get: function () { return this._hiddenRanges; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    HiddenRangeModel.prototype.updateHiddenRanges = function () {\r\n        var updateHiddenAreas = false;\r\n        var newHiddenAreas = [];\r\n        var i = 0; // index into hidden\r\n        var k = 0;\r\n        var lastCollapsedStart = Number.MAX_VALUE;\r\n        var lastCollapsedEnd = -1;\r\n        var ranges = this._foldingModel.regions;\r\n        for (; i < ranges.length; i++) {\r\n            if (!ranges.isCollapsed(i)) {\r\n                continue;\r\n            }\r\n            var startLineNumber = ranges.getStartLineNumber(i) + 1; // the first line is not hidden\r\n            var endLineNumber = ranges.getEndLineNumber(i);\r\n            if (lastCollapsedStart <= startLineNumber && endLineNumber <= lastCollapsedEnd) {\r\n                // ignore ranges contained in collapsed regions\r\n                continue;\r\n            }\r\n            if (!updateHiddenAreas && k < this._hiddenRanges.length && this._hiddenRanges[k].startLineNumber === startLineNumber && this._hiddenRanges[k].endLineNumber === endLineNumber) {\r\n                // reuse the old ranges\r\n                newHiddenAreas.push(this._hiddenRanges[k]);\r\n                k++;\r\n            }\r\n            else {\r\n                updateHiddenAreas = true;\r\n                newHiddenAreas.push(new Range(startLineNumber, 1, endLineNumber, 1));\r\n            }\r\n            lastCollapsedStart = startLineNumber;\r\n            lastCollapsedEnd = endLineNumber;\r\n        }\r\n        if (updateHiddenAreas || k < this._hiddenRanges.length) {\r\n            this.applyHiddenRanges(newHiddenAreas);\r\n        }\r\n    };\r\n    HiddenRangeModel.prototype.applyMemento = function (state) {\r\n        if (!Array.isArray(state) || state.length === 0) {\r\n            return false;\r\n        }\r\n        var hiddenRanges = [];\r\n        for (var _i = 0, state_1 = state; _i < state_1.length; _i++) {\r\n            var r = state_1[_i];\r\n            if (!r.startLineNumber || !r.endLineNumber) {\r\n                return false;\r\n            }\r\n            hiddenRanges.push(new Range(r.startLineNumber + 1, 1, r.endLineNumber, 1));\r\n        }\r\n        this.applyHiddenRanges(hiddenRanges);\r\n        return true;\r\n    };\r\n    /**\r\n     * Collapse state memento, for persistence only, only used if folding model is not yet initialized\r\n     */\r\n    HiddenRangeModel.prototype.getMemento = function () {\r\n        return this._hiddenRanges.map(function (r) { return ({ startLineNumber: r.startLineNumber - 1, endLineNumber: r.endLineNumber }); });\r\n    };\r\n    HiddenRangeModel.prototype.applyHiddenRanges = function (newHiddenAreas) {\r\n        this._hiddenRanges = newHiddenAreas;\r\n        this._updateEventEmitter.fire(newHiddenAreas);\r\n    };\r\n    HiddenRangeModel.prototype.hasRanges = function () {\r\n        return this._hiddenRanges.length > 0;\r\n    };\r\n    HiddenRangeModel.prototype.isHidden = function (line) {\r\n        return findRange(this._hiddenRanges, line) !== null;\r\n    };\r\n    HiddenRangeModel.prototype.adjustSelections = function (selections) {\r\n        var _this = this;\r\n        var hasChanges = false;\r\n        var editorModel = this._foldingModel.textModel;\r\n        var lastRange = null;\r\n        var adjustLine = function (line) {\r\n            if (!lastRange || !isInside(line, lastRange)) {\r\n                lastRange = findRange(_this._hiddenRanges, line);\r\n            }\r\n            if (lastRange) {\r\n                return lastRange.startLineNumber - 1;\r\n            }\r\n            return null;\r\n        };\r\n        for (var i = 0, len = selections.length; i < len; i++) {\r\n            var selection = selections[i];\r\n            var adjustedStartLine = adjustLine(selection.startLineNumber);\r\n            if (adjustedStartLine) {\r\n                selection = selection.setStartPosition(adjustedStartLine, editorModel.getLineMaxColumn(adjustedStartLine));\r\n                hasChanges = true;\r\n            }\r\n            var adjustedEndLine = adjustLine(selection.endLineNumber);\r\n            if (adjustedEndLine) {\r\n                selection = selection.setEndPosition(adjustedEndLine, editorModel.getLineMaxColumn(adjustedEndLine));\r\n                hasChanges = true;\r\n            }\r\n            selections[i] = selection;\r\n        }\r\n        return hasChanges;\r\n    };\r\n    HiddenRangeModel.prototype.dispose = function () {\r\n        if (this.hiddenRanges.length > 0) {\r\n            this._hiddenRanges = [];\r\n            this._updateEventEmitter.fire(this._hiddenRanges);\r\n        }\r\n        if (this._foldingModelListener) {\r\n            this._foldingModelListener.dispose();\r\n            this._foldingModelListener = null;\r\n        }\r\n    };\r\n    return HiddenRangeModel;\r\n}());\r\nexport { HiddenRangeModel };\r\nfunction isInside(line, range) {\r\n    return line >= range.startLineNumber && line <= range.endLineNumber;\r\n}\r\nfunction findRange(ranges, line) {\r\n    var i = findFirstInSorted(ranges, function (r) { return line < r.startLineNumber; }) - 1;\r\n    if (i >= 0 && ranges[i].endLineNumber >= line) {\r\n        return ranges[i];\r\n    }\r\n    return null;\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { FoldingRegions, MAX_LINE_NUMBER } from './foldingRanges.js';\r\nimport { TextModel } from '../../common/model/textModel.js';\r\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\r\nvar MAX_FOLDING_REGIONS_FOR_INDENT_LIMIT = 5000;\r\nexport var ID_INDENT_PROVIDER = 'indent';\r\nvar IndentRangeProvider = /** @class */ (function () {\r\n    function IndentRangeProvider(editorModel) {\r\n        this.editorModel = editorModel;\r\n        this.id = ID_INDENT_PROVIDER;\r\n    }\r\n    IndentRangeProvider.prototype.dispose = function () {\r\n    };\r\n    IndentRangeProvider.prototype.compute = function (cancelationToken) {\r\n        var foldingRules = LanguageConfigurationRegistry.getFoldingRules(this.editorModel.getLanguageIdentifier().id);\r\n        var offSide = foldingRules && !!foldingRules.offSide;\r\n        var markers = foldingRules && foldingRules.markers;\r\n        return Promise.resolve(computeRanges(this.editorModel, offSide, markers));\r\n    };\r\n    return IndentRangeProvider;\r\n}());\r\nexport { IndentRangeProvider };\r\n// public only for testing\r\nvar RangesCollector = /** @class */ (function () {\r\n    function RangesCollector(foldingRangesLimit) {\r\n        this._startIndexes = [];\r\n        this._endIndexes = [];\r\n        this._indentOccurrences = [];\r\n        this._length = 0;\r\n        this._foldingRangesLimit = foldingRangesLimit;\r\n    }\r\n    RangesCollector.prototype.insertFirst = function (startLineNumber, endLineNumber, indent) {\r\n        if (startLineNumber > MAX_LINE_NUMBER || endLineNumber > MAX_LINE_NUMBER) {\r\n            return;\r\n        }\r\n        var index = this._length;\r\n        this._startIndexes[index] = startLineNumber;\r\n        this._endIndexes[index] = endLineNumber;\r\n        this._length++;\r\n        if (indent < 1000) {\r\n            this._indentOccurrences[indent] = (this._indentOccurrences[indent] || 0) + 1;\r\n        }\r\n    };\r\n    RangesCollector.prototype.toIndentRanges = function (model) {\r\n        if (this._length <= this._foldingRangesLimit) {\r\n            // reverse and create arrays of the exact length\r\n            var startIndexes = new Uint32Array(this._length);\r\n            var endIndexes = new Uint32Array(this._length);\r\n            for (var i = this._length - 1, k = 0; i >= 0; i--, k++) {\r\n                startIndexes[k] = this._startIndexes[i];\r\n                endIndexes[k] = this._endIndexes[i];\r\n            }\r\n            return new FoldingRegions(startIndexes, endIndexes);\r\n        }\r\n        else {\r\n            var entries = 0;\r\n            var maxIndent = this._indentOccurrences.length;\r\n            for (var i = 0; i < this._indentOccurrences.length; i++) {\r\n                var n = this._indentOccurrences[i];\r\n                if (n) {\r\n                    if (n + entries > this._foldingRangesLimit) {\r\n                        maxIndent = i;\r\n                        break;\r\n                    }\r\n                    entries += n;\r\n                }\r\n            }\r\n            var tabSize = model.getOptions().tabSize;\r\n            // reverse and create arrays of the exact length\r\n            var startIndexes = new Uint32Array(this._foldingRangesLimit);\r\n            var endIndexes = new Uint32Array(this._foldingRangesLimit);\r\n            for (var i = this._length - 1, k = 0; i >= 0; i--) {\r\n                var startIndex = this._startIndexes[i];\r\n                var lineContent = model.getLineContent(startIndex);\r\n                var indent = TextModel.computeIndentLevel(lineContent, tabSize);\r\n                if (indent < maxIndent || (indent === maxIndent && entries++ < this._foldingRangesLimit)) {\r\n                    startIndexes[k] = startIndex;\r\n                    endIndexes[k] = this._endIndexes[i];\r\n                    k++;\r\n                }\r\n            }\r\n            return new FoldingRegions(startIndexes, endIndexes);\r\n        }\r\n    };\r\n    return RangesCollector;\r\n}());\r\nexport { RangesCollector };\r\nexport function computeRanges(model, offSide, markers, foldingRangesLimit) {\r\n    if (foldingRangesLimit === void 0) { foldingRangesLimit = MAX_FOLDING_REGIONS_FOR_INDENT_LIMIT; }\r\n    var tabSize = model.getOptions().tabSize;\r\n    var result = new RangesCollector(foldingRangesLimit);\r\n    var pattern = undefined;\r\n    if (markers) {\r\n        pattern = new RegExp(\"(\" + markers.start.source + \")|(?:\" + markers.end.source + \")\");\r\n    }\r\n    var previousRegions = [];\r\n    var line = model.getLineCount() + 1;\r\n    previousRegions.push({ indent: -1, endAbove: line, line: line }); // sentinel, to make sure there's at least one entry\r\n    for (var line_1 = model.getLineCount(); line_1 > 0; line_1--) {\r\n        var lineContent = model.getLineContent(line_1);\r\n        var indent = TextModel.computeIndentLevel(lineContent, tabSize);\r\n        var previous = previousRegions[previousRegions.length - 1];\r\n        if (indent === -1) {\r\n            if (offSide) {\r\n                // for offSide languages, empty lines are associated to the previous block\r\n                // note: the next block is already written to the results, so this only\r\n                // impacts the end position of the block before\r\n                previous.endAbove = line_1;\r\n            }\r\n            continue; // only whitespace\r\n        }\r\n        var m = void 0;\r\n        if (pattern && (m = lineContent.match(pattern))) {\r\n            // folding pattern match\r\n            if (m[1]) { // start pattern match\r\n                // discard all regions until the folding pattern\r\n                var i = previousRegions.length - 1;\r\n                while (i > 0 && previousRegions[i].indent !== -2) {\r\n                    i--;\r\n                }\r\n                if (i > 0) {\r\n                    previousRegions.length = i + 1;\r\n                    previous = previousRegions[i];\r\n                    // new folding range from pattern, includes the end line\r\n                    result.insertFirst(line_1, previous.line, indent);\r\n                    previous.line = line_1;\r\n                    previous.indent = indent;\r\n                    previous.endAbove = line_1;\r\n                    continue;\r\n                }\r\n                else {\r\n                    // no end marker found, treat line as a regular line\r\n                }\r\n            }\r\n            else { // end pattern match\r\n                previousRegions.push({ indent: -2, endAbove: line_1, line: line_1 });\r\n                continue;\r\n            }\r\n        }\r\n        if (previous.indent > indent) {\r\n            // discard all regions with larger indent\r\n            do {\r\n                previousRegions.pop();\r\n                previous = previousRegions[previousRegions.length - 1];\r\n            } while (previous.indent > indent);\r\n            // new folding range\r\n            var endLineNumber = previous.endAbove - 1;\r\n            if (endLineNumber - line_1 >= 1) { // needs at east size 1\r\n                result.insertFirst(line_1, endLineNumber, indent);\r\n            }\r\n        }\r\n        if (previous.indent === indent) {\r\n            previous.endAbove = line_1;\r\n        }\r\n        else { // previous.indent < indent\r\n            // new region with a bigger indent\r\n            previousRegions.push({ indent: indent, endAbove: line_1, line: line_1 });\r\n        }\r\n    }\r\n    return result.toIndentRanges(model);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { MAX_LINE_NUMBER, FoldingRegions } from './foldingRanges.js';\r\nvar MAX_FOLDING_REGIONS = 5000;\r\nvar foldingContext = {};\r\nexport var ID_SYNTAX_PROVIDER = 'syntax';\r\nvar SyntaxRangeProvider = /** @class */ (function () {\r\n    function SyntaxRangeProvider(editorModel, providers, limit) {\r\n        if (limit === void 0) { limit = MAX_FOLDING_REGIONS; }\r\n        this.editorModel = editorModel;\r\n        this.providers = providers;\r\n        this.limit = limit;\r\n        this.id = ID_SYNTAX_PROVIDER;\r\n    }\r\n    SyntaxRangeProvider.prototype.compute = function (cancellationToken) {\r\n        var _this = this;\r\n        return collectSyntaxRanges(this.providers, this.editorModel, cancellationToken).then(function (ranges) {\r\n            if (ranges) {\r\n                var res = sanitizeRanges(ranges, _this.limit);\r\n                return res;\r\n            }\r\n            return null;\r\n        });\r\n    };\r\n    SyntaxRangeProvider.prototype.dispose = function () {\r\n    };\r\n    return SyntaxRangeProvider;\r\n}());\r\nexport { SyntaxRangeProvider };\r\nfunction collectSyntaxRanges(providers, model, cancellationToken) {\r\n    var rangeData = null;\r\n    var promises = providers.map(function (provider, i) {\r\n        return Promise.resolve(provider.provideFoldingRanges(model, foldingContext, cancellationToken)).then(function (ranges) {\r\n            if (cancellationToken.isCancellationRequested) {\r\n                return;\r\n            }\r\n            if (Array.isArray(ranges)) {\r\n                if (!Array.isArray(rangeData)) {\r\n                    rangeData = [];\r\n                }\r\n                var nLines = model.getLineCount();\r\n                for (var _i = 0, ranges_1 = ranges; _i < ranges_1.length; _i++) {\r\n                    var r = ranges_1[_i];\r\n                    if (r.start > 0 && r.end > r.start && r.end <= nLines) {\r\n                        rangeData.push({ start: r.start, end: r.end, rank: i, kind: r.kind });\r\n                    }\r\n                }\r\n            }\r\n        }, onUnexpectedExternalError);\r\n    });\r\n    return Promise.all(promises).then(function (_) {\r\n        return rangeData;\r\n    });\r\n}\r\nvar RangesCollector = /** @class */ (function () {\r\n    function RangesCollector(foldingRangesLimit) {\r\n        this._startIndexes = [];\r\n        this._endIndexes = [];\r\n        this._nestingLevels = [];\r\n        this._nestingLevelCounts = [];\r\n        this._types = [];\r\n        this._length = 0;\r\n        this._foldingRangesLimit = foldingRangesLimit;\r\n    }\r\n    RangesCollector.prototype.add = function (startLineNumber, endLineNumber, type, nestingLevel) {\r\n        if (startLineNumber > MAX_LINE_NUMBER || endLineNumber > MAX_LINE_NUMBER) {\r\n            return;\r\n        }\r\n        var index = this._length;\r\n        this._startIndexes[index] = startLineNumber;\r\n        this._endIndexes[index] = endLineNumber;\r\n        this._nestingLevels[index] = nestingLevel;\r\n        this._types[index] = type;\r\n        this._length++;\r\n        if (nestingLevel < 30) {\r\n            this._nestingLevelCounts[nestingLevel] = (this._nestingLevelCounts[nestingLevel] || 0) + 1;\r\n        }\r\n    };\r\n    RangesCollector.prototype.toIndentRanges = function () {\r\n        if (this._length <= this._foldingRangesLimit) {\r\n            var startIndexes = new Uint32Array(this._length);\r\n            var endIndexes = new Uint32Array(this._length);\r\n            for (var i = 0; i < this._length; i++) {\r\n                startIndexes[i] = this._startIndexes[i];\r\n                endIndexes[i] = this._endIndexes[i];\r\n            }\r\n            return new FoldingRegions(startIndexes, endIndexes, this._types);\r\n        }\r\n        else {\r\n            var entries = 0;\r\n            var maxLevel = this._nestingLevelCounts.length;\r\n            for (var i = 0; i < this._nestingLevelCounts.length; i++) {\r\n                var n = this._nestingLevelCounts[i];\r\n                if (n) {\r\n                    if (n + entries > this._foldingRangesLimit) {\r\n                        maxLevel = i;\r\n                        break;\r\n                    }\r\n                    entries += n;\r\n                }\r\n            }\r\n            var startIndexes = new Uint32Array(this._foldingRangesLimit);\r\n            var endIndexes = new Uint32Array(this._foldingRangesLimit);\r\n            var types = [];\r\n            for (var i = 0, k = 0; i < this._length; i++) {\r\n                var level = this._nestingLevels[i];\r\n                if (level < maxLevel || (level === maxLevel && entries++ < this._foldingRangesLimit)) {\r\n                    startIndexes[k] = this._startIndexes[i];\r\n                    endIndexes[k] = this._endIndexes[i];\r\n                    types[k] = this._types[i];\r\n                    k++;\r\n                }\r\n            }\r\n            return new FoldingRegions(startIndexes, endIndexes, types);\r\n        }\r\n    };\r\n    return RangesCollector;\r\n}());\r\nexport { RangesCollector };\r\nexport function sanitizeRanges(rangeData, limit) {\r\n    var sorted = rangeData.sort(function (d1, d2) {\r\n        var diff = d1.start - d2.start;\r\n        if (diff === 0) {\r\n            diff = d1.rank - d2.rank;\r\n        }\r\n        return diff;\r\n    });\r\n    var collector = new RangesCollector(limit);\r\n    var top = undefined;\r\n    var previous = [];\r\n    for (var _i = 0, sorted_1 = sorted; _i < sorted_1.length; _i++) {\r\n        var entry = sorted_1[_i];\r\n        if (!top) {\r\n            top = entry;\r\n            collector.add(entry.start, entry.end, entry.kind && entry.kind.value, previous.length);\r\n        }\r\n        else {\r\n            if (entry.start > top.start) {\r\n                if (entry.end <= top.end) {\r\n                    previous.push(top);\r\n                    top = entry;\r\n                    collector.add(entry.start, entry.end, entry.kind && entry.kind.value, previous.length);\r\n                }\r\n                else {\r\n                    if (entry.start > top.end) {\r\n                        do {\r\n                            top = previous.pop();\r\n                        } while (top && entry.start > top.end);\r\n                        if (top) {\r\n                            previous.push(top);\r\n                        }\r\n                        top = entry;\r\n                    }\r\n                    collector.add(entry.start, entry.end, entry.kind && entry.kind.value, previous.length);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return collector.toIndentRanges();\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { sanitizeRanges } from './syntaxRangeProvider.js';\r\nexport var ID_INIT_PROVIDER = 'init';\r\nvar InitializingRangeProvider = /** @class */ (function () {\r\n    function InitializingRangeProvider(editorModel, initialRanges, onTimeout, timeoutTime) {\r\n        this.editorModel = editorModel;\r\n        this.id = ID_INIT_PROVIDER;\r\n        if (initialRanges.length) {\r\n            var toDecorationRange = function (range) {\r\n                return {\r\n                    range: {\r\n                        startLineNumber: range.startLineNumber,\r\n                        startColumn: 0,\r\n                        endLineNumber: range.endLineNumber,\r\n                        endColumn: editorModel.getLineLength(range.endLineNumber)\r\n                    },\r\n                    options: {\r\n                        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */\r\n                    }\r\n                };\r\n            };\r\n            this.decorationIds = editorModel.deltaDecorations([], initialRanges.map(toDecorationRange));\r\n            this.timeout = setTimeout(onTimeout, timeoutTime);\r\n        }\r\n    }\r\n    InitializingRangeProvider.prototype.dispose = function () {\r\n        if (this.decorationIds) {\r\n            this.editorModel.deltaDecorations(this.decorationIds, []);\r\n            this.decorationIds = undefined;\r\n        }\r\n        if (typeof this.timeout === 'number') {\r\n            clearTimeout(this.timeout);\r\n            this.timeout = undefined;\r\n        }\r\n    };\r\n    InitializingRangeProvider.prototype.compute = function (cancelationToken) {\r\n        var foldingRangeData = [];\r\n        if (this.decorationIds) {\r\n            for (var _i = 0, _a = this.decorationIds; _i < _a.length; _i++) {\r\n                var id = _a[_i];\r\n                var range = this.editorModel.getDecorationRange(id);\r\n                if (range) {\r\n                    foldingRangeData.push({ start: range.startLineNumber, end: range.endLineNumber, rank: 1 });\r\n                }\r\n            }\r\n        }\r\n        return Promise.resolve(sanitizeRanges(foldingRangeData, Number.MAX_VALUE));\r\n    };\r\n    return InitializingRangeProvider;\r\n}());\r\nexport { InitializingRangeProvider };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport './folding.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as types from '../../../base/common/types.js';\r\nimport { escapeRegExpCharacters } from '../../../base/common/strings.js';\r\nimport { RunOnceScheduler, Delayer, createCancelablePromise } from '../../../base/common/async.js';\r\nimport { KeyChord } from '../../../base/common/keyCodes.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { registerEditorAction, registerEditorContribution, EditorAction, registerInstantiatedEditorAction } from '../../browser/editorExtensions.js';\r\nimport { FoldingModel, setCollapseStateAtLevel, setCollapseStateLevelsDown, setCollapseStateLevelsUp, setCollapseStateForMatchingLines, setCollapseStateForType, toggleCollapseState, setCollapseStateUp } from './foldingModel.js';\r\nimport { FoldingDecorationProvider } from './foldingDecorations.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { HiddenRangeModel } from './hiddenRangeModel.js';\r\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\r\nimport { IndentRangeProvider } from './indentRangeProvider.js';\r\nimport { FoldingRangeProviderRegistry, FoldingRangeKind } from '../../common/modes.js';\r\nimport { SyntaxRangeProvider, ID_SYNTAX_PROVIDER } from './syntaxRangeProvider.js';\r\nimport { InitializingRangeProvider, ID_INIT_PROVIDER } from './intializingRangeProvider.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { RawContextKey, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { registerColor, editorSelectionBackground, transparent } from '../../../platform/theme/common/colorRegistry.js';\r\nvar CONTEXT_FOLDING_ENABLED = new RawContextKey('foldingEnabled', false);\r\nvar FoldingController = /** @class */ (function (_super) {\r\n    __extends(FoldingController, _super);\r\n    function FoldingController(editor, contextKeyService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.contextKeyService = contextKeyService;\r\n        _this.localToDispose = _this._register(new DisposableStore());\r\n        _this.editor = editor;\r\n        var options = _this.editor.getOptions();\r\n        _this._isEnabled = options.get(30 /* folding */);\r\n        _this._useFoldingProviders = options.get(31 /* foldingStrategy */) !== 'indentation';\r\n        _this.foldingModel = null;\r\n        _this.hiddenRangeModel = null;\r\n        _this.rangeProvider = null;\r\n        _this.foldingRegionPromise = null;\r\n        _this.foldingStateMemento = null;\r\n        _this.foldingModelPromise = null;\r\n        _this.updateScheduler = null;\r\n        _this.cursorChangedScheduler = null;\r\n        _this.mouseDownInfo = null;\r\n        _this.foldingDecorationProvider = new FoldingDecorationProvider(editor);\r\n        _this.foldingDecorationProvider.autoHideFoldingControls = options.get(84 /* showFoldingControls */) === 'mouseover';\r\n        _this.foldingDecorationProvider.showFoldingHighlights = options.get(32 /* foldingHighlight */);\r\n        _this.foldingEnabled = CONTEXT_FOLDING_ENABLED.bindTo(_this.contextKeyService);\r\n        _this.foldingEnabled.set(_this._isEnabled);\r\n        _this._register(_this.editor.onDidChangeModel(function () { return _this.onModelChanged(); }));\r\n        _this._register(_this.editor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(30 /* folding */)) {\r\n                var options_1 = _this.editor.getOptions();\r\n                _this._isEnabled = options_1.get(30 /* folding */);\r\n                _this.foldingEnabled.set(_this._isEnabled);\r\n                _this.onModelChanged();\r\n            }\r\n            if (e.hasChanged(84 /* showFoldingControls */) || e.hasChanged(32 /* foldingHighlight */)) {\r\n                var options_2 = _this.editor.getOptions();\r\n                _this.foldingDecorationProvider.autoHideFoldingControls = options_2.get(84 /* showFoldingControls */) === 'mouseover';\r\n                _this.foldingDecorationProvider.showFoldingHighlights = options_2.get(32 /* foldingHighlight */);\r\n                _this.onModelContentChanged();\r\n            }\r\n            if (e.hasChanged(31 /* foldingStrategy */)) {\r\n                var options_3 = _this.editor.getOptions();\r\n                _this._useFoldingProviders = options_3.get(31 /* foldingStrategy */) !== 'indentation';\r\n                _this.onFoldingStrategyChanged();\r\n            }\r\n        }));\r\n        _this.onModelChanged();\r\n        return _this;\r\n    }\r\n    FoldingController.get = function (editor) {\r\n        return editor.getContribution(FoldingController.ID);\r\n    };\r\n    /**\r\n     * Store view state.\r\n     */\r\n    FoldingController.prototype.saveViewState = function () {\r\n        var model = this.editor.getModel();\r\n        if (!model || !this._isEnabled || model.isTooLargeForTokenization()) {\r\n            return {};\r\n        }\r\n        if (this.foldingModel) { // disposed ?\r\n            var collapsedRegions = this.foldingModel.isInitialized ? this.foldingModel.getMemento() : this.hiddenRangeModel.getMemento();\r\n            var provider = this.rangeProvider ? this.rangeProvider.id : undefined;\r\n            return { collapsedRegions: collapsedRegions, lineCount: model.getLineCount(), provider: provider };\r\n        }\r\n        return undefined;\r\n    };\r\n    /**\r\n     * Restore view state.\r\n     */\r\n    FoldingController.prototype.restoreViewState = function (state) {\r\n        var model = this.editor.getModel();\r\n        if (!model || !this._isEnabled || model.isTooLargeForTokenization() || !this.hiddenRangeModel) {\r\n            return;\r\n        }\r\n        if (!state || !state.collapsedRegions || state.lineCount !== model.getLineCount()) {\r\n            return;\r\n        }\r\n        if (state.provider === ID_SYNTAX_PROVIDER || state.provider === ID_INIT_PROVIDER) {\r\n            this.foldingStateMemento = state;\r\n        }\r\n        var collapsedRegions = state.collapsedRegions;\r\n        // set the hidden ranges right away, before waiting for the folding model.\r\n        if (this.hiddenRangeModel.applyMemento(collapsedRegions)) {\r\n            var foldingModel = this.getFoldingModel();\r\n            if (foldingModel) {\r\n                foldingModel.then(function (foldingModel) {\r\n                    if (foldingModel) {\r\n                        foldingModel.applyMemento(collapsedRegions);\r\n                    }\r\n                }).then(undefined, onUnexpectedError);\r\n            }\r\n        }\r\n    };\r\n    FoldingController.prototype.onModelChanged = function () {\r\n        var _this = this;\r\n        this.localToDispose.clear();\r\n        var model = this.editor.getModel();\r\n        if (!this._isEnabled || !model || model.isTooLargeForTokenization()) {\r\n            // huge files get no view model, so they cannot support hidden areas\r\n            return;\r\n        }\r\n        this.foldingModel = new FoldingModel(model, this.foldingDecorationProvider);\r\n        this.localToDispose.add(this.foldingModel);\r\n        this.hiddenRangeModel = new HiddenRangeModel(this.foldingModel);\r\n        this.localToDispose.add(this.hiddenRangeModel);\r\n        this.localToDispose.add(this.hiddenRangeModel.onDidChange(function (hr) { return _this.onHiddenRangesChanges(hr); }));\r\n        this.updateScheduler = new Delayer(200);\r\n        this.cursorChangedScheduler = new RunOnceScheduler(function () { return _this.revealCursor(); }, 200);\r\n        this.localToDispose.add(this.cursorChangedScheduler);\r\n        this.localToDispose.add(FoldingRangeProviderRegistry.onDidChange(function () { return _this.onFoldingStrategyChanged(); }));\r\n        this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(function () { return _this.onFoldingStrategyChanged(); })); // covers model language changes as well\r\n        this.localToDispose.add(this.editor.onDidChangeModelContent(function () { return _this.onModelContentChanged(); }));\r\n        this.localToDispose.add(this.editor.onDidChangeCursorPosition(function () { return _this.onCursorPositionChanged(); }));\r\n        this.localToDispose.add(this.editor.onMouseDown(function (e) { return _this.onEditorMouseDown(e); }));\r\n        this.localToDispose.add(this.editor.onMouseUp(function (e) { return _this.onEditorMouseUp(e); }));\r\n        this.localToDispose.add({\r\n            dispose: function () {\r\n                if (_this.foldingRegionPromise) {\r\n                    _this.foldingRegionPromise.cancel();\r\n                    _this.foldingRegionPromise = null;\r\n                }\r\n                if (_this.updateScheduler) {\r\n                    _this.updateScheduler.cancel();\r\n                }\r\n                _this.updateScheduler = null;\r\n                _this.foldingModel = null;\r\n                _this.foldingModelPromise = null;\r\n                _this.hiddenRangeModel = null;\r\n                _this.cursorChangedScheduler = null;\r\n                _this.foldingStateMemento = null;\r\n                if (_this.rangeProvider) {\r\n                    _this.rangeProvider.dispose();\r\n                }\r\n                _this.rangeProvider = null;\r\n            }\r\n        });\r\n        this.onModelContentChanged();\r\n    };\r\n    FoldingController.prototype.onFoldingStrategyChanged = function () {\r\n        if (this.rangeProvider) {\r\n            this.rangeProvider.dispose();\r\n        }\r\n        this.rangeProvider = null;\r\n        this.onModelContentChanged();\r\n    };\r\n    FoldingController.prototype.getRangeProvider = function (editorModel) {\r\n        var _this = this;\r\n        if (this.rangeProvider) {\r\n            return this.rangeProvider;\r\n        }\r\n        this.rangeProvider = new IndentRangeProvider(editorModel); // fallback\r\n        if (this._useFoldingProviders && this.foldingModel) {\r\n            var foldingProviders = FoldingRangeProviderRegistry.ordered(this.foldingModel.textModel);\r\n            if (foldingProviders.length === 0 && this.foldingStateMemento && this.foldingStateMemento.collapsedRegions) {\r\n                var rangeProvider = this.rangeProvider = new InitializingRangeProvider(editorModel, this.foldingStateMemento.collapsedRegions, function () {\r\n                    // if after 30 the InitializingRangeProvider is still not replaced, force a refresh\r\n                    _this.foldingStateMemento = null;\r\n                    _this.onFoldingStrategyChanged();\r\n                }, 30000);\r\n                return rangeProvider; // keep memento in case there are still no foldingProviders on the next request.\r\n            }\r\n            else if (foldingProviders.length > 0) {\r\n                this.rangeProvider = new SyntaxRangeProvider(editorModel, foldingProviders);\r\n            }\r\n        }\r\n        this.foldingStateMemento = null;\r\n        return this.rangeProvider;\r\n    };\r\n    FoldingController.prototype.getFoldingModel = function () {\r\n        return this.foldingModelPromise;\r\n    };\r\n    FoldingController.prototype.onModelContentChanged = function () {\r\n        var _this = this;\r\n        if (this.updateScheduler) {\r\n            if (this.foldingRegionPromise) {\r\n                this.foldingRegionPromise.cancel();\r\n                this.foldingRegionPromise = null;\r\n            }\r\n            this.foldingModelPromise = this.updateScheduler.trigger(function () {\r\n                var foldingModel = _this.foldingModel;\r\n                if (!foldingModel) { // null if editor has been disposed, or folding turned off\r\n                    return null;\r\n                }\r\n                var foldingRegionPromise = _this.foldingRegionPromise = createCancelablePromise(function (token) { return _this.getRangeProvider(foldingModel.textModel).compute(token); });\r\n                return foldingRegionPromise.then(function (foldingRanges) {\r\n                    if (foldingRanges && foldingRegionPromise === _this.foldingRegionPromise) { // new request or cancelled in the meantime?\r\n                        // some cursors might have moved into hidden regions, make sure they are in expanded regions\r\n                        var selections = _this.editor.getSelections();\r\n                        var selectionLineNumbers = selections ? selections.map(function (s) { return s.startLineNumber; }) : [];\r\n                        foldingModel.update(foldingRanges, selectionLineNumbers);\r\n                    }\r\n                    return foldingModel;\r\n                });\r\n            }).then(undefined, function (err) {\r\n                onUnexpectedError(err);\r\n                return null;\r\n            });\r\n        }\r\n    };\r\n    FoldingController.prototype.onHiddenRangesChanges = function (hiddenRanges) {\r\n        if (this.hiddenRangeModel && hiddenRanges.length) {\r\n            var selections = this.editor.getSelections();\r\n            if (selections) {\r\n                if (this.hiddenRangeModel.adjustSelections(selections)) {\r\n                    this.editor.setSelections(selections);\r\n                }\r\n            }\r\n        }\r\n        this.editor.setHiddenAreas(hiddenRanges);\r\n    };\r\n    FoldingController.prototype.onCursorPositionChanged = function () {\r\n        if (this.hiddenRangeModel && this.hiddenRangeModel.hasRanges()) {\r\n            this.cursorChangedScheduler.schedule();\r\n        }\r\n    };\r\n    FoldingController.prototype.revealCursor = function () {\r\n        var _this = this;\r\n        var foldingModel = this.getFoldingModel();\r\n        if (!foldingModel) {\r\n            return;\r\n        }\r\n        foldingModel.then(function (foldingModel) {\r\n            if (foldingModel) {\r\n                var selections = _this.editor.getSelections();\r\n                if (selections && selections.length > 0) {\r\n                    var toToggle = [];\r\n                    var _loop_1 = function (selection) {\r\n                        var lineNumber = selection.selectionStartLineNumber;\r\n                        if (_this.hiddenRangeModel && _this.hiddenRangeModel.isHidden(lineNumber)) {\r\n                            toToggle.push.apply(toToggle, foldingModel.getAllRegionsAtLine(lineNumber, function (r) { return r.isCollapsed && lineNumber > r.startLineNumber; }));\r\n                        }\r\n                    };\r\n                    for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\r\n                        var selection = selections_1[_i];\r\n                        _loop_1(selection);\r\n                    }\r\n                    if (toToggle.length) {\r\n                        foldingModel.toggleCollapseState(toToggle);\r\n                        _this.reveal(selections[0].getPosition());\r\n                    }\r\n                }\r\n            }\r\n        }).then(undefined, onUnexpectedError);\r\n    };\r\n    FoldingController.prototype.onEditorMouseDown = function (e) {\r\n        this.mouseDownInfo = null;\r\n        if (!this.hiddenRangeModel || !e.target || !e.target.range) {\r\n            return;\r\n        }\r\n        if (!e.event.leftButton && !e.event.middleButton) {\r\n            return;\r\n        }\r\n        var range = e.target.range;\r\n        var iconClicked = false;\r\n        switch (e.target.type) {\r\n            case 4 /* GUTTER_LINE_DECORATIONS */:\r\n                var data = e.target.detail;\r\n                var offsetLeftInGutter = e.target.element.offsetLeft;\r\n                var gutterOffsetX = data.offsetX - offsetLeftInGutter;\r\n                // const gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\r\n                // TODO@joao TODO@alex TODO@martin this is such that we don't collide with dirty diff\r\n                if (gutterOffsetX < 5) { // the whitespace between the border and the real folding icon border is 5px\r\n                    return;\r\n                }\r\n                iconClicked = true;\r\n                break;\r\n            case 6 /* CONTENT_TEXT */: {\r\n                if (this.hiddenRangeModel.hasRanges()) {\r\n                    var model = this.editor.getModel();\r\n                    if (model && range.startColumn === model.getLineMaxColumn(range.startLineNumber)) {\r\n                        break;\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            default:\r\n                return;\r\n        }\r\n        this.mouseDownInfo = { lineNumber: range.startLineNumber, iconClicked: iconClicked };\r\n    };\r\n    FoldingController.prototype.onEditorMouseUp = function (e) {\r\n        var _this = this;\r\n        var foldingModel = this.getFoldingModel();\r\n        if (!foldingModel || !this.mouseDownInfo || !e.target) {\r\n            return;\r\n        }\r\n        var lineNumber = this.mouseDownInfo.lineNumber;\r\n        var iconClicked = this.mouseDownInfo.iconClicked;\r\n        var range = e.target.range;\r\n        if (!range || range.startLineNumber !== lineNumber) {\r\n            return;\r\n        }\r\n        if (iconClicked) {\r\n            if (e.target.type !== 4 /* GUTTER_LINE_DECORATIONS */) {\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            var model = this.editor.getModel();\r\n            if (!model || range.startColumn !== model.getLineMaxColumn(lineNumber)) {\r\n                return;\r\n            }\r\n        }\r\n        foldingModel.then(function (foldingModel) {\r\n            if (foldingModel) {\r\n                var region = foldingModel.getRegionAtLine(lineNumber);\r\n                if (region && region.startLineNumber === lineNumber) {\r\n                    var isCollapsed = region.isCollapsed;\r\n                    if (iconClicked || isCollapsed) {\r\n                        var toToggle = [];\r\n                        var recursive = e.event.middleButton || e.event.shiftKey;\r\n                        if (recursive) {\r\n                            for (var _i = 0, _a = foldingModel.getRegionsInside(region); _i < _a.length; _i++) {\r\n                                var r = _a[_i];\r\n                                if (r.isCollapsed === isCollapsed) {\r\n                                    toToggle.push(r);\r\n                                }\r\n                            }\r\n                        }\r\n                        // when recursive, first only collapse all children. If all are already folded or there are no children, also fold parent.\r\n                        if (isCollapsed || !recursive || toToggle.length === 0) {\r\n                            toToggle.push(region);\r\n                        }\r\n                        foldingModel.toggleCollapseState(toToggle);\r\n                        _this.reveal({ lineNumber: lineNumber, column: 1 });\r\n                    }\r\n                }\r\n            }\r\n        }).then(undefined, onUnexpectedError);\r\n    };\r\n    FoldingController.prototype.reveal = function (position) {\r\n        this.editor.revealPositionInCenterIfOutsideViewport(position, 0 /* Smooth */);\r\n    };\r\n    FoldingController.ID = 'editor.contrib.folding';\r\n    FoldingController = __decorate([\r\n        __param(1, IContextKeyService)\r\n    ], FoldingController);\r\n    return FoldingController;\r\n}(Disposable));\r\nexport { FoldingController };\r\nvar FoldingAction = /** @class */ (function (_super) {\r\n    __extends(FoldingAction, _super);\r\n    function FoldingAction() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FoldingAction.prototype.runEditorCommand = function (accessor, editor, args) {\r\n        var _this = this;\r\n        var foldingController = FoldingController.get(editor);\r\n        if (!foldingController) {\r\n            return;\r\n        }\r\n        var foldingModelPromise = foldingController.getFoldingModel();\r\n        if (foldingModelPromise) {\r\n            this.reportTelemetry(accessor, editor);\r\n            return foldingModelPromise.then(function (foldingModel) {\r\n                if (foldingModel) {\r\n                    _this.invoke(foldingController, foldingModel, editor, args);\r\n                    var selection = editor.getSelection();\r\n                    if (selection) {\r\n                        foldingController.reveal(selection.getStartPosition());\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    FoldingAction.prototype.getSelectedLines = function (editor) {\r\n        var selections = editor.getSelections();\r\n        return selections ? selections.map(function (s) { return s.startLineNumber; }) : [];\r\n    };\r\n    FoldingAction.prototype.getLineNumbers = function (args, editor) {\r\n        if (args && args.selectionLines) {\r\n            return args.selectionLines.map(function (l) { return l + 1; }); // to 0-bases line numbers\r\n        }\r\n        return this.getSelectedLines(editor);\r\n    };\r\n    FoldingAction.prototype.run = function (_accessor, _editor) {\r\n    };\r\n    return FoldingAction;\r\n}(EditorAction));\r\nfunction foldingArgumentsConstraint(args) {\r\n    if (!types.isUndefined(args)) {\r\n        if (!types.isObject(args)) {\r\n            return false;\r\n        }\r\n        var foldingArgs = args;\r\n        if (!types.isUndefined(foldingArgs.levels) && !types.isNumber(foldingArgs.levels)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(foldingArgs.direction) && !types.isString(foldingArgs.direction)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(foldingArgs.selectionLines) && (!types.isArray(foldingArgs.selectionLines) || !foldingArgs.selectionLines.every(types.isNumber))) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nvar UnfoldAction = /** @class */ (function (_super) {\r\n    __extends(UnfoldAction, _super);\r\n    function UnfoldAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfold',\r\n            label: nls.localize('unfoldAction.label', \"Unfold\"),\r\n            alias: 'Unfold',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 89 /* US_CLOSE_SQUARE_BRACKET */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 89 /* US_CLOSE_SQUARE_BRACKET */\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            description: {\r\n                description: 'Unfold the content in the editor',\r\n                args: [\r\n                    {\r\n                        name: 'Unfold editor argument',\r\n                        description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t\\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\\n\\t\\t\\t\\t\\t\\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\\n\\t\\t\\t\\t\\t\\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\\n\\t\\t\\t\\t\\t\\t\",\r\n                        constraint: foldingArgumentsConstraint,\r\n                        schema: {\r\n                            'type': 'object',\r\n                            'properties': {\r\n                                'levels': {\r\n                                    'type': 'number',\r\n                                    'default': 1\r\n                                },\r\n                                'direction': {\r\n                                    'type': 'string',\r\n                                    'enum': ['up', 'down'],\r\n                                    'default': 'down'\r\n                                },\r\n                                'selectionLines': {\r\n                                    'type': 'array',\r\n                                    'items': {\r\n                                        'type': 'number'\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        }) || this;\r\n    }\r\n    UnfoldAction.prototype.invoke = function (_foldingController, foldingModel, editor, args) {\r\n        var levels = args && args.levels || 1;\r\n        var lineNumbers = this.getLineNumbers(args, editor);\r\n        if (args && args.direction === 'up') {\r\n            setCollapseStateLevelsUp(foldingModel, false, levels, lineNumbers);\r\n        }\r\n        else {\r\n            setCollapseStateLevelsDown(foldingModel, false, levels, lineNumbers);\r\n        }\r\n    };\r\n    return UnfoldAction;\r\n}(FoldingAction));\r\nvar UnFoldRecursivelyAction = /** @class */ (function (_super) {\r\n    __extends(UnFoldRecursivelyAction, _super);\r\n    function UnFoldRecursivelyAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfoldRecursively',\r\n            label: nls.localize('unFoldRecursivelyAction.label', \"Unfold Recursively\"),\r\n            alias: 'Unfold Recursively',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 89 /* US_CLOSE_SQUARE_BRACKET */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    UnFoldRecursivelyAction.prototype.invoke = function (_foldingController, foldingModel, editor, _args) {\r\n        setCollapseStateLevelsDown(foldingModel, false, Number.MAX_VALUE, this.getSelectedLines(editor));\r\n    };\r\n    return UnFoldRecursivelyAction;\r\n}(FoldingAction));\r\nvar FoldAction = /** @class */ (function (_super) {\r\n    __extends(FoldAction, _super);\r\n    function FoldAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.fold',\r\n            label: nls.localize('foldAction.label', \"Fold\"),\r\n            alias: 'Fold',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 87 /* US_OPEN_SQUARE_BRACKET */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 87 /* US_OPEN_SQUARE_BRACKET */\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            description: {\r\n                description: 'Fold the content in the editor',\r\n                args: [\r\n                    {\r\n                        name: 'Fold editor argument',\r\n                        description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t\\t\\t* 'levels': Number of levels to fold.\\n\\t\\t\\t\\t\\t\\t\\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\\n\\t\\t\\t\\t\\t\\t\\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\\n\\t\\t\\t\\t\\t\\t\\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\\n\\t\\t\\t\\t\\t\\t\",\r\n                        constraint: foldingArgumentsConstraint,\r\n                        schema: {\r\n                            'type': 'object',\r\n                            'properties': {\r\n                                'levels': {\r\n                                    'type': 'number',\r\n                                },\r\n                                'direction': {\r\n                                    'type': 'string',\r\n                                    'enum': ['up', 'down'],\r\n                                },\r\n                                'selectionLines': {\r\n                                    'type': 'array',\r\n                                    'items': {\r\n                                        'type': 'number'\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAction.prototype.invoke = function (_foldingController, foldingModel, editor, args) {\r\n        var lineNumbers = this.getLineNumbers(args, editor);\r\n        var levels = args && args.levels;\r\n        var direction = args && args.direction;\r\n        if (typeof levels !== 'number' && typeof direction !== 'string') {\r\n            // fold the region at the location or if already collapsed, the first uncollapsed parent instead.\r\n            setCollapseStateUp(foldingModel, true, lineNumbers);\r\n        }\r\n        else {\r\n            if (direction === 'up') {\r\n                setCollapseStateLevelsUp(foldingModel, true, levels || 1, lineNumbers);\r\n            }\r\n            else {\r\n                setCollapseStateLevelsDown(foldingModel, true, levels || 1, lineNumbers);\r\n            }\r\n        }\r\n    };\r\n    return FoldAction;\r\n}(FoldingAction));\r\nvar ToggleFoldAction = /** @class */ (function (_super) {\r\n    __extends(ToggleFoldAction, _super);\r\n    function ToggleFoldAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.toggleFold',\r\n            label: nls.localize('toggleFoldAction.label', \"Toggle Fold\"),\r\n            alias: 'Toggle Fold',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 42 /* KEY_L */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    ToggleFoldAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        var selectedLines = this.getSelectedLines(editor);\r\n        toggleCollapseState(foldingModel, 1, selectedLines);\r\n    };\r\n    return ToggleFoldAction;\r\n}(FoldingAction));\r\nvar FoldRecursivelyAction = /** @class */ (function (_super) {\r\n    __extends(FoldRecursivelyAction, _super);\r\n    function FoldRecursivelyAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldRecursively',\r\n            label: nls.localize('foldRecursivelyAction.label', \"Fold Recursively\"),\r\n            alias: 'Fold Recursively',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 87 /* US_OPEN_SQUARE_BRACKET */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldRecursivelyAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        var selectedLines = this.getSelectedLines(editor);\r\n        setCollapseStateLevelsDown(foldingModel, true, Number.MAX_VALUE, selectedLines);\r\n    };\r\n    return FoldRecursivelyAction;\r\n}(FoldingAction));\r\nvar FoldAllBlockCommentsAction = /** @class */ (function (_super) {\r\n    __extends(FoldAllBlockCommentsAction, _super);\r\n    function FoldAllBlockCommentsAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldAllBlockComments',\r\n            label: nls.localize('foldAllBlockComments.label', \"Fold All Block Comments\"),\r\n            alias: 'Fold All Block Comments',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 85 /* US_SLASH */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAllBlockCommentsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        if (foldingModel.regions.hasTypes()) {\r\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Comment.value, true);\r\n        }\r\n        else {\r\n            var editorModel = editor.getModel();\r\n            if (!editorModel) {\r\n                return;\r\n            }\r\n            var comments = LanguageConfigurationRegistry.getComments(editorModel.getLanguageIdentifier().id);\r\n            if (comments && comments.blockCommentStartToken) {\r\n                var regExp = new RegExp('^\\\\s*' + escapeRegExpCharacters(comments.blockCommentStartToken));\r\n                setCollapseStateForMatchingLines(foldingModel, regExp, true);\r\n            }\r\n        }\r\n    };\r\n    return FoldAllBlockCommentsAction;\r\n}(FoldingAction));\r\nvar FoldAllRegionsAction = /** @class */ (function (_super) {\r\n    __extends(FoldAllRegionsAction, _super);\r\n    function FoldAllRegionsAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldAllMarkerRegions',\r\n            label: nls.localize('foldAllMarkerRegions.label', \"Fold All Regions\"),\r\n            alias: 'Fold All Regions',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 29 /* KEY_8 */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAllRegionsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        if (foldingModel.regions.hasTypes()) {\r\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, true);\r\n        }\r\n        else {\r\n            var editorModel = editor.getModel();\r\n            if (!editorModel) {\r\n                return;\r\n            }\r\n            var foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageIdentifier().id);\r\n            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\r\n                var regExp = new RegExp(foldingRules.markers.start);\r\n                setCollapseStateForMatchingLines(foldingModel, regExp, true);\r\n            }\r\n        }\r\n    };\r\n    return FoldAllRegionsAction;\r\n}(FoldingAction));\r\nvar UnfoldAllRegionsAction = /** @class */ (function (_super) {\r\n    __extends(UnfoldAllRegionsAction, _super);\r\n    function UnfoldAllRegionsAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfoldAllMarkerRegions',\r\n            label: nls.localize('unfoldAllMarkerRegions.label', \"Unfold All Regions\"),\r\n            alias: 'Unfold All Regions',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 30 /* KEY_9 */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    UnfoldAllRegionsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        if (foldingModel.regions.hasTypes()) {\r\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, false);\r\n        }\r\n        else {\r\n            var editorModel = editor.getModel();\r\n            if (!editorModel) {\r\n                return;\r\n            }\r\n            var foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageIdentifier().id);\r\n            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\r\n                var regExp = new RegExp(foldingRules.markers.start);\r\n                setCollapseStateForMatchingLines(foldingModel, regExp, false);\r\n            }\r\n        }\r\n    };\r\n    return UnfoldAllRegionsAction;\r\n}(FoldingAction));\r\nvar FoldAllAction = /** @class */ (function (_super) {\r\n    __extends(FoldAllAction, _super);\r\n    function FoldAllAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldAll',\r\n            label: nls.localize('foldAllAction.label', \"Fold All\"),\r\n            alias: 'Fold All',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 21 /* KEY_0 */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAllAction.prototype.invoke = function (_foldingController, foldingModel, _editor) {\r\n        setCollapseStateLevelsDown(foldingModel, true);\r\n    };\r\n    return FoldAllAction;\r\n}(FoldingAction));\r\nvar UnfoldAllAction = /** @class */ (function (_super) {\r\n    __extends(UnfoldAllAction, _super);\r\n    function UnfoldAllAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfoldAll',\r\n            label: nls.localize('unfoldAllAction.label', \"Unfold All\"),\r\n            alias: 'Unfold All',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 40 /* KEY_J */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    UnfoldAllAction.prototype.invoke = function (_foldingController, foldingModel, _editor) {\r\n        setCollapseStateLevelsDown(foldingModel, false);\r\n    };\r\n    return UnfoldAllAction;\r\n}(FoldingAction));\r\nvar FoldLevelAction = /** @class */ (function (_super) {\r\n    __extends(FoldLevelAction, _super);\r\n    function FoldLevelAction() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FoldLevelAction.prototype.getFoldingLevel = function () {\r\n        return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length));\r\n    };\r\n    FoldLevelAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        setCollapseStateAtLevel(foldingModel, this.getFoldingLevel(), true, this.getSelectedLines(editor));\r\n    };\r\n    FoldLevelAction.ID_PREFIX = 'editor.foldLevel';\r\n    FoldLevelAction.ID = function (level) { return FoldLevelAction.ID_PREFIX + level; };\r\n    return FoldLevelAction;\r\n}(FoldingAction));\r\nregisterEditorContribution(FoldingController.ID, FoldingController);\r\nregisterEditorAction(UnfoldAction);\r\nregisterEditorAction(UnFoldRecursivelyAction);\r\nregisterEditorAction(FoldAction);\r\nregisterEditorAction(FoldRecursivelyAction);\r\nregisterEditorAction(FoldAllAction);\r\nregisterEditorAction(UnfoldAllAction);\r\nregisterEditorAction(FoldAllBlockCommentsAction);\r\nregisterEditorAction(FoldAllRegionsAction);\r\nregisterEditorAction(UnfoldAllRegionsAction);\r\nregisterEditorAction(ToggleFoldAction);\r\nfor (var i = 1; i <= 7; i++) {\r\n    registerInstantiatedEditorAction(new FoldLevelAction({\r\n        id: FoldLevelAction.ID(i),\r\n        label: nls.localize('foldLevelAction.label', \"Fold Level {0}\", i),\r\n        alias: \"Fold Level \" + i,\r\n        precondition: CONTEXT_FOLDING_ENABLED,\r\n        kbOpts: {\r\n            kbExpr: EditorContextKeys.editorTextFocus,\r\n            primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | (21 /* KEY_0 */ + i)),\r\n            weight: 100 /* EditorContrib */\r\n        }\r\n    }));\r\n}\r\nexport var foldBackgroundBackground = registerColor('editor.foldBackground', { light: transparent(editorSelectionBackground, 0.3), dark: transparent(editorSelectionBackground, 0.3), hc: null }, nls.localize('editorSelectionBackground', \"Color of the editor selection.\"));\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var foldBackground = theme.getColor(foldBackgroundBackground);\r\n    if (foldBackground) {\r\n        collector.addRule(\".monaco-editor .folded-background { background-color: \" + foldBackground + \"; }\");\r\n    }\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { buildReplaceStringWithCasePreserved } from '../../../base/common/search.js';\r\n/**\r\n * Assigned when the replace pattern is entirely static.\r\n */\r\nvar StaticValueReplacePattern = /** @class */ (function () {\r\n    function StaticValueReplacePattern(staticValue) {\r\n        this.staticValue = staticValue;\r\n        this.kind = 0 /* StaticValue */;\r\n    }\r\n    return StaticValueReplacePattern;\r\n}());\r\n/**\r\n * Assigned when the replace pattern has replacemend patterns.\r\n */\r\nvar DynamicPiecesReplacePattern = /** @class */ (function () {\r\n    function DynamicPiecesReplacePattern(pieces) {\r\n        this.pieces = pieces;\r\n        this.kind = 1 /* DynamicPieces */;\r\n    }\r\n    return DynamicPiecesReplacePattern;\r\n}());\r\nvar ReplacePattern = /** @class */ (function () {\r\n    function ReplacePattern(pieces) {\r\n        if (!pieces || pieces.length === 0) {\r\n            this._state = new StaticValueReplacePattern('');\r\n        }\r\n        else if (pieces.length === 1 && pieces[0].staticValue !== null) {\r\n            this._state = new StaticValueReplacePattern(pieces[0].staticValue);\r\n        }\r\n        else {\r\n            this._state = new DynamicPiecesReplacePattern(pieces);\r\n        }\r\n    }\r\n    ReplacePattern.fromStaticValue = function (value) {\r\n        return new ReplacePattern([ReplacePiece.staticValue(value)]);\r\n    };\r\n    Object.defineProperty(ReplacePattern.prototype, \"hasReplacementPatterns\", {\r\n        get: function () {\r\n            return (this._state.kind === 1 /* DynamicPieces */);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ReplacePattern.prototype.buildReplaceString = function (matches, preserveCase) {\r\n        if (this._state.kind === 0 /* StaticValue */) {\r\n            if (preserveCase) {\r\n                return buildReplaceStringWithCasePreserved(matches, this._state.staticValue);\r\n            }\r\n            else {\r\n                return this._state.staticValue;\r\n            }\r\n        }\r\n        var result = '';\r\n        for (var i = 0, len = this._state.pieces.length; i < len; i++) {\r\n            var piece = this._state.pieces[i];\r\n            if (piece.staticValue !== null) {\r\n                // static value ReplacePiece\r\n                result += piece.staticValue;\r\n                continue;\r\n            }\r\n            // match index ReplacePiece\r\n            result += ReplacePattern._substitute(piece.matchIndex, matches);\r\n        }\r\n        return result;\r\n    };\r\n    ReplacePattern._substitute = function (matchIndex, matches) {\r\n        if (matches === null) {\r\n            return '';\r\n        }\r\n        if (matchIndex === 0) {\r\n            return matches[0];\r\n        }\r\n        var remainder = '';\r\n        while (matchIndex > 0) {\r\n            if (matchIndex < matches.length) {\r\n                // A match can be undefined\r\n                var match = (matches[matchIndex] || '');\r\n                return match + remainder;\r\n            }\r\n            remainder = String(matchIndex % 10) + remainder;\r\n            matchIndex = Math.floor(matchIndex / 10);\r\n        }\r\n        return '$' + remainder;\r\n    };\r\n    return ReplacePattern;\r\n}());\r\nexport { ReplacePattern };\r\n/**\r\n * A replace piece can either be a static string or an index to a specific match.\r\n */\r\nvar ReplacePiece = /** @class */ (function () {\r\n    function ReplacePiece(staticValue, matchIndex) {\r\n        this.staticValue = staticValue;\r\n        this.matchIndex = matchIndex;\r\n    }\r\n    ReplacePiece.staticValue = function (value) {\r\n        return new ReplacePiece(value, -1);\r\n    };\r\n    ReplacePiece.matchIndex = function (index) {\r\n        return new ReplacePiece(null, index);\r\n    };\r\n    return ReplacePiece;\r\n}());\r\nexport { ReplacePiece };\r\nvar ReplacePieceBuilder = /** @class */ (function () {\r\n    function ReplacePieceBuilder(source) {\r\n        this._source = source;\r\n        this._lastCharIndex = 0;\r\n        this._result = [];\r\n        this._resultLen = 0;\r\n        this._currentStaticPiece = '';\r\n    }\r\n    ReplacePieceBuilder.prototype.emitUnchanged = function (toCharIndex) {\r\n        this._emitStatic(this._source.substring(this._lastCharIndex, toCharIndex));\r\n        this._lastCharIndex = toCharIndex;\r\n    };\r\n    ReplacePieceBuilder.prototype.emitStatic = function (value, toCharIndex) {\r\n        this._emitStatic(value);\r\n        this._lastCharIndex = toCharIndex;\r\n    };\r\n    ReplacePieceBuilder.prototype._emitStatic = function (value) {\r\n        if (value.length === 0) {\r\n            return;\r\n        }\r\n        this._currentStaticPiece += value;\r\n    };\r\n    ReplacePieceBuilder.prototype.emitMatchIndex = function (index, toCharIndex) {\r\n        if (this._currentStaticPiece.length !== 0) {\r\n            this._result[this._resultLen++] = ReplacePiece.staticValue(this._currentStaticPiece);\r\n            this._currentStaticPiece = '';\r\n        }\r\n        this._result[this._resultLen++] = ReplacePiece.matchIndex(index);\r\n        this._lastCharIndex = toCharIndex;\r\n    };\r\n    ReplacePieceBuilder.prototype.finalize = function () {\r\n        this.emitUnchanged(this._source.length);\r\n        if (this._currentStaticPiece.length !== 0) {\r\n            this._result[this._resultLen++] = ReplacePiece.staticValue(this._currentStaticPiece);\r\n            this._currentStaticPiece = '';\r\n        }\r\n        return new ReplacePattern(this._result);\r\n    };\r\n    return ReplacePieceBuilder;\r\n}());\r\n/**\r\n * \\n\t\t\t=> inserts a LF\r\n * \\t\t\t\t=> inserts a TAB\r\n * \\\\\t\t\t=> inserts a \"\\\".\r\n * $$\t\t\t=> inserts a \"$\".\r\n * $& and $0\t=> inserts the matched substring.\r\n * $n\t\t\t=> Where n is a non-negative integer lesser than 100, inserts the nth parenthesized submatch string\r\n * everything else stays untouched\r\n *\r\n * Also see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#Specifying_a_string_as_a_parameter\r\n */\r\nexport function parseReplaceString(replaceString) {\r\n    if (!replaceString || replaceString.length === 0) {\r\n        return new ReplacePattern(null);\r\n    }\r\n    var result = new ReplacePieceBuilder(replaceString);\r\n    for (var i = 0, len = replaceString.length; i < len; i++) {\r\n        var chCode = replaceString.charCodeAt(i);\r\n        if (chCode === 92 /* Backslash */) {\r\n            // move to next char\r\n            i++;\r\n            if (i >= len) {\r\n                // string ends with a \\\r\n                break;\r\n            }\r\n            var nextChCode = replaceString.charCodeAt(i);\r\n            // let replaceWithCharacter: string | null = null;\r\n            switch (nextChCode) {\r\n                case 92 /* Backslash */:\r\n                    // \\\\ => inserts a \"\\\"\r\n                    result.emitUnchanged(i - 1);\r\n                    result.emitStatic('\\\\', i + 1);\r\n                    break;\r\n                case 110 /* n */:\r\n                    // \\n => inserts a LF\r\n                    result.emitUnchanged(i - 1);\r\n                    result.emitStatic('\\n', i + 1);\r\n                    break;\r\n                case 116 /* t */:\r\n                    // \\t => inserts a TAB\r\n                    result.emitUnchanged(i - 1);\r\n                    result.emitStatic('\\t', i + 1);\r\n                    break;\r\n            }\r\n            continue;\r\n        }\r\n        if (chCode === 36 /* DollarSign */) {\r\n            // move to next char\r\n            i++;\r\n            if (i >= len) {\r\n                // string ends with a $\r\n                break;\r\n            }\r\n            var nextChCode = replaceString.charCodeAt(i);\r\n            if (nextChCode === 36 /* DollarSign */) {\r\n                // $$ => inserts a \"$\"\r\n                result.emitUnchanged(i - 1);\r\n                result.emitStatic('$', i + 1);\r\n                continue;\r\n            }\r\n            if (nextChCode === 48 /* Digit0 */ || nextChCode === 38 /* Ampersand */) {\r\n                // $& and $0 => inserts the matched substring.\r\n                result.emitUnchanged(i - 1);\r\n                result.emitMatchIndex(0, i + 1);\r\n                continue;\r\n            }\r\n            if (49 /* Digit1 */ <= nextChCode && nextChCode <= 57 /* Digit9 */) {\r\n                // $n\r\n                var matchIndex = nextChCode - 48 /* Digit0 */;\r\n                // peek next char to probe for $nn\r\n                if (i + 1 < len) {\r\n                    var nextNextChCode = replaceString.charCodeAt(i + 1);\r\n                    if (48 /* Digit0 */ <= nextNextChCode && nextNextChCode <= 57 /* Digit9 */) {\r\n                        // $nn\r\n                        // move to next char\r\n                        i++;\r\n                        matchIndex = matchIndex * 10 + (nextNextChCode - 48 /* Digit0 */);\r\n                        result.emitUnchanged(i - 2);\r\n                        result.emitMatchIndex(matchIndex, i + 1);\r\n                        continue;\r\n                    }\r\n                }\r\n                result.emitUnchanged(i - 1);\r\n                result.emitMatchIndex(matchIndex, i + 1);\r\n                continue;\r\n            }\r\n        }\r\n    }\r\n    return result.finalize();\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { Range } from '../../common/core/range.js';\r\nfunction effectiveOptionValue(override, value) {\r\n    if (override === 1 /* True */) {\r\n        return true;\r\n    }\r\n    if (override === 2 /* False */) {\r\n        return false;\r\n    }\r\n    return value;\r\n}\r\nvar FindReplaceState = /** @class */ (function (_super) {\r\n    __extends(FindReplaceState, _super);\r\n    function FindReplaceState() {\r\n        var _this = _super.call(this) || this;\r\n        _this._onFindReplaceStateChange = _this._register(new Emitter());\r\n        _this.onFindReplaceStateChange = _this._onFindReplaceStateChange.event;\r\n        _this._searchString = '';\r\n        _this._replaceString = '';\r\n        _this._isRevealed = false;\r\n        _this._isReplaceRevealed = false;\r\n        _this._isRegex = false;\r\n        _this._isRegexOverride = 0 /* NotSet */;\r\n        _this._wholeWord = false;\r\n        _this._wholeWordOverride = 0 /* NotSet */;\r\n        _this._matchCase = false;\r\n        _this._matchCaseOverride = 0 /* NotSet */;\r\n        _this._preserveCase = false;\r\n        _this._preserveCaseOverride = 0 /* NotSet */;\r\n        _this._searchScope = null;\r\n        _this._matchesPosition = 0;\r\n        _this._matchesCount = 0;\r\n        _this._currentMatch = null;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(FindReplaceState.prototype, \"searchString\", {\r\n        get: function () { return this._searchString; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"replaceString\", {\r\n        get: function () { return this._replaceString; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"isRevealed\", {\r\n        get: function () { return this._isRevealed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"isReplaceRevealed\", {\r\n        get: function () { return this._isReplaceRevealed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"isRegex\", {\r\n        get: function () { return effectiveOptionValue(this._isRegexOverride, this._isRegex); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"wholeWord\", {\r\n        get: function () { return effectiveOptionValue(this._wholeWordOverride, this._wholeWord); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"matchCase\", {\r\n        get: function () { return effectiveOptionValue(this._matchCaseOverride, this._matchCase); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"preserveCase\", {\r\n        get: function () { return effectiveOptionValue(this._preserveCaseOverride, this._preserveCase); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"actualIsRegex\", {\r\n        get: function () { return this._isRegex; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"actualWholeWord\", {\r\n        get: function () { return this._wholeWord; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"actualMatchCase\", {\r\n        get: function () { return this._matchCase; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"actualPreserveCase\", {\r\n        get: function () { return this._preserveCase; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"searchScope\", {\r\n        get: function () { return this._searchScope; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"matchesPosition\", {\r\n        get: function () { return this._matchesPosition; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"matchesCount\", {\r\n        get: function () { return this._matchesCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FindReplaceState.prototype, \"currentMatch\", {\r\n        get: function () { return this._currentMatch; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    FindReplaceState.prototype.changeMatchInfo = function (matchesPosition, matchesCount, currentMatch) {\r\n        var changeEvent = {\r\n            moveCursor: false,\r\n            updateHistory: false,\r\n            searchString: false,\r\n            replaceString: false,\r\n            isRevealed: false,\r\n            isReplaceRevealed: false,\r\n            isRegex: false,\r\n            wholeWord: false,\r\n            matchCase: false,\r\n            preserveCase: false,\r\n            searchScope: false,\r\n            matchesPosition: false,\r\n            matchesCount: false,\r\n            currentMatch: false\r\n        };\r\n        var somethingChanged = false;\r\n        if (matchesCount === 0) {\r\n            matchesPosition = 0;\r\n        }\r\n        if (matchesPosition > matchesCount) {\r\n            matchesPosition = matchesCount;\r\n        }\r\n        if (this._matchesPosition !== matchesPosition) {\r\n            this._matchesPosition = matchesPosition;\r\n            changeEvent.matchesPosition = true;\r\n            somethingChanged = true;\r\n        }\r\n        if (this._matchesCount !== matchesCount) {\r\n            this._matchesCount = matchesCount;\r\n            changeEvent.matchesCount = true;\r\n            somethingChanged = true;\r\n        }\r\n        if (typeof currentMatch !== 'undefined') {\r\n            if (!Range.equalsRange(this._currentMatch, currentMatch)) {\r\n                this._currentMatch = currentMatch;\r\n                changeEvent.currentMatch = true;\r\n                somethingChanged = true;\r\n            }\r\n        }\r\n        if (somethingChanged) {\r\n            this._onFindReplaceStateChange.fire(changeEvent);\r\n        }\r\n    };\r\n    FindReplaceState.prototype.change = function (newState, moveCursor, updateHistory) {\r\n        if (updateHistory === void 0) { updateHistory = true; }\r\n        var changeEvent = {\r\n            moveCursor: moveCursor,\r\n            updateHistory: updateHistory,\r\n            searchString: false,\r\n            replaceString: false,\r\n            isRevealed: false,\r\n            isReplaceRevealed: false,\r\n            isRegex: false,\r\n            wholeWord: false,\r\n            matchCase: false,\r\n            preserveCase: false,\r\n            searchScope: false,\r\n            matchesPosition: false,\r\n            matchesCount: false,\r\n            currentMatch: false\r\n        };\r\n        var somethingChanged = false;\r\n        var oldEffectiveIsRegex = this.isRegex;\r\n        var oldEffectiveWholeWords = this.wholeWord;\r\n        var oldEffectiveMatchCase = this.matchCase;\r\n        var oldEffectivePreserveCase = this.preserveCase;\r\n        if (typeof newState.searchString !== 'undefined') {\r\n            if (this._searchString !== newState.searchString) {\r\n                this._searchString = newState.searchString;\r\n                changeEvent.searchString = true;\r\n                somethingChanged = true;\r\n            }\r\n        }\r\n        if (typeof newState.replaceString !== 'undefined') {\r\n            if (this._replaceString !== newState.replaceString) {\r\n                this._replaceString = newState.replaceString;\r\n                changeEvent.replaceString = true;\r\n                somethingChanged = true;\r\n            }\r\n        }\r\n        if (typeof newState.isRevealed !== 'undefined') {\r\n            if (this._isRevealed !== newState.isRevealed) {\r\n                this._isRevealed = newState.isRevealed;\r\n                changeEvent.isRevealed = true;\r\n                somethingChanged = true;\r\n            }\r\n        }\r\n        if (typeof newState.isReplaceRevealed !== 'undefined') {\r\n            if (this._isReplaceRevealed !== newState.isReplaceRevealed) {\r\n                this._isReplaceRevealed = newState.isReplaceRevealed;\r\n                changeEvent.isReplaceRevealed = true;\r\n                somethingChanged = true;\r\n            }\r\n        }\r\n        if (typeof newState.isRegex !== 'undefined') {\r\n            this._isRegex = newState.isRegex;\r\n        }\r\n        if (typeof newState.wholeWord !== 'undefined') {\r\n            this._wholeWord = newState.wholeWord;\r\n        }\r\n        if (typeof newState.matchCase !== 'undefined') {\r\n            this._matchCase = newState.matchCase;\r\n        }\r\n        if (typeof newState.preserveCase !== 'undefined') {\r\n            this._preserveCase = newState.preserveCase;\r\n        }\r\n        if (typeof newState.searchScope !== 'undefined') {\r\n            if (!Range.equalsRange(this._searchScope, newState.searchScope)) {\r\n                this._searchScope = newState.searchScope;\r\n                changeEvent.searchScope = true;\r\n                somethingChanged = true;\r\n            }\r\n        }\r\n        // Overrides get set when they explicitly come in and get reset anytime something else changes\r\n        this._isRegexOverride = (typeof newState.isRegexOverride !== 'undefined' ? newState.isRegexOverride : 0 /* NotSet */);\r\n        this._wholeWordOverride = (typeof newState.wholeWordOverride !== 'undefined' ? newState.wholeWordOverride : 0 /* NotSet */);\r\n        this._matchCaseOverride = (typeof newState.matchCaseOverride !== 'undefined' ? newState.matchCaseOverride : 0 /* NotSet */);\r\n        this._preserveCaseOverride = (typeof newState.preserveCaseOverride !== 'undefined' ? newState.preserveCaseOverride : 0 /* NotSet */);\r\n        if (oldEffectiveIsRegex !== this.isRegex) {\r\n            somethingChanged = true;\r\n            changeEvent.isRegex = true;\r\n        }\r\n        if (oldEffectiveWholeWords !== this.wholeWord) {\r\n            somethingChanged = true;\r\n            changeEvent.wholeWord = true;\r\n        }\r\n        if (oldEffectiveMatchCase !== this.matchCase) {\r\n            somethingChanged = true;\r\n            changeEvent.matchCase = true;\r\n        }\r\n        if (oldEffectivePreserveCase !== this.preserveCase) {\r\n            somethingChanged = true;\r\n            changeEvent.preserveCase = true;\r\n        }\r\n        if (somethingChanged) {\r\n            this._onFindReplaceStateChange.fire(changeEvent);\r\n        }\r\n    };\r\n    return FindReplaceState;\r\n}(Disposable));\r\nexport { FindReplaceState };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Range } from '../../common/core/range.js';\r\nvar ReplaceAllCommand = /** @class */ (function () {\r\n    function ReplaceAllCommand(editorSelection, ranges, replaceStrings) {\r\n        this._editorSelection = editorSelection;\r\n        this._ranges = ranges;\r\n        this._replaceStrings = replaceStrings;\r\n        this._trackedEditorSelectionId = null;\r\n    }\r\n    ReplaceAllCommand.prototype.getEditOperations = function (model, builder) {\r\n        if (this._ranges.length > 0) {\r\n            // Collect all edit operations\r\n            var ops = [];\r\n            for (var i = 0; i < this._ranges.length; i++) {\r\n                ops.push({\r\n                    range: this._ranges[i],\r\n                    text: this._replaceStrings[i]\r\n                });\r\n            }\r\n            // Sort them in ascending order by range starts\r\n            ops.sort(function (o1, o2) {\r\n                return Range.compareRangesUsingStarts(o1.range, o2.range);\r\n            });\r\n            // Merge operations that touch each other\r\n            var resultOps = [];\r\n            var previousOp = ops[0];\r\n            for (var i = 1; i < ops.length; i++) {\r\n                if (previousOp.range.endLineNumber === ops[i].range.startLineNumber && previousOp.range.endColumn === ops[i].range.startColumn) {\r\n                    // These operations are one after another and can be merged\r\n                    previousOp.range = previousOp.range.plusRange(ops[i].range);\r\n                    previousOp.text = previousOp.text + ops[i].text;\r\n                }\r\n                else {\r\n                    resultOps.push(previousOp);\r\n                    previousOp = ops[i];\r\n                }\r\n            }\r\n            resultOps.push(previousOp);\r\n            for (var _i = 0, resultOps_1 = resultOps; _i < resultOps_1.length; _i++) {\r\n                var op = resultOps_1[_i];\r\n                builder.addEditOperation(op.range, op.text);\r\n            }\r\n        }\r\n        this._trackedEditorSelectionId = builder.trackSelection(this._editorSelection);\r\n    };\r\n    ReplaceAllCommand.prototype.computeCursorState = function (model, helper) {\r\n        return helper.getTrackedSelection(this._trackedEditorSelectionId);\r\n    };\r\n    return ReplaceAllCommand;\r\n}());\r\nexport { ReplaceAllCommand };\r\n"],"sourceRoot":""}